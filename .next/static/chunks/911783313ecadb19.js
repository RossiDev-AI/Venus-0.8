(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31713,e=>{"use strict";let t,n,i,l,r,a,s;var o,c,d,u,p,m,h,g,f,x,b,y,v,_,N,w,E,j,S,I,A,C,T,k,O,R,P,M,D,U,L,z,G,F,q,H,V,B,$,J,W,Y,K,X,Z,Q,ee,et,en,ei,el,er,ea,es,eo,ec,ed,eu,ep,em,eh,eg,ef,ex,eb,ey,ev,e_,eN,ew,eE,ej,eS,eI,eA,eC,eT,ek,eO,eR,eP,eM,eD,eU,eL,ez,eG,eF,eq,eH,eV,eB,e$,eJ,eW,eY,eK,eX,eZ,eQ,e0,e1,e2,e5,e4,e3,e6,e8,e7,e9,te,tt,tn,ti,tl,tr=e.i(43476),ta=e.i(71645);let ts=({activeTab:e,setActiveTab:t})=>(0,tr.jsxs)("header",{className:"sticky top-0 z-[500] h-14 md:h-20 flex items-center justify-between px-4 md:px-12 bg-black/40 backdrop-blur-2xl border-b border-white/5",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-2 md:gap-4 shrink-0",children:[(0,tr.jsxs)("div",{className:"relative group cursor-pointer",onClick:()=>t("creation"),children:[(0,tr.jsx)("div",{className:"absolute inset-0 bg-indigo-600 rounded-lg blur-xl opacity-20 group-hover:opacity-40 transition-opacity animate-pulse"}),(0,tr.jsx)("div",{className:"relative w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-indigo-500 to-indigo-700 rounded-lg flex items-center justify-center shadow-2xl border border-white/10",children:(0,tr.jsx)("span",{className:"text-white font-black text-xs md:text-sm",children:"V"})})]}),(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsxs)("h1",{className:"text-sm md:text-xl font-black tracking-tighter uppercase leading-none text-white whitespace-nowrap",children:["Venus ",(0,tr.jsx)("span",{className:"text-indigo-500",children:"AI"})]}),(0,tr.jsx)("span",{className:"text-[7px] md:text-[10px] text-zinc-500 font-bold uppercase tracking-[0.2em] opacity-60 hidden sm:block",children:"Neural Studio v2.0"})]})]}),(0,tr.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[(0,tr.jsxs)("div",{className:"hidden sm:flex flex-col items-end mr-2",children:[(0,tr.jsx)("span",{className:"text-[6px] md:text-[8px] font-black text-indigo-500 uppercase tracking-widest",children:"System Load"}),(0,tr.jsx)("div",{className:"w-16 h-1 bg-white/5 rounded-full overflow-hidden mt-0.5",children:(0,tr.jsx)("div",{className:"h-full bg-indigo-500 animate-pulse",style:{width:"42%"}})})]}),(0,tr.jsx)("div",{className:"px-2 py-1 rounded-lg bg-emerald-500/10 border border-emerald-500/30 text-[7px] md:text-[9px] mono text-emerald-400 uppercase font-black",children:"Online"})]})]}),to=({id:e,label:t,icon:n,badge:i,activeTab:l,setActiveTab:r,isMobile:a})=>{let s=l===e;return(0,tr.jsxs)("button",{onClick:()=>r(e),className:`relative flex flex-col items-center justify-center md:flex-row gap-1 md:gap-3 px-1 md:px-5 py-2 rounded-xl md:rounded-full transition-all duration-500 group
        ${s?"text-white":"text-zinc-500 hover:text-zinc-300"}`,children:[s&&(0,tr.jsx)("div",{className:"absolute inset-0 bg-indigo-600/10 md:bg-indigo-600 rounded-xl md:rounded-full blur-[4px] md:blur-none opacity-80 md:opacity-100 animate-in fade-in zoom-in-95"}),(0,tr.jsxs)("div",{className:`relative flex flex-col md:flex-row items-center gap-1 md:gap-2 z-10 ${s&&!a&&"md:bg-indigo-600"}`,children:[(0,tr.jsx)("span",{className:`text-lg md:text-xl transition-transform duration-300 group-hover:scale-110 ${s?"text-white":"text-zinc-500 group-hover:text-indigo-400"}`,children:n}),(0,tr.jsx)("span",{className:"text-[7px] md:text-[10px] font-black uppercase tracking-widest whitespace-nowrap overflow-hidden max-w-[45px] md:max-w-none text-center",children:t}),void 0!==i&&i>0&&(0,tr.jsx)("span",{className:"absolute -top-1 -right-1 md:static md:ml-1 px-1 min-w-[12px] h-[12px] bg-indigo-500 text-white text-[6px] md:text-[8px] font-black rounded-full flex items-center justify-center",children:i>99?"99+":i})]})]})},tc=({activeTab:e,setActiveTab:t,vaultCount:n})=>{let i=[{id:"creation",label:"Criar",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 4v16m8-8H4",strokeWidth:2.5})})},{id:"workspace",label:"EstÃºdio",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10",strokeWidth:2.5})})},{id:"grading",label:"Cores",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343",strokeWidth:2.5})})},{id:"cinema",label:"Cinema",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z",strokeWidth:2.5})})},{id:"fusion",label:"Fusion",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M13 10V3L4 14h7v7l9-11h-7z",strokeWidth:2.5})})},{id:"manual",label:"Index",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z",strokeWidth:2.5})})},{id:"vault",label:"Vault",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4",strokeWidth:2.5})}),badge:n},{id:"docs",label:"Docs",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253",strokeWidth:2.5})})},{id:"settings",label:"Config",icon:(0,tr.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,tr.jsx)("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z",strokeWidth:2.5}),(0,tr.jsx)("circle",{cx:"12",cy:"12",r:"3",strokeWidth:2.5})]})}];return(0,tr.jsxs)(tr.Fragment,{children:[(0,tr.jsx)("nav",{className:"hidden lg:flex items-center absolute top-[14px] left-1/2 -translate-x-1/2 z-[600] bg-zinc-900/60 backdrop-blur-3xl border border-white/10 p-1 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.5)] scale-90 xl:scale-100 origin-center",children:i.map(n=>(0,tr.jsx)(to,{...n,activeTab:e,setActiveTab:t},n.id))}),(0,tr.jsxs)("nav",{className:"lg:hidden fixed bottom-4 left-2 right-2 z-[500] bg-black/85 backdrop-blur-3xl border border-white/10 h-20 rounded-[2.5rem] flex items-center justify-around px-2 shadow-[0_20px_50px_rgba(0,0,0,0.9)]",children:[(0,tr.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-indigo-500/5 to-transparent pointer-events-none rounded-[2.5rem]"}),i.map(n=>(0,tr.jsx)(to,{...n,activeTab:e,setActiveTab:t,isMobile:!0},n.id))]})]})};var td=e.i(47167);class tu{}function tp(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function tm(e,t,n){for(let i=0;i<t.length-1;i++){let l=t[i];if(l.endsWith("[]")){let r=l.slice(0,-2);if(!(r in e))if(Array.isArray(n))e[r]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${l}`);if(Array.isArray(e[r])){let l=e[r];if(Array.isArray(n))for(let e=0;e<l.length;e++)tm(l[e],t.slice(i+1),n[e]);else for(let e of l)tm(e,t.slice(i+1),n)}return}if(l.endsWith("[0]")){let r=l.slice(0,-3);r in e||(e[r]=[{}]),tm(e[r][0],t.slice(i+1),n);return}e[l]&&"object"==typeof e[l]||(e[l]={}),e=e[l]}let i=t[t.length-1],l=e[i];if(void 0!==l){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===l)return;if("object"==typeof l&&"object"==typeof n&&null!==l&&null!==n)Object.assign(l,n);else throw Error(`Cannot set value for an existing key. Key: ${i}`)}else"_self"!==i||"object"!=typeof n||null===n||Array.isArray(n)?e[i]=n:Object.assign(e,n)}function th(e,t,n){try{if(1===t.length&&"_self"===t[0])return e;for(let i=0;i<t.length;i++){if("object"!=typeof e||null===e)return n;let l=t[i];if(l.endsWith("[]")){let r=l.slice(0,-2);if(!(r in e))return n;{let l=e[r];if(!Array.isArray(l))return n;return l.map(e=>th(e,t.slice(i+1),n))}}e=e[l]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function tg(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}function tf(e){var t;let n,i,l,r,a={},s=th(e,["name"]);null!=s&&tm(a,["name"],s);let o=th(e,["metadata"]);null!=o&&tm(a,["metadata"],o);let c=th(e,["done"]);null!=c&&tm(a,["done"],c);let d=th(e,["error"]);null!=d&&tm(a,["error"],d);let u=th(e,["response"]);return null!=u&&tm(a,["response"],(n={},null!=(i=th(t=u,["sdkHttpResponse"]))&&tm(n,["sdkHttpResponse"],i),null!=(l=th(t,["parent"]))&&tm(n,["parent"],l),null!=(r=th(t,["documentName"]))&&tm(n,["documentName"],r),n)),a}(o=eu||(eu={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(c=ep||(ep={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",c.PYTHON="PYTHON",(d=em||(em={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",d.SILENT="SILENT",d.WHEN_IDLE="WHEN_IDLE",d.INTERRUPT="INTERRUPT",(u=eh||(eh={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",u.STRING="STRING",u.NUMBER="NUMBER",u.INTEGER="INTEGER",u.BOOLEAN="BOOLEAN",u.ARRAY="ARRAY",u.OBJECT="OBJECT",u.NULL="NULL",(p=eg||(eg={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",p.SIMPLE_SEARCH="SIMPLE_SEARCH",p.ELASTIC_SEARCH="ELASTIC_SEARCH",(m=ef||(ef={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",m.NO_AUTH="NO_AUTH",m.API_KEY_AUTH="API_KEY_AUTH",m.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",m.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",m.OAUTH="OAUTH",m.OIDC_AUTH="OIDC_AUTH",(h=ex||(ex={})).HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",h.HTTP_IN_QUERY="HTTP_IN_QUERY",h.HTTP_IN_HEADER="HTTP_IN_HEADER",h.HTTP_IN_PATH="HTTP_IN_PATH",h.HTTP_IN_BODY="HTTP_IN_BODY",h.HTTP_IN_COOKIE="HTTP_IN_COOKIE",(g=eb||(eb={})).PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",g.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",g.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",g.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",g.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",g.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",g.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH",(f=ey||(ey={})).UNSPECIFIED="UNSPECIFIED",f.BLOCKING="BLOCKING",f.NON_BLOCKING="NON_BLOCKING",(x=ev||(ev={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",x.MODE_DYNAMIC="MODE_DYNAMIC",(b=e_||(e_={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",b.AUTO="AUTO",b.ANY="ANY",b.NONE="NONE",b.VALIDATED="VALIDATED",(y=eN||(eN={})).THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",y.LOW="LOW",y.MEDIUM="MEDIUM",y.HIGH="HIGH",y.MINIMAL="MINIMAL",(v=ew||(ew={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",v.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",v.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",v.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",v.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",v.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",v.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",v.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",v.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",v.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",v.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(_=eE||(eE={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",_.SEVERITY="SEVERITY",_.PROBABILITY="PROBABILITY",(N=ej||(ej={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",N.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",N.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",N.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",N.BLOCK_NONE="BLOCK_NONE",N.OFF="OFF",(w=eS||(eS={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",w.STOP="STOP",w.MAX_TOKENS="MAX_TOKENS",w.SAFETY="SAFETY",w.RECITATION="RECITATION",w.LANGUAGE="LANGUAGE",w.OTHER="OTHER",w.BLOCKLIST="BLOCKLIST",w.PROHIBITED_CONTENT="PROHIBITED_CONTENT",w.SPII="SPII",w.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",w.IMAGE_SAFETY="IMAGE_SAFETY",w.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",w.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",w.NO_IMAGE="NO_IMAGE",w.IMAGE_RECITATION="IMAGE_RECITATION",w.IMAGE_OTHER="IMAGE_OTHER",(E=eI||(eI={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",E.NEGLIGIBLE="NEGLIGIBLE",E.LOW="LOW",E.MEDIUM="MEDIUM",E.HIGH="HIGH",(j=eA||(eA={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",j.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",j.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",j.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",j.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(S=eC||(eC={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",S.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",S.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",S.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",S.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(I=eT||(eT={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",I.SAFETY="SAFETY",I.OTHER="OTHER",I.BLOCKLIST="BLOCKLIST",I.PROHIBITED_CONTENT="PROHIBITED_CONTENT",I.IMAGE_SAFETY="IMAGE_SAFETY",I.MODEL_ARMOR="MODEL_ARMOR",I.JAILBREAK="JAILBREAK",(A=ek||(ek={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",A.ON_DEMAND="ON_DEMAND",A.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(C=eO||(eO={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",C.TEXT="TEXT",C.IMAGE="IMAGE",C.AUDIO="AUDIO",(T=eR||(eR={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",T.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",T.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",T.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(k=eP||(eP={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",k.TUNING_MODE_FULL="TUNING_MODE_FULL",k.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(O=eM||(eM={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",O.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",O.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",O.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",O.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",O.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",O.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(R=eD||(eD={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",R.JOB_STATE_QUEUED="JOB_STATE_QUEUED",R.JOB_STATE_PENDING="JOB_STATE_PENDING",R.JOB_STATE_RUNNING="JOB_STATE_RUNNING",R.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",R.JOB_STATE_FAILED="JOB_STATE_FAILED",R.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",R.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",R.JOB_STATE_PAUSED="JOB_STATE_PAUSED",R.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",R.JOB_STATE_UPDATING="JOB_STATE_UPDATING",R.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(P=eU||(eU={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",P.TUNING_TASK_I2V="TUNING_TASK_I2V",P.TUNING_TASK_T2V="TUNING_TASK_T2V",P.TUNING_TASK_R2V="TUNING_TASK_R2V",(M=eL||(eL={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",M.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",M.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",M.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",M.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH",(ez||(ez={})).COLLECTION="COLLECTION",(D=eG||(eG={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",D.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",D.BALANCED="BALANCED",D.PRIORITIZE_COST="PRIORITIZE_COST",(U=eF||(eF={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",U.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(L=eq||(eq={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",L.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",L.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",L.BLOCK_NONE="BLOCK_NONE",(z=eH||(eH={})).DONT_ALLOW="DONT_ALLOW",z.ALLOW_ADULT="ALLOW_ADULT",z.ALLOW_ALL="ALLOW_ALL",(G=eV||(eV={})).auto="auto",G.en="en",G.ja="ja",G.ko="ko",G.hi="hi",G.zh="zh",G.pt="pt",G.es="es",(F=eB||(eB={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",F.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",F.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",F.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",F.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(q=e$||(e$={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",q.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",q.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",q.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(H=eJ||(eJ={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",H.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",H.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",H.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(V=eW||(eW={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",V.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",V.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",V.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",V.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",V.EDIT_MODE_STYLE="EDIT_MODE_STYLE",V.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",V.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(B=eY||(eY={})).FOREGROUND="FOREGROUND",B.BACKGROUND="BACKGROUND",B.PROMPT="PROMPT",B.SEMANTIC="SEMANTIC",B.INTERACTIVE="INTERACTIVE",($=eK||(eK={})).ASSET="ASSET",$.STYLE="STYLE",(J=eX||(eX={})).INSERT="INSERT",J.REMOVE="REMOVE",J.REMOVE_STATIC="REMOVE_STATIC",J.OUTPAINT="OUTPAINT",(W=eZ||(eZ={})).OPTIMIZED="OPTIMIZED",W.LOSSLESS="LOSSLESS",(Y=eQ||(eQ={})).SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",Y.PREFERENCE_TUNING="PREFERENCE_TUNING",(K=e0||(e0={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",K.STATE_PENDING="STATE_PENDING",K.STATE_ACTIVE="STATE_ACTIVE",K.STATE_FAILED="STATE_FAILED",(X=e1||(e1={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",X.PROCESSING="PROCESSING",X.ACTIVE="ACTIVE",X.FAILED="FAILED",(Z=e2||(e2={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",Z.UPLOADED="UPLOADED",Z.GENERATED="GENERATED",Z.REGISTERED="REGISTERED",(Q=e5||(e5={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",Q.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",Q.RESPONSE_REJECTED="RESPONSE_REJECTED",Q.NEED_MORE_INPUT="NEED_MORE_INPUT",(ee=e4||(e4={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",ee.TEXT="TEXT",ee.IMAGE="IMAGE",ee.VIDEO="VIDEO",ee.AUDIO="AUDIO",ee.DOCUMENT="DOCUMENT",(et=e3||(e3={})).VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",et.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",et.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS",(en=e6||(e6={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",en.ACTIVITY_START="ACTIVITY_START",en.ACTIVITY_END="ACTIVITY_END",(ei=e8||(e8={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",ei.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",ei.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(el=e7||(e7={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",el.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",el.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(er=e9||(e9={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",er.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",er.NO_INTERRUPTION="NO_INTERRUPTION",(ea=te||(te={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",ea.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",ea.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(es=tt||(tt={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",es.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",es.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",es.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",es.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",es.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",es.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",es.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",es.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",es.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",es.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",es.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",es.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(eo=tn||(tn={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",eo.QUALITY="QUALITY",eo.DIVERSITY="DIVERSITY",eo.VOCALIZATION="VOCALIZATION",(ec=ti||(ti={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",ec.PLAY="PLAY",ec.PAUSE="PAUSE",ec.STOP="STOP",ec.RESET_CONTEXT="RESET_CONTEXT";class tx{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class tb{get text(){var e,t,n,i,l,r,a,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let o="",c=!1,d=[];for(let e of null!=(s=null==(a=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:a.parts)?s:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&"thoughtSignature"!==t&&(null!==n||void 0!==n)&&d.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;c=!0,o+=e.text}}return d.length>0&&console.warn(`there are non-text parts ${d} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),c?o:void 0}get data(){var e,t,n,i,l,r,a,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let o="",c=[];for(let e of null!=(s=null==(a=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:a.parts)?s:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&c.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(o+=atob(e.inlineData.data))}return c.length>0&&console.warn(`there are non-data parts ${c} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}get functionCalls(){var e,t,n,i,l,r,a,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let o=null==(s=null==(a=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:a.parts)?void 0:s.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==o?void 0:o.length)!==0)return o}get executableCode(){var e,t,n,i,l,r,a,s,o;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let c=null==(s=null==(a=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:a.parts)?void 0:s.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==c?void 0:c.length)!==0)return null==(o=null==c?void 0:c[0])?void 0:o.code}get codeExecutionResult(){var e,t,n,i,l,r,a,s,o;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let c=null==(s=null==(a=null==(r=null==(l=this.candidates)?void 0:l[0])?void 0:r.content)?void 0:a.parts)?void 0:s.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==c?void 0:c.length)!==0)return null==(o=null==c?void 0:c[0])?void 0:o.output}}class ty{}class tv{}class t_{}class tN{}class tw{}class tE{}class tj{}class tS{}class tI{}class tA{}class tC{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n,i=new tC;if(t){let t,i,l,r,a,s;t={},null!=(i=th(e,["name"]))&&tm(t,["name"],i),null!=(l=th(e,["metadata"]))&&tm(t,["metadata"],l),null!=(r=th(e,["done"]))&&tm(t,["done"],r),null!=(a=th(e,["error"]))&&tm(t,["error"],a),null!=(s=th(e,["response"]))&&tm(t,["response"],function(e){let t={},n=th(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s;return n={},null!=(i=th(e,["_self"]))&&tm(n,["video"],(l={},null!=(r=th(t=i,["gcsUri"]))&&tm(l,["uri"],r),null!=(a=th(t,["bytesBase64Encoded"]))&&tm(l,["videoBytes"],tg(a)),null!=(s=th(t,["mimeType"]))&&tm(l,["mimeType"],s),l)),n})),tm(t,["generatedVideos"],e)}let i=th(e,["raiMediaFilteredCount"]);null!=i&&tm(t,["raiMediaFilteredCount"],i);let l=th(e,["raiMediaFilteredReasons"]);return null!=l&&tm(t,["raiMediaFilteredReasons"],l),t}(s)),n=t}else{let t,i,l,r,a,s;t={},null!=(i=th(e,["name"]))&&tm(t,["name"],i),null!=(l=th(e,["metadata"]))&&tm(t,["metadata"],l),null!=(r=th(e,["done"]))&&tm(t,["done"],r),null!=(a=th(e,["error"]))&&tm(t,["error"],a),null!=(s=th(e,["response","generateVideoResponse"]))&&tm(t,["response"],function(e){let t={},n=th(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s;return n={},null!=(i=th(e,["video"]))&&tm(n,["video"],(l={},null!=(r=th(t=i,["uri"]))&&tm(l,["uri"],r),null!=(a=th(t,["encodedVideo"]))&&tm(l,["videoBytes"],tg(a)),null!=(s=th(t,["encoding"]))&&tm(l,["mimeType"],s),l)),n})),tm(t,["generatedVideos"],e)}let i=th(e,["raiMediaFilteredCount"]);null!=i&&tm(t,["raiMediaFilteredCount"],i);let l=th(e,["raiMediaFilteredReasons"]);return null!=l&&tm(t,["raiMediaFilteredReasons"],l),t}(s)),n=t}return Object.assign(i,n),i}}class tT{}class tk{}class tO{}class tR{}class tP{}class tM{}class tD{}class tU{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){var n;let i,l,r,a,s,o,c,d,u,p,m=new tU;return Object.assign(m,(s={},null!=(o=th(e,["name"]))&&tm(s,["name"],o),null!=(c=th(e,["metadata"]))&&tm(s,["metadata"],c),null!=(d=th(e,["done"]))&&tm(s,["done"],d),null!=(u=th(e,["error"]))&&tm(s,["error"],u),null!=(p=th(e,["response"]))&&tm(s,["response"],(i={},null!=(l=th(n=p,["sdkHttpResponse"]))&&tm(i,["sdkHttpResponse"],l),null!=(r=th(n,["parent"]))&&tm(i,["parent"],r),null!=(a=th(n,["documentName"]))&&tm(i,["documentName"],a),i)),s)),m}}class tL{}class tz{}class tG{}class tF{}class tq{get text(){var e,t,n;let i="",l=!1,r=[];for(let a of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(a))"text"!==e&&"thought"!==e&&null!==t&&r.push(e);if("string"==typeof a.text){if("boolean"==typeof a.thought&&a.thought)continue;l=!0,i+=a.text}}return r.length>0&&console.warn(`there are non-text parts ${r} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?i:void 0}get data(){var e,t,n;let i="",l=[];for(let r of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(r))"inlineData"!==e&&null!==t&&l.push(e);r.inlineData&&"string"==typeof r.inlineData.data&&(i+=atob(r.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class tH{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class tV{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new tV;return Object.assign(n,tf(e)),n}}function tB(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw Error("invalid model parameter");if(e.isVertexAI())if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;else{if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function t$(e,t){let n=tB(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function tJ(e){return Array.isArray(e)?e.map(e=>tW(e)):[tW(e)]}function tW(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function tY(e){let t=tW(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tK(e){let t=tW(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tX(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function tZ(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>tX(e)):[tX(e)]}function tQ(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function t0(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function t1(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function t2(e){if(null==e)throw Error("ContentUnion is required");return tQ(e)?e:{role:"user",parts:tZ(e)}}function t5(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=t2(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=t2(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>t2(e)):[t2(t)]}function t4(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(t0(e)||t1(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[t2(e)]}let t=[],n=[],i=tQ(e[0]);for(let l of e){let e=tQ(l);if(e!=i)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(l);else if(t0(l)||t1(l))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else n.push(l)}return i||t.push({role:"user",parts:tZ(n)}),t}function t3(e){let t={},n=["items"],i=["anyOf"],l=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let r=e.anyOf;for(let[a,s]of(null!=r&&2==r.length&&("null"===r[0].type?(t.nullable=!0,e=r[1]):"null"===r[1].type&&(t.nullable=!0,e=r[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(eh).includes(n[0].toUpperCase())?n[0].toUpperCase():eh.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(eh).includes(e.toUpperCase())?e.toUpperCase():eh.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=s)if("type"==a){if("null"===s)throw Error("type: null can not be the only possible type for the field.");if(s instanceof Array)continue;t.type=Object.values(eh).includes(s.toUpperCase())?s.toUpperCase():eh.TYPE_UNSPECIFIED}else if(n.includes(a))t[a]=t3(s);else if(i.includes(a)){let e=[];for(let n of s){if("null"==n.type){t.nullable=!0;continue}e.push(t3(n))}t[a]=e}else if(l.includes(a)){let e={};for(let[t,n]of Object.entries(s))e[t]=t3(n);t[a]=e}else{if("additionalProperties"===a)continue;t[a]=s}return t}function t6(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function t8(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function t7(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=t3(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=t3(t.response));return e}function t9(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let n of e)t.push(n);return t}function ne(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,i=1){let l=!t.startsWith(`${n}/`)&&t.split("/").length===i;if(e.isVertexAI())if(t.startsWith("projects/"))return t;else if(t.startsWith("locations/"))return`projects/${e.getProject()}/${t}`;else if(t.startsWith(`${n}/`))return`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`;else if(l)return`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`;else return t;return l?`${n}/${t}`:t}(e,t,"cachedContents")}function nt(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function nn(e){var t;let n;if(null!=e&&"object"==typeof e&&"name"in e&&(n=e.name),null==e||"object"!=typeof e||!("uri"in e)||void 0!==(n=e.uri)){if(null==e||"object"!=typeof e||!("video"in e)||void 0!==(n=null==(t=e.video)?void 0:t.uri)){if("string"==typeof e&&(n=e),void 0===n)throw Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}}function ni(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function nl(e){for(let i of["models","tunedModels","publisherModels"]){var t,n;if(t=e,n=i,null!==t&&"object"==typeof t&&n in t)return e[i]}return[]}function nr(e,t){let n;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;let i=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,l=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(l>0||1!==i)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||1!==l)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function na(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let n=t.inlinedResponses;if(!Array.isArray(n)||0===n.length)return e;let i=!1;for(let e of n){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function ns(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function no(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";else if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";else if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function nc(e){let t={},n=th(e,["name"]);null!=n&&tm(t,["name"],n);let i=th(e,["metadata","displayName"]);null!=i&&tm(t,["displayName"],i);let l=th(e,["metadata","state"]);null!=l&&tm(t,["state"],no(l));let r=th(e,["metadata","createTime"]);null!=r&&tm(t,["createTime"],r);let a=th(e,["metadata","endTime"]);null!=a&&tm(t,["endTime"],a);let s=th(e,["metadata","updateTime"]);null!=s&&tm(t,["updateTime"],s);let o=th(e,["metadata","model"]);null!=o&&tm(t,["model"],o);let c=th(e,["metadata","output"]);return null!=c&&tm(t,["dest"],function(e){let t={},n=th(e,["responsesFile"]);null!=n&&tm(t,["fileName"],n);let i=th(e,["inlinedResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l;return n={},null!=(i=th(t=e,["response"]))&&tm(n,["response"],function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["content"]);null!=n&&tm(t,["content"],n);let i=th(e,["citationMetadata"]);null!=i&&tm(t,["citationMetadata"],function(e){let t={},n=th(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["citations"],e)}return t}(i));let l=th(e,["tokenCount"]);null!=l&&tm(t,["tokenCount"],l);let r=th(e,["finishReason"]);null!=r&&tm(t,["finishReason"],r);let a=th(e,["avgLogprobs"]);null!=a&&tm(t,["avgLogprobs"],a);let s=th(e,["groundingMetadata"]);null!=s&&tm(t,["groundingMetadata"],s);let o=th(e,["index"]);null!=o&&tm(t,["index"],o);let c=th(e,["logprobsResult"]);null!=c&&tm(t,["logprobsResult"],c);let d=th(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["safetyRatings"],e)}let u=th(e,["urlContextMetadata"]);return null!=u&&tm(t,["urlContextMetadata"],u),t})(e))),tm(t,["candidates"],e)}let l=th(e,["modelVersion"]);null!=l&&tm(t,["modelVersion"],l);let r=th(e,["promptFeedback"]);null!=r&&tm(t,["promptFeedback"],r);let a=th(e,["responseId"]);null!=a&&tm(t,["responseId"],a);let s=th(e,["usageMetadata"]);return null!=s&&tm(t,["usageMetadata"],s),t}(i)),null!=(l=th(t,["error"]))&&tm(n,["error"],l),n})),tm(t,["inlinedResponses"],e)}let l=th(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["inlinedEmbedContentResponses"],e)}return t}(na(c))),t}function nd(e){var t,n;let i,l,r,a,s,o,c,d,u={},p=th(e,["name"]);null!=p&&tm(u,["name"],p);let m=th(e,["displayName"]);null!=m&&tm(u,["displayName"],m);let h=th(e,["state"]);null!=h&&tm(u,["state"],no(h));let g=th(e,["error"]);null!=g&&tm(u,["error"],g);let f=th(e,["createTime"]);null!=f&&tm(u,["createTime"],f);let x=th(e,["startTime"]);null!=x&&tm(u,["startTime"],x);let b=th(e,["endTime"]);null!=b&&tm(u,["endTime"],b);let y=th(e,["updateTime"]);null!=y&&tm(u,["updateTime"],y);let v=th(e,["model"]);null!=v&&tm(u,["model"],v);let _=th(e,["inputConfig"]);null!=_&&tm(u,["src"],(i={},null!=(l=th(n=_,["instancesFormat"]))&&tm(i,["format"],l),null!=(r=th(n,["gcsSource","uris"]))&&tm(i,["gcsUri"],r),null!=(a=th(n,["bigquerySource","inputUri"]))&&tm(i,["bigqueryUri"],a),i));let N=th(e,["outputConfig"]);null!=N&&tm(u,["dest"],(t=na(N),s={},null!=(o=th(t,["predictionsFormat"]))&&tm(s,["format"],o),null!=(c=th(t,["gcsDestination","outputUriPrefix"]))&&tm(s,["gcsUri"],c),null!=(d=th(t,["bigqueryDestination","outputUri"]))&&tm(s,["bigqueryUri"],d),s));let w=th(e,["completionStats"]);return null!=w&&tm(u,["completionStats"],w),u}function nu(e){let t={},n=th(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s,o,c,d,u,p,m;return n={},null!=(i=th(t=e,["mediaResolution"]))&&tm(n,["mediaResolution"],i),null!=(l=th(t,["codeExecutionResult"]))&&tm(n,["codeExecutionResult"],l),null!=(r=th(t,["executableCode"]))&&tm(n,["executableCode"],r),null!=(a=th(t,["fileData"]))&&tm(n,["fileData"],function(e){let t={};if(void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=th(e,["fileUri"]);null!=n&&tm(t,["fileUri"],n);let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(a)),null!=(s=th(t,["functionCall"]))&&tm(n,["functionCall"],function(e){let t={},n=th(e,["id"]);null!=n&&tm(t,["id"],n);let i=th(e,["args"]);null!=i&&tm(t,["args"],i);let l=th(e,["name"]);if(null!=l&&tm(t,["name"],l),void 0!==th(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==th(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s)),null!=(o=th(t,["functionResponse"]))&&tm(n,["functionResponse"],o),null!=(c=th(t,["inlineData"]))&&tm(n,["inlineData"],function(e){let t={},n=th(e,["data"]);if(null!=n&&tm(t,["data"],n),void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(c)),null!=(d=th(t,["text"]))&&tm(n,["text"],d),null!=(u=th(t,["thought"]))&&tm(n,["thought"],u),null!=(p=th(t,["thoughtSignature"]))&&tm(n,["thoughtSignature"],p),null!=(m=th(t,["videoMetadata"]))&&tm(n,["videoMetadata"],m),n})),tm(t,["parts"],e)}let i=th(e,["role"]);return null!=i&&tm(t,["role"],i),t}function np(e,t){let n={},i=th(t,["model"]);null!=i&&tm(n,["_url","model"],tB(e,i));let l=th(t,["src"]);null!=l&&tm(n,["batch","inputConfig"],function(e,t){let n={};if(void 0!==th(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==th(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==th(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let i=th(t,["fileName"]);null!=i&&tm(n,["fileName"],i);let l=th(t,["inlinedRequests"]);if(null!=l){let t=l;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},i=th(t,["model"]);null!=i&&tm(n,["request","model"],tB(e,i));let l=th(t,["contents"]);if(null!=l){let e=t4(l);Array.isArray(e)&&(e=e.map(e=>nu(e))),tm(n,["request","contents"],e)}let r=th(t,["metadata"]);null!=r&&tm(n,["metadata"],r);let a=th(t,["config"]);return null!=a&&tm(n,["request","generationConfig"],function(e,t,n){var i;let l,r,a,s={},o=th(t,["systemInstruction"]);void 0!==n&&null!=o&&tm(n,["systemInstruction"],nu(t2(o)));let c=th(t,["temperature"]);null!=c&&tm(s,["temperature"],c);let d=th(t,["topP"]);null!=d&&tm(s,["topP"],d);let u=th(t,["topK"]);null!=u&&tm(s,["topK"],u);let p=th(t,["candidateCount"]);null!=p&&tm(s,["candidateCount"],p);let m=th(t,["maxOutputTokens"]);null!=m&&tm(s,["maxOutputTokens"],m);let h=th(t,["stopSequences"]);null!=h&&tm(s,["stopSequences"],h);let g=th(t,["responseLogprobs"]);null!=g&&tm(s,["responseLogprobs"],g);let f=th(t,["logprobs"]);null!=f&&tm(s,["logprobs"],f);let x=th(t,["presencePenalty"]);null!=x&&tm(s,["presencePenalty"],x);let b=th(t,["frequencyPenalty"]);null!=b&&tm(s,["frequencyPenalty"],b);let y=th(t,["seed"]);null!=y&&tm(s,["seed"],y);let v=th(t,["responseMimeType"]);null!=v&&tm(s,["responseMimeType"],v);let _=th(t,["responseSchema"]);null!=_&&tm(s,["responseSchema"],t3(_));let N=th(t,["responseJsonSchema"]);if(null!=N&&tm(s,["responseJsonSchema"],N),void 0!==th(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==th(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let w=th(t,["safetySettings"]);if(void 0!==n&&null!=w){let e=w;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["category"]);if(null!=n&&tm(t,["category"],n),void 0!==th(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let i=th(e,["threshold"]);return null!=i&&tm(t,["threshold"],i),t})(e))),tm(n,["safetySettings"],e)}let E=th(t,["tools"]);if(void 0!==n&&null!=E){let e=t9(E);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==th(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=th(e,["computerUse"]);null!=n&&tm(t,["computerUse"],n);let i=th(e,["fileSearch"]);null!=i&&tm(t,["fileSearch"],i);let l=th(e,["codeExecution"]);if(null!=l&&tm(t,["codeExecution"],l),void 0!==th(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let r=th(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["functionDeclarations"],e)}let a=th(e,["googleMaps"]);null!=a&&tm(t,["googleMaps"],function(e){let t={};if(void 0!==th(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=th(e,["enableWidget"]);return null!=n&&tm(t,["enableWidget"],n),t}(a));let s=th(e,["googleSearch"]);null!=s&&tm(t,["googleSearch"],function(e){let t={};if(void 0!==th(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==th(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=th(e,["timeRangeFilter"]);return null!=n&&tm(t,["timeRangeFilter"],n),t}(s));let o=th(e,["googleSearchRetrieval"]);null!=o&&tm(t,["googleSearchRetrieval"],o);let c=th(e,["urlContext"]);return null!=c&&tm(t,["urlContext"],c),t})(t7(e)))),tm(n,["tools"],e)}let j=th(t,["toolConfig"]);if(void 0!==n&&null!=j&&tm(n,["toolConfig"],(l={},null!=(r=th(i=j,["retrievalConfig"]))&&tm(l,["retrievalConfig"],r),null!=(a=th(i,["functionCallingConfig"]))&&tm(l,["functionCallingConfig"],function(e){let t={},n=th(e,["allowedFunctionNames"]);null!=n&&tm(t,["allowedFunctionNames"],n);let i=th(e,["mode"]);if(null!=i&&tm(t,["mode"],i),void 0!==th(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(a)),l)),void 0!==th(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let S=th(t,["cachedContent"]);void 0!==n&&null!=S&&tm(n,["cachedContent"],ne(e,S));let I=th(t,["responseModalities"]);null!=I&&tm(s,["responseModalities"],I);let A=th(t,["mediaResolution"]);null!=A&&tm(s,["mediaResolution"],A);let C=th(t,["speechConfig"]);if(null!=C&&tm(s,["speechConfig"],t6(C)),void 0!==th(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let T=th(t,["thinkingConfig"]);null!=T&&tm(s,["thinkingConfig"],T);let k=th(t,["imageConfig"]);null!=k&&tm(s,["imageConfig"],function(e){let t={},n=th(e,["aspectRatio"]);null!=n&&tm(t,["aspectRatio"],n);let i=th(e,["imageSize"]);if(null!=i&&tm(t,["imageSize"],i),void 0!==th(e,["personGeneration"]))throw Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==th(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==th(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(k));let O=th(t,["enableEnhancedCivicAnswers"]);if(null!=O&&tm(s,["enableEnhancedCivicAnswers"],O),void 0!==th(t,["modelArmorConfig"]))throw Error("modelArmorConfig parameter is not supported in Gemini API.");return s}(e,a,th(n,["request"],{}))),n})(e,t))),tm(n,["requests","requests"],t)}return n}(e,nr(e,l)));let r=th(t,["config"]);return null!=r&&function(e,t){let n=th(e,["displayName"]);if(void 0!==t&&null!=n&&tm(t,["batch","displayName"],n),void 0!==th(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(r,n),n}(ed=tl||(tl={})).PAGED_ITEM_BATCH_JOBS="batchJobs",ed.PAGED_ITEM_MODELS="models",ed.PAGED_ITEM_TUNING_JOBS="tuningJobs",ed.PAGED_ITEM_FILES="files",ed.PAGED_ITEM_CACHED_CONTENTS="cachedContents",ed.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",ed.PAGED_ITEM_DOCUMENTS="documents";class nm{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,l;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let r={config:{}};(r=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(r.config.pageToken=t.nextPageToken),this.paramsInternal=r,this.pageInternalSize=null!=(l=null==(i=r.config)?void 0:i.pageSize)?l:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null==(e=this.params.config)?void 0:e.pageToken)!==void 0}}class nh extends tu{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new nm(tl.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(e){let t=np(this.apiClient,e),n=tp("{model}:batchGenerateContent",t._url),i=t.batch.inputConfig.requests,l=i.requests,r=[];for(let e of l){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}r.push(t)}return i.requests=r,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),void 0===n.dest){let t=this.getGcsUri(e),l=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${i}`;else if(l)n.dest=`${l}_dest_${i}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,i,l,r;let a="",s={};if(this.apiClient.isVertexAI()){let i,l,o,c,d,u,p=(r=this.apiClient,i={},null!=(l=th(e,["model"]))&&tm(i,["model"],tB(r,l)),null!=(o=th(e,["src"]))&&tm(i,["inputConfig"],function(e){let t={},n=th(e,["format"]);null!=n&&tm(t,["instancesFormat"],n);let i=th(e,["gcsUri"]);null!=i&&tm(t,["gcsSource","uris"],i);let l=th(e,["bigqueryUri"]);if(null!=l&&tm(t,["bigquerySource","inputUri"],l),void 0!==th(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==th(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(nr(r,o))),null!=(c=th(e,["config"]))&&(d=th(c,["displayName"]),void 0!==i&&null!=d&&tm(i,["displayName"],d),u=th(c,["dest"]),void 0!==i&&null!=u&&tm(i,["outputConfig"],function(e){let t={},n=th(e,["format"]);null!=n&&tm(t,["predictionsFormat"],n);let i=th(e,["gcsUri"]);null!=i&&tm(t,["gcsDestination","outputUriPrefix"],i);let l=th(e,["bigqueryUri"]);if(null!=l&&tm(t,["bigqueryDestination","outputUri"],l),void 0!==th(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==th(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==th(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(u)))),i);return a=tp("batchPredictionJobs",p._url),s=p._query,delete p._url,delete p._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(p),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nd(e))}{let t=np(this.apiClient,e);return a=tp("{model}:batchGenerateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>nc(e))}}async createEmbeddingsInternal(e){var t,n,i,l,r;let a="",s={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,c,d,u,p,m,h,g,f=(i=this.apiClient,u={},null!=(p=th(e,["model"]))&&tm(u,["_url","model"],tB(i,p)),null!=(m=th(e,["src"]))&&tm(u,["batch","inputConfig"],(l=i,o={},null!=(c=th(r=m,["fileName"]))&&tm(o,["file_name"],c),null!=(d=th(r,["inlinedRequests"]))&&tm(o,["requests"],function(e,t){let n={},i=th(t,["contents"]);if(null!=i){let t=t5(e,i);Array.isArray(t)&&(t=t.map(e=>e)),tm(n,["requests[]","request","content"],t)}let l=th(t,["config"]);return null!=l&&(tm(n,["_self"],function(e,t){let n=th(e,["taskType"]);void 0!==t&&null!=n&&tm(t,["requests[]","taskType"],n);let i=th(e,["title"]);void 0!==t&&null!=i&&tm(t,["requests[]","title"],i);let l=th(e,["outputDimensionality"]);if(void 0!==t&&null!=l&&tm(t,["requests[]","outputDimensionality"],l),void 0!==th(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==th(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(l,n)),!function(e,t){for(let[n,i]of Object.entries(t)){let t=n.split("."),l=i.split("."),r=new Set,a=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){a=e;break}if(-1!==a&&l.length>a)for(let e=a;e<l.length;e++){let t=l[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||r.add(t)}!function e(t,n,i,l,r){if(l>=n.length||"object"!=typeof t||null===t)return;let a=n[l];if(a.endsWith("[]")){let s=a.slice(0,-2);if(s in t&&Array.isArray(t[s]))for(let a of t[s])e(a,n,i,l+1,r)}else if("*"===a){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!r.has(e)),n={};for(let i of e)n[i]=t[i];for(let[e,r]of Object.entries(n)){let n=[];for(let t of i.slice(l))"*"===t?n.push(e):n.push(t);tm(t,n,r)}for(let n of e)delete t[n]}}else a in t&&e(t[a],n,i,l+1,r)}(e,t,l,0,r)}}(n,{"requests[].*":"requests[].request.*"})),n}(l,d)),o)),null!=(h=th(e,["config"]))&&(g=th(h,["displayName"]),void 0!==u&&null!=g&&tm(u,["batch","displayName"],g)),u);return a=tp("{model}:asyncBatchEmbedContent",f._url),s=f._query,delete f._url,delete f._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(f),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nc(e))}}async get(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(r=this.apiClient,i={},null!=(l=th(e,["name"]))&&tm(i,["_url","name"],ns(r,l)),i);return s=tp("batchPredictionJobs/{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nd(e))}{let t,n,r=(a=this.apiClient,t={},null!=(n=th(e,["name"]))&&tm(t,["_url","name"],ns(a,n)),t);return s=tp("batches/{name}",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>nc(e))}}async cancel(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(r=this.apiClient,i={},null!=(l=th(e,["name"]))&&tm(i,["_url","name"],ns(r,l)),i);s=tp("batchPredictionJobs/{name}:cancel",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,r=(a=this.apiClient,t={},null!=(n=th(e,["name"]))&&tm(t,["_url","name"],ns(a,n)),t);s=tp("batches/{name}:cancel",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal})}}async listInternal(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i,l,s,o,c,d=(i={},null!=(l=th(e,["config"]))&&(s=th(l,["pageSize"]),void 0!==i&&null!=s&&tm(i,["_query","pageSize"],s),o=th(l,["pageToken"]),void 0!==i&&null!=o&&tm(i,["_query","pageToken"],o),c=th(l,["filter"]),void 0!==i&&null!=c&&tm(i,["_query","filter"],c)),i);return r=tp("batchPredictionJobs",d._url),a=d._query,delete d._url,delete d._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["batchPredictionJobs"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>nd(e))),tm(t,["batchJobs"],e)}return t}(e),n=new tF;return Object.assign(n,t),n})}{let t,n,s=(t={},null!=(n=th(e,["config"]))&&function(e,t){let n=th(e,["pageSize"]);void 0!==t&&null!=n&&tm(t,["_query","pageSize"],n);let i=th(e,["pageToken"]);if(void 0!==t&&null!=i&&tm(t,["_query","pageToken"],i),void 0!==th(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(n,t),t);return r=tp("batches",s._url),a=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["operations"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>nc(e))),tm(t,["batchJobs"],e)}return t}(e),n=new tF;return Object.assign(n,t),n})}}async delete(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(r=this.apiClient,i={},null!=(l=th(e,["name"]))&&tm(i,["_url","name"],ns(r,l)),i);return s=tp("batchPredictionJobs/{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l,r;return t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),null!=(i=th(e,["name"]))&&tm(t,["name"],i),null!=(l=th(e,["done"]))&&tm(t,["done"],l),null!=(r=th(e,["error"]))&&tm(t,["error"],r),t})}{let t,n,r=(a=this.apiClient,t={},null!=(n=th(e,["name"]))&&tm(t,["_url","name"],ns(a,n)),t);return s=tp("batches/{name}",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l,r;return t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),null!=(i=th(e,["name"]))&&tm(t,["name"],i),null!=(l=th(e,["done"]))&&tm(t,["done"],l),null!=(r=th(e,["error"]))&&tm(t,["error"],r),t})}}}function ng(e){let t={},n=th(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s,o,c,d,u,p,m;return n={},null!=(i=th(t=e,["mediaResolution"]))&&tm(n,["mediaResolution"],i),null!=(l=th(t,["codeExecutionResult"]))&&tm(n,["codeExecutionResult"],l),null!=(r=th(t,["executableCode"]))&&tm(n,["executableCode"],r),null!=(a=th(t,["fileData"]))&&tm(n,["fileData"],function(e){let t={};if(void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=th(e,["fileUri"]);null!=n&&tm(t,["fileUri"],n);let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(a)),null!=(s=th(t,["functionCall"]))&&tm(n,["functionCall"],function(e){let t={},n=th(e,["id"]);null!=n&&tm(t,["id"],n);let i=th(e,["args"]);null!=i&&tm(t,["args"],i);let l=th(e,["name"]);if(null!=l&&tm(t,["name"],l),void 0!==th(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==th(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s)),null!=(o=th(t,["functionResponse"]))&&tm(n,["functionResponse"],o),null!=(c=th(t,["inlineData"]))&&tm(n,["inlineData"],function(e){let t={},n=th(e,["data"]);if(null!=n&&tm(t,["data"],n),void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(c)),null!=(d=th(t,["text"]))&&tm(n,["text"],d),null!=(u=th(t,["thought"]))&&tm(n,["thought"],u),null!=(p=th(t,["thoughtSignature"]))&&tm(n,["thoughtSignature"],p),null!=(m=th(t,["videoMetadata"]))&&tm(n,["videoMetadata"],m),n})),tm(t,["parts"],e)}let i=th(e,["role"]);return null!=i&&tm(t,["role"],i),t}class nf extends tu{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new nm(tl.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a,c=(r=this.apiClient,i={},null!=(l=th(e,["model"]))&&tm(i,["model"],t$(r,l)),null!=(a=th(e,["config"]))&&function(e,t){let n=th(e,["ttl"]);void 0!==t&&null!=n&&tm(t,["ttl"],n);let i=th(e,["expireTime"]);void 0!==t&&null!=i&&tm(t,["expireTime"],i);let l=th(e,["displayName"]);void 0!==t&&null!=l&&tm(t,["displayName"],l);let r=th(e,["contents"]);if(void 0!==t&&null!=r){let e=t4(r);Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["contents"],e)}let a=th(e,["systemInstruction"]);void 0!==t&&null!=a&&tm(t,["systemInstruction"],t2(a));let s=th(e,["tools"]);if(void 0!==t&&null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["retrieval"]);null!=n&&tm(t,["retrieval"],n);let i=th(e,["computerUse"]);if(null!=i&&tm(t,["computerUse"],i),void 0!==th(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let l=th(e,["codeExecution"]);null!=l&&tm(t,["codeExecution"],l);let r=th(e,["enterpriseWebSearch"]);null!=r&&tm(t,["enterpriseWebSearch"],r);let a=th(e,["functionDeclarations"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["description"]);null!=n&&tm(t,["description"],n);let i=th(e,["name"]);null!=i&&tm(t,["name"],i);let l=th(e,["parameters"]);null!=l&&tm(t,["parameters"],l);let r=th(e,["parametersJsonSchema"]);null!=r&&tm(t,["parametersJsonSchema"],r);let a=th(e,["response"]);null!=a&&tm(t,["response"],a);let s=th(e,["responseJsonSchema"]);if(null!=s&&tm(t,["responseJsonSchema"],s),void 0!==th(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),tm(t,["functionDeclarations"],e)}let s=th(e,["googleMaps"]);null!=s&&tm(t,["googleMaps"],s);let o=th(e,["googleSearch"]);null!=o&&tm(t,["googleSearch"],o);let c=th(e,["googleSearchRetrieval"]);null!=c&&tm(t,["googleSearchRetrieval"],c);let d=th(e,["urlContext"]);return null!=d&&tm(t,["urlContext"],d),t})(e))),tm(t,["tools"],e)}let o=th(e,["toolConfig"]);void 0!==t&&null!=o&&tm(t,["toolConfig"],o);let c=th(e,["kmsKeyName"]);void 0!==t&&null!=c&&tm(t,["encryption_spec","kmsKeyName"],c)}(a,i),i);return s=tp("cachedContents",c._url),o=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,r,c=(a=this.apiClient,t={},null!=(n=th(e,["model"]))&&tm(t,["model"],t$(a,n)),null!=(r=th(e,["config"]))&&function(e,t){var n;let i,l,r,a=th(e,["ttl"]);void 0!==t&&null!=a&&tm(t,["ttl"],a);let s=th(e,["expireTime"]);void 0!==t&&null!=s&&tm(t,["expireTime"],s);let o=th(e,["displayName"]);void 0!==t&&null!=o&&tm(t,["displayName"],o);let c=th(e,["contents"]);if(void 0!==t&&null!=c){let e=t4(c);Array.isArray(e)&&(e=e.map(e=>ng(e))),tm(t,["contents"],e)}let d=th(e,["systemInstruction"]);void 0!==t&&null!=d&&tm(t,["systemInstruction"],ng(t2(d)));let u=th(e,["tools"]);if(void 0!==t&&null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==th(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=th(e,["computerUse"]);null!=n&&tm(t,["computerUse"],n);let i=th(e,["fileSearch"]);null!=i&&tm(t,["fileSearch"],i);let l=th(e,["codeExecution"]);if(null!=l&&tm(t,["codeExecution"],l),void 0!==th(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let r=th(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["functionDeclarations"],e)}let a=th(e,["googleMaps"]);null!=a&&tm(t,["googleMaps"],function(e){let t={};if(void 0!==th(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=th(e,["enableWidget"]);return null!=n&&tm(t,["enableWidget"],n),t}(a));let s=th(e,["googleSearch"]);null!=s&&tm(t,["googleSearch"],function(e){let t={};if(void 0!==th(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==th(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=th(e,["timeRangeFilter"]);return null!=n&&tm(t,["timeRangeFilter"],n),t}(s));let o=th(e,["googleSearchRetrieval"]);null!=o&&tm(t,["googleSearchRetrieval"],o);let c=th(e,["urlContext"]);return null!=c&&tm(t,["urlContext"],c),t})(e))),tm(t,["tools"],e)}let p=th(e,["toolConfig"]);if(void 0!==t&&null!=p&&tm(t,["toolConfig"],(i={},null!=(l=th(n=p,["retrievalConfig"]))&&tm(i,["retrievalConfig"],l),null!=(r=th(n,["functionCallingConfig"]))&&tm(i,["functionCallingConfig"],function(e){let t={},n=th(e,["allowedFunctionNames"]);null!=n&&tm(t,["allowedFunctionNames"],n);let i=th(e,["mode"]);if(null!=i&&tm(t,["mode"],i),void 0!==th(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(r)),i)),void 0!==th(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(r,t),t);return s=tp("cachedContents",c._url),o=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(r=this.apiClient,i={},null!=(l=th(e,["name"]))&&tm(i,["_url","name"],ne(r,l)),i);return s=tp("{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,r=(a=this.apiClient,t={},null!=(n=th(e,["name"]))&&tm(t,["_url","name"],ne(a,n)),t);return s=tp("{name}",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(r=this.apiClient,i={},null!=(l=th(e,["name"]))&&tm(i,["_url","name"],ne(r,l)),i);return s=tp("{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tO;return Object.assign(l,i),l})}{let t,n,r=(a=this.apiClient,t={},null!=(n=th(e,["name"]))&&tm(t,["_url","name"],ne(a,n)),t);return s=tp("{name}",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tO;return Object.assign(l,i),l})}}async update(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a,c,d,u=(r=this.apiClient,i={},null!=(l=th(e,["name"]))&&tm(i,["_url","name"],ne(r,l)),null!=(a=th(e,["config"]))&&(c=th(a,["ttl"]),void 0!==i&&null!=c&&tm(i,["ttl"],c),d=th(a,["expireTime"]),void 0!==i&&null!=d&&tm(i,["expireTime"],d)),i);return s=tp("{name}",u._url),o=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,r,c,d,u=(a=this.apiClient,t={},null!=(n=th(e,["name"]))&&tm(t,["_url","name"],ne(a,n)),null!=(r=th(e,["config"]))&&(c=th(r,["ttl"]),void 0!==t&&null!=c&&tm(t,["ttl"],c),d=th(r,["expireTime"]),void 0!==t&&null!=d&&tm(t,["expireTime"],d)),t);return s=tp("{name}",u._url),o=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i,l,s,o,c=(i={},null!=(l=th(e,["config"]))&&(s=th(l,["pageSize"]),void 0!==i&&null!=s&&tm(i,["_query","pageSize"],s),o=th(l,["pageToken"]),void 0!==i&&null!=o&&tm(i,["_query","pageToken"],o)),i);return r=tp("cachedContents",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["cachedContents"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["cachedContents"],e)}return t}(e),n=new tR;return Object.assign(n,t),n})}{let t,n,s,o,c=(t={},null!=(n=th(e,["config"]))&&(s=th(n,["pageSize"]),void 0!==t&&null!=s&&tm(t,["_query","pageSize"],s),o=th(n,["pageToken"]),void 0!==t&&null!=o&&tm(t,["_query","pageToken"],o)),t);return r=tp("cachedContents",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["cachedContents"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["cachedContents"],e)}return t}(e),n=new tR;return Object.assign(n,t),n})}}}function nx(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var l=0,i=Object.getOwnPropertySymbols(e);l<i.length;l++)0>t.indexOf(i[l])&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(n[i[l]]=e[i[l]]);return n}function nb(e){return this instanceof nb?(this.v=e,this):new nb(e)}function ny(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,l=n.apply(e,t||[]),r=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),i[Symbol.asyncIterator]=function(){return this},i;function a(e,t){l[e]&&(i[e]=function(t){return new Promise(function(n,i){r.push([e,t,n,i])>1||s(e,t)})},t&&(i[e]=t(i[e])))}function s(e,t){try{var n;(n=l[e](t)).value instanceof nb?Promise.resolve(n.value.v).then(o,c):d(r[0][2],n)}catch(e){d(r[0][3],e)}}function o(e){s("next",e)}function c(e){s("throw",e)}function d(e,t){e(t),r.shift(),r.length&&s(r[0][0],r[0][1])}}function nv(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,l){var r,a,s;r=i,a=l,s=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){r({value:e,done:s})},a)})}}}function n_(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function nN(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,i=0;for(;i<n;)if("user"===e[i].role)t.push(e[i]),i++;else{let l=[],r=!0;for(;i<n&&"model"===e[i].role;)l.push(e[i]),r&&!n_(e[i])&&(r=!1),i++;r?t.push(...l):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class nw{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new nE(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class nE{constructor(e,t,n,i={},l=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(l)}async sendMessage(e){var t;await this.sendPromise;let n=t2(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});return this.sendPromise=(async()=>{var e,t,l;let r=await i,a=null==(t=null==(e=r.candidates)?void 0:e[0])?void 0:t.content,s=r.automaticFunctionCallingHistory,o=this.getHistory(!0).length,c=[];null!=s&&(c=null!=(l=s.slice(o))?l:[]),this.recordHistory(n,a?[a]:[],c)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;let n=t2(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});this.sendPromise=i.then(()=>void 0).catch(()=>void 0);let l=await i;return this.processStreamResponse(l,n)}getHistory(e=!1){return structuredClone(e?nN(this.history):this.history)}processStreamResponse(e,t){return ny(this,arguments,function*(){let n=[];try{for(var i,l,r,a,s,o,c,d=!0,u=nv(e);!(i=(c=yield nb(u.next())).done);d=!0){if(a=c.value,d=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;return void 0!==n&&n_(n)}(a)){let e=null==(o=null==(s=a.candidates)?void 0:s[0])?void 0:o.content;void 0!==e&&n.push(e)}yield yield nb(a)}}catch(e){l={error:e}}finally{try{!d&&!i&&(r=u.return)&&(yield nb(r.call(u)))}finally{if(l)throw l.error}}this.recordHistory(t,n)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(e=>void 0!==e.role)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...nN(n)):this.history.push(e),this.history.push(...i)}}class nj extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,nj.prototype)}}class nS extends tu{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new nm(tl.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o,c=(r={},null!=(a=th(e,["config"]))&&(s=th(a,["pageSize"]),void 0!==r&&null!=s&&tm(r,["_query","pageSize"],s),o=th(a,["pageToken"]),void 0!==r&&null!=o&&tm(r,["_query","pageToken"],o)),r);return i=tp("files",c._url),l=c._query,delete c._url,delete c._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["files"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["files"],e)}return t}(e),n=new tL;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s=(r={},null!=(a=th(e,["file"]))&&tm(r,["file"],a),r);return i=tp("upload/v1beta/files",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tz;return Object.assign(l,i),l})}}async get(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s=(r={},null!=(a=th(e,["name"]))&&tm(r,["_url","file"],nn(a)),r);return i=tp("files/{file}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s=(r={},null!=(a=th(e,["name"]))&&tm(r,["_url","file"],nn(a)),r);return i=tp("files/{file}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tG;return Object.assign(l,i),l})}}}function nI(e){let t={},n=th(e,["data"]);if(null!=n&&tm(t,["data"],n),void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}function nA(e){let t={},n=th(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s,o,c,d,u,p,m;return n={},null!=(i=th(t=e,["mediaResolution"]))&&tm(n,["mediaResolution"],i),null!=(l=th(t,["codeExecutionResult"]))&&tm(n,["codeExecutionResult"],l),null!=(r=th(t,["executableCode"]))&&tm(n,["executableCode"],r),null!=(a=th(t,["fileData"]))&&tm(n,["fileData"],function(e){let t={};if(void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=th(e,["fileUri"]);null!=n&&tm(t,["fileUri"],n);let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(a)),null!=(s=th(t,["functionCall"]))&&tm(n,["functionCall"],function(e){let t={},n=th(e,["id"]);null!=n&&tm(t,["id"],n);let i=th(e,["args"]);null!=i&&tm(t,["args"],i);let l=th(e,["name"]);if(null!=l&&tm(t,["name"],l),void 0!==th(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==th(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s)),null!=(o=th(t,["functionResponse"]))&&tm(n,["functionResponse"],o),null!=(c=th(t,["inlineData"]))&&tm(n,["inlineData"],function(e){let t={},n=th(e,["data"]);if(null!=n&&tm(t,["data"],n),void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(c)),null!=(d=th(t,["text"]))&&tm(n,["text"],d),null!=(u=th(t,["thought"]))&&tm(n,["thought"],u),null!=(p=th(t,["thoughtSignature"]))&&tm(n,["thoughtSignature"],p),null!=(m=th(t,["videoMetadata"]))&&tm(n,["videoMetadata"],m),n})),tm(t,["parts"],e)}let i=th(e,["role"]);return null!=i&&tm(t,["role"],i),t}function nC(e,t){let n={},i=th(t,["model"]);null!=i&&tm(n,["_url","model"],tB(e,i));let l=th(t,["contents"]);if(null!=l){let e=t4(l);Array.isArray(e)&&(e=e.map(e=>nA(e))),tm(n,["contents"],e)}let r=th(t,["config"]);return null!=r&&tm(n,["generationConfig"],function(e,t,n){var i;let l,r,a,s={},o=th(t,["systemInstruction"]);void 0!==n&&null!=o&&tm(n,["systemInstruction"],nA(t2(o)));let c=th(t,["temperature"]);null!=c&&tm(s,["temperature"],c);let d=th(t,["topP"]);null!=d&&tm(s,["topP"],d);let u=th(t,["topK"]);null!=u&&tm(s,["topK"],u);let p=th(t,["candidateCount"]);null!=p&&tm(s,["candidateCount"],p);let m=th(t,["maxOutputTokens"]);null!=m&&tm(s,["maxOutputTokens"],m);let h=th(t,["stopSequences"]);null!=h&&tm(s,["stopSequences"],h);let g=th(t,["responseLogprobs"]);null!=g&&tm(s,["responseLogprobs"],g);let f=th(t,["logprobs"]);null!=f&&tm(s,["logprobs"],f);let x=th(t,["presencePenalty"]);null!=x&&tm(s,["presencePenalty"],x);let b=th(t,["frequencyPenalty"]);null!=b&&tm(s,["frequencyPenalty"],b);let y=th(t,["seed"]);null!=y&&tm(s,["seed"],y);let v=th(t,["responseMimeType"]);null!=v&&tm(s,["responseMimeType"],v);let _=th(t,["responseSchema"]);null!=_&&tm(s,["responseSchema"],t3(_));let N=th(t,["responseJsonSchema"]);if(null!=N&&tm(s,["responseJsonSchema"],N),void 0!==th(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==th(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let w=th(t,["safetySettings"]);if(void 0!==n&&null!=w){let e=w;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["category"]);if(null!=n&&tm(t,["category"],n),void 0!==th(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let i=th(e,["threshold"]);return null!=i&&tm(t,["threshold"],i),t})(e))),tm(n,["safetySettings"],e)}let E=th(t,["tools"]);if(void 0!==n&&null!=E){let e=t9(E);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==th(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=th(e,["computerUse"]);null!=n&&tm(t,["computerUse"],n);let i=th(e,["fileSearch"]);null!=i&&tm(t,["fileSearch"],i);let l=th(e,["codeExecution"]);if(null!=l&&tm(t,["codeExecution"],l),void 0!==th(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let r=th(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["functionDeclarations"],e)}let a=th(e,["googleMaps"]);null!=a&&tm(t,["googleMaps"],function(e){let t={};if(void 0!==th(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=th(e,["enableWidget"]);return null!=n&&tm(t,["enableWidget"],n),t}(a));let s=th(e,["googleSearch"]);null!=s&&tm(t,["googleSearch"],function(e){let t={};if(void 0!==th(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==th(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=th(e,["timeRangeFilter"]);return null!=n&&tm(t,["timeRangeFilter"],n),t}(s));let o=th(e,["googleSearchRetrieval"]);null!=o&&tm(t,["googleSearchRetrieval"],o);let c=th(e,["urlContext"]);return null!=c&&tm(t,["urlContext"],c),t})(t7(e)))),tm(n,["tools"],e)}let j=th(t,["toolConfig"]);if(void 0!==n&&null!=j&&tm(n,["toolConfig"],(l={},null!=(r=th(i=j,["retrievalConfig"]))&&tm(l,["retrievalConfig"],r),null!=(a=th(i,["functionCallingConfig"]))&&tm(l,["functionCallingConfig"],function(e){let t={},n=th(e,["allowedFunctionNames"]);null!=n&&tm(t,["allowedFunctionNames"],n);let i=th(e,["mode"]);if(null!=i&&tm(t,["mode"],i),void 0!==th(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(a)),l)),void 0!==th(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let S=th(t,["cachedContent"]);void 0!==n&&null!=S&&tm(n,["cachedContent"],ne(e,S));let I=th(t,["responseModalities"]);null!=I&&tm(s,["responseModalities"],I);let A=th(t,["mediaResolution"]);null!=A&&tm(s,["mediaResolution"],A);let C=th(t,["speechConfig"]);if(null!=C&&tm(s,["speechConfig"],t6(C)),void 0!==th(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let T=th(t,["thinkingConfig"]);null!=T&&tm(s,["thinkingConfig"],T);let k=th(t,["imageConfig"]);null!=k&&tm(s,["imageConfig"],function(e){let t={},n=th(e,["aspectRatio"]);null!=n&&tm(t,["aspectRatio"],n);let i=th(e,["imageSize"]);if(null!=i&&tm(t,["imageSize"],i),void 0!==th(e,["personGeneration"]))throw Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==th(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==th(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(k));let O=th(t,["enableEnhancedCivicAnswers"]);if(null!=O&&tm(s,["enableEnhancedCivicAnswers"],O),void 0!==th(t,["modelArmorConfig"]))throw Error("modelArmorConfig parameter is not supported in Gemini API.");return s}(e,r,n)),n}function nT(e,t){let n={},i=th(t,["model"]);null!=i&&tm(n,["_url","model"],tB(e,i));let l=th(t,["contents"]);if(null!=l){let e=t4(l);Array.isArray(e)&&(e=e.map(e=>e)),tm(n,["contents"],e)}let r=th(t,["config"]);return null!=r&&tm(n,["generationConfig"],function(e,t,n){var i;let l,r,a,s,o,c,d={},u=th(t,["systemInstruction"]);void 0!==n&&null!=u&&tm(n,["systemInstruction"],t2(u));let p=th(t,["temperature"]);null!=p&&tm(d,["temperature"],p);let m=th(t,["topP"]);null!=m&&tm(d,["topP"],m);let h=th(t,["topK"]);null!=h&&tm(d,["topK"],h);let g=th(t,["candidateCount"]);null!=g&&tm(d,["candidateCount"],g);let f=th(t,["maxOutputTokens"]);null!=f&&tm(d,["maxOutputTokens"],f);let x=th(t,["stopSequences"]);null!=x&&tm(d,["stopSequences"],x);let b=th(t,["responseLogprobs"]);null!=b&&tm(d,["responseLogprobs"],b);let y=th(t,["logprobs"]);null!=y&&tm(d,["logprobs"],y);let v=th(t,["presencePenalty"]);null!=v&&tm(d,["presencePenalty"],v);let _=th(t,["frequencyPenalty"]);null!=_&&tm(d,["frequencyPenalty"],_);let N=th(t,["seed"]);null!=N&&tm(d,["seed"],N);let w=th(t,["responseMimeType"]);null!=w&&tm(d,["responseMimeType"],w);let E=th(t,["responseSchema"]);null!=E&&tm(d,["responseSchema"],t3(E));let j=th(t,["responseJsonSchema"]);null!=j&&tm(d,["responseJsonSchema"],j);let S=th(t,["routingConfig"]);null!=S&&tm(d,["routingConfig"],S);let I=th(t,["modelSelectionConfig"]);null!=I&&tm(d,["modelConfig"],I);let A=th(t,["safetySettings"]);if(void 0!==n&&null!=A){let e=A;Array.isArray(e)&&(e=e.map(e=>e)),tm(n,["safetySettings"],e)}let C=th(t,["tools"]);if(void 0!==n&&null!=C){let e=t9(C);Array.isArray(e)&&(e=e.map(e=>nF(t7(e)))),tm(n,["tools"],e)}let T=th(t,["toolConfig"]);void 0!==n&&null!=T&&tm(n,["toolConfig"],T);let k=th(t,["labels"]);void 0!==n&&null!=k&&tm(n,["labels"],k);let O=th(t,["cachedContent"]);void 0!==n&&null!=O&&tm(n,["cachedContent"],ne(e,O));let R=th(t,["responseModalities"]);null!=R&&tm(d,["responseModalities"],R);let P=th(t,["mediaResolution"]);null!=P&&tm(d,["mediaResolution"],P);let M=th(t,["speechConfig"]);null!=M&&tm(d,["speechConfig"],t6(M));let D=th(t,["audioTimestamp"]);null!=D&&tm(d,["audioTimestamp"],D);let U=th(t,["thinkingConfig"]);null!=U&&tm(d,["thinkingConfig"],U);let L=th(t,["imageConfig"]);if(null!=L&&tm(d,["imageConfig"],(l={},null!=(r=th(i=L,["aspectRatio"]))&&tm(l,["aspectRatio"],r),null!=(a=th(i,["imageSize"]))&&tm(l,["imageSize"],a),null!=(s=th(i,["personGeneration"]))&&tm(l,["personGeneration"],s),null!=(o=th(i,["outputMimeType"]))&&tm(l,["imageOutputOptions","mimeType"],o),null!=(c=th(i,["outputCompressionQuality"]))&&tm(l,["imageOutputOptions","compressionQuality"],c),l)),void 0!==th(t,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");let z=th(t,["modelArmorConfig"]);return void 0!==n&&null!=z&&tm(n,["modelArmorConfig"],z),d}(e,r,n)),n}function nk(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["content"]);null!=n&&tm(t,["content"],n);let i=th(e,["citationMetadata"]);null!=i&&tm(t,["citationMetadata"],function(e){let t={},n=th(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["citations"],e)}return t}(i));let l=th(e,["tokenCount"]);null!=l&&tm(t,["tokenCount"],l);let r=th(e,["finishReason"]);null!=r&&tm(t,["finishReason"],r);let a=th(e,["avgLogprobs"]);null!=a&&tm(t,["avgLogprobs"],a);let s=th(e,["groundingMetadata"]);null!=s&&tm(t,["groundingMetadata"],s);let o=th(e,["index"]);null!=o&&tm(t,["index"],o);let c=th(e,["logprobsResult"]);null!=c&&tm(t,["logprobsResult"],c);let d=th(e,["safetyRatings"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["safetyRatings"],e)}let u=th(e,["urlContextMetadata"]);return null!=u&&tm(t,["urlContextMetadata"],u),t})(e))),tm(t,["candidates"],e)}let l=th(e,["modelVersion"]);null!=l&&tm(t,["modelVersion"],l);let r=th(e,["promptFeedback"]);null!=r&&tm(t,["promptFeedback"],r);let a=th(e,["responseId"]);null!=a&&tm(t,["responseId"],a);let s=th(e,["usageMetadata"]);return null!=s&&tm(t,["usageMetadata"],s),t}function nO(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["candidates"],e)}let l=th(e,["createTime"]);null!=l&&tm(t,["createTime"],l);let r=th(e,["modelVersion"]);null!=r&&tm(t,["modelVersion"],r);let a=th(e,["promptFeedback"]);null!=a&&tm(t,["promptFeedback"],a);let s=th(e,["responseId"]);null!=s&&tm(t,["responseId"],s);let o=th(e,["usageMetadata"]);return null!=o&&tm(t,["usageMetadata"],o),t}function nR(e){let t={},n=th(e,["_self"]);null!=n&&tm(t,["image"],nP(n));let i=th(e,["raiFilteredReason"]);null!=i&&tm(t,["raiFilteredReason"],i);let l=th(e,["_self"]);null!=l&&tm(t,["safetyAttributes"],nG(l));let r=th(e,["prompt"]);return null!=r&&tm(t,["enhancedPrompt"],r),t}function nP(e){let t={},n=th(e,["gcsUri"]);null!=n&&tm(t,["gcsUri"],n);let i=th(e,["bytesBase64Encoded"]);null!=i&&tm(t,["imageBytes"],tg(i));let l=th(e,["mimeType"]);return null!=l&&tm(t,["mimeType"],l),t}function nM(e){let t={};if(void 0!==th(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let n=th(e,["imageBytes"]);null!=n&&tm(t,["bytesBase64Encoded"],tg(n));let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}function nD(e){let t={},n=th(e,["gcsUri"]);null!=n&&tm(t,["gcsUri"],n);let i=th(e,["imageBytes"]);null!=i&&tm(t,["bytesBase64Encoded"],tg(i));let l=th(e,["mimeType"]);return null!=l&&tm(t,["mimeType"],l),t}function nU(e){var t;let n,i,l,r,a={},s=th(e,["name"]);null!=s&&tm(a,["name"],s);let o=th(e,["displayName"]);null!=o&&tm(a,["displayName"],o);let c=th(e,["description"]);null!=c&&tm(a,["description"],c);let d=th(e,["version"]);null!=d&&tm(a,["version"],d);let u=th(e,["_self"]);null!=u&&tm(a,["tunedModelInfo"],(n={},null!=(i=th(t=u,["baseModel"]))&&tm(n,["baseModel"],i),null!=(l=th(t,["createTime"]))&&tm(n,["createTime"],l),null!=(r=th(t,["updateTime"]))&&tm(n,["updateTime"],r),n));let p=th(e,["inputTokenLimit"]);null!=p&&tm(a,["inputTokenLimit"],p);let m=th(e,["outputTokenLimit"]);null!=m&&tm(a,["outputTokenLimit"],m);let h=th(e,["supportedGenerationMethods"]);null!=h&&tm(a,["supportedActions"],h);let g=th(e,["temperature"]);null!=g&&tm(a,["temperature"],g);let f=th(e,["maxTemperature"]);null!=f&&tm(a,["maxTemperature"],f);let x=th(e,["topP"]);null!=x&&tm(a,["topP"],x);let b=th(e,["topK"]);null!=b&&tm(a,["topK"],b);let y=th(e,["thinking"]);return null!=y&&tm(a,["thinking"],y),a}function nL(e){var t;let n,i,l,r,a={},s=th(e,["name"]);null!=s&&tm(a,["name"],s);let o=th(e,["displayName"]);null!=o&&tm(a,["displayName"],o);let c=th(e,["description"]);null!=c&&tm(a,["description"],c);let d=th(e,["versionId"]);null!=d&&tm(a,["version"],d);let u=th(e,["deployedModels"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>{let t,n,i;return t={},null!=(n=th(e,["endpoint"]))&&tm(t,["name"],n),null!=(i=th(e,["deployedModelId"]))&&tm(t,["deployedModelId"],i),t})),tm(a,["endpoints"],e)}let p=th(e,["labels"]);null!=p&&tm(a,["labels"],p);let m=th(e,["_self"]);null!=m&&tm(a,["tunedModelInfo"],(n={},null!=(i=th(t=m,["labels","google-vertex-llm-tuning-base-model-id"]))&&tm(n,["baseModel"],i),null!=(l=th(t,["createTime"]))&&tm(n,["createTime"],l),null!=(r=th(t,["updateTime"]))&&tm(n,["updateTime"],r),n));let h=th(e,["defaultCheckpointId"]);null!=h&&tm(a,["defaultCheckpointId"],h);let g=th(e,["checkpoints"]);if(null!=g){let e=g;Array.isArray(e)&&(e=e.map(e=>e)),tm(a,["checkpoints"],e)}return a}function nz(e){let t={},n=th(e,["safetyAttributes","categories"]);null!=n&&tm(t,["categories"],n);let i=th(e,["safetyAttributes","scores"]);null!=i&&tm(t,["scores"],i);let l=th(e,["contentType"]);return null!=l&&tm(t,["contentType"],l),t}function nG(e){let t={},n=th(e,["safetyAttributes","categories"]);null!=n&&tm(t,["categories"],n);let i=th(e,["safetyAttributes","scores"]);null!=i&&tm(t,["scores"],i);let l=th(e,["contentType"]);return null!=l&&tm(t,["contentType"],l),t}function nF(e){let t={},n=th(e,["retrieval"]);null!=n&&tm(t,["retrieval"],n);let i=th(e,["computerUse"]);if(null!=i&&tm(t,["computerUse"],i),void 0!==th(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let l=th(e,["codeExecution"]);null!=l&&tm(t,["codeExecution"],l);let r=th(e,["enterpriseWebSearch"]);null!=r&&tm(t,["enterpriseWebSearch"],r);let a=th(e,["functionDeclarations"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["description"]);null!=n&&tm(t,["description"],n);let i=th(e,["name"]);null!=i&&tm(t,["name"],i);let l=th(e,["parameters"]);null!=l&&tm(t,["parameters"],l);let r=th(e,["parametersJsonSchema"]);null!=r&&tm(t,["parametersJsonSchema"],r);let a=th(e,["response"]);null!=a&&tm(t,["response"],a);let s=th(e,["responseJsonSchema"]);if(null!=s&&tm(t,["responseJsonSchema"],s),void 0!==th(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),tm(t,["functionDeclarations"],e)}let s=th(e,["googleMaps"]);null!=s&&tm(t,["googleMaps"],s);let o=th(e,["googleSearch"]);null!=o&&tm(t,["googleSearch"],o);let c=th(e,["googleSearchRetrieval"]);null!=c&&tm(t,["googleSearchRetrieval"],c);let d=th(e,["urlContext"]);return null!=d&&tm(t,["urlContext"],d),t}function nq(e){let t={},n=th(e,["uri"]);null!=n&&tm(t,["uri"],n);let i=th(e,["videoBytes"]);null!=i&&tm(t,["encodedVideo"],tg(i));let l=th(e,["mimeType"]);return null!=l&&tm(t,["encoding"],l),t}function nH(e){let t={},n=th(e,["uri"]);null!=n&&tm(t,["gcsUri"],n);let i=th(e,["videoBytes"]);null!=i&&tm(t,["bytesBase64Encoded"],tg(i));let l=th(e,["mimeType"]);return null!=l&&tm(t,["mimeType"],l),t}function nV(e,t){let n=th(e,["mimeType"]);void 0!==t&&null!=n&&tm(t,["mimeType"],n);let i=th(e,["displayName"]);void 0!==t&&null!=i&&tm(t,["displayName"],i);let l=th(e,["customMetadata"]);if(void 0!==t&&null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["customMetadata"],e)}let r=th(e,["chunkingConfig"]);return void 0!==t&&null!=r&&tm(t,["chunkingConfig"],r),{}}let nB="x-goog-api-client";class n${constructor(e){var t,n,i;this.clientOptions=Object.assign({},e),this.customBaseUrl=null==(t=e.httpOptions)?void 0:t.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const l={};if(this.clientOptions.vertexai){if(this.clientOptions.location||this.clientOptions.apiKey||this.customBaseUrl||(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const t=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!t?(l.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||"global"===this.clientOptions.location?l.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(l.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),l.apiVersion=null!=(n=this.clientOptions.apiVersion)?n:"v1beta1"}else{if(!this.clientOptions.apiKey)throw new nj({message:"API key must be set when using the Gemini API.",status:403});l.apiVersion=null!=(i=this.clientOptions.apiVersion)?i:"v1beta",l.baseUrl="https://generativelanguage.googleapis.com/"}l.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=l,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(l,e.httpOptions))}isVertexAI(){var e;return null!=(e=this.clientOptions.vertexai)&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let i=[this.getRequestUrlInternal(t)];return n&&i.push(this.getBaseResourcePath()),""!==e&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e,t){return!(t.baseUrl&&t.baseUrlResourceScope===ez.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e,t),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))i.searchParams.append(t,String(n));let l={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else l.body=e.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,t,i.toString(),e.abortSignal),this.unaryApiCall(i,l,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,i]of Object.entries(t))"object"==typeof i?n[e]=Object.assign(Object.assign({},n[e]),i):void 0!==i&&(n[e]=i);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e,t),i=this.constructUrl(e.path,t,n);i.searchParams.has("alt")&&"sse"===i.searchParams.get("alt")||i.searchParams.set("alt","sse");let l={};return l.body=e.body,l=await this.includeExtraHttpOptionsToRequestInit(l,t,i.toString(),e.abortSignal),this.streamApiCall(i,l,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,i){if(t&&t.timeout||i){let n=new AbortController,l=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}i&&i.addEventListener("abort",()=>{n.abort()}),e.signal=l}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let n={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");n=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}e.body=JSON.stringify(function e(t,n){let i=Object.assign({},t);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let l=n[t],r=i[t];l&&"object"==typeof l&&!Array.isArray(l)&&r&&"object"==typeof r&&!Array.isArray(r)?i[t]=e(r,l):(r&&l&&typeof r!=typeof l&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof r}, New type: ${typeof l}. Overwriting.`),i[t]=l)}return i}(n,t))}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await nJ(e),new tx(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await nJ(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){return ny(this,arguments,function*(){var t;let n=null==(t=null==e?void 0:e.body)?void 0:t.getReader(),i=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="",l="data:",r=["\n\n","\r\r","\r\n\r\n"];for(;;){let{done:a,value:s}=yield nb(n.read());if(a){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let o=i.decode(s,{stream:!0});try{let e=JSON.parse(o);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,i=t.code,l=`got status: ${n}. ${JSON.stringify(e)}`;if(i>=400&&i<600)throw new nj({message:l,status:i})}}catch(e){if("ApiError"===e.name)throw e}t+=o;let c=-1,d=0;for(;;){for(let e of(c=-1,d=0,r)){let n=t.indexOf(e);-1!==n&&(-1===c||n<c)&&(c=n,d=e.length)}if(-1===c)break;let n=t.substring(0,c);t=t.substring(c+d);let i=n.trim();if(i.startsWith(l)){let t=i.substring(l.length).trim();try{let n=new Response(t,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield nb(new tx(n))}catch(e){throw Error(`exception parsing stream chunk ${t}. ${e}`)}}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.38.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[nB]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[t,i]of Object.entries(e.headers))n.append(t,i);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return"string"==typeof e&&(n=null!=(t=(n=e.replace(/[/\\]+$/,"")).split(/[/\\]/).pop())?t:""),n}async uploadFile(e,t){var n;let i={};null!=t&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let l=this.clientOptions.uploader,r=await l.stat(e);i.sizeBytes=String(r.size);let a=null!=(n=null==t?void 0:t.mimeType)?n:r.type;if(void 0===a||""===a)throw Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;let s={file:i},o=this.getFileName(e),c=tp("upload/v1beta/files",s._url),d=await this.fetchUploadUrl(c,i.sizeBytes,i.mimeType,o,s,null==t?void 0:t.httpOptions);return l.upload(e,d,this)}async uploadFileToFileSearchStore(e,t,n){var i;let l=this.clientOptions.uploader,r=await l.stat(t),a=String(r.size),s=null!=(i=null==n?void 0:n.mimeType)?i:r.type;if(void 0===s||""===s)throw Error("Can not determine mimeType. Please provide mimeType in the config.");let o=`upload/v1beta/${e}:uploadToFileSearchStore`,c=this.getFileName(t),d={};null!=n&&nV(n,d);let u=await this.fetchUploadUrl(o,a,s,c,d,null==n?void 0:n.httpOptions);return l.uploadToFileSearchStore(t,u,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,n,i,l,r){var a;let s={};s=r||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},i?{"X-Goog-Upload-File-Name":i}:{})};let o=await this.request({path:e,body:JSON.stringify(l),httpMethod:"POST",httpOptions:s});if(!o||!(null==o?void 0:o.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let c=null==(a=null==o?void 0:o.headers)?void 0:a["x-goog-upload-url"];if(void 0===c)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function nJ(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let n=e.status,i=JSON.stringify((null==(t=e.headers.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(n>=400&&n<600)throw new nj({message:i,status:n});throw Error(i)}}function nW(e){for(let n of e){var t;if(null!==(t=n)&&"object"==typeof t&&t instanceof nK||"object"==typeof n&&"inputSchema"in n)return!0}return!1}function nY(e){var t;let n=null!=(t=e[nB])?t:"";e[nB]=(n+" mcp_used/unknown").trimStart()}class nK{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new nK(e,t)}async initialize(){var e,t,n,i;if(this.mcpTools.length>0)return;let l={},r=[];for(let c of this.mcpClients)try{for(var a,s=!0,o=(t=void 0,nv(function(e){return ny(this,arguments,function*(e,t=100){let n,i=0;for(;i<t;){let t=yield nb(e.listTools({cursor:n}));for(let e of t.tools)yield yield nb(e),i++;if(!t.nextCursor)break;n=t.nextCursor}})}(c)));!(e=(a=await o.next()).done);s=!0){i=a.value,s=!1,r.push(i);let e=i.name;if(l[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);l[e]=c}}catch(e){t={error:e}}finally{try{!s&&!e&&(n=o.return)&&await n.call(o)}finally{if(t)throw t.error}}this.mcpTools=r,this.functionNameToMcpClient=l}async tool(){return await this.initialize(),function(e,t={}){let n=[],i=new Set;for(let l of e){let e=l.name;if(i.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i.add(e);let r=function(e,t={}){let n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(l,t);r.functionDeclarations&&n.push(...r.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e,i=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let l=await i.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:l.isError?{error:l}:l}})}return t}}async function nX(e,t,n){let i=new tH;Object.assign(i,n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data)),t(i)}class nZ{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;let i;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let l=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),a=function(e){let t=new Headers;for(let[n,i]of Object.entries(e))t.append(n,i);return t}(this.apiClient.getDefaultHeaders()),s=this.apiClient.getApiKey(),o=`${l}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${s}`,c=()=>{},d=new Promise(e=>{c=e}),u=e.callbacks,p=this.apiClient,m={onopen:function(){c({})},onmessage:e=>{nX(p,u.onmessage,e)},onerror:null!=(t=null==u?void 0:u.onerror)?t:function(e){},onclose:null!=(n=null==u?void 0:u.onclose)?n:function(e){}},h=this.webSocketFactory.create(o,(i={},a.forEach((e,t)=>{i[t]=e}),i),m);h.connect(),await d;let g=tB(this.apiClient,e.model);return h.send(JSON.stringify({setup:{model:g}})),new nQ(h,this.apiClient)}}class nQ{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},n=th(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){let t,n;e.musicGenerationConfig||(e.musicGenerationConfig={});let i=(t={},null!=(n=th(e,["musicGenerationConfig"]))&&tm(t,["musicGenerationConfig"],n),t);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(ti.PLAY)}pause(){this.sendPlaybackControl(ti.PAUSE)}stop(){this.sendPlaybackControl(ti.STOP)}resetContext(){this.sendPlaybackControl(ti.RESET_CONTEXT)}close(){this.conn.close()}}async function n0(e,t,n){let i=new tq,l=JSON.parse(n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data);if(e.isVertexAI()){let e,t,n,r,a,s,o,c,d,u,p,m;Object.assign(i,(e={},null!=(t=th(l,["setupComplete"]))&&tm(e,["setupComplete"],t),null!=(n=th(l,["serverContent"]))&&tm(e,["serverContent"],n),null!=(r=th(l,["toolCall"]))&&tm(e,["toolCall"],r),null!=(a=th(l,["toolCallCancellation"]))&&tm(e,["toolCallCancellation"],a),null!=(s=th(l,["usageMetadata"]))&&tm(e,["usageMetadata"],function(e){let t={},n=th(e,["promptTokenCount"]);null!=n&&tm(t,["promptTokenCount"],n);let i=th(e,["cachedContentTokenCount"]);null!=i&&tm(t,["cachedContentTokenCount"],i);let l=th(e,["candidatesTokenCount"]);null!=l&&tm(t,["responseTokenCount"],l);let r=th(e,["toolUsePromptTokenCount"]);null!=r&&tm(t,["toolUsePromptTokenCount"],r);let a=th(e,["thoughtsTokenCount"]);null!=a&&tm(t,["thoughtsTokenCount"],a);let s=th(e,["totalTokenCount"]);null!=s&&tm(t,["totalTokenCount"],s);let o=th(e,["promptTokensDetails"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["promptTokensDetails"],e)}let c=th(e,["cacheTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["cacheTokensDetails"],e)}let d=th(e,["candidatesTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["responseTokensDetails"],e)}let u=th(e,["toolUsePromptTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["toolUsePromptTokensDetails"],e)}let p=th(e,["trafficType"]);return null!=p&&tm(t,["trafficType"],p),t}(s)),null!=(o=th(l,["goAway"]))&&tm(e,["goAway"],o),null!=(c=th(l,["sessionResumptionUpdate"]))&&tm(e,["sessionResumptionUpdate"],c),null!=(d=th(l,["voiceActivityDetectionSignal"]))&&tm(e,["voiceActivityDetectionSignal"],d),null!=(u=th(l,["voiceActivity"]))&&tm(e,["voiceActivity"],(p={},null!=(m=th(u,["type"]))&&tm(p,["voiceActivityType"],m),p)),e))}else Object.assign(i,l);t(i)}class n1{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new nZ(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,l,r,a,s,o;let c,d;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let u=this.apiClient.getWebsocketBaseUrl(),p=this.apiClient.getApiVersion(),m=this.apiClient.getHeaders();e.config&&e.config.tools&&nW(e.config.tools)&&nY(m);let h=function(e){let t=new Headers;for(let[n,i]of Object.entries(e))t.append(n,i);return t}(m);if(this.apiClient.isVertexAI()){let e=this.apiClient.getProject(),t=this.apiClient.getLocation(),n=this.apiClient.getApiKey();this.apiClient.getCustomBaseUrl()&&!(e&&t||n)?c=u:(c=`${u}/ws/google.cloud.aiplatform.${p}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,c))}else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==p&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),c=`${u}/ws/google.ai.generativelanguage.${p}.GenerativeService.${t}?${n}=${e}`}let g=()=>{},f=new Promise(e=>{g=e}),x=e.callbacks,b=this.apiClient,y={onopen:function(){var e;null==(e=null==x?void 0:x.onopen)||e.call(x),g({})},onmessage:e=>{n0(b,x.onmessage,e)},onerror:null!=(t=null==x?void 0:x.onerror)?t:function(e){},onclose:null!=(n=null==x?void 0:x.onclose)?n:function(e){}},v=this.webSocketFactory.create(c,(d={},h.forEach((e,t)=>{d[t]=e}),d),y);v.connect(),await f;let _=tB(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&_.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();e&&t&&(_=`projects/${e}/locations/${t}/`+_)}let N={};this.apiClient.isVertexAI()&&(null==(i=e.config)?void 0:i.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[eO.AUDIO]}:e.config.responseModalities=[eO.AUDIO]),(null==(l=e.config)?void 0:l.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let w=null!=(a=null==(r=e.config)?void 0:r.tools)?a:[],E=[];for(let e of w)this.isCallableTool(e)?E.push(await e.tool()):E.push(e);E.length>0&&(e.config.tools=E);let j={model:_,config:e.config,callbacks:e.callbacks};if(this.apiClient.isVertexAI()){let e,t,n;s=this.apiClient,e={},null!=(t=th(j,["model"]))&&tm(e,["setup","model"],tB(s,t)),null!=(n=th(j,["config"]))&&tm(e,["config"],function(e,t){let n=th(e,["generationConfig"]);void 0!==t&&null!=n&&tm(t,["setup","generationConfig"],function(e){let t={},n=th(e,["modelSelectionConfig"]);null!=n&&tm(t,["modelConfig"],n);let i=th(e,["responseJsonSchema"]);null!=i&&tm(t,["responseJsonSchema"],i);let l=th(e,["audioTimestamp"]);null!=l&&tm(t,["audioTimestamp"],l);let r=th(e,["candidateCount"]);null!=r&&tm(t,["candidateCount"],r);let a=th(e,["enableAffectiveDialog"]);null!=a&&tm(t,["enableAffectiveDialog"],a);let s=th(e,["frequencyPenalty"]);null!=s&&tm(t,["frequencyPenalty"],s);let o=th(e,["logprobs"]);null!=o&&tm(t,["logprobs"],o);let c=th(e,["maxOutputTokens"]);null!=c&&tm(t,["maxOutputTokens"],c);let d=th(e,["mediaResolution"]);null!=d&&tm(t,["mediaResolution"],d);let u=th(e,["presencePenalty"]);null!=u&&tm(t,["presencePenalty"],u);let p=th(e,["responseLogprobs"]);null!=p&&tm(t,["responseLogprobs"],p);let m=th(e,["responseMimeType"]);null!=m&&tm(t,["responseMimeType"],m);let h=th(e,["responseModalities"]);null!=h&&tm(t,["responseModalities"],h);let g=th(e,["responseSchema"]);null!=g&&tm(t,["responseSchema"],g);let f=th(e,["routingConfig"]);null!=f&&tm(t,["routingConfig"],f);let x=th(e,["seed"]);null!=x&&tm(t,["seed"],x);let b=th(e,["speechConfig"]);null!=b&&tm(t,["speechConfig"],b);let y=th(e,["stopSequences"]);null!=y&&tm(t,["stopSequences"],y);let v=th(e,["temperature"]);null!=v&&tm(t,["temperature"],v);let _=th(e,["thinkingConfig"]);null!=_&&tm(t,["thinkingConfig"],_);let N=th(e,["topK"]);null!=N&&tm(t,["topK"],N);let w=th(e,["topP"]);if(null!=w&&tm(t,["topP"],w),void 0!==th(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));let i=th(e,["responseModalities"]);void 0!==t&&null!=i&&tm(t,["setup","generationConfig","responseModalities"],i);let l=th(e,["temperature"]);void 0!==t&&null!=l&&tm(t,["setup","generationConfig","temperature"],l);let r=th(e,["topP"]);void 0!==t&&null!=r&&tm(t,["setup","generationConfig","topP"],r);let a=th(e,["topK"]);void 0!==t&&null!=a&&tm(t,["setup","generationConfig","topK"],a);let s=th(e,["maxOutputTokens"]);void 0!==t&&null!=s&&tm(t,["setup","generationConfig","maxOutputTokens"],s);let o=th(e,["mediaResolution"]);void 0!==t&&null!=o&&tm(t,["setup","generationConfig","mediaResolution"],o);let c=th(e,["seed"]);void 0!==t&&null!=c&&tm(t,["setup","generationConfig","seed"],c);let d=th(e,["speechConfig"]);void 0!==t&&null!=d&&tm(t,["setup","generationConfig","speechConfig"],t8(d));let u=th(e,["thinkingConfig"]);void 0!==t&&null!=u&&tm(t,["setup","generationConfig","thinkingConfig"],u);let p=th(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&tm(t,["setup","generationConfig","enableAffectiveDialog"],p);let m=th(e,["systemInstruction"]);void 0!==t&&null!=m&&tm(t,["setup","systemInstruction"],t2(m));let h=th(e,["tools"]);if(void 0!==t&&null!=h){let e=t9(h);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["retrieval"]);null!=n&&tm(t,["retrieval"],n);let i=th(e,["computerUse"]);if(null!=i&&tm(t,["computerUse"],i),void 0!==th(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let l=th(e,["codeExecution"]);null!=l&&tm(t,["codeExecution"],l);let r=th(e,["enterpriseWebSearch"]);null!=r&&tm(t,["enterpriseWebSearch"],r);let a=th(e,["functionDeclarations"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["description"]);null!=n&&tm(t,["description"],n);let i=th(e,["name"]);null!=i&&tm(t,["name"],i);let l=th(e,["parameters"]);null!=l&&tm(t,["parameters"],l);let r=th(e,["parametersJsonSchema"]);null!=r&&tm(t,["parametersJsonSchema"],r);let a=th(e,["response"]);null!=a&&tm(t,["response"],a);let s=th(e,["responseJsonSchema"]);if(null!=s&&tm(t,["responseJsonSchema"],s),void 0!==th(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),tm(t,["functionDeclarations"],e)}let s=th(e,["googleMaps"]);null!=s&&tm(t,["googleMaps"],s);let o=th(e,["googleSearch"]);null!=o&&tm(t,["googleSearch"],o);let c=th(e,["googleSearchRetrieval"]);null!=c&&tm(t,["googleSearchRetrieval"],c);let d=th(e,["urlContext"]);return null!=d&&tm(t,["urlContext"],d),t})(t7(e)))),tm(t,["setup","tools"],e)}let g=th(e,["sessionResumption"]);void 0!==t&&null!=g&&tm(t,["setup","sessionResumption"],g);let f=th(e,["inputAudioTranscription"]);void 0!==t&&null!=f&&tm(t,["setup","inputAudioTranscription"],f);let x=th(e,["outputAudioTranscription"]);void 0!==t&&null!=x&&tm(t,["setup","outputAudioTranscription"],x);let b=th(e,["realtimeInputConfig"]);void 0!==t&&null!=b&&tm(t,["setup","realtimeInputConfig"],b);let y=th(e,["contextWindowCompression"]);void 0!==t&&null!=y&&tm(t,["setup","contextWindowCompression"],y);let v=th(e,["proactivity"]);void 0!==t&&null!=v&&tm(t,["setup","proactivity"],v);let _=th(e,["explicitVadSignal"]);return void 0!==t&&null!=_&&tm(t,["setup","explicitVadSignal"],_),{}}(n,e)),N=e}else{let e,t,n;o=this.apiClient,e={},null!=(t=th(j,["model"]))&&tm(e,["setup","model"],tB(o,t)),null!=(n=th(j,["config"]))&&tm(e,["config"],function(e,t){let n=th(e,["generationConfig"]);void 0!==t&&null!=n&&tm(t,["setup","generationConfig"],n);let i=th(e,["responseModalities"]);void 0!==t&&null!=i&&tm(t,["setup","generationConfig","responseModalities"],i);let l=th(e,["temperature"]);void 0!==t&&null!=l&&tm(t,["setup","generationConfig","temperature"],l);let r=th(e,["topP"]);void 0!==t&&null!=r&&tm(t,["setup","generationConfig","topP"],r);let a=th(e,["topK"]);void 0!==t&&null!=a&&tm(t,["setup","generationConfig","topK"],a);let s=th(e,["maxOutputTokens"]);void 0!==t&&null!=s&&tm(t,["setup","generationConfig","maxOutputTokens"],s);let o=th(e,["mediaResolution"]);void 0!==t&&null!=o&&tm(t,["setup","generationConfig","mediaResolution"],o);let c=th(e,["seed"]);void 0!==t&&null!=c&&tm(t,["setup","generationConfig","seed"],c);let d=th(e,["speechConfig"]);void 0!==t&&null!=d&&tm(t,["setup","generationConfig","speechConfig"],t8(d));let u=th(e,["thinkingConfig"]);void 0!==t&&null!=u&&tm(t,["setup","generationConfig","thinkingConfig"],u);let p=th(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&tm(t,["setup","generationConfig","enableAffectiveDialog"],p);let m=th(e,["systemInstruction"]);void 0!==t&&null!=m&&tm(t,["setup","systemInstruction"],function(e){let t={},n=th(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s,o,c,d,u,p,m;return n={},null!=(i=th(t=e,["mediaResolution"]))&&tm(n,["mediaResolution"],i),null!=(l=th(t,["codeExecutionResult"]))&&tm(n,["codeExecutionResult"],l),null!=(r=th(t,["executableCode"]))&&tm(n,["executableCode"],r),null!=(a=th(t,["fileData"]))&&tm(n,["fileData"],function(e){let t={};if(void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=th(e,["fileUri"]);null!=n&&tm(t,["fileUri"],n);let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(a)),null!=(s=th(t,["functionCall"]))&&tm(n,["functionCall"],function(e){let t={},n=th(e,["id"]);null!=n&&tm(t,["id"],n);let i=th(e,["args"]);null!=i&&tm(t,["args"],i);let l=th(e,["name"]);if(null!=l&&tm(t,["name"],l),void 0!==th(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==th(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s)),null!=(o=th(t,["functionResponse"]))&&tm(n,["functionResponse"],o),null!=(c=th(t,["inlineData"]))&&tm(n,["inlineData"],nI(c)),null!=(d=th(t,["text"]))&&tm(n,["text"],d),null!=(u=th(t,["thought"]))&&tm(n,["thought"],u),null!=(p=th(t,["thoughtSignature"]))&&tm(n,["thoughtSignature"],p),null!=(m=th(t,["videoMetadata"]))&&tm(n,["videoMetadata"],m),n})),tm(t,["parts"],e)}let i=th(e,["role"]);return null!=i&&tm(t,["role"],i),t}(t2(m)));let h=th(e,["tools"]);if(void 0!==t&&null!=h){let e=t9(h);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==th(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=th(e,["computerUse"]);null!=n&&tm(t,["computerUse"],n);let i=th(e,["fileSearch"]);null!=i&&tm(t,["fileSearch"],i);let l=th(e,["codeExecution"]);if(null!=l&&tm(t,["codeExecution"],l),void 0!==th(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let r=th(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["functionDeclarations"],e)}let a=th(e,["googleMaps"]);null!=a&&tm(t,["googleMaps"],function(e){let t={};if(void 0!==th(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=th(e,["enableWidget"]);return null!=n&&tm(t,["enableWidget"],n),t}(a));let s=th(e,["googleSearch"]);null!=s&&tm(t,["googleSearch"],function(e){let t={};if(void 0!==th(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==th(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=th(e,["timeRangeFilter"]);return null!=n&&tm(t,["timeRangeFilter"],n),t}(s));let o=th(e,["googleSearchRetrieval"]);null!=o&&tm(t,["googleSearchRetrieval"],o);let c=th(e,["urlContext"]);return null!=c&&tm(t,["urlContext"],c),t})(t7(e)))),tm(t,["setup","tools"],e)}let g=th(e,["sessionResumption"]);void 0!==t&&null!=g&&tm(t,["setup","sessionResumption"],function(e){let t={},n=th(e,["handle"]);if(null!=n&&tm(t,["handle"],n),void 0!==th(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(g));let f=th(e,["inputAudioTranscription"]);void 0!==t&&null!=f&&tm(t,["setup","inputAudioTranscription"],f);let x=th(e,["outputAudioTranscription"]);void 0!==t&&null!=x&&tm(t,["setup","outputAudioTranscription"],x);let b=th(e,["realtimeInputConfig"]);void 0!==t&&null!=b&&tm(t,["setup","realtimeInputConfig"],b);let y=th(e,["contextWindowCompression"]);void 0!==t&&null!=y&&tm(t,["setup","contextWindowCompression"],y);let v=th(e,["proactivity"]);if(void 0!==t&&null!=v&&tm(t,["setup","proactivity"],v),void 0!==th(e,["explicitVadSignal"]))throw Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}(n,e)),N=e}return delete N.config,v.send(JSON.stringify(N)),new n5(v,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let n2={turnComplete:!0};class n5{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=t4(t.turns),e.isVertexAI()||(n=n.map(e=>nA(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},n2),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},n=th(e,["media"]);if(null!=n){let e=tJ(n);Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["mediaChunks"],e)}let i=th(e,["audio"]);null!=i&&tm(t,["audio"],tK(i));let l=th(e,["audioStreamEnd"]);null!=l&&tm(t,["audioStreamEnd"],l);let r=th(e,["video"]);null!=r&&tm(t,["video"],tY(r));let a=th(e,["text"]);null!=a&&tm(t,["text"],a);let s=th(e,["activityStart"]);null!=s&&tm(t,["activityStart"],s);let o=th(e,["activityEnd"]);return null!=o&&tm(t,["activityEnd"],o),t}(e)}:{realtimeInput:function(e){let t={},n=th(e,["media"]);if(null!=n){let e=tJ(n);Array.isArray(e)&&(e=e.map(e=>nI(e))),tm(t,["mediaChunks"],e)}let i=th(e,["audio"]);null!=i&&tm(t,["audio"],nI(tK(i)));let l=th(e,["audioStreamEnd"]);null!=l&&tm(t,["audioStreamEnd"],l);let r=th(e,["video"]);null!=r&&tm(t,["video"],nI(tY(r)));let a=th(e,["text"]);null!=a&&tm(t,["text"],a);let s=th(e,["activityStart"]);null!=s&&tm(t,["activityStart"],s);let o=th(e,["activityEnd"]);return null!=o&&tm(t,["activityEnd"],o),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function n4(e){var t,n,i;if(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.disable)return!0;let l=!1;for(let t of null!=(n=null==e?void 0:e.tools)?n:[])if(n3(t)){l=!0;break}if(!l)return!0;let r=null==(i=null==e?void 0:e.automaticFunctionCalling)?void 0:i.maximumRemoteCalls;return(!(!r||!(r<0)&&Number.isInteger(r))||0==r)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0)}function n3(e){return"callTool"in e&&"function"==typeof e.callTool}function n6(e){var t;let n=[];return(null==(t=null==e?void 0:e.config)?void 0:t.tools)&&e.config.tools.forEach((e,t)=>{n3(e)||e.functionDeclarations&&e.functionDeclarations.length>0&&n.push(t)}),n}function n8(e){var t;return!(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.ignoreCallHistory)}class n7 extends tu{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,i,l,r,a,s,o;let c,d,u=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!(null!=(o=null==(s=null==(a=e.config)?void 0:a.tools)?void 0:s.some(e=>n3(e)))&&o)||n4(e.config))return await this.generateContentInternal(u);let p=n6(e);if(p.length>0){let e=p.map(e=>`tools[${e}]`).join(", ");throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let m=t4(u.contents),h=null!=(i=null==(n=null==(t=u.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?i:10,g=0;for(;g<h&&(c=await this.generateContentInternal(u)).functionCalls&&0!==c.functionCalls.length;){let t=c.candidates[0].content,n=[];for(let t of null!=(r=null==(l=e.config)?void 0:l.tools)?r:[])if(n3(t)){let e=await t.callTool(c.functionCalls);n.push(...e)}g++,d={role:"user",parts:n},u.contents=t4(u.contents),u.contents.push(t),u.contents.push(d),n8(u.config)&&(m.push(t),m.push(d))}return n8(u.config)&&(c.automaticFunctionCallingHistory=m),c},this.generateContentStream=async e=>{var t,n,i,l,r;if(this.maybeMoveToResponseJsonSchem(e),n4(e.config)){let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}let a=n6(e);if(a.length>0){let e=a.map(e=>`tools[${e}]`).join(", ");throw Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let s=null==(i=null==(n=null==(t=null==e?void 0:e.config)?void 0:t.toolConfig)?void 0:n.functionCallingConfig)?void 0:i.streamFunctionCallArguments,o=null==(r=null==(l=null==e?void 0:e.config)?void 0:l.automaticFunctionCalling)?void 0:r.disable;if(s&&!o)throw Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n,i=[];if(null==e?void 0:e.generatedImages)for(let l of e.generatedImages)l&&(null==l?void 0:l.safetyAttributes)&&(null==(t=null==l?void 0:l.safetyAttributes)?void 0:t.contentType)==="Positive Prompt"?n=null==l?void 0:l.safetyAttributes:i.push(l);return n?{generatedImages:i,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:i,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase)if(null==(t=n.config)?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else n.config.filter="labels.tune-type:*";return new nm(tl.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,i,l,r,a;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null==(t=e.video)?void 0:t.uri)&&(null==(n=e.video)?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null==(l=null==(i=e.source)?void 0:i.video)?void 0:l.uri)&&(null==(a=null==(r=e.source)?void 0:r.video)?void 0:a.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,n,i;let l=null==(t=e.config)?void 0:t.tools;if(!l)return e;let r=await Promise.all(l.map(async e=>n3(e)?await e.tool():e)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:r})};if(a.config.tools=r,e.config&&e.config.tools&&nW(e.config.tools)){let t=Object.assign({},null!=(i=null==(n=e.config.httpOptions)?void 0:n.headers)?i:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),nY(t),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return a}async initAfcToolsMap(e){var t,n,i;let l=new Map;for(let r of null!=(n=null==(t=e.config)?void 0:t.tools)?n:[])if(n3(r))for(let e of null!=(i=(await r.tool()).functionDeclarations)?i:[]){if(!e.name)throw Error("Function declaration name is required.");if(l.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);l.set(e.name,r)}return l}async processAfcStream(e){var t,n,i;let l=null!=(i=null==(n=null==(t=e.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?i:10,r=!1,a=0;return function(e,t,n){return ny(this,arguments,function*(){for(;a<l;){r&&(a++,r=!1);let g=yield nb(e.processParamsMaybeAddMcpUsage(n)),f=yield nb(e.generateContentStreamInternal(g)),x=[],b=[];try{for(var i,s,o,c,d,u,p,m=!0,h=(s=void 0,nv(f));!(i=(p=yield nb(h.next())).done);m=!0)if(c=p.value,m=!1,yield yield nb(c),c.candidates&&(null==(d=c.candidates[0])?void 0:d.content)){for(let e of(b.push(c.candidates[0].content),null!=(u=c.candidates[0].content.parts)?u:[]))if(a<l&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield nb(t.get(e.functionCall.name).callTool([e.functionCall]));x.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){s={error:e}}finally{try{!m&&!i&&(o=h.return)&&(yield nb(o.call(h)))}finally{if(s)throw s.error}}if(x.length>0){r=!0;let e=new tb;e.candidates=[{content:{role:"user",parts:x}}],yield yield nb(e);let t=[];t.push(...b),t.push({role:"user",parts:x});let i=t4(n.contents).concat(t);n.contents=i}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i=nT(this.apiClient,e);return r=tp("{model}:generateContent",i._url),a=i._query,delete i._url,delete i._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=nO(e),n=new tb;return Object.assign(n,t),n})}{let t=nC(this.apiClient,e);return r=tp("{model}:generateContent",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=nk(e),n=new tb;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i=nT(this.apiClient,e);return r=tp("{model}:streamGenerateContent?alt=sse",i._url),a=i._query,delete i._url,delete i._query,this.apiClient.requestStream({path:r,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(function(e){return ny(this,arguments,function*(){var t,n,i,l;try{for(var r,a=!0,s=nv(e);!(t=(r=yield nb(s.next())).done);a=!0){l=r.value,a=!1;let e=nO((yield nb(l.json())));e.sdkHttpResponse={headers:l.headers};let t=new tb;Object.assign(t,e),yield yield nb(t)}}catch(e){n={error:e}}finally{try{!a&&!t&&(i=s.return)&&(yield nb(i.call(s)))}finally{if(n)throw n.error}}})})}{let t=nC(this.apiClient,e);return r=tp("{model}:streamGenerateContent?alt=sse",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:r,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(function(e){return ny(this,arguments,function*(){var t,n,i,l;try{for(var r,a=!0,s=nv(e);!(t=(r=yield nb(s.next())).done);a=!0){l=r.value,a=!1;let e=nk((yield nb(l.json())));e.sdkHttpResponse={headers:l.headers};let t=new tb;Object.assign(t,e),yield yield nb(t)}}catch(e){n={error:e}}finally{try{!a&&!t&&(i=s.return)&&(yield nb(i.call(s)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i=function(e,t){let n,i,l,r,a,s={},o=th(t,["model"]);null!=o&&tm(s,["_url","model"],tB(e,o));let c=th(t,["contents"]);if(null!=c){let t=t5(e,c);Array.isArray(t)&&(t=t.map(e=>e)),tm(s,["instances[]","content"],t)}let d=th(t,["config"]);return null!=d&&(n=th(d,["taskType"]),void 0!==s&&null!=n&&tm(s,["instances[]","task_type"],n),i=th(d,["title"]),void 0!==s&&null!=i&&tm(s,["instances[]","title"],i),l=th(d,["outputDimensionality"]),void 0!==s&&null!=l&&tm(s,["parameters","outputDimensionality"],l),r=th(d,["mimeType"]),void 0!==s&&null!=r&&tm(s,["instances[]","mimeType"],r),a=th(d,["autoTruncate"]),void 0!==s&&null!=a&&tm(s,["parameters","autoTruncate"],a)),s}(this.apiClient,e);return r=tp("{model}:predict",i._url),a=i._query,delete i._url,delete i._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["predictions[]","embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s;return n={},null!=(i=th(e,["values"]))&&tm(n,["values"],i),null!=(l=th(e,["statistics"]))&&tm(n,["statistics"],(r={},null!=(a=th(t=l,["truncated"]))&&tm(r,["truncated"],a),null!=(s=th(t,["token_count"]))&&tm(r,["tokenCount"],s),r)),n})),tm(t,["embeddings"],e)}let l=th(e,["metadata"]);return null!=l&&tm(t,["metadata"],l),t}(e),n=new ty;return Object.assign(n,t),n})}{let t=function(e,t){let n={},i=th(t,["model"]);null!=i&&tm(n,["_url","model"],tB(e,i));let l=th(t,["contents"]);if(null!=l){let t=t5(e,l);Array.isArray(t)&&(t=t.map(e=>e)),tm(n,["requests[]","content"],t)}let r=th(t,["config"]);null!=r&&function(e,t){let n=th(e,["taskType"]);void 0!==t&&null!=n&&tm(t,["requests[]","taskType"],n);let i=th(e,["title"]);void 0!==t&&null!=i&&tm(t,["requests[]","title"],i);let l=th(e,["outputDimensionality"]);if(void 0!==t&&null!=l&&tm(t,["requests[]","outputDimensionality"],l),void 0!==th(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==th(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(r,n);let a=th(t,["model"]);return void 0!==a&&tm(n,["requests[]","model"],tB(e,a)),n}(this.apiClient,e);return r=tp("{model}:batchEmbedContents",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["embeddings"],e)}let l=th(e,["metadata"]);return null!=l&&tm(t,["metadata"],l),t}(e),n=new ty;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a,c,d,u,p,m,h,g,f,x,b,y,v,_,N,w,E,j,S,I=(r=this.apiClient,i={},null!=(l=th(e,["model"]))&&tm(i,["_url","model"],tB(r,l)),null!=(a=th(e,["prompt"]))&&tm(i,["instances[0]","prompt"],a),null!=(c=th(e,["config"]))&&(d=th(c,["outputGcsUri"]),void 0!==i&&null!=d&&tm(i,["parameters","storageUri"],d),u=th(c,["negativePrompt"]),void 0!==i&&null!=u&&tm(i,["parameters","negativePrompt"],u),p=th(c,["numberOfImages"]),void 0!==i&&null!=p&&tm(i,["parameters","sampleCount"],p),m=th(c,["aspectRatio"]),void 0!==i&&null!=m&&tm(i,["parameters","aspectRatio"],m),h=th(c,["guidanceScale"]),void 0!==i&&null!=h&&tm(i,["parameters","guidanceScale"],h),g=th(c,["seed"]),void 0!==i&&null!=g&&tm(i,["parameters","seed"],g),f=th(c,["safetyFilterLevel"]),void 0!==i&&null!=f&&tm(i,["parameters","safetySetting"],f),x=th(c,["personGeneration"]),void 0!==i&&null!=x&&tm(i,["parameters","personGeneration"],x),b=th(c,["includeSafetyAttributes"]),void 0!==i&&null!=b&&tm(i,["parameters","includeSafetyAttributes"],b),y=th(c,["includeRaiReason"]),void 0!==i&&null!=y&&tm(i,["parameters","includeRaiReason"],y),v=th(c,["language"]),void 0!==i&&null!=v&&tm(i,["parameters","language"],v),_=th(c,["outputMimeType"]),void 0!==i&&null!=_&&tm(i,["parameters","outputOptions","mimeType"],_),N=th(c,["outputCompressionQuality"]),void 0!==i&&null!=N&&tm(i,["parameters","outputOptions","compressionQuality"],N),w=th(c,["addWatermark"]),void 0!==i&&null!=w&&tm(i,["parameters","addWatermark"],w),E=th(c,["labels"]),void 0!==i&&null!=E&&tm(i,["labels"],E),j=th(c,["imageSize"]),void 0!==i&&null!=j&&tm(i,["parameters","sampleImageSize"],j),S=th(c,["enhancePrompt"]),void 0!==i&&null!=S&&tm(i,["parameters","enhancePrompt"],S)),i);return s=tp("{model}:predict",I._url),o=I._query,delete I._url,delete I._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(I),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nR(e))),tm(t,["generatedImages"],e)}let l=th(e,["positivePromptSafetyAttributes"]);return null!=l&&tm(t,["positivePromptSafetyAttributes"],nG(l)),t}(e),n=new tv;return Object.assign(n,t),n})}{let t,n,r,c,d=(a=this.apiClient,t={},null!=(n=th(e,["model"]))&&tm(t,["_url","model"],tB(a,n)),null!=(r=th(e,["prompt"]))&&tm(t,["instances[0]","prompt"],r),null!=(c=th(e,["config"]))&&function(e,t){if(void 0!==th(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==th(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let n=th(e,["numberOfImages"]);void 0!==t&&null!=n&&tm(t,["parameters","sampleCount"],n);let i=th(e,["aspectRatio"]);void 0!==t&&null!=i&&tm(t,["parameters","aspectRatio"],i);let l=th(e,["guidanceScale"]);if(void 0!==t&&null!=l&&tm(t,["parameters","guidanceScale"],l),void 0!==th(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let r=th(e,["safetyFilterLevel"]);void 0!==t&&null!=r&&tm(t,["parameters","safetySetting"],r);let a=th(e,["personGeneration"]);void 0!==t&&null!=a&&tm(t,["parameters","personGeneration"],a);let s=th(e,["includeSafetyAttributes"]);void 0!==t&&null!=s&&tm(t,["parameters","includeSafetyAttributes"],s);let o=th(e,["includeRaiReason"]);void 0!==t&&null!=o&&tm(t,["parameters","includeRaiReason"],o);let c=th(e,["language"]);void 0!==t&&null!=c&&tm(t,["parameters","language"],c);let d=th(e,["outputMimeType"]);void 0!==t&&null!=d&&tm(t,["parameters","outputOptions","mimeType"],d);let u=th(e,["outputCompressionQuality"]);if(void 0!==t&&null!=u&&tm(t,["parameters","outputOptions","compressionQuality"],u),void 0!==th(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==th(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let p=th(e,["imageSize"]);if(void 0!==t&&null!=p&&tm(t,["parameters","sampleImageSize"],p),void 0!==th(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(c,t),t);return s=tp("{model}:predict",d._url),o=d._query,delete d._url,delete d._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t,n;let i,l,r,a,s,o,c;return i={},null!=(l=th(t=e,["_self"]))&&tm(i,["image"],(r={},null!=(a=th(n=l,["bytesBase64Encoded"]))&&tm(r,["imageBytes"],tg(a)),null!=(s=th(n,["mimeType"]))&&tm(r,["mimeType"],s),r)),null!=(o=th(t,["raiFilteredReason"]))&&tm(i,["raiFilteredReason"],o),null!=(c=th(t,["_self"]))&&tm(i,["safetyAttributes"],nz(c)),i})),tm(t,["generatedImages"],e)}let l=th(e,["positivePromptSafetyAttributes"]);return null!=l&&tm(t,["positivePromptSafetyAttributes"],nz(l)),t}(e),n=new tv;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n,i,l,r,a,s,o,c,d,u,p,m,h,g,f,x,b,y={},v=th(t,["model"]);null!=v&&tm(y,["_url","model"],tB(e,v));let _=th(t,["prompt"]);null!=_&&tm(y,["instances[0]","prompt"],_);let N=th(t,["referenceImages"]);if(null!=N){let e=N;Array.isArray(e)&&(e=e.map(e=>(function(e){let t,n,i,l,r,a,s,o={},c=th(e,["referenceImage"]);null!=c&&tm(o,["referenceImage"],nD(c));let d=th(e,["referenceId"]);null!=d&&tm(o,["referenceId"],d);let u=th(e,["referenceType"]);null!=u&&tm(o,["referenceType"],u);let p=th(e,["maskImageConfig"]);null!=p&&tm(o,["maskImageConfig"],(t={},null!=(n=th(p,["maskMode"]))&&tm(t,["maskMode"],n),null!=(i=th(p,["segmentationClasses"]))&&tm(t,["maskClasses"],i),null!=(l=th(p,["maskDilation"]))&&tm(t,["dilation"],l),t));let m=th(e,["controlImageConfig"]);null!=m&&tm(o,["controlImageConfig"],(r={},null!=(a=th(m,["controlType"]))&&tm(r,["controlType"],a),null!=(s=th(m,["enableControlImageComputation"]))&&tm(r,["computeControl"],s),r));let h=th(e,["styleImageConfig"]);null!=h&&tm(o,["styleImageConfig"],h);let g=th(e,["subjectImageConfig"]);return null!=g&&tm(o,["subjectImageConfig"],g),o})(e))),tm(y,["instances[0]","referenceImages"],e)}let w=th(t,["config"]);return null!=w&&(n=th(w,["outputGcsUri"]),void 0!==y&&null!=n&&tm(y,["parameters","storageUri"],n),i=th(w,["negativePrompt"]),void 0!==y&&null!=i&&tm(y,["parameters","negativePrompt"],i),l=th(w,["numberOfImages"]),void 0!==y&&null!=l&&tm(y,["parameters","sampleCount"],l),r=th(w,["aspectRatio"]),void 0!==y&&null!=r&&tm(y,["parameters","aspectRatio"],r),a=th(w,["guidanceScale"]),void 0!==y&&null!=a&&tm(y,["parameters","guidanceScale"],a),s=th(w,["seed"]),void 0!==y&&null!=s&&tm(y,["parameters","seed"],s),o=th(w,["safetyFilterLevel"]),void 0!==y&&null!=o&&tm(y,["parameters","safetySetting"],o),c=th(w,["personGeneration"]),void 0!==y&&null!=c&&tm(y,["parameters","personGeneration"],c),d=th(w,["includeSafetyAttributes"]),void 0!==y&&null!=d&&tm(y,["parameters","includeSafetyAttributes"],d),u=th(w,["includeRaiReason"]),void 0!==y&&null!=u&&tm(y,["parameters","includeRaiReason"],u),p=th(w,["language"]),void 0!==y&&null!=p&&tm(y,["parameters","language"],p),m=th(w,["outputMimeType"]),void 0!==y&&null!=m&&tm(y,["parameters","outputOptions","mimeType"],m),h=th(w,["outputCompressionQuality"]),void 0!==y&&null!=h&&tm(y,["parameters","outputOptions","compressionQuality"],h),g=th(w,["addWatermark"]),void 0!==y&&null!=g&&tm(y,["parameters","addWatermark"],g),f=th(w,["labels"]),void 0!==y&&null!=f&&tm(y,["labels"],f),x=th(w,["editMode"]),void 0!==y&&null!=x&&tm(y,["parameters","editMode"],x),b=th(w,["baseSteps"]),void 0!==y&&null!=b&&tm(y,["parameters","editConfig","baseSteps"],b)),y}(this.apiClient,e);return i=tp("{model}:predict",r._url),l=r._query,delete r._url,delete r._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nR(e))),tm(t,["generatedImages"],e)}return t}(e),n=new t_;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n,i;let l="",r={};if(this.apiClient.isVertexAI()){let a,s,o,c,d,u,p,m,h,g,f,x,b,y,v,_,N=(i=this.apiClient,a={},null!=(s=th(e,["model"]))&&tm(a,["_url","model"],tB(i,s)),null!=(o=th(e,["image"]))&&tm(a,["instances[0]","image"],nD(o)),null!=(c=th(e,["upscaleFactor"]))&&tm(a,["parameters","upscaleConfig","upscaleFactor"],c),null!=(d=th(e,["config"]))&&(u=th(d,["outputGcsUri"]),void 0!==a&&null!=u&&tm(a,["parameters","storageUri"],u),p=th(d,["safetyFilterLevel"]),void 0!==a&&null!=p&&tm(a,["parameters","safetySetting"],p),m=th(d,["personGeneration"]),void 0!==a&&null!=m&&tm(a,["parameters","personGeneration"],m),h=th(d,["includeRaiReason"]),void 0!==a&&null!=h&&tm(a,["parameters","includeRaiReason"],h),g=th(d,["outputMimeType"]),void 0!==a&&null!=g&&tm(a,["parameters","outputOptions","mimeType"],g),f=th(d,["outputCompressionQuality"]),void 0!==a&&null!=f&&tm(a,["parameters","outputOptions","compressionQuality"],f),x=th(d,["enhanceInputImage"]),void 0!==a&&null!=x&&tm(a,["parameters","upscaleConfig","enhanceInputImage"],x),b=th(d,["imagePreservationFactor"]),void 0!==a&&null!=b&&tm(a,["parameters","upscaleConfig","imagePreservationFactor"],b),y=th(d,["labels"]),void 0!==a&&null!=y&&tm(a,["labels"],y),v=th(d,["numberOfImages"]),void 0!==a&&null!=v&&tm(a,["parameters","sampleCount"],v),_=th(d,["mode"]),void 0!==a&&null!=_&&tm(a,["parameters","mode"],_)),a);return l=tp("{model}:predict",N._url),r=N._query,delete N._url,delete N._query,this.apiClient.request({path:l,queryParams:r,body:JSON.stringify(N),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nR(e))),tm(t,["generatedImages"],e)}return t}(e),n=new tN;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n,i;let l="",r={};if(this.apiClient.isVertexAI()){let a,s,o,c,d,u,p,m,h,g,f,x,b,y,v,_=(i=this.apiClient,a={},null!=(s=th(e,["model"]))&&tm(a,["_url","model"],tB(i,s)),null!=(o=th(e,["source"]))&&function(e,t){let n=th(e,["prompt"]);void 0!==t&&null!=n&&tm(t,["instances[0]","prompt"],n);let i=th(e,["personImage"]);void 0!==t&&null!=i&&tm(t,["instances[0]","personImage","image"],nD(i));let l=th(e,["productImages"]);if(void 0!==t&&null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>{let t,n;return t={},null!=(n=th(e,["productImage"]))&&tm(t,["image"],nD(n)),t})),tm(t,["instances[0]","productImages"],e)}}(o,a),null!=(c=th(e,["config"]))&&(d=th(c,["numberOfImages"]),void 0!==a&&null!=d&&tm(a,["parameters","sampleCount"],d),u=th(c,["baseSteps"]),void 0!==a&&null!=u&&tm(a,["parameters","baseSteps"],u),p=th(c,["outputGcsUri"]),void 0!==a&&null!=p&&tm(a,["parameters","storageUri"],p),m=th(c,["seed"]),void 0!==a&&null!=m&&tm(a,["parameters","seed"],m),h=th(c,["safetyFilterLevel"]),void 0!==a&&null!=h&&tm(a,["parameters","safetySetting"],h),g=th(c,["personGeneration"]),void 0!==a&&null!=g&&tm(a,["parameters","personGeneration"],g),f=th(c,["addWatermark"]),void 0!==a&&null!=f&&tm(a,["parameters","addWatermark"],f),x=th(c,["outputMimeType"]),void 0!==a&&null!=x&&tm(a,["parameters","outputOptions","mimeType"],x),b=th(c,["outputCompressionQuality"]),void 0!==a&&null!=b&&tm(a,["parameters","outputOptions","compressionQuality"],b),y=th(c,["enhancePrompt"]),void 0!==a&&null!=y&&tm(a,["parameters","enhancePrompt"],y),v=th(c,["labels"]),void 0!==a&&null!=v&&tm(a,["labels"],v)),a);return l=tp("{model}:predict",_._url),r=_._query,delete _._url,delete _._query,this.apiClient.request({path:l,queryParams:r,body:JSON.stringify(_),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=th(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>nR(e))),tm(t,["generatedImages"],e)}return t}(e),n=new tw;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n,i,l,r;let a="",s={};if(this.apiClient.isVertexAI()){let o,c,d,u,p,m,h,g,f,x,b,y,v,_,N,w=(i=this.apiClient,m={},null!=(h=th(e,["model"]))&&tm(m,["_url","model"],tB(i,h)),null!=(g=th(e,["source"]))&&(l=g,r=m,d=th(l,["prompt"]),void 0!==r&&null!=d&&tm(r,["instances[0]","prompt"],d),u=th(l,["image"]),void 0!==r&&null!=u&&tm(r,["instances[0]","image"],nD(u)),p=th(l,["scribbleImage"]),void 0!==r&&null!=p&&tm(r,["instances[0]","scribble"],(o={},null!=(c=th(p,["image"]))&&tm(o,["image"],nD(c)),o))),null!=(f=th(e,["config"]))&&(x=th(f,["mode"]),void 0!==m&&null!=x&&tm(m,["parameters","mode"],x),b=th(f,["maxPredictions"]),void 0!==m&&null!=b&&tm(m,["parameters","maxPredictions"],b),y=th(f,["confidenceThreshold"]),void 0!==m&&null!=y&&tm(m,["parameters","confidenceThreshold"],y),v=th(f,["maskDilation"]),void 0!==m&&null!=v&&tm(m,["parameters","maskDilation"],v),_=th(f,["binaryColorThreshold"]),void 0!==m&&null!=_&&tm(m,["parameters","binaryColorThreshold"],_),N=th(f,["labels"]),void 0!==m&&null!=N&&tm(m,["labels"],N)),m);return a=tp("{model}:predict",w._url),s=w._query,delete w._url,delete w._query,this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(w),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=th(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=th(e,["_self"]);null!=n&&tm(t,["mask"],nP(n));let i=th(e,["labels"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["labels"],e)}return t})(e))),tm(t,["generatedMasks"],e)}return t}(e),n=new tE;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(r=this.apiClient,i={},null!=(l=th(e,["model"]))&&tm(i,["_url","name"],tB(r,l)),i);return s=tp("{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nL(e))}{let t,n,r=(a=this.apiClient,t={},null!=(n=th(e,["model"]))&&tm(t,["_url","name"],tB(a,n)),t);return s=tp("{name}",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>nU(e))}}async listInternal(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a,c,d,u,p=(r=this.apiClient,i={},null!=(l=th(e,["config"]))&&(a=th(l,["pageSize"]),void 0!==i&&null!=a&&tm(i,["_query","pageSize"],a),c=th(l,["pageToken"]),void 0!==i&&null!=c&&tm(i,["_query","pageToken"],c),d=th(l,["filter"]),void 0!==i&&null!=d&&tm(i,["_query","filter"],d),u=th(l,["queryBase"]),void 0!==i&&null!=u&&tm(i,["_url","models_url"],ni(r,u))),i);return s=tp("{models_url}",p._url),o=p._query,delete p._url,delete p._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["_self"]);if(null!=l){let e=nl(l);Array.isArray(e)&&(e=e.map(e=>nL(e))),tm(t,["models"],e)}return t}(e),n=new tj;return Object.assign(n,t),n})}{let t,n,r,c,d,u,p=(a=this.apiClient,t={},null!=(n=th(e,["config"]))&&(r=th(n,["pageSize"]),void 0!==t&&null!=r&&tm(t,["_query","pageSize"],r),c=th(n,["pageToken"]),void 0!==t&&null!=c&&tm(t,["_query","pageToken"],c),d=th(n,["filter"]),void 0!==t&&null!=d&&tm(t,["_query","filter"],d),u=th(n,["queryBase"]),void 0!==t&&null!=u&&tm(t,["_url","models_url"],ni(a,u))),t);return s=tp("{models_url}",p._url),o=p._query,delete p._url,delete p._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(p),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["_self"]);if(null!=l){let e=nl(l);Array.isArray(e)&&(e=e.map(e=>nU(e))),tm(t,["models"],e)}return t}(e),n=new tj;return Object.assign(n,t),n})}}async update(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a,c,d,u,p=(r=this.apiClient,i={},null!=(l=th(e,["model"]))&&tm(i,["_url","model"],tB(r,l)),null!=(a=th(e,["config"]))&&(c=th(a,["displayName"]),void 0!==i&&null!=c&&tm(i,["displayName"],c),d=th(a,["description"]),void 0!==i&&null!=d&&tm(i,["description"],d),u=th(a,["defaultCheckpointId"]),void 0!==i&&null!=u&&tm(i,["defaultCheckpointId"],u)),i);return s=tp("{model}",p._url),o=p._query,delete p._url,delete p._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nL(e))}{let t,n,r,c,d,u,p=(a=this.apiClient,t={},null!=(n=th(e,["model"]))&&tm(t,["_url","name"],tB(a,n)),null!=(r=th(e,["config"]))&&(c=th(r,["displayName"]),void 0!==t&&null!=c&&tm(t,["displayName"],c),d=th(r,["description"]),void 0!==t&&null!=d&&tm(t,["description"],d),u=th(r,["defaultCheckpointId"]),void 0!==t&&null!=u&&tm(t,["defaultCheckpointId"],u)),t);return s=tp("{name}",p._url),o=p._query,delete p._url,delete p._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>nU(e))}}async delete(e){var t,n,i,l,r,a;let s="",o={};if(this.apiClient.isVertexAI()){let i,l,a=(r=this.apiClient,i={},null!=(l=th(e,["model"]))&&tm(i,["_url","name"],tB(r,l)),i);return s=tp("{name}",a._url),o=a._query,delete a._url,delete a._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tS;return Object.assign(l,i),l})}{let t,n,r=(a=this.apiClient,t={},null!=(n=th(e,["model"]))&&tm(t,["_url","name"],tB(a,n)),t);return s=tp("{name}",r._url),o=r._query,delete r._url,delete r._query,this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tS;return Object.assign(l,i),l})}}async countTokens(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i=function(e,t){let n={},i=th(t,["model"]);null!=i&&tm(n,["_url","model"],tB(e,i));let l=th(t,["contents"]);if(null!=l){let e=t4(l);Array.isArray(e)&&(e=e.map(e=>e)),tm(n,["contents"],e)}let r=th(t,["config"]);return null!=r&&function(e,t){let n=th(e,["systemInstruction"]);void 0!==t&&null!=n&&tm(t,["systemInstruction"],t2(n));let i=th(e,["tools"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nF(e))),tm(t,["tools"],e)}let l=th(e,["generationConfig"]);void 0!==t&&null!=l&&tm(t,["generationConfig"],function(e){let t={},n=th(e,["modelSelectionConfig"]);null!=n&&tm(t,["modelConfig"],n);let i=th(e,["responseJsonSchema"]);null!=i&&tm(t,["responseJsonSchema"],i);let l=th(e,["audioTimestamp"]);null!=l&&tm(t,["audioTimestamp"],l);let r=th(e,["candidateCount"]);null!=r&&tm(t,["candidateCount"],r);let a=th(e,["enableAffectiveDialog"]);null!=a&&tm(t,["enableAffectiveDialog"],a);let s=th(e,["frequencyPenalty"]);null!=s&&tm(t,["frequencyPenalty"],s);let o=th(e,["logprobs"]);null!=o&&tm(t,["logprobs"],o);let c=th(e,["maxOutputTokens"]);null!=c&&tm(t,["maxOutputTokens"],c);let d=th(e,["mediaResolution"]);null!=d&&tm(t,["mediaResolution"],d);let u=th(e,["presencePenalty"]);null!=u&&tm(t,["presencePenalty"],u);let p=th(e,["responseLogprobs"]);null!=p&&tm(t,["responseLogprobs"],p);let m=th(e,["responseMimeType"]);null!=m&&tm(t,["responseMimeType"],m);let h=th(e,["responseModalities"]);null!=h&&tm(t,["responseModalities"],h);let g=th(e,["responseSchema"]);null!=g&&tm(t,["responseSchema"],g);let f=th(e,["routingConfig"]);null!=f&&tm(t,["routingConfig"],f);let x=th(e,["seed"]);null!=x&&tm(t,["seed"],x);let b=th(e,["speechConfig"]);null!=b&&tm(t,["speechConfig"],b);let y=th(e,["stopSequences"]);null!=y&&tm(t,["stopSequences"],y);let v=th(e,["temperature"]);null!=v&&tm(t,["temperature"],v);let _=th(e,["thinkingConfig"]);null!=_&&tm(t,["thinkingConfig"],_);let N=th(e,["topK"]);null!=N&&tm(t,["topK"],N);let w=th(e,["topP"]);if(null!=w&&tm(t,["topP"],w),void 0!==th(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(l))}(r,n),n}(this.apiClient,e);return r=tp("{model}:countTokens",i._url),a=i._query,delete i._url,delete i._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),null!=(i=th(e,["totalTokens"]))&&tm(t,["totalTokens"],i),t),r=new tI;return Object.assign(r,l),r})}{let t=function(e,t){let n={},i=th(t,["model"]);null!=i&&tm(n,["_url","model"],tB(e,i));let l=th(t,["contents"]);if(null!=l){let e=t4(l);Array.isArray(e)&&(e=e.map(e=>nA(e))),tm(n,["contents"],e)}let r=th(t,["config"]);return null!=r&&function(e){if(void 0!==th(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==th(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==th(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(r),n}(this.apiClient,e);return r=tp("{model}:countTokens",t._url),a=t._query,delete t._url,delete t._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l,r=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),null!=(i=th(e,["totalTokens"]))&&tm(t,["totalTokens"],i),null!=(l=th(e,["cachedContentTokenCount"]))&&tm(t,["cachedContentTokenCount"],l),t),a=new tI;return Object.assign(a,r),a})}}async computeTokens(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},i=th(t,["model"]);null!=i&&tm(n,["_url","model"],tB(e,i));let l=th(t,["contents"]);if(null!=l){let e=t4(l);Array.isArray(e)&&(e=e.map(e=>e)),tm(n,["contents"],e)}return n}(this.apiClient,e);return i=tp("{model}:computeTokens",r._url),l=r._query,delete r._url,delete r._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["tokensInfo"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["tokensInfo"],e)}return t}(e),n=new tA;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,i,l,r,a,s,o,c,d;let u="",p={};if(this.apiClient.isVertexAI()){let i,l,a,c,d,m,h,g,f,x,b=(r=this.apiClient,c={},null!=(d=th(e,["model"]))&&tm(c,["_url","model"],tB(r,d)),null!=(m=th(e,["prompt"]))&&tm(c,["instances[0]","prompt"],m),null!=(h=th(e,["image"]))&&tm(c,["instances[0]","image"],nD(h)),null!=(g=th(e,["video"]))&&tm(c,["instances[0]","video"],nH(g)),null!=(f=th(e,["source"]))&&(s=f,o=c,i=th(s,["prompt"]),void 0!==o&&null!=i&&tm(o,["instances[0]","prompt"],i),l=th(s,["image"]),void 0!==o&&null!=l&&tm(o,["instances[0]","image"],nD(l)),a=th(s,["video"]),void 0!==o&&null!=a&&tm(o,["instances[0]","video"],nH(a))),null!=(x=th(e,["config"]))&&function(e,t){var n;let i,l,r,a=th(e,["numberOfVideos"]);void 0!==t&&null!=a&&tm(t,["parameters","sampleCount"],a);let s=th(e,["outputGcsUri"]);void 0!==t&&null!=s&&tm(t,["parameters","storageUri"],s);let o=th(e,["fps"]);void 0!==t&&null!=o&&tm(t,["parameters","fps"],o);let c=th(e,["durationSeconds"]);void 0!==t&&null!=c&&tm(t,["parameters","durationSeconds"],c);let d=th(e,["seed"]);void 0!==t&&null!=d&&tm(t,["parameters","seed"],d);let u=th(e,["aspectRatio"]);void 0!==t&&null!=u&&tm(t,["parameters","aspectRatio"],u);let p=th(e,["resolution"]);void 0!==t&&null!=p&&tm(t,["parameters","resolution"],p);let m=th(e,["personGeneration"]);void 0!==t&&null!=m&&tm(t,["parameters","personGeneration"],m);let h=th(e,["pubsubTopic"]);void 0!==t&&null!=h&&tm(t,["parameters","pubsubTopic"],h);let g=th(e,["negativePrompt"]);void 0!==t&&null!=g&&tm(t,["parameters","negativePrompt"],g);let f=th(e,["enhancePrompt"]);void 0!==t&&null!=f&&tm(t,["parameters","enhancePrompt"],f);let x=th(e,["generateAudio"]);void 0!==t&&null!=x&&tm(t,["parameters","generateAudio"],x);let b=th(e,["lastFrame"]);void 0!==t&&null!=b&&tm(t,["instances[0]","lastFrame"],nD(b));let y=th(e,["referenceImages"]);if(void 0!==t&&null!=y){let e=y;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l;return n={},null!=(i=th(t=e,["image"]))&&tm(n,["image"],nD(i)),null!=(l=th(t,["referenceType"]))&&tm(n,["referenceType"],l),n})),tm(t,["instances[0]","referenceImages"],e)}let v=th(e,["mask"]);void 0!==t&&null!=v&&tm(t,["instances[0]","mask"],(i={},null!=(l=th(n=v,["image"]))&&tm(i,["_self"],nD(l)),null!=(r=th(n,["maskMode"]))&&tm(i,["maskMode"],r),i));let _=th(e,["compressionQuality"]);void 0!==t&&null!=_&&tm(t,["parameters","compressionQuality"],_)}(x,c),c);return u=tp("{model}:predictLongRunning",b._url),p=b._query,delete b._url,delete b._query,this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i,l,r,a,s=(t={},null!=(n=th(e,["name"]))&&tm(t,["name"],n),null!=(i=th(e,["metadata"]))&&tm(t,["metadata"],i),null!=(l=th(e,["done"]))&&tm(t,["done"],l),null!=(r=th(e,["error"]))&&tm(t,["error"],r),null!=(a=th(e,["response"]))&&tm(t,["response"],function(e){let t={},n=th(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s;return n={},null!=(i=th(e,["_self"]))&&tm(n,["video"],(l={},null!=(r=th(t=i,["gcsUri"]))&&tm(l,["uri"],r),null!=(a=th(t,["bytesBase64Encoded"]))&&tm(l,["videoBytes"],tg(a)),null!=(s=th(t,["mimeType"]))&&tm(l,["mimeType"],s),l)),n})),tm(t,["generatedVideos"],e)}let i=th(e,["raiMediaFilteredCount"]);null!=i&&tm(t,["raiMediaFilteredCount"],i);let l=th(e,["raiMediaFilteredReasons"]);return null!=l&&tm(t,["raiMediaFilteredReasons"],l),t}(a)),t),o=new tC;return Object.assign(o,s),o})}{let t,n,r,s,o,m,h,g,f,x,b=(a=this.apiClient,s={},null!=(o=th(e,["model"]))&&tm(s,["_url","model"],tB(a,o)),null!=(m=th(e,["prompt"]))&&tm(s,["instances[0]","prompt"],m),null!=(h=th(e,["image"]))&&tm(s,["instances[0]","image"],nM(h)),null!=(g=th(e,["video"]))&&tm(s,["instances[0]","video"],nq(g)),null!=(f=th(e,["source"]))&&(c=f,d=s,t=th(c,["prompt"]),void 0!==d&&null!=t&&tm(d,["instances[0]","prompt"],t),n=th(c,["image"]),void 0!==d&&null!=n&&tm(d,["instances[0]","image"],nM(n)),r=th(c,["video"]),void 0!==d&&null!=r&&tm(d,["instances[0]","video"],nq(r))),null!=(x=th(e,["config"]))&&function(e,t){let n=th(e,["numberOfVideos"]);if(void 0!==t&&null!=n&&tm(t,["parameters","sampleCount"],n),void 0!==th(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==th(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let i=th(e,["durationSeconds"]);if(void 0!==t&&null!=i&&tm(t,["parameters","durationSeconds"],i),void 0!==th(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let l=th(e,["aspectRatio"]);void 0!==t&&null!=l&&tm(t,["parameters","aspectRatio"],l);let r=th(e,["resolution"]);void 0!==t&&null!=r&&tm(t,["parameters","resolution"],r);let a=th(e,["personGeneration"]);if(void 0!==t&&null!=a&&tm(t,["parameters","personGeneration"],a),void 0!==th(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let s=th(e,["negativePrompt"]);void 0!==t&&null!=s&&tm(t,["parameters","negativePrompt"],s);let o=th(e,["enhancePrompt"]);if(void 0!==t&&null!=o&&tm(t,["parameters","enhancePrompt"],o),void 0!==th(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let c=th(e,["lastFrame"]);void 0!==t&&null!=c&&tm(t,["instances[0]","lastFrame"],nM(c));let d=th(e,["referenceImages"]);if(void 0!==t&&null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l;return n={},null!=(i=th(t=e,["image"]))&&tm(n,["image"],nM(i)),null!=(l=th(t,["referenceType"]))&&tm(n,["referenceType"],l),n})),tm(t,["instances[0]","referenceImages"],e)}if(void 0!==th(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==th(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(x,s),s);return u=tp("{model}:predictLongRunning",b._url),p=b._query,delete b._url,delete b._query,this.apiClient.request({path:u,queryParams:p,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i,l,r,a,s=(t={},null!=(n=th(e,["name"]))&&tm(t,["name"],n),null!=(i=th(e,["metadata"]))&&tm(t,["metadata"],i),null!=(l=th(e,["done"]))&&tm(t,["done"],l),null!=(r=th(e,["error"]))&&tm(t,["error"],r),null!=(a=th(e,["response","generateVideoResponse"]))&&tm(t,["response"],function(e){let t={},n=th(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s;return n={},null!=(i=th(e,["video"]))&&tm(n,["video"],(l={},null!=(r=th(t=i,["uri"]))&&tm(l,["uri"],r),null!=(a=th(t,["encodedVideo"]))&&tm(l,["videoBytes"],tg(a)),null!=(s=th(t,["encoding"]))&&tm(l,["mimeType"],s),l)),n})),tm(t,["generatedVideos"],e)}let i=th(e,["raiMediaFilteredCount"]);null!=i&&tm(t,["raiMediaFilteredCount"],i);let l=th(e,["raiMediaFilteredReasons"]);return null!=l&&tm(t,["raiMediaFilteredReasons"],l),t}(a)),t),o=new tC;return Object.assign(o,s),o})}}}class n9 extends tu{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,i=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,i=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i,l,s=(i={},null!=(l=th(e,["operationName"]))&&tm(i,["_url","operationName"],l),i);return r=tp("{operationName}",s._url),a=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}{let t,n,s=(t={},null!=(n=th(e,["operationName"]))&&tm(t,["_url","operationName"],n),t);return r=tp("{operationName}",s._url),a=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI()){let r,a,s,o=(r={},null!=(a=th(e,["operationName"]))&&tm(r,["operationName"],a),null!=(s=th(e,["resourceName"]))&&tm(r,["_url","resourceName"],s),r);return i=tp("{resourceName}:fetchPredictOperation",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class ie extends tu{constructor(e){super(),this.apiClient=e}async create(e){var t,n,i,l,r;let a="",s={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let o,c,d,u,p,m,h,g,f,x,b=(i=this.apiClient,u={},null!=(p=th(e,["config"]))&&tm(u,["config"],(m=th(p,["expireTime"]),void 0!==u&&null!=m&&tm(u,["expireTime"],m),h=th(p,["newSessionExpireTime"]),void 0!==u&&null!=h&&tm(u,["newSessionExpireTime"],h),g=th(p,["uses"]),void 0!==u&&null!=g&&tm(u,["uses"],g),f=th(p,["liveConnectConstraints"]),void 0!==u&&null!=f&&tm(u,["bidiGenerateContentSetup"],(l=i,o={},null!=(c=th(r=f,["model"]))&&tm(o,["setup","model"],tB(l,c)),null!=(d=th(r,["config"]))&&tm(o,["config"],function(e,t){let n=th(e,["generationConfig"]);void 0!==t&&null!=n&&tm(t,["setup","generationConfig"],n);let i=th(e,["responseModalities"]);void 0!==t&&null!=i&&tm(t,["setup","generationConfig","responseModalities"],i);let l=th(e,["temperature"]);void 0!==t&&null!=l&&tm(t,["setup","generationConfig","temperature"],l);let r=th(e,["topP"]);void 0!==t&&null!=r&&tm(t,["setup","generationConfig","topP"],r);let a=th(e,["topK"]);void 0!==t&&null!=a&&tm(t,["setup","generationConfig","topK"],a);let s=th(e,["maxOutputTokens"]);void 0!==t&&null!=s&&tm(t,["setup","generationConfig","maxOutputTokens"],s);let o=th(e,["mediaResolution"]);void 0!==t&&null!=o&&tm(t,["setup","generationConfig","mediaResolution"],o);let c=th(e,["seed"]);void 0!==t&&null!=c&&tm(t,["setup","generationConfig","seed"],c);let d=th(e,["speechConfig"]);void 0!==t&&null!=d&&tm(t,["setup","generationConfig","speechConfig"],t8(d));let u=th(e,["thinkingConfig"]);void 0!==t&&null!=u&&tm(t,["setup","generationConfig","thinkingConfig"],u);let p=th(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&tm(t,["setup","generationConfig","enableAffectiveDialog"],p);let m=th(e,["systemInstruction"]);void 0!==t&&null!=m&&tm(t,["setup","systemInstruction"],function(e){let t={},n=th(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,l,r,a,s,o,c,d,u,p,m;return n={},null!=(i=th(t=e,["mediaResolution"]))&&tm(n,["mediaResolution"],i),null!=(l=th(t,["codeExecutionResult"]))&&tm(n,["codeExecutionResult"],l),null!=(r=th(t,["executableCode"]))&&tm(n,["executableCode"],r),null!=(a=th(t,["fileData"]))&&tm(n,["fileData"],function(e){let t={};if(void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=th(e,["fileUri"]);null!=n&&tm(t,["fileUri"],n);let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(a)),null!=(s=th(t,["functionCall"]))&&tm(n,["functionCall"],function(e){let t={},n=th(e,["id"]);null!=n&&tm(t,["id"],n);let i=th(e,["args"]);null!=i&&tm(t,["args"],i);let l=th(e,["name"]);if(null!=l&&tm(t,["name"],l),void 0!==th(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==th(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s)),null!=(o=th(t,["functionResponse"]))&&tm(n,["functionResponse"],o),null!=(c=th(t,["inlineData"]))&&tm(n,["inlineData"],function(e){let t={},n=th(e,["data"]);if(null!=n&&tm(t,["data"],n),void 0!==th(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let i=th(e,["mimeType"]);return null!=i&&tm(t,["mimeType"],i),t}(c)),null!=(d=th(t,["text"]))&&tm(n,["text"],d),null!=(u=th(t,["thought"]))&&tm(n,["thought"],u),null!=(p=th(t,["thoughtSignature"]))&&tm(n,["thoughtSignature"],p),null!=(m=th(t,["videoMetadata"]))&&tm(n,["videoMetadata"],m),n})),tm(t,["parts"],e)}let i=th(e,["role"]);return null!=i&&tm(t,["role"],i),t}(t2(m)));let h=th(e,["tools"]);if(void 0!==t&&null!=h){let e=t9(h);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==th(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let n=th(e,["computerUse"]);null!=n&&tm(t,["computerUse"],n);let i=th(e,["fileSearch"]);null!=i&&tm(t,["fileSearch"],i);let l=th(e,["codeExecution"]);if(null!=l&&tm(t,["codeExecution"],l),void 0!==th(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let r=th(e,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["functionDeclarations"],e)}let a=th(e,["googleMaps"]);null!=a&&tm(t,["googleMaps"],function(e){let t={};if(void 0!==th(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=th(e,["enableWidget"]);return null!=n&&tm(t,["enableWidget"],n),t}(a));let s=th(e,["googleSearch"]);null!=s&&tm(t,["googleSearch"],function(e){let t={};if(void 0!==th(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==th(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=th(e,["timeRangeFilter"]);return null!=n&&tm(t,["timeRangeFilter"],n),t}(s));let o=th(e,["googleSearchRetrieval"]);null!=o&&tm(t,["googleSearchRetrieval"],o);let c=th(e,["urlContext"]);return null!=c&&tm(t,["urlContext"],c),t})(t7(e)))),tm(t,["setup","tools"],e)}let g=th(e,["sessionResumption"]);void 0!==t&&null!=g&&tm(t,["setup","sessionResumption"],function(e){let t={},n=th(e,["handle"]);if(null!=n&&tm(t,["handle"],n),void 0!==th(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(g));let f=th(e,["inputAudioTranscription"]);void 0!==t&&null!=f&&tm(t,["setup","inputAudioTranscription"],f);let x=th(e,["outputAudioTranscription"]);void 0!==t&&null!=x&&tm(t,["setup","outputAudioTranscription"],x);let b=th(e,["realtimeInputConfig"]);void 0!==t&&null!=b&&tm(t,["setup","realtimeInputConfig"],b);let y=th(e,["contextWindowCompression"]);void 0!==t&&null!=y&&tm(t,["setup","contextWindowCompression"],y);let v=th(e,["proactivity"]);if(void 0!==t&&null!=v&&tm(t,["setup","proactivity"],v),void 0!==th(e,["explicitVadSignal"]))throw Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}(d,o)),o)),x=th(p,["lockAdditionalFields"]),void 0!==u&&null!=x&&tm(u,["fieldMask"],x),{})),u);a=tp("auth_tokens",b._url),s=b._query,delete b.config,delete b._url,delete b._query;let y=function(e,t){let n=null,i=e.bidiGenerateContentSetup;if("object"==typeof i&&null!==i&&"setup"in i){let t=i.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==i&&delete e.bidiGenerateContentSetup;let l=e.fieldMask;if(n){let i=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n];if("object"==typeof i&&null!=i&&Object.keys(i).length>0){let e=Object.keys(i).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==l&&Array.isArray(l)&&l.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];l.length>0&&(n=l.map(e=>t.includes(e)?`generationConfig.${e}`:e));let r=[];i&&r.push(i),n.length>0&&r.push(...n),r.length>0?e.fieldMask=r.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==l&&Array.isArray(l)&&l.length>0?e.fieldMask=l.join(","):delete e.fieldMask;return e}(b,e.config);return this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(y),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}}class it extends tu{constructor(e){super(),this.apiClient=e,this.list=async e=>new nm(tl.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s=(r={},null!=(a=th(e,["name"]))&&tm(r,["_url","name"],a),r);return i=tp("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o,c=(r={},null!=(a=th(e,["name"]))&&tm(r,["_url","name"],a),null!=(s=th(e,["config"]))&&(o=th(s,["force"]),void 0!==r&&null!=o&&tm(r,["_query","force"],o)),r);i=tp("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o,c,d=(r={},null!=(a=th(e,["parent"]))&&tm(r,["_url","parent"],a),null!=(s=th(e,["config"]))&&(o=th(s,["pageSize"]),void 0!==r&&null!=o&&tm(r,["_query","pageSize"],o),c=th(s,["pageToken"]),void 0!==r&&null!=c&&tm(r,["_query","pageToken"],c)),r);return i=tp("{parent}/documents",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["documents"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["documents"],e)}return t}(e),n=new tP;return Object.assign(n,t),n})}}}class ii extends tu{constructor(e,t=new it(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new nm(tl.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o=(r={},null!=(a=th(e,["config"]))&&(s=th(a,["displayName"]),void 0!==r&&null!=s&&tm(r,["displayName"],s)),r);return i=tp("fileSearchStores",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s=(r={},null!=(a=th(e,["name"]))&&tm(r,["_url","name"],a),r);return i=tp("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o,c=(r={},null!=(a=th(e,["name"]))&&tm(r,["_url","name"],a),null!=(s=th(e,["config"]))&&(o=th(s,["force"]),void 0!==r&&null!=o&&tm(r,["_query","force"],o)),r);i=tp("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}}async listInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o,c=(r={},null!=(a=th(e,["config"]))&&(s=th(a,["pageSize"]),void 0!==r&&null!=s&&tm(r,["_query","pageSize"],s),o=th(a,["pageToken"]),void 0!==r&&null!=o&&tm(r,["_query","pageToken"],o)),r);return i=tp("fileSearchStores",c._url),l=c._query,delete c._url,delete c._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=th(e,["sdkHttpResponse"]);null!=n&&tm(t,["sdkHttpResponse"],n);let i=th(e,["nextPageToken"]);null!=i&&tm(t,["nextPageToken"],i);let l=th(e,["fileSearchStores"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["fileSearchStores"],e)}return t}(e),n=new tM;return Object.assign(n,t),n})}}async uploadToFileSearchStoreInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o=(r={},null!=(a=th(e,["fileSearchStoreName"]))&&tm(r,["_url","file_search_store_name"],a),null!=(s=th(e,["config"]))&&nV(s,r),r);return i=tp("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",o._url),l=o._query,delete o._url,delete o._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tD;return Object.assign(l,i),l})}}async importFile(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o,c=(r={},null!=(a=th(e,["fileSearchStoreName"]))&&tm(r,["_url","file_search_store_name"],a),null!=(s=th(e,["fileName"]))&&tm(r,["fileName"],s),null!=(o=th(e,["config"]))&&function(e,t){let n=th(e,["customMetadata"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tm(t,["customMetadata"],e)}let i=th(e,["chunkingConfig"]);void 0!==t&&null!=i&&tm(t,["chunkingConfig"],i)}(o,r),r);return i=tp("{file_search_store_name}:importFile",c._url),l=c._query,delete c._url,delete c._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{var t;let n,i,l,r,a,s,o,c,d,u,p=(a={},null!=(s=th(e,["name"]))&&tm(a,["name"],s),null!=(o=th(e,["metadata"]))&&tm(a,["metadata"],o),null!=(c=th(e,["done"]))&&tm(a,["done"],c),null!=(d=th(e,["error"]))&&tm(a,["error"],d),null!=(u=th(e,["response"]))&&tm(a,["response"],(n={},null!=(i=th(t=u,["sdkHttpResponse"]))&&tm(n,["sdkHttpResponse"],i),null!=(l=th(t,["parent"]))&&tm(n,["parent"],l),null!=(r=th(t,["documentName"]))&&tm(n,["documentName"],r),n)),a),m=new tU;return Object.assign(m,p),m})}}}let il=function(){let{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return il=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^n()&15>>e/4).toString(16))};function ir(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let ia=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch(e){}try{return Error(JSON.stringify(e))}catch(e){}}return Error(e)};class is extends Error{}class io extends is{constructor(e,t,n,i){super(`${io.makeMessage(e,t,n)}`),this.status=e,this.headers=i,this.error=t}static makeMessage(e,t,n){let i=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,n,i){return e&&i?400===e?new ip(e,t,n,i):401===e?new im(e,t,n,i):403===e?new ih(e,t,n,i):404===e?new ig(e,t,n,i):409===e?new ix(e,t,n,i):422===e?new ib(e,t,n,i):429===e?new iy(e,t,n,i):e>=500?new iv(e,t,n,i):new io(e,t,n,i):new id({message:n,cause:ia(t)})}}class ic extends io{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class id extends io{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class iu extends id{constructor({message:e}={}){super({message:null!=e?e:"Request timed out."})}}class ip extends io{}class im extends io{}class ih extends io{}class ig extends io{}class ix extends io{}class ib extends io{}class iy extends io{}class iv extends io{}let i_=/^[a-z][a-z0-9+.-]*:/i,iN=e=>(iN=Array.isArray)(e),iw=iN,iE="0.0.1",ij=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",iS=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function iI(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function iA(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function iC(e){var t,n;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await (null==(n=(t=e[Symbol.asyncIterator]()).return)?void 0:n.call(t));let i=e.getReader(),l=i.cancel();i.releaseLock(),await l}let iT=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),ik=()=>{var e;if("u"<typeof File){let{process:t}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof(null==(e=null==t?void 0:t.versions)?void 0:e.node)&&20>parseInt(t.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function iO(e,t,n){return ik(),new File(e,null!=t?t:"unknown_file",n)}let iR=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function iP(e,t,n){var i;let l,r;if(ik(),null!=(l=e=await e)&&"object"==typeof l&&"string"==typeof l.name&&"number"==typeof l.lastModified&&iR(l))return e instanceof File?e:iO([await e.arrayBuffer()],e.name);if(null!=(r=e)&&"object"==typeof r&&"string"==typeof r.url&&"function"==typeof r.blob){let i=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),iO(await iM(i),t,n)}let a=await iM(e);if(t||(t=("object"==typeof(i=e)&&null!==i&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0),!(null==n?void 0:n.type)){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(n=Object.assign(Object.assign({},n),{type:e}))}return iO(a,t,n)}async function iM(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(iR(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator])try{for(var n,i,l,r,a,s,o=!0,c=nv(e);!(n=(s=await c.next()).done);o=!0)r=s.value,o=!1,t.push(...await iM(r))}catch(e){i={error:e}}finally{try{!o&&!n&&(l=c.return)&&await l.call(c)}finally{if(i)throw i.error}}else{let t=null==(a=null==e?void 0:e.constructor)?void 0:a.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class iD{constructor(e){this._client=e}}function iU(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}iD._key=[];let iL=Object.freeze(Object.create(null)),iz=((e=iU)=>function(t,...n){let i;if(1===t.length)return t[0];let l=!1,r=[],a=t.reduce((t,i,a)=>{var s,o,c;/[?#]/.test(i)&&(l=!0);let d=n[a],u=(l?encodeURIComponent:e)(""+d);return a!==n.length&&(null==d||"object"==typeof d&&d.toString===(null==(c=Object.getPrototypeOf(null!=(o=Object.getPrototypeOf(null!=(s=d.hasOwnProperty)?s:iL))?o:iL))?void 0:c.toString))&&(u=d+"",r.push({start:t.length+i.length,length:u.length,error:`Value of type ${Object.prototype.toString.call(d).slice(8,-1)} is not a valid path parameter`})),t+i+(a===n.length?"":u)},""),s=a.split(/[?#]/,1)[0],o=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(i=o.exec(s));)r.push({start:i.index,length:i[0].length,error:`Value "${i[0]}" can't be safely passed as a path parameter`});if(r.sort((e,t)=>e.start-t.start),r.length>0){let e=0,t=r.reduce((t,n)=>{let i=" ".repeat(n.start-e),l="^".repeat(n.length);return e=n.start+n.length,t+i+l},"");throw new is(`Path parameters result in path with invalid segments:
${r.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(iU);class iG extends iD{create(e,t){var n;let{api_version:i=this._client.apiVersion}=e,l=nx(e,["api_version"]);if("model"in l&&"agent_config"in l)throw new is("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in l&&"generation_config"in l)throw new is("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(iz`/${i}/interactions`,Object.assign(Object.assign({body:l},t),{stream:null!=(n=e.stream)&&n}))}delete(e,t={},n){let{api_version:i=this._client.apiVersion}=null!=t?t:{};return this._client.delete(iz`/${i}/interactions/${e}`,n)}cancel(e,t={},n){let{api_version:i=this._client.apiVersion}=null!=t?t:{};return this._client.post(iz`/${i}/interactions/${e}/cancel`,n)}get(e,t={},n){var i;let l=null!=t?t:{},{api_version:r=this._client.apiVersion}=l,a=nx(l,["api_version"]);return this._client.get(iz`/${r}/interactions/${e}`,Object.assign(Object.assign({query:a},n),{stream:null!=(i=null==t?void 0:t.stream)&&i}))}}iG._key=Object.freeze(["interactions"]);class iF extends iG{}function iq(e){let t;return(null!=n?n:n=(t=new globalThis.TextEncoder).encode.bind(t))(e)}function iH(e){let t;return(null!=i?i:i=(t=new globalThis.TextDecoder).decode.bind(t))(e)}class iV{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){let t;if(null==e)return[];let n=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?iq(e):e;this.buffer=function(e){let t=0;for(let n of e)t+=n.length;let n=new Uint8Array(t),i=0;for(let t of e)n.set(t,i),i+=t.length;return n}([this.buffer,n]);let i=[];for(;null!=(t=function(e,t){for(let n=null!=t?t:0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}(this.buffer,this.carriageReturnIndex));){if(t.carriage&&null==this.carriageReturnIndex){this.carriageReturnIndex=t.index;continue}if(null!=this.carriageReturnIndex&&(t.index!==this.carriageReturnIndex+1||t.carriage)){i.push(iH(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let e=null!==this.carriageReturnIndex?t.preceding-1:t.preceding,n=iH(this.buffer.subarray(0,e));i.push(n),this.buffer=this.buffer.subarray(t.index),this.carriageReturnIndex=null}return i}flush(){return this.buffer.length?this.decode("\n"):[]}}iV.NEWLINE_CHARS=new Set(["\n","\r"]),iV.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let iB={off:0,error:200,warn:300,info:400,debug:500},i$=(e,t,n)=>{if(e){if(Object.prototype.hasOwnProperty.call(iB,e))return e;iX(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(iB))}`)}};function iJ(){}function iW(e,t,n){return!t||iB[e]>iB[n]?iJ:t[e].bind(t)}let iY={error:iJ,warn:iJ,info:iJ,debug:iJ},iK=new WeakMap;function iX(e){var t;let n=e.logger,i=null!=(t=e.logLevel)?t:"off";if(!n)return iY;let l=iK.get(n);if(l&&l[0]===i)return l[1];let r={error:iW("error",n,i),warn:iW("warn",n,i),info:iW("info",n,i),debug:iW("debug",n,i)};return iK.set(n,[i,r]),r}let iZ=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-goog-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class iQ{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let i=!1,l=n?iX(n):console;return new iQ(function(){return ny(this,arguments,function*(){var n,r,a,s;if(i)throw new is("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let o=!1;try{try{for(var c,d=!0,u=nv(function(e,t){return ny(this,arguments,function*(){var n,i,l,r;if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new is("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new is("Attempted to iterate over a response with no body")}let a=new i0,s=new iV,o=iA(e.body);try{for(var c,d=!0,u=nv(function(e){return ny(this,arguments,function*(){var t,n,i,l;let r=new Uint8Array;try{for(var a,s=!0,o=nv(e);!(t=(a=yield nb(o.next())).done);s=!0){let e;if(l=a.value,s=!1,null==l)continue;let t=l instanceof ArrayBuffer?new Uint8Array(l):"string"==typeof l?iq(l):l,n=new Uint8Array(r.length+t.length);for(n.set(r),n.set(t,r.length),r=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(r));)yield yield nb(r.slice(0,e)),r=r.slice(e)}}catch(e){n={error:e}}finally{try{!s&&!t&&(i=o.return)&&(yield nb(i.call(o)))}finally{if(n)throw n.error}}r.length>0&&(yield yield nb(r))})}(o));!(n=(c=yield nb(u.next())).done);d=!0)for(let e of(r=c.value,d=!1,s.decode(r))){let t=a.decode(e);t&&(yield yield nb(t))}}catch(e){i={error:e}}finally{try{!d&&!n&&(l=u.return)&&(yield nb(l.call(u)))}finally{if(i)throw i.error}}for(let e of s.flush()){let t=a.decode(e);t&&(yield yield nb(t))}})}(e,t));!(n=(c=yield nb(u.next())).done);d=!0)if(s=c.value,d=!1,!o)if(s.data.startsWith("[DONE]")){o=!0;continue}else try{yield yield nb(JSON.parse(s.data))}catch(e){throw l.error("Could not parse message into JSON:",s.data),l.error("From chunk:",s.raw),e}}catch(e){r={error:e}}finally{try{!d&&!n&&(a=u.return)&&(yield nb(a.call(u)))}finally{if(r)throw r.error}}o=!0}catch(e){if(ir(e))return yield nb(void 0);throw e}finally{o||t.abort()}})},t,n)}static fromReadableStream(e,t,n){let i=!1;return new iQ(function(){return ny(this,arguments,function*(){var n,l,r,a;if(i)throw new is("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let s=!1;try{try{for(var o,c=!0,d=nv(function(){return ny(this,arguments,function*(){var t,n,i,l;let r=new iV,a=iA(e);try{for(var s,o=!0,c=nv(a);!(t=(s=yield nb(c.next())).done);o=!0)for(let e of(l=s.value,o=!1,r.decode(l)))yield yield nb(e)}catch(e){n={error:e}}finally{try{!o&&!t&&(i=c.return)&&(yield nb(i.call(c)))}finally{if(n)throw n.error}}for(let e of r.flush())yield yield nb(e)})}());!(n=(o=yield nb(d.next())).done);c=!0)a=o.value,c=!1,!s&&a&&(yield yield nb(JSON.parse(a)))}catch(e){l={error:e}}finally{try{!c&&!n&&(r=d.return)&&(yield nb(r.call(d)))}finally{if(l)throw l.error}}s=!0}catch(e){if(ir(e))return yield nb(void 0);throw e}finally{s||t.abort()}})},t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),i=i=>({next:()=>{if(0===i.length){let i=n.next();e.push(i),t.push(i)}return i.shift()}});return[new iQ(()=>i(e),this.controller,this.client),new iQ(()=>i(t),this.controller,this.client)]}toReadableStream(){let e,t=this;return iI({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:n,done:i}=await e.next();if(i)return t.close();let l=iq(JSON.stringify(n)+"\n");t.enqueue(l)}catch(e){t.error(e)}},async cancel(){var t;await (null==(t=e.return)?void 0:t.call(e))}})}}class i0{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let n;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[i,l,r]=-1!==(n=(t=e).indexOf(":"))?[t.substring(0,n),":",t.substring(n+1)]:[t,"",""];return r.startsWith(" ")&&(r=r.substring(1)),"event"===i?this.event=r:"data"===i&&this.data.push(r),null}}async function i1(e,t){let{response:n,requestLogID:i,retryOfRequestLogID:l,startTime:r}=t,a=await (async()=>{var i;if(t.options.stream)return(iX(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(n,t.controller,e):iQ.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;let l=n.headers.get("content-type"),r=null==(i=null==l?void 0:l.split(";")[0])?void 0:i.trim();return(null==r?void 0:r.includes("application/json"))||(null==r?void 0:r.endsWith("+json"))?await n.json():await n.text()})();return iX(e).debug(`[${i}] response parsed`,iZ({retryOfRequestLogID:l,url:n.url,status:n.status,body:a,durationMs:Date.now()-r})),a}class i2 extends Promise{constructor(e,t,n=i1){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new i2(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}let i5=Symbol("brand.privateNullableHeaders"),i4=e=>{let t=new Headers,n=new Set;for(let i of e){let e=new Set;for(let[l,r]of function*(e){let t;if(!e)return;if(i5 in e){let{values:t,nulls:n}=e;for(let e of(yield*t.entries(),n))yield[e,null];return}let n=!1;for(let i of(e instanceof Headers?t=e.entries():iw(e)?t=e:(n=!0,t=Object.entries(null!=e?e:{})),t)){let e=i[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=iw(i[1])?i[1]:[i[1]],l=!1;for(let i of t)void 0!==i&&(n&&!l&&(l=!0,yield[e,null]),yield[e,i])}}(i)){let i=l.toLowerCase();e.has(i)||(t.delete(l),e.add(i)),null===r?(t.delete(l),n.add(i)):(t.append(l,r),n.delete(i))}}return{[i5]:!0,values:t,nulls:n}},i3=e=>{var t,n,i,l,r,a;return void 0!==globalThis.process?null!=(i=null==(n=null==(t=globalThis.process.env)?void 0:t[e])?void 0:n.trim())?i:void 0:void 0!==globalThis.Deno?null==(a=null==(r=null==(l=globalThis.Deno.env)?void 0:l.get)?void 0:r.call(l,e))?void 0:a.trim():void 0};class i6{constructor(e){var t,n,i,l,r,a,s,{baseURL:o=i3("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:c=null!=(t=i3("GEMINI_API_KEY"))?t:null,apiVersion:d="v1beta"}=e;const u=Object.assign(Object.assign({apiKey:c,apiVersion:d},nx(e,["baseURL","apiKey","apiVersion"])),{baseURL:o||"https://generativelanguage.googleapis.com"});this.baseURL=u.baseURL,this.timeout=null!=(n=u.timeout)?n:i6.DEFAULT_TIMEOUT,this.logger=null!=(i=u.logger)?i:console;const p="warn";this.logLevel=p,this.logLevel=null!=(r=null!=(l=i$(u.logLevel,"ClientOptions.logLevel",this))?l:i$(i3("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))?r:p,this.fetchOptions=u.fetchOptions,this.maxRetries=null!=(a=u.maxRetries)?a:2,this.fetch=null!=(s=u.fetch)?s:function(){if("u">typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),this.encoder=iT,this._options=u,this.apiKey=c,this.apiVersion=d,this.clientAdapter=u.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return"https://generativelanguage.googleapis.com"!==this.baseURL}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key")||this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=i4([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return i4([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return i4([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new is(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${iE}`}defaultIdempotencyKey(){return`stainless-node-retry-${il()}`}makeStatusError(e,t,n,i){return io.generate(e,t,n,i)}buildURL(e,t,n){let i=!this.baseURLOverridden()&&n||this.baseURL,l=new URL(i_.test(e)?e:i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(r)&&(t=Object.assign(Object.assign({},r),t)),"object"==typeof t&&t&&!Array.isArray(t)&&(l.search=this.stringifyQuery(t)),l.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>Object.assign({method:e,path:t},n)))}request(e,t=null){return new i2(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var i,l,r;let a=await e,s=null!=(i=a.maxRetries)?i:this.maxRetries;null==t&&(t=s),await this.prepareOptions(a);let{req:o,url:c,timeout:d}=await this.buildRequest(a,{retryCount:s-t});await this.prepareRequest(o,{url:c,options:a});let u="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),p=void 0===n?"":`, retryOf: ${n}`,m=Date.now();if(iX(this).debug(`[${u}] sending request`,iZ({retryOfRequestLogID:n,method:a.method,url:c,options:a,headers:o.headers})),null==(l=a.signal)?void 0:l.aborted)throw new ic;let h=new AbortController,g=await this.fetchWithTimeout(c,o,d,h).catch(ia),f=Date.now();if(g instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(null==(r=a.signal)?void 0:r.aborted)throw new ic;let i=ir(g)||/timed? ?out/i.test(String(g)+("cause"in g?String(g.cause):""));if(t)return iX(this).info(`[${u}] connection ${i?"timed out":"failed"} - ${e}`),iX(this).debug(`[${u}] connection ${i?"timed out":"failed"} (${e})`,iZ({retryOfRequestLogID:n,url:c,durationMs:f-m,message:g.message})),this.retryRequest(a,t,null!=n?n:u);if(iX(this).info(`[${u}] connection ${i?"timed out":"failed"} - error; no more retries left`),iX(this).debug(`[${u}] connection ${i?"timed out":"failed"} (error; no more retries left)`,iZ({retryOfRequestLogID:n,url:c,durationMs:f-m,message:g.message})),i)throw new iu;throw new id({cause:g})}let x=`[${u}${p}] ${o.method} ${c} ${g.ok?"succeeded":"failed"} with status ${g.status} in ${f-m}ms`;if(!g.ok){let e=await this.shouldRetry(g);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await iC(g.body),iX(this).info(`${x} - ${e}`),iX(this).debug(`[${u}] response error (${e})`,iZ({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,durationMs:f-m})),this.retryRequest(a,t,null!=n?n:u,g.headers)}let i=e?"error; no more retries left":"error; not retryable";iX(this).info(`${x} - ${i}`);let l=await g.text().catch(e=>ia(e).message),r=(e=>{try{return JSON.parse(e)}catch(e){return}})(l),s=r?void 0:l;throw iX(this).debug(`[${u}] response error (${i})`,iZ({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,message:s,durationMs:Date.now()-m})),this.makeStatusError(g.status,r,s,g.headers)}return iX(this).info(x),iX(this).debug(`[${u}] response start`,iZ({retryOfRequestLogID:n,url:g.url,status:g.status,headers:g.headers,durationMs:f-m})),{response:g,options:a,controller:h,requestLogID:u,retryOfRequestLogID:n,startTime:m}}async fetchWithTimeout(e,t,n,i){let l=t||{},{signal:r,method:a}=l,s=nx(l,["signal","method"]);r&&r.addEventListener("abort",()=>i.abort());let o=setTimeout(()=>i.abort(),n),c=globalThis.ReadableStream&&s.body instanceof globalThis.ReadableStream||"object"==typeof s.body&&null!==s.body&&Symbol.asyncIterator in s.body,d=Object.assign(Object.assign(Object.assign({signal:i.signal},c?{duplex:"half"}:{}),{method:"GET"}),s);a&&(d.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,n,i){var l;let r,a,s=null==i?void 0:i.get("retry-after-ms");if(s){let e=parseFloat(s);Number.isNaN(e)||(r=e)}let o=null==i?void 0:i.get("retry-after");if(o&&!r){let e=parseFloat(o);r=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let n=null!=(l=e.maxRetries)?l:this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await (a=r,new Promise(e=>setTimeout(e,a))),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,i,l;let r=Object.assign({},e),{method:a,path:s,query:o,defaultBaseURL:c}=r,d=this.buildURL(s,o,c);"timeout"in r&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new is(`${e} must be an integer`);if(t<0)throw new is(`${e} must be a positive integer`)})("timeout",r.timeout),r.timeout=null!=(n=r.timeout)?n:this.timeout;let{bodyHeaders:u,body:p}=this.buildBody({options:r}),m=await this.buildHeaders({options:e,method:a,bodyHeaders:u,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:m},r.signal&&{signal:r.signal}),globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"}),p&&{body:p}),null!=(i=this.fetchOptions)?i:{}),null!=(l=r.fetchOptions)?l:{}),url:d,timeout:r.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:i,retryCount:l}){let r={};this.idempotencyHeader&&"get"!==n&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let a=await this.authHeaders(e),s=i4([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(l)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),null!=t?t:t=(()=>{var e,t,n,i,l;let r="u">typeof Deno&&null!=Deno.build?"deno":"u">typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===r)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":iE,"X-Stainless-OS":iS(Deno.build.os),"X-Stainless-Arch":ij(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:null!=(t=null==(e=Deno.version)?void 0:e.deno)?t:"unknown"};if("u">typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":iE,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===r)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":iE,"X-Stainless-OS":iS(null!=(n=globalThis.process.platform)?n:"unknown"),"X-Stainless-Arch":ij(null!=(i=globalThis.process.arch)?i:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":null!=(l=globalThis.process.version)?l:"unknown"};let a=function(){if("u"<typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=t.exec(navigator.userAgent);if(n){let t=n[1]||0,i=n[2]||0,l=n[3]||0;return{browser:e,version:`${t}.${i}.${l}`}}}return null}();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":iE,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":iE,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),this._options.defaultHeaders,i,e.headers,a]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){let n;if(!e)return{bodyHeaders:void 0,body:void 0};let i=i4([t]);if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&i.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream)return{bodyHeaders:void 0,body:e};if("object"!=typeof e||!(Symbol.asyncIterator in e)&&(!(Symbol.iterator in e)||!("next"in e)||"function"!=typeof e.next))return this.encoder({body:e,headers:i});return{bodyHeaders:void 0,body:(n=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator](),iI({start(){},async pull(e){let{done:t,value:i}=await n.next();t?e.close():e.enqueue(i)},async cancel(){var e;await (null==(e=n.return)?void 0:e.call(n))}}))}}}i6.DEFAULT_TIMEOUT=6e4;class i8 extends i6{constructor(){super(...arguments),this.interactions=new iF(this)}}function i7(e,t){let n,i,l,r={},a=th(e,["sdkHttpResponse"]);null!=a&&tm(r,["sdkHttpResponse"],a);let s=th(e,["name"]);null!=s&&tm(r,["name"],s);let o=th(e,["state"]);null!=o&&tm(r,["state"],nt(o));let c=th(e,["createTime"]);null!=c&&tm(r,["createTime"],c);let d=th(e,["tuningTask","startTime"]);null!=d&&tm(r,["startTime"],d);let u=th(e,["tuningTask","completeTime"]);null!=u&&tm(r,["endTime"],u);let p=th(e,["updateTime"]);null!=p&&tm(r,["updateTime"],p);let m=th(e,["description"]);null!=m&&tm(r,["description"],m);let h=th(e,["baseModel"]);null!=h&&tm(r,["baseModel"],h);let g=th(e,["_self"]);return null!=g&&tm(r,["tunedModel"],(n={},null!=(i=th(g,["name"]))&&tm(n,["model"],i),null!=(l=th(g,["name"]))&&tm(n,["endpoint"],l),n)),r}function i9(e,t){let n={},i=th(e,["sdkHttpResponse"]);null!=i&&tm(n,["sdkHttpResponse"],i);let l=th(e,["name"]);null!=l&&tm(n,["name"],l);let r=th(e,["state"]);null!=r&&tm(n,["state"],nt(r));let a=th(e,["createTime"]);null!=a&&tm(n,["createTime"],a);let s=th(e,["startTime"]);null!=s&&tm(n,["startTime"],s);let o=th(e,["endTime"]);null!=o&&tm(n,["endTime"],o);let c=th(e,["updateTime"]);null!=c&&tm(n,["updateTime"],c);let d=th(e,["error"]);null!=d&&tm(n,["error"],d);let u=th(e,["description"]);null!=u&&tm(n,["description"],u);let p=th(e,["baseModel"]);null!=p&&tm(n,["baseModel"],p);let m=th(e,["tunedModel"]);null!=m&&tm(n,["tunedModel"],m);let h=th(e,["preTunedModel"]);null!=h&&tm(n,["preTunedModel"],h);let g=th(e,["supervisedTuningSpec"]);null!=g&&tm(n,["supervisedTuningSpec"],g);let f=th(e,["preferenceOptimizationSpec"]);null!=f&&tm(n,["preferenceOptimizationSpec"],f);let x=th(e,["tuningDataStats"]);null!=x&&tm(n,["tuningDataStats"],x);let b=th(e,["encryptionSpec"]);null!=b&&tm(n,["encryptionSpec"],b);let y=th(e,["partnerModelTuningSpec"]);null!=y&&tm(n,["partnerModelTuningSpec"],y);let v=th(e,["customBaseModel"]);null!=v&&tm(n,["customBaseModel"],v);let _=th(e,["experiment"]);null!=_&&tm(n,["experiment"],_);let N=th(e,["labels"]);null!=N&&tm(n,["labels"],N);let w=th(e,["outputUri"]);null!=w&&tm(n,["outputUri"],w);let E=th(e,["pipelineJob"]);null!=E&&tm(n,["pipelineJob"],E);let j=th(e,["serviceAccount"]);null!=j&&tm(n,["serviceAccount"],j);let S=th(e,["tunedModelDisplayName"]);null!=S&&tm(n,["tunedModelDisplayName"],S);let I=th(e,["veoTuningSpec"]);return null!=I&&tm(n,["veoTuningSpec"],I),n}function le(e,t){let n={},i=th(e,["gcsUri"]);null!=i&&tm(n,["validationDatasetUri"],i);let l=th(e,["vertexDatasetResource"]);return null!=l&&tm(n,["validationDatasetUri"],l),n}i8.GeminiNextGenAPIClient=i8,i8.GeminiNextGenAPIClientError=is,i8.APIError=io,i8.APIConnectionError=id,i8.APIConnectionTimeoutError=iu,i8.APIUserAbortError=ic,i8.NotFoundError=ig,i8.ConflictError=ix,i8.RateLimitError=iy,i8.BadRequestError=ip,i8.AuthenticationError=im,i8.InternalServerError=iv,i8.PermissionDeniedError=ih,i8.UnprocessableEntityError=ib,i8.toFile=iP,i8.Interactions=iF;class lt extends tu{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new nm(tl.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let n={tunedModelName:e.baseModel};(null==(t=e.config)?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);let i=Object.assign(Object.assign({},e),{preTunedModel:n});return i.baseModel=void 0,await this.tuneInternal(i)}else{let t=Object.assign({},e);return await this.tuneInternal(t)}{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),i="";return void 0!==n.metadata&&void 0!==n.metadata.tunedModel?i=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:eD.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i,l,s=(i={},null!=(l=th(e,["name"]))&&tm(i,["_url","name"],l),i);return r=tp("{name}",s._url),a=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>i9(e))}{let t,n,s=(t={},null!=(n=th(e,["name"]))&&tm(t,["_url","name"],n),t);return r=tp("{name}",s._url),a=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>i7(e))}}async listInternal(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i,l,s,o,c,d=(i={},null!=(l=th(e,["config"]))&&(s=th(l,["pageSize"]),void 0!==i&&null!=s&&tm(i,["_query","pageSize"],s),o=th(l,["pageToken"]),void 0!==i&&null!=o&&tm(i,["_query","pageToken"],o),c=th(l,["filter"]),void 0!==i&&null!=c&&tm(i,["_query","filter"],c)),i);return r=tp("tuningJobs",d._url),a=d._query,delete d._url,delete d._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},i=th(e,["sdkHttpResponse"]);null!=i&&tm(n,["sdkHttpResponse"],i);let l=th(e,["nextPageToken"]);null!=l&&tm(n,["nextPageToken"],l);let r=th(e,["tuningJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>i9(e))),tm(n,["tuningJobs"],e)}return n}(e),n=new tT;return Object.assign(n,t),n})}{let t,n,s,o,c,d=(t={},null!=(n=th(e,["config"]))&&(s=th(n,["pageSize"]),void 0!==t&&null!=s&&tm(t,["_query","pageSize"],s),o=th(n,["pageToken"]),void 0!==t&&null!=o&&tm(t,["_query","pageToken"],o),c=th(n,["filter"]),void 0!==t&&null!=c&&tm(t,["_query","filter"],c)),t);return r=tp("tunedModels",d._url),a=d._query,delete d._url,delete d._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},i=th(e,["sdkHttpResponse"]);null!=i&&tm(n,["sdkHttpResponse"],i);let l=th(e,["nextPageToken"]);null!=l&&tm(n,["nextPageToken"],l);let r=th(e,["tunedModels"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>i7(e))),tm(n,["tuningJobs"],e)}return n}(e),n=new tT;return Object.assign(n,t),n})}}async cancel(e){var t,n,i,l;let r="",a={};if(this.apiClient.isVertexAI()){let i,l,s=(i={},null!=(l=th(e,["name"]))&&tm(i,["_url","name"],l),i);return r=tp("{name}:cancel",s._url),a=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tk;return Object.assign(l,i),l})}{let t,n,s=(t={},null!=(n=th(e,["name"]))&&tm(t,["_url","name"],n),t);return r=tp("{name}:cancel",s._url),a=s._query,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:a,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(l=e.config)?void 0:l.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),t),l=new tk;return Object.assign(l,i),l})}}async tuneInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI()){let r,a,s,o,c,d=(r={},null!=(a=th(e,["baseModel"]))&&tm(r,["baseModel"],a),null!=(s=th(e,["preTunedModel"]))&&tm(r,["preTunedModel"],s),null!=(o=th(e,["trainingDataset"]))&&function(e,t,n){let i=th(n,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let n=th(e,["gcsUri"]);void 0!==t&&null!=n&&tm(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===i){let n=th(e,["gcsUri"]);void 0!==t&&null!=n&&tm(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}let l=th(n,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){let n=th(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&tm(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===l){let n=th(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&tm(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}if(void 0!==th(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(o,r,e),null!=(c=th(e,["config"]))&&function(e,t,n){let i=th(n,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let n=th(e,["validationDataset"]);void 0!==t&&null!=n&&tm(t,["supervisedTuningSpec"],le(n))}else if("PREFERENCE_TUNING"===i){let n=th(e,["validationDataset"]);void 0!==t&&null!=n&&tm(t,["preferenceOptimizationSpec"],le(n))}let l=th(e,["tunedModelDisplayName"]);void 0!==t&&null!=l&&tm(t,["tunedModelDisplayName"],l);let r=th(e,["description"]);void 0!==t&&null!=r&&tm(t,["description"],r);let a=th(n,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){let n=th(e,["epochCount"]);void 0!==t&&null!=n&&tm(t,["supervisedTuningSpec","hyperParameters","epochCount"],n)}else if("PREFERENCE_TUNING"===a){let n=th(e,["epochCount"]);void 0!==t&&null!=n&&tm(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],n)}let s=th(n,["config","method"]);if(void 0===s&&(s="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===s){let n=th(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&tm(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],n)}else if("PREFERENCE_TUNING"===s){let n=th(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&tm(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],n)}let o=th(n,["config","method"]);if(void 0===o&&(o="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===o){let n=th(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&tm(t,["supervisedTuningSpec","exportLastCheckpointOnly"],n)}else if("PREFERENCE_TUNING"===o){let n=th(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&tm(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],n)}let c=th(n,["config","method"]);if(void 0===c&&(c="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===c){let n=th(e,["adapterSize"]);void 0!==t&&null!=n&&tm(t,["supervisedTuningSpec","hyperParameters","adapterSize"],n)}else if("PREFERENCE_TUNING"===c){let n=th(e,["adapterSize"]);void 0!==t&&null!=n&&tm(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],n)}if(void 0!==th(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==th(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let d=th(e,["labels"]);void 0!==t&&null!=d&&tm(t,["labels"],d);let u=th(e,["beta"]);void 0!==t&&null!=u&&tm(t,["preferenceOptimizationSpec","hyperParameters","beta"],u)}(c,r,e),r);return i=tp("tuningJobs",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>i9(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i="",l={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let r,a,s,o,c,d=(r={},null!=(a=th(e,["baseModel"]))&&tm(r,["baseModel"],a),null!=(s=th(e,["preTunedModel"]))&&tm(r,["preTunedModel"],s),null!=(o=th(e,["trainingDataset"]))&&function(e,t){if(void 0!==th(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==th(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=th(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),tm({},["examples","examples"],e)}}(o),null!=(c=th(e,["config"]))&&function(e,t,n){if(void 0!==th(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let i=th(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=i&&tm(t,["displayName"],i),void 0!==th(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let l=th(e,["epochCount"]);void 0!==t&&null!=l&&tm(t,["tuningTask","hyperparameters","epochCount"],l);let r=th(e,["learningRateMultiplier"]);if(null!=r&&tm({},["tuningTask","hyperparameters","learningRateMultiplier"],r),void 0!==th(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==th(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==th(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let a=th(e,["batchSize"]);void 0!==t&&null!=a&&tm(t,["tuningTask","hyperparameters","batchSize"],a);let s=th(e,["learningRate"]);if(void 0!==t&&null!=s&&tm(t,["tuningTask","hyperparameters","learningRate"],s),void 0!==th(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");if(void 0!==th(e,["beta"]))throw Error("beta parameter is not supported in Gemini API.")}(c,r),r);return i=tp("tunedModels",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,l,r,a;return t={},null!=(n=th(e,["sdkHttpResponse"]))&&tm(t,["sdkHttpResponse"],n),null!=(i=th(e,["name"]))&&tm(t,["name"],i),null!=(l=th(e,["metadata"]))&&tm(t,["metadata"],l),null!=(r=th(e,["done"]))&&tm(t,["done"],r),null!=(a=th(e,["error"]))&&tm(t,["error"],a),t})}}}class ln{async download(e,t){throw Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}let li="x-goog-upload-status";async function ll(e,t,n){var i;let l=await la(e,t,n),r=await (null==l?void 0:l.json());if((null==(i=null==l?void 0:l.headers)?void 0:i[li])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return r.file}async function lr(e,t,n){var i;let l=await la(e,t,n),r=await (null==l?void 0:l.json());if((null==(i=null==l?void 0:l.headers)?void 0:i[li])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let a=tf(r),s=new tV;return Object.assign(s,a),s}async function la(e,t,n){var i,l;let r=0,a=0,s=new tx(new Response),o="upload";for(r=e.size;a<r;){let c=Math.min(8388608,r-a),d=e.slice(a,a+c);a+c>=r&&(o+=", finalize");let u=0,p=1e3;for(;u<3&&(null==(i=null==(s=await n.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":o,"X-Goog-Upload-Offset":String(a),"Content-Length":String(c)}}}))?void 0:s.headers)||!i[li]);)u++,await function(e){return new Promise(t=>setTimeout(t,e))}(p),p*=2;if(a+=c,(null==(l=null==s?void 0:s.headers)?void 0:l[li])!=="active")break;if(r<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}return s}async function ls(e){return{size:e.size,type:e.type}}class lo{async upload(e,t,n){if("string"==typeof e)throw Error("File path is not supported in browser uploader.");return await ll(e,t,n)}async uploadToFileSearchStore(e,t,n){if("string"==typeof e)throw Error("File path is not supported in browser uploader.");return await lr(e,t,n)}async stat(e){if("string"!=typeof e)return await ls(e);throw Error("File path is not supported in browser uploader.")}}class lc{create(e,t,n){return new ld(e,t,n)}}class ld{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}let lu="x-goog-api-key";class lp{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(null===e.get(lu)){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw Error("API key is missing. Please provide a valid API key.");e.append(lu,this.apiKey)}}}class lm{get interactions(){if(void 0!==this._interactions)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;(null==e?void 0:e.extraBody)&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new i8({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:null==e?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(null==e.apiKey)throw Error("An API Key must be set when running in a browser");if(e.project||e.location)throw Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=null!=(t=e.vertexai)&&t,this.apiKey=e.apiKey;const n=function(e,t,n,i){return(null==e?void 0:e.baseUrl)?e.baseUrl:t?null!=r?r:n:null!=l?l:i}(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const i=new lp(this.apiKey);this.apiClient=new n$({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:"gl-node/web",uploader:new lo,downloader:new ln}),this.models=new n7(this.apiClient),this.live=new n1(this.apiClient,i,new lc),this.batches=new nh(this.apiClient),this.chats=new nw(this.models,this.apiClient),this.caches=new nf(this.apiClient),this.files=new nS(this.apiClient),this.operations=new n9(this.apiClient),this.authTokens=new ie(this.apiClient),this.tunings=new lt(this.apiClient),this.fileSearchStores=new ii(this.apiClient)}}let lh=e=>{let t=e?.googleApiKey||td.default.env.API_KEY;return t||console.warn("CRITICAL: API Key missing in GeminiService"),new lm({apiKey:t})},lg=[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_ONLY_HIGH"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_ONLY_HIGH"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_ONLY_HIGH"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_ONLY_HIGH"},{category:"HARM_CATEGORY_CIVIC_INTEGRITY",threshold:"BLOCK_ONLY_HIGH"}];async function lf(e,t=2,n=2e3){try{return await e()}catch(l){let i=JSON.stringify(l,null,2);if(console.warn(`[Gemini Retry Log] Attempt failed. Retries left: ${t}. Error:`,i.substring(0,300)),(i.includes("SAFETY")||i.includes("BLOCKED"))&&console.error(" [CRITICAL] SAFETY BLOCK DETECTED. Retries may be futile but proceeding if quota allows."),t>0)return await new Promise(e=>setTimeout(e,n)),lf(e,t-1,2*n);throw l}}async function lx(e,t,n){return new Promise((i,l)=>{let r=new Image;r.crossOrigin="anonymous",r.src=e,r.onload=()=>{let l=document.createElement("canvas");l.width=t,l.height=n;let a=l.getContext("2d");if(!a)return i(e);a.fillStyle="black",a.fillRect(0,0,t,n);let s=Math.max(t/r.width,n/r.height),o=t/2-r.width/2*s,c=n/2-r.height/2*s;a.drawImage(r,o,c,r.width*s,r.height*s),i(l.toDataURL("image/png"))},r.onerror=()=>{console.warn("Image load failed for dimension matching, using original."),i(e)}})}async function lb(e,t,n,i){let l=lh(n),r=await lf(()=>l.models.generateContent({model:"gemini-3-flash-preview",contents:`TEXT: "${t}". TASK: Literal search string for visuals (English, 3-5 words).`}));return{assetUrl:null,source:"Web Search",title:r.text?.trim()||e}}async function ly(e,t,n=!1,i){let l=lh(i);return JSON.parse((await lf(()=>l.models.generateContent({model:"gemini-3-flash-preview",contents:`Transform into cinematic beats: "${e}"`,config:{systemInstruction:"Professional Director: Output JSON array. Fields: caption, scoutQuery, duration.",responseMimeType:"application/json",responseSchema:{type:eh.ARRAY,items:{type:eh.OBJECT,properties:{caption:{type:eh.STRING},scoutQuery:{type:eh.STRING},duration:{type:eh.NUMBER}},required:["caption","scoutQuery","duration"]}}}}))).text||"[]").map(e=>({id:crypto.randomUUID(),timestamp:Date.now(),duration:e.duration||6,assetUrl:null,caption:e.caption,assetType:"IMAGE",scoutQuery:e.scoutQuery}))}async function lv(e,t,n,i){let l=lh(n),r=[];i&&r.push({inlineData:{mimeType:"image/png",data:i.split(",")[1]}}),r.push({text:`Cinematic frame: ${t}. ${e}. Photorealistic, 8k. ${i?"Maintain style/identity of ref.":""}`});let a=await lf(()=>l.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:r},config:{imageConfig:{aspectRatio:"16:9"},safetySettings:lg}})),s="";if(a.candidates?.[0]?.content?.parts)for(let e of a.candidates[0].content.parts)e.inlineData&&(s=`data:image/png;base64,${e.inlineData.data}`);return s}async function l_(e,t){let n=lh(t),i=e.includes(",")?e.split(",")[1]:e,l=JSON.parse((await lf(()=>n.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{mimeType:"image/png",data:i}},{text:"JSON forensic DNA biopsy in English: human_description, character_details, environment_context, pose_attribute, camera_specs, lighting_setup, technical_tags."}]},config:{responseMimeType:"application/json"}}))).text||"{}"),r=e=>e?"string"==typeof e?e:"object"==typeof e?Object.values(e).join(", "):String(e):"",a={...l,character_details:r(l.character_details),environment_context:r(l.environment_context),pose_attribute:r(l.pose_attribute),camera_specs:r(l.camera_specs),lighting_setup:r(l.lighting_setup),human_description:r(l.human_description),technical_tags:Array.isArray(l.technical_tags)?l.technical_tags.map(e=>r(e)):[]};return{...a,character:a.character_details,environment:a.environment_context,pose:a.pose_attribute}}async function lN(e,t,n,i,l,r,a,s,o,c,d){let u=lh(l);if(r&&o){console.log("[Gemini Service] Initializing Iterative Refinement Pipeline (V13.0 - NO CACHE)...");let t=e.trim()?e:"Cinematic scene.",n=[],i="16:9";if(d)i=d;else{let e,t,n=await new Promise(e=>{let t=new Image;t.onload=()=>e({w:t.width,h:t.height}),t.onerror=()=>e({w:1024,h:1024}),t.src=o});e=n.w/n.h,i=Object.keys(t={"1:1":1,"3:4":3/4,"4:3":4/3,"9:16":9/16,"16:9":16/9}).reduce((n,i)=>Math.abs(t[n]-e)<Math.abs(t[i]-e)?n:i)}let l=1024,a=576;"9:16"===i?(l=576,a=1024):"1:1"===i?(l=1024,a=1024):"4:3"===i&&(l=1024,a=768);let s=o.split(",")[1],c=await lx(r,l,a),p=c.split(",")[1],m=Date.now().toString(36)+Math.random().toString(36).substring(2);n.push({type:"Identity Guard",status:"processing",message:"Stage 1/4: Analyzing Biological & Structural Matrix...",timestamp:Date.now(),department:"Casting"}),n.push({type:"Rigging Supervisor",status:"completed",message:"Vectors Locked. Initiating Structural Draft.",timestamp:Date.now(),department:"Structure"}),n.push({type:"Puppeteer Agent",status:"processing",message:`Stage 2/4: Generating Structural Draft (Session ${m})...`,timestamp:Date.now(),department:"Structure"});let h=`
      [SYSTEM: FRESH RENDER SESSION ${m}_DRAFT]
      TASK: Generate an image based on the SKELETON POSE and CHARACTER IDENTITY.
      
      INPUTS:
      1. IMAGE 1 (SKELETON): Strict pose guide. IGNORE the black background and colored lines visual style.
      2. IMAGE 2 (CHARACTER): The person to render.
      
      INSTRUCTION:
      - Render the character from Image 2 in the exact pose of Image 1.
      - SCENE: ${t}
      - IMPORTANT: Do not make it look like a 3D render. Attempt photorealism.
      - FORCE: Do not use cached latent patterns. Calculate geometry from scratch.
      `,g=await lf(()=>u.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:"image/png",data:s}},{inlineData:{mimeType:"image/png",data:p}},{text:h}]},config:{imageConfig:{aspectRatio:i},safetySettings:lg,temperature:.45}})),f="";if(g.candidates?.[0]?.content?.parts)for(let e of g.candidates[0].content.parts)e.inlineData&&e.inlineData.data&&(f=e.inlineData.data);if(!f)throw Error("Stage 2 Failed: Draft Generation Error.");n.push({type:"Puppeteer Agent",status:"completed",message:"Draft Anchor Created.",timestamp:Date.now(),department:"Structure"}),n.push({type:"Neural Alchemist",status:"processing",message:"Stage 3/4: Recursive Refinement (Memory Flush & Polish)...",timestamp:Date.now(),department:"Advanced"});let x=`
      [SYSTEM: MEMORY FLUSH REQUIRED - ID ${m}_POLISH]
      TASK: RE-TEXTURE and FIX ANATOMY.
      
      INPUTS:
      1. IMAGE 1 (DRAFT): Composition is correct, but texture might be plastic/fake/clay.
      2. IMAGE 2 (REFERENCE): Contains the REAL skin texture, lighting, and fabric details.

      MANDATORY PROTOCOLS:
      - **FLUSH CACHE**: Do not use internal memory from previous runs.
      - **ANTI-ALIASING**: Remove "plastic" or "3D render" look.
      - Transfer HYPER-REALISTIC SKIN TEXTURE from Image 2 to Image 1.
      - If limbs in Image 1 look awkward (bad anatomy), FIX THEM to look natural.
      - SCENE: ${t}
      `,b=await lf(()=>u.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:"image/png",data:f}},{inlineData:{mimeType:"image/png",data:p}},{text:x}]},config:{imageConfig:{aspectRatio:i},safetySettings:lg,temperature:.6}})),y="";if(b.candidates?.[0]?.content?.parts)for(let e of b.candidates[0].content.parts)e.inlineData&&(y=`data:image/png;base64,${e.inlineData.data}`);if(!y)throw Error("Stage 3 Failed: Refinement Error.");return f="",p="",c="",n.push({type:"Director",status:"completed",message:"Pipeline Complete. VRAM Cache Purged.",timestamp:Date.now(),department:"Direction"}),{imageUrl:y,logs:n,enhancedPrompt:"RECURSIVE_POLISH_V13: "+t,params:{neural_metrics:{consensus_score:1,iteration_count:2,tensor_vram:0,projection_coherence:1,loss_mse:0,ssim_index:1}}}}let p=[];r&&p.push({inlineData:{mimeType:"image/png",data:r.split(",")[1]}});let m=JSON.parse((await lf(()=>u.models.generateContent({model:"gemini-3-flash-preview",contents:p.length>0?{parts:p.concat([{text:`Task: Character Re-Targeting Optimization. User intent: ${e}.`}])}:{text:`Task: Optimize intent for image synth. Prompt: ${e}`},config:{thinkingConfig:{thinkingBudget:1024},responseMimeType:"application/json",responseSchema:{type:eh.OBJECT,properties:{enhancedPrompt:{type:eh.STRING},logs:{type:eh.ARRAY,items:{type:eh.OBJECT,properties:{type:{type:eh.STRING},status:{type:eh.STRING},message:{type:eh.STRING}}}}}}}}))).text||"{}"),h=await lv(m.enhancedPrompt||e,e,l,r);if(!h)throw Error("Standard Synthesis produced no visual output.");return{imageUrl:h,logs:(m.logs||[]).map(e=>({type:e.type,status:e.status,message:e.message,timestamp:Date.now()})),enhancedPrompt:m.enhancedPrompt||e,params:{neural_metrics:{consensus_score:.98,iteration_count:64,tensor_vram:7.8,projection_coherence:.96,loss_mse:0,ssim_index:1}}}}async function lw(e,t,n){let i=lh(t),l=[];n&&l.push({inlineData:{mimeType:"image/png",data:n.split(",")[1]}}),l.push({text:`
    ACT AS A BACKEND API. 
    TASK: Rewrite the following user request into ONE SINGLE, highly detailed, technical image generation prompt (English).
    INPUT: "${e}"
    RULES:
    1. Output ONLY the raw prompt string. 
    2. NO "Option 1", NO "Here is the prompt", NO conversational text.
    3. NO Markdown, NO bolding, NO bullets.
    4. Combine scene, lighting, style, and camera details into one dense paragraph.
  `});let r=await lf(()=>i.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:l}})),a=r.text?.trim()||e;return a.replace(/^Here is.*?:\s*/i,"").replace(/^Option 1:?/i,"").replace(/\*\*/g,"")}async function lE(e,t,n){if(0===t.length)return null;let i=lh(n),l=JSON.parse((await lf(()=>i.models.generateContent({model:"gemini-3-flash-preview",contents:`Identify best Node ID from vault for: "${e}". VAULT: ${JSON.stringify(t.map(e=>({id:e.shortId,p:e.prompt})))}`,config:{responseMimeType:"application/json"}}))).text||"{}").winner_id;return t.find(e=>e.shortId===l)||null}async function lj(e,t){let n=lh(t),i=await lf(()=>n.models.generateContent({model:"gemini-3-flash-preview",contents:`Atmosphere description for cover (8 words): "${e}"`}));return i.text?.trim()||"Cinematic atmosphere"}async function lS(e,t,n){let i=lh(n),l=t.find(t=>t.shortId===e.pep_id),r=t.find(t=>t.shortId===e.pop_id),a=[];l&&a.push({inlineData:{mimeType:"image/png",data:l.imageUrl.split(",")[1]}}),r&&a.push({inlineData:{mimeType:"image/png",data:r.imageUrl.split(",")[1]}}),a.push({text:`Fuse PEP identity with POP pose. Intent: ${e.fusionIntent}`});let s=await lf(()=>i.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:a},config:{imageConfig:{aspectRatio:"16:9"},safetySettings:lg}})),o="";if(s.candidates?.[0]?.content?.parts)for(let e of s.candidates[0].content.parts)e.inlineData&&(o=`data:image/png;base64,${e.inlineData.data}`);return{imageUrl:o,logs:[{type:"Neural Alchemist",status:"completed",message:"Identity Migration stabilized.",timestamp:Date.now()}],params:{neural_metrics:{consensus_score:.95,iteration_count:50,tensor_vram:8.2,loss_mse:.02,ssim_index:.98}}}}async function lI(e,t,n,i){let l=lh(i),r=await lf(()=>l.models.generateContent({model:"gemini-3-flash-preview",contents:`Select best Node IDs for: "${e}". VAULT: ${JSON.stringify(n.map(e=>({id:e.shortId,dna:e.dna})))}`,config:{responseMimeType:"application/json"}}));return{manifest:{...t,...JSON.parse(r.text||"{}")}}}async function lA(e,t,n,i){let l=lh(i),r=[{inlineData:{mimeType:"image/png",data:e.split(",")[1]}}];return n&&r.push({inlineData:{mimeType:"image/png",data:n.split(",")[1]}}),r.push({text:`Audit visual quality. Intent: ${t}`}),JSON.parse((await lf(()=>l.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:r},config:{responseMimeType:"application/json"}}))).text||'{"score": 0.8}')}async function lC(e,t){let n=lh(t),i=await lf(()=>n.models.generateContent({model:"gemini-3-flash-preview",contents:`Refine intent: "${e}"`}));return{refined:i.text?.trim()||e,logs:[]}}let lT=({logs:e,isProcessing:t,deliberation_flow:n})=>{let i=(0,ta.useRef)(null),[l,r]=(0,ta.useState)("terminal");return(0,ta.useEffect)(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[e,t]),(0,tr.jsxs)("div",{className:"bg-black border border-white/10 rounded-2xl overflow-hidden shadow-2xl relative flex flex-col h-full min-h-[400px]",children:[(0,tr.jsxs)("div",{className:"bg-zinc-900/80 px-4 py-2 border-b border-white/5 flex items-center justify-between sticky top-0 z-20",children:[(0,tr.jsxs)("div",{className:"flex gap-1.5",children:[(0,tr.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500/30 border border-red-500/50"}),(0,tr.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-amber-500/30 border border-amber-500/50"}),(0,tr.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-emerald-500/30 border border-emerald-500/50"})]}),(0,tr.jsxs)("div",{className:"flex bg-black/40 p-0.5 rounded-lg border border-white/5",children:[(0,tr.jsx)("button",{onClick:()=>r("terminal"),className:`px-3 py-1 text-[8px] font-black uppercase tracking-widest rounded-md transition-all ${"terminal"===l?"bg-zinc-700 text-white":"text-zinc-600"}`,children:"Log"}),(0,tr.jsx)("button",{onClick:()=>r("flow"),className:`px-3 py-1 text-[8px] font-black uppercase tracking-widest rounded-md transition-all ${"flow"===l?"bg-zinc-700 text-white":"text-zinc-600"}`,children:"Flow"})]}),(0,tr.jsx)("span",{className:"hidden md:inline text-[7px] mono text-zinc-600 font-bold uppercase tracking-widest",children:"MAD_KERNEL_v12.2"})]}),(0,tr.jsxs)("div",{ref:i,className:"flex-1 overflow-y-auto p-5 space-y-3 mono text-[10px] scroll-smooth custom-scrollbar relative bg-[#020202]",children:[(0,tr.jsx)("div",{className:"absolute inset-0 pointer-events-none z-10 opacity-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_2px,3px_100%]"}),"terminal"===l?(0,tr.jsx)(tr.Fragment,{children:0!==e.length||t?e.map((n,i)=>{var l;return(0,tr.jsx)("div",{className:`animate-in fade-in slide-in-from-left-2 duration-300 p-3 rounded-xl border ${"Director"===(l=n.type)?"bg-blue-500/5 border-blue-500/20":"Lighting Architect"===l?"bg-amber-500/5 border-amber-500/20":"Texture Master"===l?"bg-emerald-500/5 border-emerald-500/20":"Visual Archivist"===l?"bg-indigo-600/10 border-indigo-500/30":"Meta-Prompt Translator"===l?"bg-purple-500/10 border-purple-500/30":"bg-zinc-900/40 border-white/5"}`,children:(0,tr.jsxs)("div",{className:"flex items-start gap-3",children:[(0,tr.jsxs)("span",{className:"text-zinc-800 shrink-0 font-bold",children:["[",new Date(n.timestamp).toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),"]"]}),(0,tr.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,tr.jsx)("span",{className:`font-black shrink-0 ${(e=>{switch(e){case"Direction":return"text-blue-400";case"Advanced":return"text-indigo-400";case"Texture":return"text-emerald-400";case"Casting":return"text-pink-400";default:return"text-zinc-500"}})(n.department)} uppercase tracking-tighter`,children:n.type.replace(/\s/g,"_")}),"processing"===n.status&&(0,tr.jsx)("span",{className:"text-[6px] px-1 bg-white/5 rounded text-zinc-600 animate-pulse",children:"ANALYZING"})]}),(0,tr.jsxs)("p",{className:"text-zinc-400 leading-relaxed break-words border-l border-white/5 pl-3 py-1 mt-1",children:[n.message,i===e.length-1&&t&&(0,tr.jsx)("span",{className:"inline-block w-2 h-4 bg-indigo-500 ml-1 animate-pulse"})]})]})]})},i)}):(0,tr.jsx)("div",{className:"h-full flex flex-col items-center justify-center text-zinc-900",children:(0,tr.jsx)("p",{className:"text-[9px] uppercase tracking-[0.8em] font-black animate-pulse",children:"KERNEL_STANDBY_"})})}):(0,tr.jsx)("div",{className:"space-y-6 py-4",children:n&&n.length>0?n.map((e,t)=>(0,tr.jsxs)("div",{className:"relative pl-8 before:absolute before:left-3 before:top-2 before:bottom-[-20px] before:w-0.5 before:bg-gradient-to-b before:from-indigo-500 before:to-transparent",children:[(0,tr.jsx)("div",{className:"absolute left-1.5 top-1.5 w-3.5 h-3.5 bg-indigo-600 rounded-full border-2 border-black z-10 flex items-center justify-center"}),(0,tr.jsxs)("div",{className:"bg-zinc-900/60 p-4 rounded-2xl border border-white/5 space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,tr.jsxs)("span",{className:"text-[8px] font-black text-indigo-400 uppercase tracking-widest",children:[e.from," â ",e.to]}),(0,tr.jsx)("span",{className:"text-[7px] text-zinc-600 mono",children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,tr.jsx)("p",{className:"text-[10px] font-black text-white uppercase",children:e.action}),(0,tr.jsxs)("div",{className:"flex items-center gap-2 bg-black/40 p-2 rounded-lg",children:[(0,tr.jsx)("div",{className:"w-1 h-1 bg-emerald-500 rounded-full"}),(0,tr.jsx)("span",{className:"text-[8px] text-zinc-400 mono italic",children:e.impact})]})]})]},t)):(0,tr.jsx)("div",{className:"text-zinc-800 text-center py-20 uppercase font-black tracking-widest text-[9px]",children:"Awaiting decision trace"})})]})]})},lk=({params:e,onParamChange:t})=>{let{z_anatomy:n=1,z_structure:i=1,z_lighting:l=.5,z_texture:r=.5}=e,[a,s]=(0,ta.useState)(null),o=(0,ta.useRef)(0),c=(0,ta.useRef)(0),d=(e,t,n)=>{e.preventDefault(),s(t),o.current="touches"in e?e.touches[0].clientY:e.clientY,c.current=n,document.body.style.userSelect="none"},u=(0,ta.useCallback)(e=>{if(!a||!t)return;let n="touches"in e?e.touches[0].clientY:e.clientY,i=o.current-n,l=c.current+.005*i;l=Math.min(Math.max(l,0),"z_structure"===a||"z_anatomy"===a?1.5:1),t(a,l)},[a,t]),p=(0,ta.useCallback)(()=>{s(null),document.body.style.userSelect=""},[]);return ta.default.useEffect(()=>(a&&(window.addEventListener("mousemove",u),window.addEventListener("mouseup",p),window.addEventListener("touchmove",u),window.addEventListener("touchend",p)),()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",p),window.removeEventListener("touchmove",u),window.removeEventListener("touchend",p)}),[a,u,p]),(0,tr.jsxs)("div",{className:"relative w-full aspect-video md:aspect-[21/9] flex items-center justify-center overflow-hidden bg-black/40 rounded-3xl border border-white/5 mb-8 group cursor-default",children:[(0,tr.jsx)("div",{className:`absolute top-4 left-1/2 -translate-x-1/2 px-4 py-1.5 bg-indigo-500/20 border border-indigo-500/40 rounded-full text-[8px] mono text-indigo-300 font-black uppercase tracking-[0.3em] transition-opacity duration-500 z-50 pointer-events-none ${a?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:a?`Modulating ${a.replace("z_","").toUpperCase()}...`:"Drag layers vertically to modulate studio weights"}),(0,tr.jsxs)("div",{className:"relative w-full h-full perspective-[1200px] flex items-center justify-center",children:[(0,tr.jsxs)("div",{className:`relative transform-gpu transition-transform duration-1000 ease-out rotate-x-[60deg] rotate-z-[-25deg] scale-75 md:scale-90 ${a?"":"group-hover:rotate-x-[55deg] group-hover:rotate-z-[-20deg]"}`,children:[(0,tr.jsxs)("div",{onMouseDown:e=>d(e,"z_anatomy",n),onTouchStart:e=>d(e,"z_anatomy",n),className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[320px] h-[220px] border-2 backdrop-blur-sm transition-all duration-300 cursor-ns-resize ${"z_anatomy"===a?"border-pink-400 bg-pink-500/30 scale-105 shadow-[0_0_50px_rgba(236,72,153,0.2)]":"border-pink-500/40 bg-pink-500/10 hover:border-pink-400/60"}`,style:{transform:"translate3d(-50%, -50%, -40px)",opacity:.2+.4*n},children:[(0,tr.jsx)("div",{className:"absolute -top-6 -left-6 text-[8px] mono font-black uppercase tracking-widest transition-colors text-pink-400",children:"Z_ANATOMY [Pose/DNA]"}),(0,tr.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[16px] font-black text-pink-400/20 select-none",children:"BONE"})]}),(0,tr.jsxs)("div",{onMouseDown:e=>d(e,"z_structure",i),onTouchStart:e=>d(e,"z_structure",i),className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[200px] border-2 backdrop-blur-sm transition-all duration-300 cursor-ns-resize ${"z_structure"===a?"border-indigo-400 bg-indigo-500/30 scale-105 shadow-[0_0_50px_rgba(99,102,241,0.2)]":"border-indigo-500/40 bg-indigo-500/10 hover:border-indigo-400/60"}`,style:{transform:"translate3d(-50%, -50%, 20px)",opacity:.2+.5*i},children:[(0,tr.jsx)("div",{className:"absolute -top-6 -left-6 text-[8px] mono font-black uppercase tracking-widest transition-colors text-indigo-400",children:"Z_STRUCTURE [Geometry]"}),(0,tr.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[16px] font-black text-indigo-400/20 select-none",children:"GEOM"})]}),(0,tr.jsxs)("div",{onMouseDown:e=>d(e,"z_lighting",l),onTouchStart:e=>d(e,"z_lighting",l),className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[280px] h-[180px] border-2 backdrop-blur-sm transition-all duration-300 cursor-ns-resize ${"z_lighting"===a?"border-amber-400 bg-amber-500/30 scale-105 shadow-[0_0_50px_rgba(245,158,11,0.2)]":"border-amber-500/40 bg-amber-500/10 hover:border-amber-400/60"}`,style:{transform:"translate3d(-50%, -50%, 80px)",opacity:.1+.6*l},children:[(0,tr.jsx)("div",{className:"absolute -top-6 -left-6 text-[8px] mono font-black uppercase tracking-widest transition-colors text-amber-400",children:"Z_LIGHTING [Photons]"}),(0,tr.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[16px] font-black text-amber-400/20 select-none",children:"RAD"})]}),(0,tr.jsxs)("div",{onMouseDown:e=>d(e,"z_texture",r),onTouchStart:e=>d(e,"z_texture",r),className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[260px] h-[160px] border-2 backdrop-blur-sm transition-all duration-300 cursor-ns-resize ${"z_texture"===a?"border-emerald-400 bg-emerald-500/30 scale-105 shadow-[0_0_50px_rgba(16,185,129,0.2)]":"border-emerald-500/40 bg-emerald-500/10 hover:border-emerald-400/60"}`,style:{transform:"translate3d(-50%, -50%, 140px)",opacity:.1+.7*r},children:[(0,tr.jsx)("div",{className:"absolute -top-6 -left-6 text-[8px] mono font-black uppercase tracking-widest transition-colors text-emerald-400",children:"Z_TEXTURE [Pores]"}),(0,tr.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[16px] font-black text-emerald-400/20 select-none",children:"TEX"})]})]}),(0,tr.jsxs)("div",{className:"absolute top-1/2 right-10 -translate-y-1/2 space-y-4 opacity-50 group-hover:opacity-100 transition-opacity",children:[(0,tr.jsx)("div",{className:`w-1 transition-all duration-300 ${"z_anatomy"===a?"h-16":"h-12"} bg-white/5 rounded-full overflow-hidden`,children:(0,tr.jsx)("div",{className:"w-full bg-pink-500 transition-all",style:{height:`${n/1.5*100}%`}})}),(0,tr.jsx)("div",{className:`w-1 transition-all duration-300 ${"z_structure"===a?"h-16":"h-12"} bg-white/5 rounded-full overflow-hidden`,children:(0,tr.jsx)("div",{className:"w-full bg-indigo-500 transition-all",style:{height:`${i/1.5*100}%`}})}),(0,tr.jsx)("div",{className:`w-1 transition-all duration-300 ${"z_lighting"===a?"h-16":"h-12"} bg-white/5 rounded-full overflow-hidden`,children:(0,tr.jsx)("div",{className:"w-full bg-amber-500 transition-all",style:{height:`${100*l}%`}})}),(0,tr.jsx)("div",{className:`w-1 transition-all duration-300 ${"z_texture"===a?"h-16":"h-12"} bg-white/5 rounded-full overflow-hidden`,children:(0,tr.jsx)("div",{className:"w-full bg-emerald-500 transition-all",style:{height:`${100*r}%`}})})]})]})]})},lO=({isOpen:e,onClose:t,params:n,setParams:i})=>{if(!e)return null;let l=(e,t)=>{n.auto_tune_active||i(n=>({...n,[e]:t}))};return(0,tr.jsxs)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center overflow-hidden p-0 sm:p-4",children:[(0,tr.jsx)("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-2xl",onClick:t}),(0,tr.jsxs)("div",{className:"relative w-full max-w-2xl h-full md:h-auto max-h-[95vh] md:max-h-[85vh] bg-[#121215] border-x md:border border-white/10 md:rounded-[3rem] overflow-hidden shadow-[0_0_120px_rgba(79,70,229,0.15)] flex flex-col",children:[(0,tr.jsxs)("div",{className:"px-6 py-4 md:px-10 md:py-8 border-b border-white/10 flex items-center justify-between sticky top-0 bg-[#121215] z-[10000]",children:[(0,tr.jsxs)("button",{onClick:t,className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-zinc-400 hover:text-white transition-all",children:[(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,tr.jsxs)("div",{className:"flex items-center gap-4 bg-zinc-900/50 px-5 py-2 rounded-full border border-white/10",children:[(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)("span",{className:"text-[8px] font-black text-zinc-500 uppercase tracking-widest leading-none",children:"Neural Override"}),(0,tr.jsx)("span",{className:`text-[7px] font-bold uppercase transition-colors ${n.auto_tune_active?"text-indigo-400":"text-zinc-700"}`,children:n.auto_tune_active?"Active Pilot":"Manual Mode"})]}),(0,tr.jsx)("button",{onClick:()=>{i(e=>({...e,auto_tune_active:!e.auto_tune_active}))},className:`relative w-10 h-5 rounded-full transition-all duration-500 ${n.auto_tune_active?"bg-indigo-600 shadow-[0_0_15px_rgba(79,70,229,0.5)]":"bg-zinc-800"}`,children:(0,tr.jsx)("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all duration-500 ${n.auto_tune_active?"left-6":"left-1"}`})})]})]}),(0,tr.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 md:p-10 space-y-10 scroll-smooth pb-24 relative",children:[(0,tr.jsx)(lk,{params:n,onParamChange:l}),(0,tr.jsx)("div",{className:"space-y-8",children:[{key:"z_anatomy",label:"Z_ANATOMY (DNA/Pose Lock)",min:0,max:1.5,step:.01,hz:"< 0.1 Hz"},{key:"z_structure",label:"Z_STRUCTURE (Geometry)",min:0,max:1.5,step:.01,hz:"0.1 - 5 Hz"},{key:"z_lighting",label:"Z_LIGHTING (Shadows)",min:0,max:1,step:.01,hz:"5 - 30 Hz"},{key:"z_texture",label:"Z_TEXTURE (Surface)",min:0,max:1,step:.01,hz:"30 - 128 Hz"}].map(e=>(0,tr.jsxs)("div",{className:`space-y-4 transition-all duration-700 ${n.auto_tune_active?"opacity-40 saturate-0":"opacity-100"}`,children:[(0,tr.jsxs)("div",{className:"flex justify-between items-end",children:[(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)("label",{className:"text-[11px] font-black text-zinc-200 uppercase tracking-wider",children:e.label}),(0,tr.jsx)("span",{className:"text-[8px] mono text-indigo-400 font-bold uppercase",children:e.hz})]}),(0,tr.jsxs)("span",{className:"text-sm font-black text-indigo-400 mono tracking-tighter",children:[(100*n[e.key]).toFixed(1),"%"]})]}),(0,tr.jsx)("input",{type:"range",disabled:n.auto_tune_active,min:e.min,max:e.max,step:e.step,value:n[e.key],onChange:t=>l(e.key,parseFloat(t.target.value)),className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-indigo-500"})]},e.key))})]}),(0,tr.jsx)("div",{className:"p-8 bg-[#121215]/95 border-t border-white/10 sticky bottom-0 z-[10000]",children:(0,tr.jsx)("button",{onClick:t,className:"w-full py-5 bg-white text-black hover:bg-zinc-100 rounded-2xl text-[11px] font-black tracking-[0.4em] uppercase transition-all shadow-2xl active:scale-95",children:"Confirm Configuration"})})]})]})},lR=({isOpen:e,onClose:t,grading:n,onChange:i})=>e?(0,tr.jsxs)("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center p-4",children:[(0,tr.jsx)("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-xl",onClick:t}),(0,tr.jsxs)("div",{className:"relative w-full max-w-xl bg-[#0b0b0d] border border-white/10 rounded-[3rem] overflow-hidden shadow-2xl flex flex-col max-h-[90vh]",children:[(0,tr.jsxs)("div",{className:"px-8 py-6 border-b border-white/5 flex justify-between items-center bg-zinc-900/10",children:[(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)("h3",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-[0.4em]",children:"LGN_LOW_LEVEL_MASTERING"}),(0,tr.jsx)("p",{className:"text-[8px] mono text-zinc-600 uppercase font-bold tracking-widest",children:"Industrial Core v12.1"})]}),(0,tr.jsx)("button",{onClick:t,className:"text-zinc-500 hover:text-white transition-all",children:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:3})})})]}),(0,tr.jsx)("div",{className:"flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar",children:(0,tr.jsxs)("div",{className:"space-y-6",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest px-1",children:"Low-Level Sliders"}),[{key:"brightness",label:"Exposure",min:.5,max:1.5,step:.01},{key:"contrast",label:"Contrast",min:.5,max:1.5,step:.01},{key:"saturation",label:"Saturation",min:0,max:2,step:.01},{key:"blur",label:"Haze / Focus",min:0,max:5,step:.1},{key:"sepia",label:"Warmth",min:0,max:1,step:.01},{key:"hueRotate",label:"Hue Rotate",min:-180,max:180,step:1}].map(e=>(0,tr.jsxs)("div",{className:"space-y-2.5",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center px-1",children:[(0,tr.jsx)("span",{className:"text-[10px] font-black text-zinc-300 uppercase tracking-widest",children:e.label}),(0,tr.jsx)("span",{className:"text-[10px] mono text-indigo-400 font-bold",children:n[e.key]})]}),(0,tr.jsx)("input",{type:"range",min:e.min,max:e.max,step:e.step,value:n[e.key],onChange:t=>{var l,r;let a;return l=e.key,r=parseFloat(t.target.value),void((a={...n,[l]:r}).css_filter_string=`brightness(${a.brightness}) contrast(${a.contrast}) saturate(${a.saturation}) blur(${a.blur}px) sepia(${a.sepia}) hue-rotate(${a.hueRotate}deg)`,i(a))},className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-indigo-500"})]},e.key))]})}),(0,tr.jsx)("div",{className:"p-8 bg-[#0e0e11] border-t border-white/5",children:(0,tr.jsx)("button",{onClick:t,className:"w-full py-4 bg-indigo-600 text-white rounded-2xl font-black uppercase tracking-[0.4em] text-[10px] shadow-2xl active:scale-95 transition-all",children:"Commit Master Grading"})})]})]}):null,lP=({params:e})=>{let t=e.neural_metrics,n=e.processing_speed||"Balanced",i=({title:e,value:t,sub:n,color:i})=>(0,tr.jsxs)("div",{className:"bg-zinc-900/30 border border-white/5 p-4 rounded-2xl space-y-1 hover:bg-zinc-800/40 transition-colors",children:[(0,tr.jsx)("p",{className:"text-[8px] font-black uppercase text-zinc-500 tracking-widest",children:e}),(0,tr.jsx)("p",{className:`text-xl font-black mono ${i}`,children:t}),(0,tr.jsx)("p",{className:"text-[7px] text-zinc-600 font-bold uppercase",children:n})]});return(0,tr.jsx)("div",{className:"flex flex-col gap-4 p-6 bg-black/40 border-y border-white/5",children:(0,tr.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[(0,tr.jsx)(i,{title:"Projection Index",value:`${(100*(t.projection_coherence||.94)).toFixed(1)}%`,sub:"L->X PHOTON",color:"text-emerald-400"}),(0,tr.jsx)(i,{title:"Identity Lock",value:"99.42%",sub:"V11_IDENTITY",color:"text-indigo-400"}),(0,tr.jsx)(i,{title:"Gravity Stability",value:"100%",sub:"IK_CENTER",color:"text-pink-400"}),(0,tr.jsx)(i,{title:"Reflection Steps",value:"Fast"===n?1:"Balanced"===n?3:"Deliberate"===n?8:16,sub:"NEURAL_DEPTH",color:"text-cyan-400"}),(0,tr.jsx)(i,{title:"Perspective Sync",value:"1.0",sub:"V_POINT",color:"text-amber-400"}),(0,tr.jsxs)("div",{className:"bg-zinc-900/30 border border-indigo-500/20 p-4 rounded-2xl",children:[(0,tr.jsx)("p",{className:"text-[8px] font-black uppercase text-indigo-500 tracking-widest",children:"VERDICT"}),(0,tr.jsx)("span",{className:"text-[10px] font-black text-emerald-400 uppercase mt-2 block",children:"PASSED // STABLE"})]})]})})},lM=({speed:e,setSpeed:t})=>(0,tr.jsxs)("div",{className:"bg-[#111114] border border-white/5 rounded-2xl p-3 md:p-6 space-y-3",children:[(0,tr.jsx)("h3",{className:"text-[8px] md:text-[10px] font-black uppercase text-zinc-500 tracking-widest leading-none",children:"ð§  Pacing Engine"}),(0,tr.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{id:"Fast",label:"Fast",desc:"Minimal.",icon:"â¡",color:"text-amber-400"},{id:"Balanced",label:"Balanced",desc:"Standard.",icon:"âï¸",color:"text-indigo-400"},{id:"Deliberate",label:"Deliberate",desc:"Deep.",icon:"ð¯",color:"text-emerald-400"},{id:"Debug",label:"Debug",desc:"Full.",icon:"ð",color:"text-pink-400"}].map(n=>(0,tr.jsxs)("button",{onClick:()=>t(n.id),className:`flex flex-col gap-1 p-2 rounded-xl border transition-all text-left ${e===n.id?"bg-zinc-800/50 border-white/20":"bg-black/20 border-white/5"}`,children:[(0,tr.jsx)("span",{className:`text-[8px] font-black uppercase tracking-widest ${e===n.id?n.color:"text-zinc-600"}`,children:n.label}),(0,tr.jsx)("span",{className:"text-[6px] text-zinc-700 uppercase",children:n.desc})]},n.id))})]}),lD=({poseControl:t,setPoseControl:n,vault:i,sourceImage:l,onExecuteSurgical:r,settings:a,onOpenVault:s})=>{let o=(0,ta.useRef)(null),[c,d]=(0,ta.useState)(!1),[u,p]=(0,ta.useState)(!1),[m,h]=(0,ta.useState)(null),[g,f]=(0,ta.useState)("SKELETON"),[x,b]=(0,ta.useState)(null),[y,v]=(0,ta.useState)(null);(0,ta.useEffect)(()=>{(async()=>{let t=await e.A(14244);t.env.allowLocalModels=!1,t.env.useBrowserCache=!0,v(t)})()},[]),(0,ta.useEffect)(()=>{if("u">typeof Pose&&!m){let e=new Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469404/${e}`});e.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),h(e)}},[m]),(0,ta.useEffect)(()=>{(async()=>{if(y)try{let e=await y.pipeline("image-segmentation","Xenova/segformer-b0-finetuned-ade-512-512");b(()=>e)}catch(e){console.warn("Transformers load failed, falling back to heuristic",e)}})()},[y]);let _=async e=>{try{let t=await l_(e,a);return t.environment_context||t.lighting_setup||"Neutral cinematic background"}catch(e){return"Cinematic background"}},N=async e=>{if(e.imageUrl&&m){d(!0);try{let t=new Image;t.src=e.imageUrl,t.crossOrigin="anonymous",await new Promise(e=>{t.onload=e});let i={width:t.width,height:t.height};m.onResults(async r=>{if(r.poseLandmarks){let a=((e,t)=>{let n=t.width,i=t.height,l=document.createElement("canvas");l.width=n,l.height=i;let r=l.getContext("2d");if(!r)return"";r.fillStyle="#000000",r.fillRect(0,0,n,i),r.lineCap="round",r.lineJoin="round";let a=Math.max(3,.006*n),s=Math.max(4,.008*n),o="#00FF00",c="#FF00FF",d="#FFFFFF",u=(t,l,s)=>{e[t]&&e[l]&&!(e[t].visibility<.3)&&!(e[l].visibility<.3)&&(r.shadowBlur=0,r.beginPath(),r.moveTo(e[t].x*n,e[t].y*i),r.lineTo(e[l].x*n,e[l].y*i),r.strokeStyle=s,r.lineWidth=a,r.stroke())},p=(t,l)=>{e[t]&&!(e[t].visibility<.3)&&(r.shadowBlur=0,r.beginPath(),r.arc(e[t].x*n,e[t].y*i,s,0,2*Math.PI),r.fillStyle=l,r.fill())};u(11,12,d),u(23,24,d),u(11,23,o),u(12,24,c),u(11,13,o),u(13,15,o),u(12,14,c),u(14,16,c),u(23,25,o),u(25,27,o),u(27,29,o),u(29,31,o),u(24,26,c),u(26,28,c),u(28,30,c),u(30,32,c);let m=(e[11].x+e[12].x)/2,h=(e[11].y+e[12].y)/2;return e[0]&&(r.beginPath(),r.moveTo(m*n,h*i),r.lineTo(e[0].x*n,e[0].y*i),r.strokeStyle=d,r.lineWidth=a,r.stroke(),p(0,d)),[11,12,13,14,15,16,23,24,25,26,27,28].forEach(e=>{let t=e%2!=0?o:c;p(e,t)}),r.fillStyle="#FFFFFF",r.fillRect(0,0,10,10),r.fillRect(n-10,i-10,10,10),l.toDataURL("image/png")})(r.poseLandmarks,t),s="Studio Background";l&&(s=await _(l)),n({...e,skeletonImage:a,poseMaskImage:a,landmarks:r.poseLandmarks,technicalDescription:"HYPER_RIG_V6 [Engineering Audit]",poseText:"",backgroundContext:s,targetAspectRatio:i}),d(!1)}else d(!1),alert("Pose extraction failed. Try a clearer image.")}),await m.send({image:t})}catch(e){d(!1)}}};(0,ta.useEffect)(()=>{t&&t.imageUrl&&!t.skeletonImage&&!c&&N(t)},[t,m]);let w=async()=>{r&&r()};return(0,tr.jsxs)("div",{className:"bg-[#0e0e11] border border-cyan-500/20 rounded-[2.5rem] overflow-hidden shadow-2xl flex flex-col p-6 space-y-6 relative group/rig",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center border-b border-white/5 pb-4",children:[(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsxs)("h3",{className:"text-[10px] font-black uppercase text-cyan-400 tracking-[0.4em] flex items-center gap-2",children:[(0,tr.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500 animate-pulse"}),"Hyper-Rig V6"]}),(0,tr.jsx)("span",{className:"text-[6px] text-zinc-600 font-bold uppercase mt-1",children:"Audit-Ready Engineering Map"})]}),t&&(0,tr.jsx)("button",{onClick:()=>n(void 0),className:"text-zinc-600 hover:text-white transition-colors",children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:3})})})]}),t?(0,tr.jsxs)("div",{className:"space-y-6 animate-in slide-in-from-right-4 duration-500",children:[(0,tr.jsxs)("div",{className:"relative aspect-[4/3] w-full rounded-[2rem] overflow-hidden border border-cyan-500/20 bg-black group/preview",children:[(0,tr.jsx)("img",{src:"SKELETON"===g?t.skeletonImage:t.imageUrl,className:"w-full h-full object-contain",alt:"Pose Reference"}),(c||u)&&(0,tr.jsxs)("div",{className:"absolute inset-0 bg-black/80 flex flex-col items-center justify-center text-cyan-400 text-[8px] font-black uppercase tracking-widest animate-pulse gap-2",children:[(0,tr.jsx)("div",{className:"w-4 h-4 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin"}),u?"Removing Background...":"Mapping Joints..."]}),(0,tr.jsx)("button",{onClick:()=>f(e=>"SKELETON"===e?"ORIGINAL":"SKELETON"),className:"absolute bottom-4 right-4 bg-black/80 hover:bg-cyan-600/40 text-white px-4 py-2 rounded-xl text-[8px] font-black uppercase border border-white/10 transition-all",children:"SKELETON"===g?"Show Ref":"Show Rig"})]}),(0,tr.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,tr.jsxs)("div",{className:"p-4 bg-cyan-600/5 border border-cyan-500/20 rounded-2xl flex flex-col justify-between",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-cyan-400 uppercase tracking-widest",children:"Rig Integrity"}),(0,tr.jsx)("p",{className:"text-[8px] text-zinc-300 mono font-bold leading-tight mt-1",children:"Audit Level"})]}),(0,tr.jsxs)("div",{className:"p-4 bg-indigo-600/5 border border-indigo-500/20 rounded-2xl flex flex-col justify-between",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-indigo-400 uppercase tracking-widest",children:"Environment"}),(0,tr.jsx)("p",{className:"text-[9px] text-zinc-300 mono font-bold truncate",title:t.backgroundContext,children:t.backgroundContext?"Context Locked":"Scanning..."})]})]}),(0,tr.jsx)("div",{className:"flex gap-2",children:["16:9","9:16","1:1"].map(e=>(0,tr.jsx)("button",{onClick:()=>{t&&n({...t,ratioString:e})},className:`flex-1 py-3 rounded-xl text-[8px] font-black uppercase transition-all ${t.ratioString===e?"bg-cyan-600 text-white shadow-lg":"bg-zinc-800 text-zinc-500 hover:bg-zinc-700"}`,children:e},e))}),(0,tr.jsxs)("button",{onClick:w,disabled:!l||c||u,className:"w-full py-8 bg-gradient-to-r from-red-700 to-indigo-600 hover:from-red-600 hover:to-indigo-500 text-white rounded-[2rem] font-black uppercase tracking-[0.6em] text-[11px] shadow-[0_0_40px_rgba(220,38,38,0.3)] transition-all active:scale-[0.98] disabled:opacity-30 relative overflow-hidden group",children:[(0,tr.jsx)("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"}),c?"ANALYZING...":"INITIATE 5-STAGE PIPELINE"]})]}):(0,tr.jsxs)("div",{className:"aspect-video bg-black/40 border-2 border-dashed border-cyan-500/10 rounded-[2rem] flex flex-col items-center justify-center gap-4 group hover:border-cyan-500/30 transition-all",children:[(0,tr.jsxs)("div",{className:"flex gap-3",children:[(0,tr.jsx)("button",{onClick:()=>o.current?.click(),className:"px-6 py-3 bg-zinc-900 border border-white/5 rounded-2xl text-[9px] font-black uppercase text-zinc-400 hover:text-white transition-all hover:bg-zinc-800",children:"Upload Pose"}),(0,tr.jsx)("button",{onClick:()=>s?.(),className:"px-6 py-3 bg-cyan-600/10 border border-cyan-500/20 rounded-2xl text-[9px] font-black uppercase text-cyan-400 hover:bg-cyan-600/20",children:"Vault"})]}),(0,tr.jsx)("input",{type:"file",ref:o,className:"hidden",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=async e=>{let t={imageUrl:e.target?.result,strength:1,symmetry_strength:1,rigid_integrity:1,preserveIdentity:!0,enabled:!0,warpMethod:"thin_plate",ratioString:"16:9"};n(t),N(t)},e.readAsDataURL(t)}}}),(0,tr.jsx)("p",{className:"text-[8px] font-black uppercase tracking-[0.2em] text-zinc-700 group-hover:text-zinc-500 transition-colors",children:"Select Skeleton Source"})]})]})},lU=({items:e,onSelect:t,onClose:n})=>(0,tr.jsxs)("div",{className:"fixed inset-0 z-[600] bg-black/98 backdrop-blur-3xl flex flex-col p-12 animate-in slide-in-from-bottom-10 duration-700",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center mb-10 max-w-7xl mx-auto w-full",children:[(0,tr.jsx)("h3",{className:"text-3xl font-black text-white uppercase tracking-tighter",children:"Vault Favorites"}),(0,tr.jsx)("button",{onClick:n,className:"px-8 py-3 bg-zinc-800 hover:bg-zinc-700 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all",children:"Voltar"})]}),(0,tr.jsx)("div",{className:"flex-1 overflow-y-auto max-w-7xl mx-auto w-full pb-20 custom-scrollbar",children:(0,tr.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-8",children:e.filter(e=>e.isFavorite).map(e=>(0,tr.jsxs)("div",{onClick:()=>t(e),className:"aspect-square bg-zinc-900 rounded-[2.5rem] overflow-hidden border border-white/5 cursor-pointer hover:border-indigo-500 hover:scale-[1.03] transition-all group relative shadow-2xl",children:[(0,tr.jsx)("img",{src:e.imageUrl,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-[2000ms]"}),(0,tr.jsx)("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,tr.jsx)("span",{className:"text-[10px] font-black text-white uppercase tracking-widest bg-indigo-600 px-4 py-2 rounded-xl",children:"Selecionar Node"})})]},e.id))})})]}),lL=({currentImage:e,isProcessing:t,isBiopsyActive:n,loadingMessage:i,localGrading:l,params:r,vault:a,onUploadClick:s,onOpenVault:o,onSlotClick:c})=>{let[d,u]=(0,ta.useState)(!1);(0,ta.useEffect)(()=>{if(e){u(!0);let e=setTimeout(()=>u(!1),500);return()=>clearTimeout(e)}},[e]);let p=(e,t,n)=>{let i=r.active_slots?.[e],l=a.find(e=>e.shortId===i);return(0,tr.jsxs)("div",{className:"relative flex flex-col items-center gap-1 group",children:[(0,tr.jsx)("div",{className:`w-12 h-12 md:w-16 md:h-16 rounded-xl border-2 transition-all cursor-pointer overflow-hidden bg-black/40 flex items-center justify-center ${l?`border-${n}-500 shadow-[0_0_15px_rgba(0,0,0,0.5)]`:"border-white/5 hover:border-indigo-500/40"}`,onClick:()=>o(e),children:l?(0,tr.jsx)("img",{src:l.imageUrl,className:"w-full h-full object-cover",alt:t}):(0,tr.jsxs)("div",{className:"flex flex-col items-center opacity-20 group-hover:opacity-100 transition-opacity",children:[(0,tr.jsx)("span",{className:"text-[10px] font-black uppercase text-white",children:e}),(0,tr.jsx)("svg",{className:"w-3 h-3 text-white mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 4v16m8-8H4",strokeWidth:3})})]})}),(0,tr.jsx)("span",{className:`text-[6px] font-black uppercase tracking-tighter ${l?`text-${n}-400`:"text-zinc-600"}`,children:t})]})},m=e=>"object"==typeof e&&null!==e?Object.values(e).join(", "):e;return(0,tr.jsxs)("div",{className:"flex-[1.4] relative bg-[#08080a] flex flex-col items-center justify-center border-r border-white/5 overflow-hidden min-h-[300px] md:min-h-0",children:[(t||n)&&(0,tr.jsxs)("div",{className:"absolute inset-0 z-[160] bg-black/80 backdrop-blur-md flex flex-col items-center justify-center space-y-4 text-center px-6 transition-opacity duration-300",children:[(0,tr.jsxs)("div",{className:"relative w-12 h-12 md:w-32 md:h-32",children:[(0,tr.jsx)("div",{className:"absolute inset-0 border-2 border-indigo-500/20 rounded-full"}),(0,tr.jsx)("div",{className:"absolute inset-0 border-2 border-t-indigo-500 rounded-full animate-spin"})]}),(0,tr.jsx)("p",{className:"text-indigo-400 font-black text-[8px] md:text-xs uppercase tracking-[0.3em] animate-pulse",children:i})]}),(0,tr.jsx)("div",{className:"flex-1 w-full relative flex items-center justify-center overflow-hidden",children:e?(0,tr.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center bg-[#050505]",children:[(0,tr.jsxs)("div",{className:"relative max-w-full max-h-full flex items-center justify-center overflow-hidden",children:[(0,tr.jsx)("img",{src:e,className:`max-w-full max-h-full w-auto h-auto object-contain transition-all duration-1000 shadow-2xl relative z-10 ${d?"brightness-125 scale-[1.01]":"brightness-100 scale-100"}`,style:{filter:l?.css_filter_string||"none"}},e),(0,tr.jsx)("div",{className:`absolute inset-0 bg-white mix-blend-overlay transition-opacity duration-500 pointer-events-none z-50 ${d?"opacity-30":"opacity-0"}`})]}),(0,tr.jsxs)("div",{className:"absolute top-8 left-8 flex flex-col gap-2 z-[100]",children:[(0,tr.jsxs)("div",{className:"bg-black/80 backdrop-blur-md px-4 py-2 rounded-xl border border-white/10 flex items-center gap-2",children:[(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full animate-pulse"}),(0,tr.jsx)("span",{className:"text-[8px] font-black text-indigo-400 uppercase tracking-widest",children:"MAD_v12.2 RIGOROUS_MAPPER"})]}),r.dna&&(0,tr.jsxs)("div",{className:"flex flex-col gap-1.5 animate-in slide-in-from-left-4 duration-500",children:[r.dna.camera_specs&&(0,tr.jsxs)("div",{className:"bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-lg border border-white/5 flex flex-col",children:[(0,tr.jsx)("span",{className:"text-[6px] font-black text-zinc-500 uppercase tracking-tighter",children:"Camera Sync"}),(0,tr.jsx)("span",{className:"text-[8px] font-black text-white uppercase",children:m(r.dna.camera_specs)})]}),r.dna.lighting_setup&&(0,tr.jsxs)("div",{className:"bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-lg border border-white/5 flex flex-col",children:[(0,tr.jsx)("span",{className:"text-[6px] font-black text-zinc-500 uppercase tracking-tighter",children:"Lighting Setup"}),(0,tr.jsx)("span",{className:"text-[8px] font-black text-white uppercase",children:m(r.dna.lighting_setup)})]})]})]}),(0,tr.jsxs)("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-4 bg-black/80 backdrop-blur-3xl p-4 rounded-[2.5rem] border border-white/10 z-[150] shadow-2xl",children:[p("X","Identity","emerald"),p("Y","Env","pink"),p("Z","Style","cyan"),p("L","Light","amber")]})]}):(0,tr.jsxs)("div",{className:"w-full h-full bg-zinc-900/10 border-2 border-dashed border-white/5 flex flex-col items-center justify-center p-8 space-y-8",children:[(0,tr.jsx)("div",{className:"w-20 h-20 bg-zinc-900 rounded-full flex items-center justify-center border border-white/5 shadow-inner",children:(0,tr.jsx)("svg",{className:"w-10 h-10 text-zinc-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),(0,tr.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,tr.jsx)("span",{className:"text-[11px] mono uppercase text-zinc-600 font-bold tracking-[0.4em]",children:"Inject Base DNA Reference"}),(0,tr.jsxs)("div",{className:"flex gap-4",children:[(0,tr.jsx)("button",{onClick:s,className:"px-8 py-3 bg-zinc-800 hover:bg-zinc-700 text-white rounded-2xl text-[9px] font-black uppercase tracking-widest border border-white/5 transition-all",children:"Upload Local"}),(0,tr.jsx)("button",{onClick:()=>o(),className:"px-8 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl text-[9px] font-black uppercase tracking-widest shadow-xl transition-all",children:"Choose Vault"})]})]})]})})]})},lz=({onPurge:e,onZMode:t,onPose:n,onLGN:i,isPoseOpen:l,hasGrading:r})=>(0,tr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)("h2",{className:"text-[9px] font-black uppercase tracking-widest text-zinc-600",children:"Studio Console"}),(0,tr.jsx)("span",{className:"text-[7px] mono text-zinc-800 uppercase font-black",children:"LCP-v12.2 MAD_CORE"})]}),(0,tr.jsxs)("div",{className:"flex gap-1",children:[(0,tr.jsx)("button",{onClick:e,className:"bg-red-600/10 px-2 py-1.5 rounded-lg text-red-500 text-[8px] font-black uppercase border border-red-500/20",children:"RESET"}),(0,tr.jsx)("button",{onClick:t,className:"bg-indigo-600/10 px-2 py-1.5 rounded-lg text-indigo-400 text-[8px] font-black uppercase border border-indigo-500/30",children:"Z-MODE"}),(0,tr.jsx)("button",{onClick:n,className:`px-2 py-1.5 rounded-lg text-[8px] font-black uppercase border transition-all ${l?"bg-pink-600 text-white":"bg-pink-600/10 text-pink-400 border-pink-500/30"}`,children:"RIGGING"}),(0,tr.jsx)("button",{onClick:i,className:`px-2 py-1.5 rounded-lg text-[8px] font-black uppercase border transition-all ${r?"bg-emerald-600/10 text-emerald-400 border-emerald-500/30":"bg-zinc-800 text-zinc-500"}`,children:"LGN"})]})]}),lG=({authority:e,onChange:t})=>(0,tr.jsxs)("div",{className:"bg-zinc-900/40 p-5 rounded-2xl border border-white/5 space-y-4",children:[(0,tr.jsx)("span",{className:"text-[8px] font-black text-zinc-500 uppercase tracking-widest",children:"Agent Authority Weights"}),(0,tr.jsx)("div",{className:"space-y-4",children:[{key:"lighting",label:"Lighting Architect",color:"accent-amber-500"},{key:"texture",label:"Texture Master",color:"accent-emerald-500"},{key:"anatomy",label:"Anatomy Specialist",color:"accent-pink-500"}].map(n=>(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center text-[7px] font-black uppercase",children:[(0,tr.jsx)("span",{className:"text-zinc-600",children:n.label}),(0,tr.jsxs)("span",{className:"text-white",children:[e[n.key],"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"0",max:"100",value:e[n.key],onChange:e=>t(n.key,parseInt(e.target.value)),className:`w-full h-0.5 bg-zinc-800 appearance-none rounded-full cursor-pointer ${n.color}`})]},n.key))})]}),lF=({report:e})=>e?(0,tr.jsx)("div",{className:"space-y-4 animate-in fade-in duration-500",children:(0,tr.jsxs)("div",{className:"bg-zinc-950 border border-white/5 p-5 rounded-2xl",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest block mb-2",children:"Multi-Agent Deliberation Result"}),(0,tr.jsx)("div",{className:"text-[8px] mono text-zinc-600 h-24 overflow-y-auto custom-scrollbar whitespace-pre-wrap leading-relaxed",children:e.prompt})]})}):null,lq=({prompt:e,setPrompt:t,onProcess:n,onCommit:i,onOptimize:l,isProcessing:r,isSaving:a,isOptimizing:s,hasImage:o,targetDomain:c,setTargetDomain:d})=>(0,tr.jsxs)("div",{className:"p-4 md:p-8 bg-black/95 backdrop-blur-3xl border-t border-white/5 space-y-4",children:[(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center px-1",children:[(0,tr.jsx)("span",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest",children:"Classify Result Domain"}),(0,tr.jsx)("span",{className:"text-[7px] mono text-indigo-500 font-bold uppercase tracking-tighter",children:"Biopsy on Commit"})]}),(0,tr.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:[{id:"X",label:"Identity",color:"bg-emerald-500"},{id:"Y",label:"Env",color:"bg-pink-500"},{id:"Z",label:"Style",color:"bg-cyan-500"},{id:"L",label:"Light",color:"bg-amber-500"}].map(e=>(0,tr.jsxs)("button",{onClick:()=>d(e.id),className:`py-2 rounded-xl border transition-all flex flex-col items-center justify-center gap-0.5 ${c===e.id?"bg-indigo-600 border-indigo-400 text-white shadow-lg":"bg-white/5 border-white/5 text-zinc-500 hover:text-zinc-300"}`,children:[(0,tr.jsx)("span",{className:"text-[10px] font-black leading-none",children:e.id}),(0,tr.jsx)("span",{className:"text-[6px] font-bold uppercase opacity-60 tracking-tighter",children:e.label})]},e.id))})]}),(0,tr.jsxs)("div",{className:"relative",children:[(0,tr.jsx)("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:"Enter synthesis directive (Kernel v12.2)...",className:"w-full bg-zinc-900/50 border border-white/5 rounded-xl px-4 py-3 text-[10px] md:text-sm h-16 md:h-24 resize-none text-zinc-200 outline-none focus:border-indigo-500/40 transition-all custom-scrollbar pr-12"}),(0,tr.jsx)("button",{onClick:l,disabled:s||!e.trim(),className:`absolute top-3 right-3 p-2 rounded-lg border transition-all ${s?"bg-amber-600/40 border-amber-400 animate-pulse":"bg-zinc-800 border-white/10 text-amber-400 hover:bg-zinc-700"}`,title:"Industrial Meta-Prompt Optimizer",children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M13.5 3L11 8.5L5.5 11L11 13.5L13.5 19L16 13.5L21.5 11L16 8.5L13.5 3Z",strokeWidth:2})})})]}),(0,tr.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,tr.jsx)("button",{onClick:n,disabled:r||s,className:"rounded-xl bg-indigo-600 text-white p-3 md:p-4 font-black uppercase tracking-widest text-[10px] active:scale-95 transition-all shadow-xl shadow-indigo-900/20",children:r?"Synapsing...":"Execute Synth"}),(0,tr.jsx)("button",{onClick:i,disabled:!o||a||r,className:"rounded-xl bg-zinc-100 text-black text-[10px] font-black uppercase tracking-widest active:scale-95 transition-all disabled:opacity-20",children:a?"Indexing...":"Commit Node"})]})]}),lH=({onSave:e,vault:t,prompt:n,setPrompt:i,currentImage:l,setCurrentImage:r,originalSource:a,setOriginalSource:s,logs:o,setLogs:c,params:d,setParams:u,onReloadApp:p,grading:m,settings:h})=>{let[g,f]=(0,ta.useState)(!1),[x,b]=(0,ta.useState)(!1),[y,v]=(0,ta.useState)(!1),[_,N]=(0,ta.useState)(0),[w,E]=(0,ta.useState)(!1),[j,S]=(0,ta.useState)(!1),[I,A]=(0,ta.useState)(!1),[C,T]=(0,ta.useState)(!1),[k,O]=(0,ta.useState)(!1),[R,P]=(0,ta.useState)("BASE"),[M,D]=(0,ta.useState)(void 0),[U,L]=(0,ta.useState)(""),[z,G]=(0,ta.useState)(null),[F,q]=(0,ta.useState)(m),[H,V]=(0,ta.useState)([]),B=(0,ta.useRef)(null),$=d.pose_control?.enabled?["COMPOSITION_LOCK_ACTIVE","ALIGNING_VECTORS","SYNTHESIZING_PIXELS"]:["Kernel Initiating: Calling Meta-Prompt Translator...","Consulting Visual Scout for Optical Truth...","Lighting Architect calculating photon bounce...","Texture Master biopsying material surfaces...","Merging consensus into Final Directive..."];(0,ta.useEffect)(()=>{q(m)},[m]),(0,ta.useEffect)(()=>{let e;return g||C||y||x?(N(0),e=setInterval(()=>{N(e=>(e+1)%$.length)},2500)):clearInterval(e),()=>clearInterval(e)},[g,C,y,x,$.length]);let J=async(e,t=!1)=>{t||T(!0),t||c(e=>[...e,{type:"Attribute Mapper",status:"processing",message:"V12.5 Rigorous Forensic Biopsy (English Standard)...",timestamp:Date.now(),department:"Advanced"}]);try{let n=await l_(e,h),i="Z";return n.character_details&&n.character_details.length>5?i="X":n.environment_context&&n.environment_context.length>5?i="Y":n.lighting_setup&&String(n.lighting_setup).toLowerCase().includes("light")&&(i="L"),u(e=>({...e,dna:n,vault_domain:i})),t||c(e=>[...e,{type:"Attribute Mapper",status:"completed",message:`DNA Sequenced: ${n.human_description}`,timestamp:Date.now(),department:"Advanced"}]),{dna:n,detectedDomain:i}}catch(n){console.error("Biopsy Error:",n);let e=n?.message?.includes("429")||JSON.stringify(n).includes("429")||JSON.stringify(n).includes("RESOURCE_EXHAUSTED");return t||c(t=>[...t,{type:"Attribute Mapper",status:"error",message:e?"Quota Limit Reached. Try later.":"Rigorous Sequence Fault.",timestamp:Date.now()}]),null}finally{t||T(!1)}},W=async()=>{if(n.trim()&&!y){v(!0),c(e=>[...e,{type:"Meta-Prompt Translator",status:"processing",message:"Upleveling user intent to Industrial Meta-Prompt...",timestamp:Date.now(),department:"Advanced"}]);try{let e=await lw(n,h,l||void 0);i(e),L(e),c(e=>[...e,{type:"Meta-Prompt Translator",status:"completed",message:"Ready for surgical synth.",timestamp:Date.now(),department:"Advanced"}])}catch(e){console.error(e),c(e=>[...e,{type:"Meta-Prompt Translator",status:"error",message:"Optimization Fault.",timestamp:Date.now()}])}finally{v(!1)}}},Y=async()=>{let e=d.pose_control?.enabled&&d.pose_control?.poseMaskImage;if(n.trim()||e){f(!0),c([]),V([]);try{let i=d.agent_authority||{lighting:50,texture:50,structure:50,anatomy:50},l=d.pose_control?.enabled?d.pose_control.poseMaskImage:void 0,s=d.pose_control?.enabled?d.pose_control.landmarks:void 0,o=d.pose_control?.enabled?d.pose_control.poseText:void 0,p=d.pose_control?.enabled?d.pose_control.ratioString:void 0,m=await lN(n,{},t,i,h,a||void 0,void 0,s,l,o,p);m.imageUrl&&(r(m.imageUrl),c(m.logs),L(m.enhancedPrompt||n),V(m.deliberation_flow||[]),u(e=>({...e,agent_authority:i})),G({logic:m.collision_logic||(e?"Direct Composition Lock":"Multi-Agent Consensus"),prompt:m.enhancedPrompt||""}),m.grading&&!l&&q(m.grading))}catch(t){console.error("Workspace Process Error:",t);let e=t.message||"Kernel Deliberation Fault.";c(t=>[...t,{type:"Director",status:"error",message:e,timestamp:Date.now()}])}finally{f(!1)}}},K=async()=>{if(l&&!x){b(!0),c(e=>[...e,{type:"Visual Archivist",status:"processing",message:"ARCHIVAL_PROTOCOL: Triggering post-synth forensic biopsy...",timestamp:Date.now(),department:"Advanced"}]);try{let t=await J(l,!0);if(!t)throw Error("Biopsy Failed");let{dna:i,detectedDomain:r}=t,s=i.human_description?.split(",").slice(0,2).join("_").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,"").substring(0,30)||`MAD_${Math.floor(Date.now()/1e3)}`,u={id:crypto.randomUUID(),shortId:`LCP-${Math.floor(1e4+9e4*Math.random())}`,name:s,imageUrl:l,originalImageUrl:a||l,prompt:U||n,agentHistory:o,params:{...d,dna:i},dna:i,rating:5,timestamp:Date.now(),usageCount:0,neuralPreferenceScore:50,isFavorite:!1,vaultDomain:r||d.vault_domain||"X",grading:F,sourceNodeId:M};await e(u),c(e=>[...e,{type:"Visual Archivist",status:"completed",message:`NODE_COMMITTED: ${s}. Full DNA indexed in Vault ${u.vaultDomain}.`,timestamp:Date.now()}]),window.alert(`Vault Commit Successful.
Node: ${s}
Domain: ${u.vaultDomain}`)}catch(e){console.error(e),c(e=>[...e,{type:"Visual Archivist",status:"error",message:"Archival sequence failed.",timestamp:Date.now()}])}finally{b(!1)}}};return(0,tr.jsxs)("div",{className:"h-full flex flex-col bg-[#0c0c0e] relative overflow-hidden min-h-full",children:[(0,tr.jsx)("div",{className:"hidden md:block",children:(0,tr.jsx)(lP,{params:d})}),(0,tr.jsxs)("div",{className:"flex-1 flex flex-col md:flex-row relative",children:[(0,tr.jsx)(lL,{currentImage:l,isProcessing:g||x,isBiopsyActive:C,loadingMessage:x?"ARCHIVING FORENSIC DATA...":$[_],localGrading:F,params:d,vault:t,onUploadClick:()=>B.current?.click(),onOpenVault:e=>{P(e||"BASE"),O(!0)},onSlotClick:()=>{}}),(0,tr.jsxs)("div",{className:"w-full md:w-[380px] lg:w-[440px] flex flex-col bg-[#0e0e11] border-l border-white/5 shadow-2xl relative overflow-hidden",children:[(0,tr.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 space-y-5 md:space-y-8 custom-scrollbar",children:[(0,tr.jsx)(lz,{onPurge:p,onZMode:()=>E(!0),onPose:()=>A(!I),onLGN:()=>S(!0),isPoseOpen:I,hasGrading:!!F}),I?(0,tr.jsx)(lD,{poseControl:d.pose_control,setPoseControl:e=>u(t=>({...t,pose_control:e})),vault:t,sourceImage:l,onExecuteSurgical:Y,settings:h,onOpenVault:()=>{P("POSE"),O(!0)}}):(0,tr.jsxs)(tr.Fragment,{children:[(0,tr.jsx)(lG,{authority:d.agent_authority||{lighting:50,texture:50,structure:50,anatomy:50},onChange:(e,t)=>u(n=>({...n,agent_authority:{...n.agent_authority||{lighting:50,texture:50,structure:50,anatomy:50},[e]:t}}))}),(0,tr.jsx)(lF,{report:z}),(0,tr.jsx)(lM,{speed:d.processing_speed||"Balanced",setSpeed:e=>u(t=>({...t,processing_speed:e}))}),(0,tr.jsx)(lT,{logs:o,isProcessing:g||y||x,deliberation_flow:H})]})]}),(0,tr.jsx)("div",{className:"flex-shrink-0",children:(0,tr.jsx)(lq,{prompt:n,setPrompt:i,onProcess:Y,onCommit:K,onOptimize:W,isProcessing:g,isSaving:x,isOptimizing:y,hasImage:!!l,targetDomain:d.vault_domain||"X",setTargetDomain:e=>u(t=>({...t,vault_domain:e}))})})]})]}),(0,tr.jsx)("input",{ref:B,type:"file",className:"hidden",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=async e=>{let t=e.target?.result;r(t),s(t),D(void 0),J(t)},e.readAsDataURL(t)}}}),k&&(0,tr.jsx)(lU,{items:t,onClose:()=>O(!1),onSelect:e=>{if("BASE"===R)r(e.imageUrl),s(e.imageUrl),D(e.id),J(e.imageUrl);else if("POSE"===R){let t={imageUrl:e.imageUrl,strength:1,symmetry_strength:.5,rigid_integrity:1,preserveIdentity:!0,enabled:!0,warpMethod:"thin_plate",dna:e.dna,technicalDescription:`[COMPOSITION_REFERENCE] Vault Source: ${e.shortId}`};u(e=>({...e,pose_control:t})),c(e=>[...e,{type:"Puppeteer Agent",status:"completed",message:"COMPOSITION_REFERENCE_LOADED.",timestamp:Date.now(),department:"Casting"}])}else u(t=>({...t,active_slots:{...t.active_slots||{},[R]:e.shortId}}));O(!1)}}),(0,tr.jsx)(lO,{isOpen:w,onClose:()=>E(!1),params:d,setParams:u,onAutoTune:()=>{}}),F&&(0,tr.jsx)(lR,{isOpen:j,onClose:()=>S(!1),grading:F,onChange:q})]})},lV="vault_nodes",lB="dna_tokens",l$=()=>new Promise((e,t)=>{let n=indexedDB.open("LatentCinemaDB",2);n.onupgradeneeded=e=>{let t=n.result;t.objectStoreNames.contains(lV)||t.createObjectStore(lV,{keyPath:"id"}),t.objectStoreNames.contains(lB)||t.createObjectStore(lB,{keyPath:"id"})},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}),lJ=async e=>{let t=await l$();return new Promise((n,i)=>{let l=t.transaction(lV,"readwrite"),r={...e,usageCount:e.usageCount??0,neuralPreferenceScore:e.neuralPreferenceScore??50,isFavorite:e.isFavorite??!1,vaultDomain:e.vaultDomain??"X"};l.objectStore(lV).put(r),l.oncomplete=()=>n(),l.onerror=()=>i(l.error)})},lW=async e=>{let t=await l$();return new Promise((n,i)=>{let l=t.transaction(lV,"readwrite").objectStore(lV),r=l.get(e);r.onsuccess=()=>{let e=r.result;e?(e.isFavorite=!e.isFavorite,e.neuralPreferenceScore=e.isFavorite?Math.min(100,e.neuralPreferenceScore+20):e.neuralPreferenceScore,l.put(e),n(e.isFavorite)):i("Node not found")}})},lY=async()=>{let e=await l$();return new Promise((t,n)=>{let i=e.transaction(lV,"readonly").objectStore(lV).getAll();i.onsuccess=()=>t(i.result||[]),i.onerror=()=>n(i.error)})},lK=async e=>{(await l$()).transaction(lV,"readwrite").objectStore(lV).delete(e)},lX=async e=>{let t=(await l$()).transaction(lV,"readwrite").objectStore(lV);e.forEach(e=>t.put(e))},lZ=({nodeCount:e,onExport:t,onImport:n})=>{let i=(0,ta.useRef)(null);return(0,tr.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center border-b border-white/5 pb-12 gap-8",children:[(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsx)("h2",{className:"text-3xl md:text-4xl font-black text-white uppercase tracking-tighter",children:"Vault Repository"}),(0,tr.jsxs)("p",{className:"text-[10px] md:text-[11px] mono text-zinc-500 uppercase tracking-[0.4em]",children:["V11.11 Multi-Domain Logic: ",e," Nodes Indexed"]})]}),(0,tr.jsxs)("div",{className:"flex gap-2",children:[(0,tr.jsxs)("button",{onClick:t,className:"px-5 py-2.5 rounded-xl bg-white/5 border border-white/10 text-[9px] font-black uppercase tracking-widest hover:bg-white/10 transition-all flex items-center gap-2",children:[(0,tr.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4",strokeWidth:2.5})}),"Export Package"]}),(0,tr.jsxs)("button",{onClick:()=>i.current?.click(),className:"px-5 py-2.5 rounded-xl bg-indigo-600/10 border border-indigo-500/20 text-indigo-400 text-[9px] font-black uppercase tracking-widest hover:bg-indigo-600/20 transition-all flex items-center gap-2",children:[(0,tr.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12",strokeWidth:2.5})}),"Sync External"]}),(0,tr.jsx)("input",{type:"file",ref:i,className:"hidden",accept:".json",onChange:n})]})]})},lQ=({filterDomain:e,setFilterDomain:t})=>(0,tr.jsx)("div",{className:"flex gap-2 bg-zinc-900/50 p-1.5 rounded-2xl border border-white/5 self-center lg:self-start mb-8",children:[{id:"ALL",label:"All Kernels"},{id:"X",label:"Identity"},{id:"Y",label:"Environment"},{id:"Z",label:"Style"},{id:"L",label:"Lighting"}].map(n=>(0,tr.jsx)("button",{onClick:()=>t(n.id),className:`px-4 py-1.5 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all ${e===n.id?"bg-indigo-600 text-white shadow-lg":"text-zinc-600 hover:text-zinc-400"}`,children:n.label},n.id))}),l0=({item:e,isExpanded:t,onToggleExpand:n,onToggleFavorite:i,onReload:l,onDelete:r,getDNAColor:a})=>(0,tr.jsxs)("div",{className:`group bg-zinc-900/20 border rounded-[3rem] overflow-hidden flex flex-col transition-all duration-700 shadow-2xl relative ${e.isFavorite?"border-amber-500/50 ring-2 ring-amber-500/10":"border-white/5 hover:border-indigo-500/40"} ${t?"col-span-1 md:col-span-2 ring-1 ring-indigo-500/30":""}`,children:[(0,tr.jsxs)("div",{className:"relative aspect-square overflow-hidden bg-black",children:[(0,tr.jsx)("img",{src:e.imageUrl,className:"w-full h-full object-cover transition-transform duration-[2000ms] group-hover:scale-110",alt:"Node"}),(0,tr.jsxs)("div",{className:"absolute top-5 right-5 flex gap-2 z-30",children:[(0,tr.jsx)("button",{onClick:()=>n(t?null:e.id),className:`p-2.5 rounded-full backdrop-blur-md transition-all ${t?"bg-indigo-600 text-white shadow-[0_0_20px_rgba(79,70,229,0.5)]":"bg-black/40 text-white/50 hover:text-white"}`,title:t?"Collapse":"Inspect DNA",children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t?(0,tr.jsx)("path",{d:"M19 13l-7 7-7-7m14-8l-7 7-7-7",strokeWidth:2.5}):(0,tr.jsx)("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeWidth:2.5})})}),(0,tr.jsx)("button",{onClick:()=>i(e.id),className:`p-2.5 rounded-full backdrop-blur-md transition-all ${e.isFavorite?"bg-amber-500 text-white shadow-[0_0_20px_rgba(245,158,11,0.5)] scale-110":"bg-black/40 text-white/50 hover:text-white"}`,children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:e.isFavorite?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.364-1.364a4.5 4.5 0 00-6.364 0z",strokeWidth:2.5})})})]}),!t&&(0,tr.jsxs)("div",{className:"absolute inset-0 bg-black/80 opacity-0 group-hover:opacity-100 transition-all duration-500 flex flex-col items-center justify-center gap-4 p-8",children:[(0,tr.jsx)("button",{onClick:()=>l(e),className:"w-full py-4 bg-indigo-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-2xl active:scale-95",children:"Reload Buffer"}),(0,tr.jsx)("button",{onClick:()=>r(e.id),className:"w-full py-3 bg-red-600/10 hover:bg-red-600/20 text-red-500 border border-red-500/10 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all",children:"Purge Node"})]}),(0,tr.jsx)("div",{className:"absolute top-5 left-5 flex flex-col gap-2 z-10",children:(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)("span",{className:"px-3 py-1 bg-black/80 backdrop-blur-md rounded-t-lg text-[12px] mono font-black text-white border-x border-t border-white/10",children:e.shortId}),(0,tr.jsxs)("span",{className:`px-3 py-1 rounded-b-lg text-[10px] mono font-black shadow-xl border-x border-b text-white ${a(e.vaultDomain)}`,children:["VAULT ",e.vaultDomain]})]})})]}),!t&&(0,tr.jsxs)("div",{className:"p-8 space-y-4",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)("span",{className:"text-[8px] mono text-zinc-600 font-black uppercase",children:"Neural Rank"}),(0,tr.jsxs)("div",{className:"flex items-center gap-1.5 mt-1",children:[(0,tr.jsx)("div",{className:"w-20 h-1.5 bg-zinc-800 rounded-full overflow-hidden",children:(0,tr.jsx)("div",{className:`h-full transition-all duration-1000 ${e.isFavorite?"bg-amber-500":"bg-indigo-500"}`,style:{width:`${e.neuralPreferenceScore}%`}})}),(0,tr.jsx)("span",{className:`text-[10px] mono font-bold ${e.isFavorite?"text-amber-400":"text-indigo-400"}`,children:e.neuralPreferenceScore})]})]}),(0,tr.jsxs)("div",{className:"text-right",children:[(0,tr.jsx)("span",{className:"text-[8px] mono text-zinc-600 font-black uppercase",children:"Uses"}),(0,tr.jsx)("p",{className:"text-[10px] mono text-zinc-400 font-bold",children:e.usageCount})]})]}),(0,tr.jsx)("div",{className:"min-h-[40px] pt-2 border-t border-white/5",children:(0,tr.jsxs)("p",{className:"text-[11px] text-zinc-400 line-clamp-2 italic leading-relaxed",children:['"',e.prompt,'"']})})]})]}),l1=({item:e,onReload:t,onClose:n})=>{let i=e.dna,l=(e,t="N/A")=>e?"object"==typeof e?Object.values(e).join(", "):e:t;return(0,tr.jsxs)("div",{className:"flex-1 bg-zinc-950 p-8 flex flex-col md:flex-row gap-8 animate-in slide-in-from-bottom-4 duration-500 relative rounded-[3rem] border border-white/10 shadow-3xl",children:[(0,tr.jsxs)("div",{className:"flex-1 space-y-6",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-start",children:[(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsx)("h4",{className:"text-[9px] font-black text-indigo-400 uppercase tracking-widest",children:"Rigorous Biopsy Results (v12.2)"}),(0,tr.jsx)("p",{className:"text-[14px] text-white font-black uppercase leading-tight",children:l(i?.human_description,"Node Analyzed")})]}),e.sourceNodeId&&(0,tr.jsxs)("div",{className:"px-3 py-1 bg-pink-600/10 border border-pink-500/20 rounded-lg flex flex-col items-end group cursor-help",children:[(0,tr.jsx)("span",{className:"text-[6px] font-black text-pink-400 uppercase tracking-tighter",children:"DNA Lineage Active"}),(0,tr.jsxs)("span",{className:"text-[8px] mono text-zinc-400 font-bold uppercase truncate max-w-[80px]",children:["Ancestor_",e.sourceNodeId.split("-")[0]]})]})]}),(0,tr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,tr.jsxs)("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/5 space-y-2",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest",children:"Character / Identity DNA"}),(0,tr.jsxs)("p",{className:"text-[10px] text-zinc-300 italic leading-relaxed",children:['"',l(i?.character_details||i?.character||"Identity Stable"),'"']})]}),(0,tr.jsxs)("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/5 space-y-2",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest",children:"Environment / Context"}),(0,tr.jsxs)("p",{className:"text-[10px] text-zinc-300 italic leading-relaxed",children:['"',l(i?.environment_context||i?.environment||"Latent Space Neutral"),'"']})]})]}),(0,tr.jsxs)("div",{className:"space-y-3",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest block px-1",children:"Synthesis Directive (Prompt)"}),(0,tr.jsxs)("div",{className:"p-4 bg-black/40 border border-white/5 rounded-2xl text-[10px] mono text-zinc-500 leading-relaxed italic max-h-24 overflow-y-auto custom-scrollbar",children:['"',e.prompt,'"']})]}),(0,tr.jsxs)("div",{className:"space-y-3",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest block px-1",children:"Forensic Spec Tags"}),(0,tr.jsx)("div",{className:"flex flex-wrap gap-2",children:i?.technical_tags?.map((e,t)=>(0,tr.jsx)("span",{className:"px-3 py-1 bg-zinc-900 border border-white/10 rounded-full text-[8px] mono text-zinc-400 font-bold uppercase",children:"object"==typeof e?Object.values(e).join(" "):e},t))})]})]}),(0,tr.jsxs)("div",{className:"w-full md:w-[220px] space-y-6 border-l border-white/5 pl-0 md:pl-8 flex flex-col justify-between",children:[(0,tr.jsxs)("div",{className:"space-y-4",children:[(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-600 uppercase block",children:"Camera Calibration"}),(0,tr.jsx)("p",{className:"text-[10px] text-indigo-400 mono font-bold uppercase",children:l(i?.camera_specs||i?.spatial_metadata?.camera_angle||"Eye-Level")})]}),(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-600 uppercase block",children:"Lighting Profile"}),(0,tr.jsx)("p",{className:"text-[10px] text-indigo-400 mono font-bold uppercase",children:l(i?.lighting_setup||i?.aesthetic_dna?.lighting_setup||"Natural")})]}),(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-600 uppercase block",children:"Pose DNA"}),(0,tr.jsx)("p",{className:"text-[10px] text-white mono font-bold uppercase truncate",children:l(i?.pose_attribute,"Static_Equilibrium")})]}),(0,tr.jsxs)("div",{className:"space-y-1 pt-2",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-600 uppercase block",children:"Neural Integrity"}),(0,tr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tr.jsx)("div",{className:"flex-1 h-1 bg-zinc-800 rounded-full overflow-hidden",children:(0,tr.jsx)("div",{className:"h-full bg-emerald-500",style:{width:`${e.neuralPreferenceScore}%`}})}),(0,tr.jsx)("span",{className:"text-[10px] mono text-emerald-400",children:e.neuralPreferenceScore})]})]})]}),(0,tr.jsxs)("div",{className:"pt-8 border-t border-white/5 space-y-3",children:[(0,tr.jsx)("button",{onClick:()=>t(e),className:"w-full py-4 bg-white text-black hover:bg-zinc-100 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl transition-all",children:"Inject to Studio"}),(0,tr.jsx)("button",{onClick:n,className:"w-full py-3 bg-white/5 border border-white/10 text-zinc-500 hover:text-white rounded-xl text-[9px] font-black uppercase tracking-widest transition-all",children:"Collapse"})]})]})]})},l2=({items:e,onDelete:t,onClearAll:n,onReload:i,onRefresh:l})=>{let[r,a]=(0,ta.useState)("ALL"),[s,o]=(0,ta.useState)(null),c=async e=>{await lW(e),await l()},d=async e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=async e=>{try{let t=JSON.parse(e.target?.result);Array.isArray(t)&&(await lX(t),await l(),alert(`${t.length} nodes successfully merged.`))}catch(e){alert("Failed to parse vault file.")}},e.readAsText(t)}},u=e=>{switch(e){case"X":return"bg-emerald-600 border-emerald-400";case"Y":return"bg-pink-600 border-pink-400";case"Z":return"bg-cyan-600 border-cyan-400";case"L":return"bg-amber-600 border-amber-400";default:return"bg-zinc-700 border-white/10"}},p=e.filter(e=>"ALL"===r||e.vaultDomain===r).sort((e,t)=>e.isFavorite!==t.isFavorite?e.isFavorite?-1:1:t.neuralPreferenceScore-e.neuralPreferenceScore);return(0,tr.jsxs)("div",{className:"p-8 md:p-12 bg-[#0c0c0e] min-h-full space-y-12 pb-32",children:[(0,tr.jsx)(lZ,{nodeCount:e.length,onExport:()=>{let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=`latent-vault-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i)},onImport:d}),(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)(lQ,{filterDomain:r,setFilterDomain:a}),(0,tr.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-8",children:p.map(e=>{let n=s===e.id;return(0,tr.jsxs)(ta.default.Fragment,{children:[(0,tr.jsx)(l0,{item:e,isExpanded:n,onToggleExpand:o,onToggleFavorite:c,onReload:i,onDelete:t,getDNAColor:u}),n&&(0,tr.jsx)("div",{className:"col-span-1 md:col-span-2 order-last md:order-none",children:(0,tr.jsx)(l1,{item:e,onReload:i,onClose:()=>o(null)})})]},e.id)})})]})]})},l5=({onBiopsy:e,isScanning:t,hasImage:n})=>(0,tr.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 relative z-10",children:[(0,tr.jsx)("div",{className:"space-y-3",children:(0,tr.jsxs)("div",{className:"flex items-center gap-4",children:[(0,tr.jsx)("div",{className:"w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center border border-white/10 group",children:(0,tr.jsx)("svg",{className:"w-6 h-6 text-indigo-500 group-hover:rotate-12 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 4v16m8-8H4",strokeWidth:2.5})})}),(0,tr.jsxs)("div",{children:[(0,tr.jsx)("h2",{className:"text-3xl font-black uppercase tracking-tighter text-white",children:"Neural Biopsy Station"}),(0,tr.jsx)("p",{className:"text-[10px] mono text-zinc-500 uppercase tracking-[0.5em]",children:"LCP_v11.11 AUTOMATED INDEXING"})]})]})}),n&&(0,tr.jsxs)("button",{onClick:e,disabled:t,className:`group flex items-center gap-3 px-8 py-4 rounded-2xl bg-indigo-600/10 border border-indigo-500/20 text-indigo-400 font-black text-[11px] uppercase tracking-widest hover:bg-indigo-600/20 transition-all ${t?"animate-pulse":""}`,children:[(0,tr.jsx)("svg",{className:"w-4 h-4 group-hover:rotate-45 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M13.5 3L11 8.5L5.5 11L11 13.5L13.5 19L16 13.5L21.5 11L16 8.5L13.5 3Z",strokeWidth:2})}),t?"Sequencing DNA...":"Neural Biopsy (Magic Wand)"]})]}),l4=({image:e,isScanning:t,scanProgress:n,onUploadClick:i})=>(0,tr.jsx)("div",{onClick:i,className:`group relative aspect-square rounded-[3rem] md:rounded-[4rem] border-2 border-dashed transition-all duration-700 overflow-hidden cursor-pointer ${e?"border-transparent":"border-white/5 hover:border-indigo-500/30 bg-black/40"}`,children:e?(0,tr.jsxs)(tr.Fragment,{children:[(0,tr.jsx)("img",{src:e,className:`w-full h-full object-cover transition-all duration-1000 ${t?"scale-110 blur-sm grayscale":"scale-100 grayscale-0"}`,alt:"Reference"}),(0,tr.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"}),t&&(0,tr.jsxs)("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center space-y-4",children:[(0,tr.jsx)("div",{className:"w-full h-[2px] bg-indigo-500 shadow-[0_0_20px_#6366f1] animate-scan-y absolute top-0"}),(0,tr.jsx)("div",{className:"bg-black/60 backdrop-blur-md px-6 py-3 rounded-full border border-indigo-500/30",children:(0,tr.jsxs)("span",{className:"text-[10px] font-black text-indigo-400 mono uppercase tracking-widest",children:["Sequencing: ",Math.floor(n),"%"]})})]}),(0,tr.jsx)("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,tr.jsx)("span",{className:"bg-black/80 backdrop-blur-md px-6 py-2 rounded-full text-[9px] font-black text-white uppercase border border-white/10",children:"Replace Frame"})})]}):(0,tr.jsxs)("div",{className:"h-full flex flex-col items-center justify-center space-y-6",children:[(0,tr.jsx)("div",{className:"w-20 h-20 bg-zinc-900 rounded-full flex items-center justify-center border border-white/5 group-hover:scale-110 transition-transform",children:(0,tr.jsx)("svg",{className:"w-8 h-8 text-zinc-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12",strokeWidth:1.5})})}),(0,tr.jsxs)("div",{className:"text-center space-y-2",children:[(0,tr.jsx)("p",{className:"text-[11px] font-black uppercase tracking-[0.4em] text-zinc-600",children:"Inject Reference Frame"}),(0,tr.jsx)("p",{className:"text-[8px] mono text-zinc-800 uppercase",children:"TIFF / PNG / WEBP SUPPORTED"})]})]})}),l3=({selectedDomain:e,onSelect:t})=>(0,tr.jsxs)("div",{className:"space-y-4",children:[(0,tr.jsx)("label",{className:"text-[10px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Select Target Domain"}),(0,tr.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{id:"X",label:"Identity"},{id:"Y",label:"Environment"},{id:"Z",label:"Style"},{id:"L",label:"Lighting"}].map(n=>(0,tr.jsxs)("button",{onClick:()=>t(n.id),className:`flex flex-col items-center justify-center gap-2 py-5 rounded-3xl border transition-all relative overflow-hidden ${e===n.id?"bg-white text-black border-white shadow-2xl scale-105":"bg-black/40 border-white/5 text-zinc-600 hover:text-zinc-400"}`,children:[(0,tr.jsx)("span",{className:"text-[13px] font-black",children:n.id}),(0,tr.jsx)("span",{className:"text-[7px] font-black uppercase tracking-widest",children:n.label}),e===n.id&&(0,tr.jsx)("div",{className:"absolute top-0 right-0 w-2 h-2 bg-indigo-500 rounded-bl-lg"})]},n.id))})]}),l6=({dna:e})=>{if(!e)return null;let t=(e,t="N/A")=>e?"object"==typeof e?Object.values(e).join(", "):e:t;return(0,tr.jsxs)("div",{className:"flex-1 bg-zinc-950/40 border border-white/5 rounded-[3rem] p-8 space-y-6 max-h-[500px] overflow-y-auto custom-scrollbar",children:[(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsx)("h4",{className:"text-[9px] font-black text-indigo-400 uppercase tracking-widest",children:"Neural Biopsy Results (v12.2)"}),(0,tr.jsx)("p",{className:"text-[14px] text-white font-black uppercase leading-tight",children:t(e.human_description,"Node Analyzed")})]}),(0,tr.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,tr.jsxs)("div",{className:"p-5 rounded-3xl bg-white/5 border border-white/5 space-y-2",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest",children:"Character / Identity DNA"}),(0,tr.jsx)("p",{className:"text-[10px] text-zinc-300 italic leading-relaxed uppercase",children:t(e.character_details)})]}),(0,tr.jsxs)("div",{className:"p-5 rounded-3xl bg-white/5 border border-white/5 space-y-2",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest",children:"Environment / Context"}),(0,tr.jsx)("p",{className:"text-[10px] text-zinc-300 italic leading-relaxed uppercase",children:t(e.environment_context)})]}),(0,tr.jsxs)("div",{className:"p-5 rounded-3xl bg-white/5 border border-white/5 space-y-2",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest",children:"Core Attribute / Pose"}),(0,tr.jsx)("p",{className:"text-[10px] text-zinc-300 italic leading-relaxed uppercase",children:t(e.pose_attribute)})]}),(0,tr.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,tr.jsxs)("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/5 space-y-1",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-600 uppercase",children:"Camera Sync"}),(0,tr.jsx)("p",{className:"text-[9px] text-indigo-400 mono font-bold uppercase",children:t(e.camera_specs)})]}),(0,tr.jsxs)("div",{className:"p-4 rounded-2xl bg-white/5 border border-white/5 space-y-1",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-600 uppercase",children:"Lighting Setup"}),(0,tr.jsx)("p",{className:"text-[9px] text-indigo-400 mono font-bold uppercase",children:t(e.lighting_setup)})]})]}),(0,tr.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-500 uppercase tracking-widest block px-1",children:"Technical Taxonomy"}),(0,tr.jsx)("div",{className:"flex flex-wrap gap-2",children:e.technical_tags?.map((e,t)=>(0,tr.jsx)("span",{className:"px-3 py-1 bg-zinc-900 border border-white/10 rounded-full text-[8px] mono text-zinc-400 font-bold uppercase",children:"object"==typeof e?Object.values(e).join(" "):e},t))})]})]})]})},l8=({onCommit:e,isIndexing:t,isEnabled:n})=>(0,tr.jsxs)("button",{onClick:e,disabled:!n||t,className:"w-full py-8 md:py-10 bg-indigo-600 hover:bg-indigo-500 text-white rounded-[2.5rem] font-black uppercase tracking-[0.8em] text-[12px] shadow-[0_20px_50px_rgba(79,70,229,0.3)] active:scale-95 transition-all relative overflow-hidden group",children:[(0,tr.jsx)("span",{className:"relative z-10",children:t?"Committing to Vault...":"Commit Categorized DNA"}),(0,tr.jsx)("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"})]}),l7=({onSave:e,settings:t})=>{let[n,i]=(0,ta.useState)(null),[l,r]=(0,ta.useState)(null),[a,s]=(0,ta.useState)("X"),[o,c]=(0,ta.useState)(!1),[d,u]=(0,ta.useState)(!1),[p,m]=(0,ta.useState)(0),h=(0,ta.useRef)(null);(0,ta.useEffect)(()=>{let e;return o?(m(0),e=setInterval(()=>{m(e=>e<95?e+15*Math.random():e)},400)):(m(0),clearInterval(e)),()=>clearInterval(e)},[o]);let g=async()=>{if(n&&!o){c(!0);try{let e=await l_(n,t);r(e),e.character_details&&e.character_details.length>5?s("X"):e.environment_context&&e.environment_context.length>5?s("Y"):e.lighting_setup&&String(e.lighting_setup).toLowerCase().includes("light")?s("L"):s("Z")}catch(e){alert(e?.message?.includes("429")||JSON.stringify(e).includes("429")||JSON.stringify(e).includes("RESOURCE_EXHAUSTED")?"Quota Limit Reached. Please wait a moment.":"Neural Biopsy Protocol Interrupted.")}finally{c(!1)}}},f=async()=>{if(n&&l&&!d){u(!0);try{let t=Math.floor(1e4+9e4*Math.random()),s=l.human_description?.split(",").slice(0,2).join("_").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,"")||"Latent_Node",o={id:crypto.randomUUID(),shortId:`LCP-${t}`,name:s,imageUrl:n,originalImageUrl:n,prompt:l.human_description||l.technical_tags?.join(", ")||`Visual DNA: ${s}`,agentHistory:[{type:"Visual Archivist",status:"completed",message:`Neural Biopsy V12.2 completed. Desc: ${l.human_description}. Node committed to Vault ${a}.`,timestamp:Date.now(),department:"Advanced"}],params:{z_anatomy:1,z_structure:1,z_lighting:1,z_texture:1,hz_range:"Index-v12.2",dna:l,structural_fidelity:1,scale_factor:1,neural_metrics:{loss_mse:0,ssim_index:1,tensor_vram:2.5,iteration_count:0,consensus_score:1}},dna:l,rating:5,timestamp:Date.now(),usageCount:0,neuralPreferenceScore:65,isFavorite:!1,vaultDomain:a};await e(o),i(null),r(null)}catch(e){alert("Vault Commitment Failure.")}finally{u(!1)}}};return(0,tr.jsxs)("div",{className:"h-full flex items-center justify-center p-4 md:p-12 bg-[#050505] overflow-y-auto",children:[(0,tr.jsxs)("div",{className:"w-full max-w-6xl bg-zinc-900/10 border border-white/5 rounded-[3rem] md:rounded-[5rem] p-8 md:p-20 space-y-12 shadow-[0_0_150px_rgba(0,0,0,0.8)] backdrop-blur-3xl relative overflow-hidden",children:[(0,tr.jsx)(l5,{onBiopsy:g,isScanning:o,hasImage:!!n}),(0,tr.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 md:gap-20",children:[(0,tr.jsxs)("div",{className:"space-y-8 relative",children:[(0,tr.jsx)(l4,{image:n,isScanning:o,scanProgress:p,onUploadClick:()=>!o&&h.current?.click()}),n&&!l&&!o&&(0,tr.jsxs)("div",{className:"p-8 bg-indigo-500/5 border border-indigo-500/10 rounded-[2.5rem] flex items-center justify-between",children:[(0,tr.jsx)("p",{className:"text-[10px] text-zinc-500 uppercase font-black tracking-widest leading-relaxed",children:"Awaiting MAD_KERNEL v12.2 neural DNA biopsy to categorize node."}),(0,tr.jsx)("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-pulse"})]})]}),(0,tr.jsx)("div",{className:"space-y-10 flex flex-col",children:l?(0,tr.jsxs)("div",{className:"flex-1 flex flex-col space-y-8 animate-in slide-in-from-right-12 duration-1000",children:[(0,tr.jsx)(l3,{selectedDomain:a,onSelect:s}),(0,tr.jsx)(l6,{dna:l}),(0,tr.jsx)(l8,{onCommit:f,isIndexing:d,isEnabled:!!l})]}):(0,tr.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center space-y-8 py-20 opacity-30",children:[(0,tr.jsx)("div",{className:"w-16 h-16 border-2 border-indigo-500/20 rounded-full border-t-indigo-500 animate-spin"}),(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsx)("p",{className:"text-[11px] font-black uppercase tracking-widest",children:"Station Locked"}),(0,tr.jsx)("p",{className:"text-[9px] mono uppercase",children:"Awaiting Rigorous Input Buffer..."})]})]})})]})]}),(0,tr.jsx)("input",{type:"file",ref:h,className:"hidden",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=e=>{i(e.target?.result),r(null)},e.readAsDataURL(t)}},accept:"image/*"}),(0,tr.jsx)("style",{children:`
        @keyframes scan {
          0% { transform: translateY(0); }
          50% { transform: translateY(100%); }
          100% { transform: translateY(0); }
        }
        .animate-scan-y {
          animation: scan 4s ease-in-out infinite;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
      `})]})},l9=()=>(0,tr.jsx)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-8 border-b border-white/5 pb-12",children:(0,tr.jsx)("div",{className:"space-y-2",children:(0,tr.jsxs)("div",{className:"flex items-center gap-4",children:[(0,tr.jsx)("div",{className:"w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-[0_0_30px_rgba(79,70,229,0.3)] animate-pulse",children:(0,tr.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 2a5 5 0 00-5 5v3a5 5 0 0010 0V7a5 5 0 00-5-5z",strokeWidth:2.5})})}),(0,tr.jsxs)("div",{children:[(0,tr.jsx)("h2",{className:"text-4xl font-black text-white uppercase tracking-tighter",children:"Fusion Reactor"}),(0,tr.jsx)("p",{className:"text-[11px] mono text-zinc-500 uppercase tracking-[0.5em]",children:"Adaptive Synaptic Logic v10.2"})]})]})})}),re=({intent:e,onIntentChange:t,onRefine:n,isOptimizing:i,isAutoPilot:l,onAutoPilotToggle:r})=>(0,tr.jsxs)("div",{className:"w-full flex flex-col sm:flex-row items-center gap-8 bg-zinc-950/50 p-8 rounded-[3rem] border border-white/5 shadow-inner",children:[(0,tr.jsxs)("div",{className:"w-full md:min-w-[400px] space-y-3 relative group",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-600 uppercase tracking-widest block px-1",children:"Neural Intent Directive"}),(0,tr.jsx)("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:"Specify synthesis...",className:"w-full bg-black/40 border border-white/5 rounded-2xl px-6 py-4 text-sm text-white focus:outline-none h-24 resize-none transition-all focus:border-indigo-500/30"}),(0,tr.jsx)("button",{onClick:n,disabled:i||!e.trim(),className:"absolute bottom-3 right-3 p-2 bg-indigo-600/10 text-indigo-400 rounded-xl border border-indigo-500/20 hover:bg-indigo-600/20 transition-all active:scale-95",children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M13.5 3L11 8.5L5.5 11L11 13.5L13.5 19L16 13.5L21.5 11L16 8.5L13.5 3Z",strokeWidth:2})})})]}),(0,tr.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,tr.jsx)("span",{className:"text-[9px] font-black text-zinc-600 uppercase tracking-widest",children:"AutoPilot"}),(0,tr.jsx)("button",{onClick:r,className:`relative w-14 h-7 rounded-full transition-all duration-500 ${l?"bg-indigo-600":"bg-zinc-800"}`,children:(0,tr.jsx)("div",{className:`absolute top-1 w-5 h-5 rounded-full bg-white transition-all duration-500 ${l?"left-8":"left-1"}`})})]})]}),rt=({label:e,color:t,currentId:n,vault:i,onSelect:l,isOptimizing:r})=>{let a=i.find(e=>e.shortId===n);return(0,tr.jsxs)("div",{className:`bg-zinc-950/40 border-2 rounded-[2.5rem] p-6 transition-all duration-700 relative overflow-hidden group ${a?"border-indigo-500/30 ring-1 ring-indigo-500/20":"border-white/5 hover:border-white/10"}`,children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center mb-5",children:[(0,tr.jsx)("div",{className:"flex flex-col",children:(0,tr.jsx)("span",{className:`text-[10px] font-black uppercase tracking-[0.3em] ${t}`,children:e})}),a&&(0,tr.jsx)("button",{onClick:()=>l(""),className:"text-zinc-600 hover:text-white p-1",children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:3})})})]}),(0,tr.jsx)("div",{className:"relative aspect-square rounded-[2rem] bg-black/60 overflow-hidden border border-white/5 mb-6 group-hover:scale-[1.02] transition-transform",children:a?(0,tr.jsxs)(tr.Fragment,{children:[(0,tr.jsx)("img",{src:a.imageUrl,className:"w-full h-full object-cover opacity-50 grayscale group-hover:grayscale-0 transition-all duration-700",alt:"Preview"}),(0,tr.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"}),(0,tr.jsxs)("div",{className:"absolute top-4 right-4 flex items-center gap-2 bg-black/60 backdrop-blur-md px-2 py-1 rounded-full border border-white/10",children:[(0,tr.jsxs)("span",{className:"text-[8px] mono text-indigo-400 font-bold",children:["R:",a.neuralPreferenceScore||0]}),a.usageCount>=10&&(0,tr.jsx)("span",{className:"text-[10px]",children:"â­"})]}),(0,tr.jsx)("div",{className:"absolute bottom-4 left-4 right-4 space-y-2",children:(0,tr.jsx)("div",{className:"flex gap-1",children:(0,tr.jsx)("div",{className:"h-1 flex-1 bg-white/10 rounded-full overflow-hidden",children:(0,tr.jsx)("div",{className:"h-full bg-indigo-500",style:{width:`${a.neuralPreferenceScore||0}%`}})})})})]}):(0,tr.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center opacity-10",children:[(0,tr.jsx)("svg",{className:`w-10 h-10 mb-2 ${t}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 4v16m8-8H4",strokeWidth:2})}),(0,tr.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Awaiting Component"})]})}),(0,tr.jsxs)("select",{value:n,onChange:e=>l(e.target.value),disabled:r,className:"w-full bg-zinc-900/60 border border-white/5 rounded-2xl p-4 text-[11px] text-zinc-400 font-bold outline-none hover:border-indigo-500/20 transition-all appearance-none text-center",children:[(0,tr.jsx)("option",{value:"",children:"Neural Select..."}),i.sort((e,t)=>(t.neuralPreferenceScore||0)-(e.neuralPreferenceScore||0)).map(e=>(0,tr.jsxs)("option",{value:e.shortId,children:[e.neuralPreferenceScore>=80?"â­ ":"",e.shortId," (Score: ",e.neuralPreferenceScore||0,")"]},e.id))]})]})},rn=({manifest:e,vault:t,onSelectSlot:n,isOptimizing:i})=>(0,tr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[(0,tr.jsx)(rt,{label:"PEP Node (Identity)",color:"text-emerald-400",currentId:e.pep_id,vault:t,onSelect:e=>n("pep_id",e),isOptimizing:i}),(0,tr.jsx)(rt,{label:"POP Node (Pose)",color:"text-pink-400",currentId:e.pop_id,vault:t,onSelect:e=>n("pop_id",e),isOptimizing:i}),(0,tr.jsx)(rt,{label:"POV Node (Lens)",color:"text-cyan-400",currentId:e.pov_id,vault:t,onSelect:e=>n("pov_id",e),isOptimizing:i}),(0,tr.jsx)(rt,{label:"AMB Node (Env)",color:"text-amber-400",currentId:e.amb_id,vault:t,onSelect:e=>n("amb_id",e),isOptimizing:i})]}),ri=({onFusion:e,isProcessing:t,isOptimizing:n})=>(0,tr.jsxs)("button",{onClick:e,disabled:t||n,className:"w-full py-12 bg-white text-black rounded-[4rem] font-black uppercase tracking-[1em] text-sm shadow-[0_0_50px_rgba(255,255,255,0.1)] hover:bg-zinc-100 transition-all active:scale-[0.98] disabled:opacity-30 relative overflow-hidden group",children:[t&&(0,tr.jsx)("div",{className:"absolute inset-0 bg-indigo-600/20 animate-pulse"}),(0,tr.jsx)("span",{className:"relative z-10",children:t?"TRANSPLANTING IDENTITY...":"EXECUTE NEURAL SYNTH"})]}),rl=({vault:e,onResult:t,settings:n})=>{let[i,l]=(0,ta.useState)({pep_id:"",pop_id:"",pov_id:"",amb_id:"",weights:{pep:1,pop:1,pov:1,amb:1},style_modifiers:[],surgicalSwap:!1,fusionIntent:"",protectionStrength:1.5}),[r,a]=(0,ta.useState)(!1),[s,o]=(0,ta.useState)(!1),[c,d]=(0,ta.useState)(!1),[u,p]=(0,ta.useState)([]),[m,h]=(0,ta.useState)(!1),g=async()=>{if(!i.pep_id&&!i.pop_id)return void alert("PEP (Identity) and POP (Pose) nodes are required for a stable reactor start.");a(!0),p([{type:"Neural Alchemist",status:"processing",message:"Warping Reactor for Identity Migration...",timestamp:Date.now(),department:"Advanced"}]);try{let l=await lS(i,e,n);if(p(e=>[...e,...l.logs]),m&&l.imageUrl){let r=e.find(e=>e.shortId===i.pop_id),a=await lA(l.imageUrl,i.fusionIntent,r?.imageUrl,n);if(p(e=>[...e,{type:"Visual Quality Judge",status:"completed",message:`Consensus Score: ${Math.round(100*a.score)}%. ${a.critique}`,timestamp:Date.now(),department:"Advanced"}]),a.score<.7){let l={...i,fusionIntent:`${i.fusionIntent}. Ensure full character migration: ${a.suggestion}`},r=await lS(l,e,n);if(r.imageUrl){let e={z_anatomy:1,z_structure:1,z_lighting:1,z_texture:1,hz_range:"Fusion-v10.2",structural_fidelity:1,scale_factor:1,neural_metrics:r.params.neural_metrics};t(r.imageUrl,e,u);return}}}if(l.imageUrl){let e={z_anatomy:1,z_structure:1,z_lighting:1,z_texture:1,hz_range:"Fusion-v10.2",structural_fidelity:1,scale_factor:1,neural_metrics:l.params.neural_metrics};t(l.imageUrl,e,u)}}catch(e){p(e=>[...e,{type:"Neural Alchemist",status:"error",message:"Critical Reactor Melt.",timestamp:Date.now(),department:"Advanced"}])}finally{a(!1)}},f=async()=>{if(i.fusionIntent.trim()&&!c){d(!0);try{let e=await lC(i.fusionIntent,n);l(t=>({...t,fusionIntent:e.refined}))}catch(e){console.error(e)}finally{d(!1)}}},x=async()=>{if(!i.fusionIntent.trim()){alert("Neural intent required."),o(!1);return}d(!0);try{let{manifest:t}=await lI(i.fusionIntent,i,e,n);l(t)}catch(e){console.error(e),o(!1)}finally{d(!1)}};return(0,ta.useEffect)(()=>{s&&i.fusionIntent.trim()&&!c&&x()},[s]),(0,tr.jsxs)("div",{className:"min-h-full bg-[#08080a] p-6 lg:p-12 flex flex-col lg:flex-row gap-12 pb-32 overflow-y-auto",children:[(0,tr.jsxs)("div",{className:"flex-1 space-y-12 max-w-5xl",children:[(0,tr.jsx)(l9,{}),(0,tr.jsx)(re,{intent:i.fusionIntent,onIntentChange:e=>l(t=>({...t,fusionIntent:e})),onRefine:f,isOptimizing:c,isAutoPilot:s,onAutoPilotToggle:()=>o(!s)}),(0,tr.jsx)(rn,{manifest:i,vault:e,onSelectSlot:(e,t)=>{l(n=>({...n,[e]:t}))},isOptimizing:c}),(0,tr.jsx)(ri,{onFusion:g,isProcessing:r,isOptimizing:c})]}),(0,tr.jsxs)("div",{className:"w-full lg:w-[400px] space-y-8 h-fit lg:sticky lg:top-32",children:[(0,tr.jsx)("h3",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-zinc-600 px-2",children:"Reactor Log Telemetry"}),(0,tr.jsx)(lT,{logs:u,isProcessing:r})]})]})},rr=({currentBeat:e,aspectRatio:t,subtitleSettings:n,title:i,credits:l,isRendering:r,renderProgress:a,renderStatus:s})=>(0,tr.jsx)("div",{className:"flex-1 flex items-center justify-center p-8 relative overflow-hidden",children:(0,tr.jsxs)("div",{className:`relative bg-zinc-950 shadow-2xl overflow-hidden rounded-[2rem] border border-white/5 transition-all duration-700 ${"16:9"===t?"w-full max-w-5xl aspect-video":"1:1"===t?"h-full max-h-[80vh] aspect-square":"h-full max-h-[80vh] aspect-[9/16]"}`,children:[e?(0,tr.jsxs)("div",{className:"w-full h-full relative",children:[e.assetUrl?(0,tr.jsx)("img",{src:e.assetUrl,className:"w-full h-full object-cover origin-top animate-ken-burns",style:{transform:`translateY(${e.yOffset||0}%)`}}):(0,tr.jsxs)("div",{className:"w-full h-full bg-zinc-900/50 flex flex-col items-center justify-center gap-4",children:[(0,tr.jsx)("svg",{className:"w-12 h-12 text-zinc-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeWidth:1.5})}),(0,tr.jsx)("span",{className:"text-[10px] font-black text-zinc-700 uppercase tracking-widest",children:"Searching Web References..."})]}),(0,tr.jsx)("div",{className:`absolute left-0 right-0 px-10 flex justify-center ${e.id.startsWith("title")||e.id.startsWith("credits")?"inset-0 items-center":"bottom-[15%]"}`,children:(0,tr.jsx)("div",{style:{fontSize:`${e.id.startsWith("credits")||e.id.startsWith("title")?.85*n.fontSize:n.fontSize}px`,color:n.fontColor,backgroundColor:n.backgroundColor,opacity:n.bgOpacity,borderRadius:`${n.fontSize*n.radiusMult}px`,padding:`${n.fontSize*n.paddingVMult}px ${n.fontSize*n.paddingHMult}px`,textAlign:n.textAlign,maxWidth:"90%",lineHeight:"1.4",fontWeight:600,fontFamily:n.fontFamily,border:"1px solid rgba(255,255,255,0.1)",whiteSpace:"pre-wrap",boxShadow:"0 20px 40px rgba(0,0,0,0.4)"},dangerouslySetInnerHTML:{__html:e.id.startsWith("title")?i:e.id.startsWith("credits")?l:e.caption}})}),e.sourceLink&&(0,tr.jsxs)("div",{className:"absolute bottom-4 right-4 px-3 py-1 bg-black/60 backdrop-blur-md rounded-full border border-white/10 flex items-center gap-2",children:[(0,tr.jsx)("div",{className:"w-1 h-1 bg-indigo-500 rounded-full animate-pulse"}),(0,tr.jsxs)("span",{className:"text-[9px] text-indigo-400 mono",children:["Web Source: ",e.sourceLink]})]})]}):(0,tr.jsx)("div",{className:"w-full h-full flex items-center justify-center opacity-10",children:(0,tr.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest text-white",children:"Execute o Protocolo de Roteiro"})}),r&&(0,tr.jsxs)("div",{className:"absolute inset-0 z-[100] bg-black/98 backdrop-blur-2xl flex flex-col items-center justify-center p-12 text-center animate-in fade-in",children:[(0,tr.jsxs)("div",{className:"w-48 h-48 border-[12px] border-indigo-500/10 rounded-full flex items-center justify-center relative",children:[(0,tr.jsx)("div",{className:"absolute inset-0 border-[12px] border-indigo-500 border-t-transparent rounded-full animate-spin"}),(0,tr.jsxs)("span",{className:"text-4xl font-black text-white mono",children:[a,"%"]})]}),(0,tr.jsx)("h4",{className:"mt-8 text-[11px] font-black uppercase tracking-[0.4em] text-indigo-400",children:s})]})]})}),ra=({beats:e,activeIndex:t,onSelect:n,onOpenOrchestrator:i,loadingBeats:l})=>(0,tr.jsx)("div",{className:"h-64 bg-zinc-950/50 p-6 overflow-y-auto border-t border-white/5 custom-scrollbar",children:(0,tr.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4",children:e.map((e,r)=>(0,tr.jsxs)("div",{onClick:()=>n(r),className:`relative aspect-video rounded-2xl border-2 transition-all cursor-pointer overflow-hidden group ${t===r?"border-indigo-500 scale-[1.03] z-10 shadow-[0_0_20px_rgba(79,70,229,0.3)]":"border-white/5 opacity-50 hover:opacity-100"}`,children:[e.assetUrl?(0,tr.jsx)("img",{src:e.assetUrl,className:"w-full h-full object-cover"}):(0,tr.jsxs)("div",{className:"w-full h-full bg-zinc-900 flex flex-col items-center justify-center text-[8px] text-zinc-700 font-black uppercase",children:[(0,tr.jsx)("span",{children:e.id.startsWith("title")?"TITLE":e.id.startsWith("credits")?"CREDITS":r+1}),e.sourceLink&&(0,tr.jsx)("span",{className:"text-indigo-600 mt-1",children:"WEB LINK"})]}),l[e.id]&&(0,tr.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:(0,tr.jsx)("div",{className:"w-5 h-5 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"})}),(0,tr.jsx)("button",{onClick:e=>{e.stopPropagation(),i(r)},className:"absolute bottom-2 right-2 p-1.5 bg-indigo-600 rounded-lg opacity-0 group-hover:opacity-100 transition-all shadow-lg hover:scale-110 active:scale-95",children:(0,tr.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 4v16m8-8H4",strokeWidth:3})})})]},e.id))})}),rs=({logs:e,isProcessing:t,deliberation_flow:n})=>{let i=(0,ta.useRef)(null),[l,r]=(0,ta.useState)("terminal");return(0,ta.useEffect)(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[e,t]),(0,tr.jsxs)("div",{className:"bg-black border border-white/10 rounded-2xl overflow-hidden shadow-2xl relative flex flex-col h-full min-h-[400px]",children:[(0,tr.jsxs)("div",{className:"bg-zinc-900/80 px-4 py-2 border-b border-white/5 flex items-center justify-between sticky top-0 z-20",children:[(0,tr.jsxs)("div",{className:"flex gap-1.5",children:[(0,tr.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500/30 border border-red-500/50"}),(0,tr.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-amber-500/30 border border-amber-500/50"}),(0,tr.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-emerald-500/30 border border-emerald-500/50"})]}),(0,tr.jsxs)("div",{className:"flex bg-black/40 p-0.5 rounded-lg border border-white/5",children:[(0,tr.jsx)("button",{onClick:()=>r("terminal"),className:`px-3 py-1 text-[8px] font-black uppercase tracking-widest rounded-md transition-all ${"terminal"===l?"bg-zinc-700 text-white":"text-zinc-600"}`,children:"Log"}),(0,tr.jsx)("button",{onClick:()=>r("flow"),className:`px-3 py-1 text-[8px] font-black uppercase tracking-widest rounded-md transition-all ${"flow"===l?"bg-zinc-700 text-white":"text-zinc-600"}`,children:"Flow"})]}),(0,tr.jsx)("span",{className:"hidden md:inline text-[7px] mono text-zinc-600 font-bold uppercase tracking-widest",children:"MAD_KERNEL_v12.2_RECOVERY"})]}),(0,tr.jsxs)("div",{ref:i,className:"flex-1 overflow-y-auto p-5 space-y-3 mono text-[10px] scroll-smooth custom-scrollbar relative bg-[#020202]",children:[(0,tr.jsx)("div",{className:"absolute inset-0 pointer-events-none z-10 opacity-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_2px,3px_100%]"}),"terminal"===l?(0,tr.jsx)(tr.Fragment,{children:0!==e.length||t?e.map((n,i)=>{var l;return(0,tr.jsx)("div",{className:`animate-in fade-in slide-in-from-left-2 duration-300 p-3 rounded-xl border ${"Director"===(l=n.type)?"bg-blue-500/5 border-blue-500/20":"Lighting Architect"===l?"bg-amber-500/5 border-amber-500/20":"Texture Master"===l?"bg-emerald-500/5 border-emerald-500/20":"Visual Archivist"===l?"bg-indigo-600/10 border-indigo-500/30":"Meta-Prompt Translator"===l?"bg-purple-500/10 border-purple-500/30":"bg-zinc-900/40 border-white/5"}`,children:(0,tr.jsxs)("div",{className:"flex items-start gap-3",children:[(0,tr.jsxs)("span",{className:"text-zinc-800 shrink-0 font-bold",children:["[",new Date(n.timestamp).toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),"]"]}),(0,tr.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,tr.jsx)("span",{className:`font-black shrink-0 ${(e=>{switch(e){case"Direction":return"text-blue-400";case"Advanced":return"text-indigo-400";case"Texture":return"text-emerald-400";case"Casting":return"text-pink-400";default:return"text-zinc-500"}})(n.department)} uppercase tracking-tighter`,children:n.type.replace(/\s/g,"_")}),"processing"===n.status&&(0,tr.jsx)("span",{className:"text-[6px] px-1 bg-white/5 rounded text-zinc-600 animate-pulse",children:"ANALYZING"}),n.flow_to&&(0,tr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,tr.jsx)("span",{className:"text-[6px] text-zinc-700",children:"â"}),(0,tr.jsx)("span",{className:"text-[6px] text-zinc-600 font-bold uppercase",children:n.flow_to})]})]}),(0,tr.jsxs)("p",{className:"text-zinc-400 leading-relaxed break-words border-l border-white/5 pl-3 py-1 mt-1",children:[n.message,i===e.length-1&&t&&(0,tr.jsx)("span",{className:"inline-block w-2 h-4 bg-indigo-500 ml-1 animate-pulse"})]})]})]})},i)}):(0,tr.jsx)("div",{className:"h-full flex flex-col items-center justify-center text-zinc-900",children:(0,tr.jsx)("p",{className:"text-[9px] uppercase tracking-[0.8em] font-black animate-pulse",children:"KERNEL_STANDBY_"})})}):(0,tr.jsx)("div",{className:"space-y-6 py-4 animate-in fade-in duration-500",children:n&&n.length>0?n.map((e,t)=>(0,tr.jsxs)("div",{className:"relative pl-8 before:absolute before:left-3 before:top-2 before:bottom-[-20px] before:w-0.5 before:bg-gradient-to-b before:from-indigo-500 before:to-transparent",children:[(0,tr.jsx)("div",{className:"absolute left-1.5 top-1.5 w-3.5 h-3.5 bg-indigo-600 rounded-full border-2 border-black z-10 flex items-center justify-center",children:(0,tr.jsx)("div",{className:"w-1 h-1 bg-white rounded-full"})}),(0,tr.jsxs)("div",{className:"bg-zinc-900/60 p-4 rounded-2xl border border-white/5 space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,tr.jsxs)("span",{className:"text-[8px] font-black text-indigo-400 uppercase tracking-widest",children:[e.from," â ",e.to]}),(0,tr.jsx)("span",{className:"text-[7px] text-zinc-600 mono",children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,tr.jsx)("p",{className:"text-[10px] font-black text-white uppercase",children:e.action}),(0,tr.jsxs)("div",{className:"flex items-center gap-2 bg-black/40 p-2 rounded-lg",children:[(0,tr.jsx)("div",{className:"w-1 h-1 bg-emerald-500 rounded-full shadow-[0_0_5px_rgba(16,185,129,0.5)]"}),(0,tr.jsx)("span",{className:"text-[8px] text-zinc-400 mono italic",children:e.impact})]})]})]},t)):(0,tr.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-zinc-900 opacity-20",children:[(0,tr.jsx)("svg",{className:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M13 10V3L4 14h7v7l9-11h-7z",strokeWidth:1})}),(0,tr.jsx)("p",{className:"text-[9px] uppercase tracking-widest font-black",children:"Awaiting Decision Trace"})]})})]}),(0,tr.jsxs)("div",{className:"bg-zinc-900/40 px-5 py-3 border-t border-white/5 flex items-center justify-between z-20",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tr.jsx)("div",{className:`w-1.5 h-1.5 rounded-full ${t?"bg-indigo-500 animate-ping":"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}`}),(0,tr.jsx)("span",{className:"text-[8px] mono text-zinc-600 uppercase font-black tracking-widest",children:t?"DELIBERATION_ACTIVE":"MAD_CORE_READY"})]}),(0,tr.jsxs)("div",{className:"flex gap-4",children:[(0,tr.jsxs)("span",{className:"text-[7px] mono text-zinc-700",children:["VAULT: ",e.length," EVT"]}),(0,tr.jsx)("span",{className:"text-[7px] mono text-zinc-700",children:"KERNEL: V12.2_MAD"})]})]})]})},ro=e=>{let{subtitleSettings:t}=e;return(0,tr.jsxs)("div",{className:"w-full lg:w-[440px] bg-[#0e0e11] border-l border-white/5 flex flex-col p-8 space-y-8 overflow-y-auto pb-40 custom-scrollbar shadow-2xl",children:[(0,tr.jsxs)("div",{className:"space-y-6 bg-zinc-950 p-6 rounded-[2.5rem] border border-white/5",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,tr.jsx)("h3",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-widest",children:"Global Protocol"}),(0,tr.jsx)("button",{onClick:e.onReset,className:"px-3 py-1 bg-red-600/10 text-red-500 text-[8px] font-black uppercase rounded-lg border border-red-500/20 hover:bg-red-600/20 transition-all",children:"Full Reset"})]}),(0,tr.jsxs)("div",{className:"space-y-4",children:[(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Capa (TÃ­tulo HTML)"}),(0,tr.jsx)("div",{contentEditable:!0,onBlur:t=>e.setTitle(t.currentTarget.innerHTML),dangerouslySetInnerHTML:{__html:e.title},className:"w-full bg-black/40 border border-white/5 rounded-xl px-4 py-2.5 text-xs text-white outline-none min-h-[60px] focus:border-indigo-500/30 overflow-y-auto custom-scrollbar"})]}),(0,tr.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Aspect Ratio"}),(0,tr.jsxs)("select",{value:e.aspectRatio,onChange:t=>e.setAspectRatio(t.target.value),className:"w-full bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] font-black text-white outline-none",children:[(0,tr.jsx)("option",{value:"16:9",children:"Widescreen 16:9"}),(0,tr.jsx)("option",{value:"9:16",children:"Portrait 9:16"}),(0,tr.jsx)("option",{value:"1:1",children:"Square 1:1"})]})]}),(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Export Res"}),(0,tr.jsxs)("select",{value:e.exportRes,onChange:t=>e.setExportRes(t.target.value),className:"w-full bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] font-black text-white outline-none",children:[(0,tr.jsx)("option",{value:"1080p",children:"HD 1080p"}),(0,tr.jsx)("option",{value:"2K",children:"2K Cinema"}),(0,tr.jsx)("option",{value:"4K",children:"UHD 4K"})]})]})]}),(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"CrÃ©ditos (HTML)"}),(0,tr.jsx)("div",{contentEditable:!0,onBlur:t=>e.setCredits(t.currentTarget.innerHTML),dangerouslySetInnerHTML:{__html:e.credits},className:"w-full bg-black/40 border border-white/5 rounded-xl px-4 py-2.5 text-xs text-white outline-none min-h-[80px] focus:border-indigo-500/30 overflow-y-auto custom-scrollbar"})]})]}),(0,tr.jsxs)("div",{className:"space-y-4 pt-4 border-t border-white/5",children:[(0,tr.jsxs)("div",{className:"flex justify-between text-[9px] font-black text-zinc-500 uppercase tracking-widest px-1",children:[(0,tr.jsx)("span",{children:"DuraÃ§Ã£o Global"}),(0,tr.jsxs)("span",{className:"text-white mono",children:[e.globalDuration,"s"]})]}),(0,tr.jsx)("input",{type:"range",min:"1",max:"20",value:e.globalDuration,onChange:t=>e.setGlobalDuration(parseInt(t.target.value)),className:"w-full h-1 bg-zinc-900 rounded-full appearance-none accent-indigo-500"})]})]}),(0,tr.jsxs)("div",{className:"space-y-6 bg-zinc-950 p-6 rounded-[2.5rem] border border-white/5",children:[(0,tr.jsx)("h3",{className:"text-[10px] font-black text-emerald-400 uppercase tracking-widest",children:"Subtitle Protocol"}),(0,tr.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Font Size"}),(0,tr.jsx)("input",{type:"number",value:t.fontSize,onChange:t=>e.onUpdateSubtitle("fontSize",parseInt(t.target.value)),className:"w-full bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] text-white outline-none"})]}),(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Text Color"}),(0,tr.jsx)("input",{type:"color",value:t.fontColor,onChange:t=>e.onUpdateSubtitle("fontColor",t.target.value),className:"w-full h-8 bg-black/40 border border-white/5 rounded-xl px-1 py-1 cursor-pointer"})]}),(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Box Color"}),(0,tr.jsx)("input",{type:"color",value:t.backgroundColor,onChange:t=>e.onUpdateSubtitle("backgroundColor",t.target.value),className:"w-full h-8 bg-black/40 border border-white/5 rounded-xl px-1 py-1 cursor-pointer"})]}),(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Opacity"}),(0,tr.jsx)("input",{type:"number",step:"0.1",min:"0",max:"1",value:t.bgOpacity,onChange:t=>e.onUpdateSubtitle("bgOpacity",parseFloat(t.target.value)),className:"w-full bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] text-white outline-none"})]})]}),(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Font Family"}),(0,tr.jsxs)("select",{value:t.fontFamily,onChange:t=>e.onUpdateSubtitle("fontFamily",t.target.value),className:"w-full bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] text-white outline-none",children:[(0,tr.jsx)("option",{value:"Inter",children:"Inter UI"}),(0,tr.jsx)("option",{value:"JetBrains Mono",children:"JetBrains Mono"}),(0,tr.jsx)("option",{value:"serif",children:"Classic Serif"}),(0,tr.jsx)("option",{value:"sans-serif",children:"System Sans"})]})]}),(0,tr.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Radius Mult"}),(0,tr.jsx)("input",{type:"number",step:"0.1",value:t.radiusMult,onChange:t=>e.onUpdateSubtitle("radiusMult",parseFloat(t.target.value)),className:"w-full bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] text-white outline-none"})]}),(0,tr.jsxs)("div",{className:"space-y-1.5",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest px-1",children:"Margin Mult"}),(0,tr.jsx)("input",{type:"number",step:"0.1",value:t.marginMult,onChange:t=>e.onUpdateSubtitle("marginMult",parseFloat(t.target.value)),className:"w-full bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] text-white outline-none"})]})]})]}),(0,tr.jsxs)("div",{className:"space-y-4",children:[(0,tr.jsxs)("div",{className:"bg-zinc-950 p-6 rounded-[3rem] border border-white/5 space-y-4 shadow-2xl",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center px-1 mb-2",children:[(0,tr.jsx)("label",{className:"text-[8px] font-black text-zinc-600 uppercase tracking-widest",children:"Roteiro / Script (HTML)"}),(0,tr.jsxs)("div",{className:"flex items-center gap-2 bg-black/40 px-2 py-1 rounded-full border border-white/5",children:[(0,tr.jsx)("span",{className:`text-[7px] font-black uppercase ${e.fidelityMode?"text-indigo-400":"text-zinc-600"}`,children:"Fidelidade"}),(0,tr.jsx)("button",{onClick:()=>e.setFidelityMode(!e.fidelityMode),className:`relative w-8 h-4 rounded-full transition-all duration-300 ${e.fidelityMode?"bg-indigo-600":"bg-zinc-800"}`,children:(0,tr.jsx)("div",{className:`absolute top-0.5 w-3 h-3 rounded-full bg-white transition-all duration-300 ${e.fidelityMode?"left-4.5":"left-0.5"}`})})]})]}),(0,tr.jsx)("div",{contentEditable:!0,onBlur:t=>e.setScript(t.currentTarget.innerHTML),dangerouslySetInnerHTML:{__html:e.script},className:"w-full h-40 bg-black/50 border border-white/5 rounded-2xl p-5 text-sm text-zinc-300 focus:outline-none resize-none transition-all overflow-y-auto custom-scrollbar"}),(0,tr.jsx)("button",{onClick:e.onAnalyze,disabled:e.isGenerating||!e.script.trim(),className:"w-full py-6 bg-indigo-600 hover:bg-indigo-500 text-white rounded-[1.8rem] font-black uppercase text-[10px] tracking-[0.5em] transition-all active:scale-95 shadow-xl",children:"Analisar & Orquestrar"})]}),(0,tr.jsx)("button",{onClick:e.onRender,disabled:e.isRendering,className:"w-full py-8 bg-emerald-600 hover:bg-emerald-500 text-white text-[12px] font-black uppercase tracking-[0.6em] rounded-[3rem] shadow-xl transition-all relative overflow-hidden group",children:(0,tr.jsx)("span",{className:"relative z-10",children:e.isRendering?"MASTERIZANDO...":"MASTERIZAR UHD"})})]}),(0,tr.jsxs)("div",{className:"bg-zinc-950 p-6 rounded-[2.5rem] border border-white/5 space-y-4",children:[(0,tr.jsx)("span",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest block text-center",children:"Batch Processing"}),(0,tr.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,tr.jsx)("button",{onClick:()=>e.onBatch("SCOUT"),className:"py-3 bg-zinc-900 text-[8px] font-black uppercase rounded-xl border border-white/5 hover:border-indigo-500 transition-all",children:"All Scout (Web)"}),(0,tr.jsx)("button",{onClick:()=>e.onBatch("AI"),className:"py-3 bg-zinc-900 text-[8px] font-black uppercase rounded-xl border border-white/5 hover:border-pink-500 transition-all",children:"All Synth (IA)"})]})]}),(0,tr.jsx)(rs,{logs:e.logs,isProcessing:e.isGenerating||e.isRendering})]})},rc=({beat:e,index:t,onClose:n,onUpdateCaption:i,onUpdateYOffset:l,onAction:r,onOpenVault:a})=>(0,tr.jsx)("div",{className:"fixed inset-0 z-[500] bg-black/95 backdrop-blur-3xl flex items-center justify-center p-6 animate-in fade-in duration-300",children:(0,tr.jsxs)("div",{className:"w-full max-w-3xl bg-zinc-900 border border-white/10 rounded-[4rem] p-10 md:p-16 space-y-10 shadow-2xl animate-in zoom-in-95 duration-500 overflow-y-auto max-h-[90vh] custom-scrollbar",children:[(0,tr.jsxs)("div",{className:"text-center space-y-3",children:[(0,tr.jsxs)("h3",{className:"text-3xl font-black text-white uppercase tracking-tighter",children:["DireÃ§Ã£o de Cena ",t+1]}),(0,tr.jsx)("p",{className:"text-[10px] text-zinc-500 uppercase tracking-[0.2em] font-bold",children:"Configure o visual e ajuste o enquadramento."})]}),(0,tr.jsxs)("div",{className:"space-y-3",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest px-1",children:"Editar Legenda da Cena"}),(0,tr.jsx)("div",{contentEditable:!0,onBlur:e=>i(e.currentTarget.innerHTML),dangerouslySetInnerHTML:{__html:e.caption},className:"w-full bg-black/60 border border-white/10 rounded-[2rem] px-8 py-6 text-sm text-white outline-none min-h-[120px] focus:border-indigo-500/30 overflow-y-auto"})]}),(0,tr.jsxs)("div",{className:"bg-zinc-950 p-8 rounded-[3rem] border border-white/5 space-y-6",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center px-1",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-emerald-400 uppercase tracking-widest",children:"Ajuste de Enquadramento (Y-Offset)"}),(0,tr.jsxs)("span",{className:"text-[10px] mono text-white font-bold",children:[e.yOffset||0,"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"-50",max:"50",step:"1",value:e.yOffset||0,onChange:e=>l(parseInt(e.target.value)),className:"w-full h-2 bg-zinc-800 rounded-full appearance-none accent-emerald-500 cursor-pointer"}),(0,tr.jsxs)("div",{className:"flex justify-between text-[7px] text-zinc-600 font-black uppercase",children:[(0,tr.jsx)("span",{children:"Subir Imagem (-Y)"}),(0,tr.jsx)("span",{children:"Descer Imagem (+Y)"})]})]}),(0,tr.jsxs)("div",{className:"space-y-4",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest px-1",children:"Web Reference Scout (Escolha o Provedor)"}),(0,tr.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["PEXELS","UNSPLASH","PIXABAY","GEMINI"].map(e=>(0,tr.jsx)("button",{onClick:()=>r("SCOUT",e),className:"py-6 bg-zinc-800 text-white rounded-3xl border border-white/5 transition-all flex flex-col items-center gap-2 group hover:bg-indigo-600",children:(0,tr.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest",children:e})},e))})]}),(0,tr.jsxs)("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-white/5",children:[(0,tr.jsxs)("button",{onClick:()=>r("AI"),className:"py-8 bg-zinc-800 hover:bg-indigo-500 text-white rounded-[2rem] border border-white/5 transition-all flex flex-col items-center gap-4 group text-center",children:[(0,tr.jsx)("svg",{className:"w-5 h-5 opacity-60 group-hover:opacity-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M13.5 3L11 8.5L5.5 11L11 13.5L13.5 19L16 13.5L21.5 11L16 8.5L13.5 3Z",strokeWidth:2.5})}),(0,tr.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"AI Synth"})]}),(0,tr.jsxs)("button",{onClick:a,className:"py-8 bg-zinc-800 hover:bg-emerald-600 text-white rounded-[2rem] border border-white/5 transition-all flex flex-col items-center gap-4 group text-center",children:[(0,tr.jsx)("svg",{className:"w-5 h-5 opacity-60 group-hover:opacity-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4",strokeWidth:2.5})}),(0,tr.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Vault Node"})]}),(0,tr.jsxs)("button",{onClick:()=>r("UPLOAD"),className:"py-8 bg-zinc-800 hover:bg-amber-600 text-white rounded-[2rem] border border-white/5 transition-all flex flex-col items-center gap-4 group text-center",children:[(0,tr.jsx)("svg",{className:"w-5 h-5 opacity-60 group-hover:opacity-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12",strokeWidth:2.5})}),(0,tr.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Upload"})]})]}),(0,tr.jsx)("button",{onClick:n,className:"w-full py-5 bg-white text-black rounded-3xl text-[11px] font-black uppercase tracking-[0.4em] active:scale-95 transition-all",children:"Fechar EdiÃ§Ã£o"})]})}),rd=e=>e?e.replace(/<br\s*\/?>/gi,"\n").replace(/<\/div>/gi,"\n").replace(/<div[^>]*>/gi,"").replace(/<p[^>]*>/gi,"").replace(/<\/p>/gi,"\n").replace(/&nbsp;/g," ").replace(/<[^>]*>/g,"").trim():"",ru=(e,t,n)=>{let i=t.split("\n"),l=[];return i.forEach(t=>{let i=t.split(" "),r="";i.forEach(t=>{let i=r+(r?" ":"")+t;e.measureText(i).width>n&&r?(l.push(r),r=t):r=i}),r&&l.push(r)}),l},rp=e=>{let[t,n]=(0,ta.useState)(5),[i,l]=(0,ta.useState)(!1),[r,a]=(0,ta.useState)(!1),[s,o]=(0,ta.useState)(!1),[c,d]=(0,ta.useState)(0),[u,p]=(0,ta.useState)(""),[m,h]=(0,ta.useState)(null),[g,f]=(0,ta.useState)(!1),[x,b]=(0,ta.useState)("1080p"),[y,v]=(0,ta.useState)({}),_=e.project.beats[e.activeBeatIndex],N=(0,ta.useRef)(null),w=(0,ta.useRef)(null);(0,ta.useEffect)(()=>{e.project.beats.length>0&&e.setProject(e=>({...e,beats:e.beats.map(e=>({...e,duration:t}))}))},[t]);let E=async()=>{let n=rd(e.script);if(n.trim()){a(!0),e.setLogs([{type:"Script Analyzer",status:"processing",message:`Iniciando orquestra\xe7\xe3o narrativa...`,timestamp:Date.now()}]);try{let l=await ly(n,30,i,e.settings);if(rd(e.title).trim()){let i=await lj(n,e.settings);l=[{id:"title-"+crypto.randomUUID(),timestamp:Date.now(),duration:t,assetUrl:null,caption:e.title,assetType:"IMAGE",scoutQuery:i,yOffset:0},...l]}l.push({id:"credits-"+crypto.randomUUID(),timestamp:Date.now(),duration:t,assetUrl:null,caption:e.credits,assetType:"IMAGE",scoutQuery:"Cinema credits background",yOffset:0}),e.setProject(e=>({...e,beats:l.map(e=>({...e,duration:t,yOffset:0}))})),e.setLogs(e=>[...e,{type:"Director",status:"completed",message:"Timeline gerada.",timestamp:Date.now()}])}catch(t){e.setLogs(e=>[...e,{type:"Director",status:"error",message:"Falha na orquestraÃ§Ã£o.",timestamp:Date.now()}])}finally{a(!1)}}},j=async(t,n,i,l)=>{let r=e.project.beats[t];if(r){v(e=>({...e,[r.id]:!0}));try{let a=null,s="";if("SCOUT"===n){let t=await lb(r.scoutQuery||"",rd(r.caption),e.settings,i);a=t.assetUrl,s=t.source}else if("AI"===n)a=await lv(rd(r.caption),r.scoutQuery||"",e.settings);else if("VAULT_AUTO"===n){let t=await lE(rd(r.caption),e.vault,e.settings);t&&(a=t.imageUrl)}else if("VAULT_MANUAL"===n&&l)a=l.imageUrl;else if("UPLOAD"===n)return void w.current?.click();e.setProject(e=>{let n=[...e.beats];return n[t]={...n[t],assetUrl:a,assetType:"IMAGE",sourceLink:s},{...e,beats:n}})}catch(e){console.error(e)}finally{v(e=>({...e,[r.id]:!1}))}}},S=async t=>{a(!0);for(let n=0;n<e.project.beats.length;n++)e.project.beats[n].id.startsWith("credits")||e.project.beats[n].id.startsWith("title")||await j(n,t);a(!1)},I=async()=>{if(0===e.project.beats.length)return;let n=N.current;if(n){o(!0),d(0),p("Motor de RenderizaÃ§Ã£o Iniciado...");try{let i=e.project.subtitleSettings,l=1920,r=1080;"4K"===x?(l=3840,r=2160):"2K"===x&&(l=2560,r=1440),"9:16"===e.project.aspectRatio?[l,r]=[r,l]:"1:1"===e.project.aspectRatio&&(l=r),n.width=l,n.height=r;let a=n.captureStream(30),s=new MediaRecorder(a,{mimeType:"video/webm",videoBitsPerSecond:4e7}),o=[];s.ondataavailable=e=>o.push(e.data);let c=new Promise(e=>{s.onstop=()=>{let t=new Blob(o,{type:"video/webm"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download="Cinema_Master.webm",i.click(),e()}});s.start();let u=n.getContext("2d",{alpha:!1});if(!u)return;for(let n=0;n<e.project.beats.length;n++){let a=e.project.beats[n],s=new Image;s.crossOrigin="anonymous",a.assetUrl&&await new Promise(e=>{s.src=a.assetUrl,s.onload=e,s.onerror=e});let o=30*(a.duration||t);for(let t=0;t<o;t++){let c=t/o;if(d(Math.round((n/e.project.beats.length+c/e.project.beats.length)*100)),u.fillStyle="black",u.fillRect(0,0,l,r),s.src){let e=1+.12*c,t=Math.max(l/s.width,r/s.height)*e,n=s.width*t,i=s.height*t;u.drawImage(s,(l-n)/2,(a.yOffset||0)*(r/100),n,i)}let p=l/800,m=Math.max(Math.round(i.fontSize*p),40);u.font=`600 ${m}px ${i.fontFamily}`,u.textAlign="center",u.textBaseline="middle";let h=ru(u,rd(a.caption),l-m*i.marginMult*2),g=1.4*m,f=h.length*g+m*i.paddingVMult*2,x=r-.15*r-f,b=0;h.forEach(e=>{let t=u.measureText(e).width;t>b&&(b=t)});let y=b+m*i.paddingHMult*2,v=(l-y)/2;u.fillStyle=i.backgroundColor,u.globalAlpha=i.bgOpacity,u.beginPath(),u.roundRect(v,x,y,f,Math.round(m*i.radiusMult)),u.fill(),u.globalAlpha=1,u.fillStyle=i.fontColor,h.forEach((e,t)=>u.fillText(e,l/2,x+m*i.paddingVMult+t*g+.5*m)),await new Promise(requestAnimationFrame)}}s.stop(),await c}catch(e){console.error(e)}finally{o(!1)}}};return(0,tr.jsxs)("div",{className:"h-full flex flex-col bg-[#050505] overflow-hidden min-h-full",children:[(0,tr.jsx)("canvas",{ref:N,className:"fixed -left-[10000px] pointer-events-none"}),(0,tr.jsxs)("div",{className:"flex-1 flex flex-col lg:flex-row relative",children:[(0,tr.jsxs)("div",{className:"flex-1 bg-black flex flex-col relative border-r border-white/5 overflow-hidden",children:[(0,tr.jsx)(rr,{currentBeat:_,aspectRatio:e.project.aspectRatio,subtitleSettings:e.project.subtitleSettings,title:e.title,credits:e.credits,isRendering:s,renderProgress:c,renderStatus:u}),(0,tr.jsx)(ra,{beats:e.project.beats,activeIndex:e.activeBeatIndex,onSelect:e.setActiveBeatIndex,onOpenOrchestrator:h,loadingBeats:y})]}),(0,tr.jsx)(ro,{...e,aspectRatio:e.project.aspectRatio,setAspectRatio:t=>e.setProject(e=>({...e,aspectRatio:t})),exportRes:x,setExportRes:b,globalDuration:t,setGlobalDuration:n,subtitleSettings:e.project.subtitleSettings,onUpdateSubtitle:(t,n)=>{e.setProject(e=>({...e,subtitleSettings:{...e.subtitleSettings,[t]:n}}))},fidelityMode:i,setFidelityMode:l,isGenerating:r,isRendering:s,onAnalyze:E,onRender:I,onBatch:S})]}),null!==m&&(0,tr.jsx)(rc,{beat:e.project.beats[m],index:m,onClose:()=>h(null),onUpdateCaption:t=>{let n=[...e.project.beats];n[m]={...n[m],caption:t},e.setProject(e=>({...e,beats:n}))},onUpdateYOffset:t=>{let n=[...e.project.beats];n[m]={...n[m],yOffset:t},e.setProject(e=>({...e,beats:n}))},onAction:(e,t)=>j(m,e,t),onOpenVault:()=>f(!0)}),g&&(0,tr.jsx)(lU,{items:e.vault,onClose:()=>f(!1),onSelect:e=>{j(m||0,"VAULT_MANUAL",void 0,e),f(!1),h(null)}}),(0,tr.jsx)("input",{ref:w,type:"file",className:"hidden",accept:"image/*",onChange:t=>{let n=t.target.files?.[0];if(n){let t=new FileReader;t.onload=t=>{let n=t.target?.result,i=m??e.activeBeatIndex,l=[...e.project.beats];l[i]={...l[i],assetUrl:n,assetType:"UPLOAD"},e.setProject(e=>({...e,beats:l})),h(null)},t.readAsDataURL(n)}}}),(0,tr.jsx)("style",{children:`
        @keyframes ken-burns { from { transform: scale(1) translateY(var(--tw-translate-y, 0)); } to { transform: scale(1.15) translate(1%, 1%) translateY(var(--tw-translate-y, 0)); } }
        .animate-ken-burns { animation: ken-burns 15s ease-in-out infinite alternate; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        [contenteditable]:empty:before { content: attr(placeholder); color: #444; }
      `})]})},rm=({onReset:e})=>(0,tr.jsxs)("div",{className:"flex justify-between items-start",children:[(0,tr.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,tr.jsx)("h2",{className:"text-4xl font-black text-white uppercase tracking-tighter",children:"Nexus Creation Hub"}),(0,tr.jsx)("p",{className:"text-[10px] mono text-zinc-500 uppercase tracking-[0.5em]",children:"LCP-v12.5 MAD_INDUSTRIAL CORE"})]}),(0,tr.jsx)("button",{onClick:e,className:"p-3 bg-red-600/10 border border-red-500/20 text-red-500 rounded-2xl hover:bg-red-600/20 transition-all flex items-center gap-2",title:"Reset Protocol",children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16",strokeWidth:2})})})]}),rh=({prompt:e,setPrompt:t,refinedPrompt:n,isOptimizing:i,onMagicWand:l})=>(0,tr.jsxs)("div",{className:"space-y-8",children:[(0,tr.jsxs)("div",{className:"bg-zinc-950 border border-white/5 p-8 rounded-[3rem] space-y-5 shadow-2xl transition-all relative group",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center px-1",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest block",children:"User Intent"}),(0,tr.jsx)("button",{onClick:l,disabled:i||!e.trim(),className:`p-2 rounded-xl border border-indigo-500/20 bg-indigo-500/5 text-indigo-400 hover:bg-indigo-500/10 transition-all ${i?"animate-pulse":""}`,title:"Meta-Prompt Optimize",children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M13.5 3L11 8.5L5.5 11L11 13.5L13.5 19L16 13.5L21.5 11L16 8.5L13.5 3Z",strokeWidth:2})})})]}),(0,tr.jsx)("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:"Specify your visual intent (Portuguese or English)...",className:"w-full h-32 bg-black/50 border border-white/5 rounded-3xl p-6 text-[13px] text-white focus:outline-none focus:border-indigo-500/30 resize-none transition-all placeholder:text-zinc-800"})]}),n&&(0,tr.jsxs)("div",{className:"bg-indigo-600/5 border border-indigo-500/20 p-8 rounded-[3rem] space-y-4 animate-in fade-in slide-in-from-top-4",children:[(0,tr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,tr.jsx)("span",{className:"text-[9px] font-black text-indigo-400 uppercase tracking-widest",children:"Meta-Prompt (Industrial English)"}),(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full shadow-[0_0_10px_rgba(99,102,241,0.5)]"})]}),(0,tr.jsxs)("p",{className:"text-[11px] text-zinc-400 mono italic leading-relaxed",children:['"',n,'"']})]})]}),rg=({authority:e,onChange:t})=>(0,tr.jsxs)("div",{className:"bg-zinc-950 border border-white/5 p-8 rounded-[3rem] space-y-6 shadow-2xl relative",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center px-1",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest",children:"Agent Authority Sliders"}),(0,tr.jsx)("span",{className:"text-[8px] font-black text-zinc-600 uppercase",children:"Priority Control"})]}),(0,tr.jsxs)("div",{className:"space-y-6",children:[(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between text-[10px] mono font-bold text-amber-400",children:[(0,tr.jsx)("span",{children:"Lighting Architect"})," ",(0,tr.jsxs)("span",{children:[e.lighting,"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"0",max:"100",value:e.lighting,onChange:e=>t("lighting",parseInt(e.target.value)),className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-amber-500"})]}),(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between text-[10px] mono font-bold text-emerald-400",children:[(0,tr.jsx)("span",{children:"Texture Master"})," ",(0,tr.jsxs)("span",{children:[e.texture,"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"0",max:"100",value:e.texture,onChange:e=>t("texture",parseInt(e.target.value)),className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-emerald-500"})]}),(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between text-[10px] mono font-bold text-pink-400",children:[(0,tr.jsx)("span",{children:"Anatomy Specialist"})," ",(0,tr.jsxs)("span",{children:[e.anatomy,"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"0",max:"100",value:e.anatomy,onChange:e=>t("anatomy",parseInt(e.target.value)),className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-pink-500"})]})]})]}),rf=({zAnatomy:e,setZAnatomy:t,zStructure:n,setZStructure:i,zLighting:l,setZLighting:r,zTexture:a,setZTexture:s})=>(0,tr.jsxs)("div",{className:"bg-zinc-950 border border-white/5 p-8 rounded-[3rem] space-y-6 shadow-2xl relative",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center px-1",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest",children:"Latent Z-Matrix Regulation"}),(0,tr.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full animate-pulse"}),(0,tr.jsx)("span",{className:"text-[8px] font-black text-zinc-600 uppercase",children:"Immutability Lock"})]})]}),(0,tr.jsxs)("div",{className:"space-y-6",children:[(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between text-[10px] mono font-bold text-pink-400",children:[(0,tr.jsx)("span",{children:"Z_ANATOMY (DNA)"})," ",(0,tr.jsxs)("span",{children:[Math.round(100*e),"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"0",max:"1.5",step:"0.01",value:e,onChange:e=>t(parseFloat(e.target.value)),className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-pink-500"})]}),(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between text-[10px] mono font-bold text-indigo-400",children:[(0,tr.jsx)("span",{children:"Z_STRUCTURE (Geom)"})," ",(0,tr.jsxs)("span",{children:[Math.round(100*n),"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"0",max:"1.5",step:"0.01",value:n,onChange:e=>i(parseFloat(e.target.value)),className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-indigo-500"})]}),(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between text-[10px] mono font-bold text-amber-400",children:[(0,tr.jsx)("span",{children:"Z_LIGHTING (Rad)"})," ",(0,tr.jsxs)("span",{children:[Math.round(100*l),"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:l,onChange:e=>r(parseFloat(e.target.value)),className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-amber-500"})]}),(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex justify-between text-[10px] mono font-bold text-emerald-400",children:[(0,tr.jsx)("span",{children:"Z_TEXTURE (Pores)"})," ",(0,tr.jsxs)("span",{children:[Math.round(100*a),"%"]})]}),(0,tr.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:a,onChange:e=>s(parseFloat(e.target.value)),className:"w-full h-1 bg-zinc-800 rounded-full appearance-none accent-emerald-500"})]})]})]}),rx=({isProcessing:e,onProcess:t,prompt:n,injectedImage:i,onImageUpload:l,onOpenVault:r})=>{let a=(0,ta.useRef)(null);return(0,tr.jsxs)("div",{className:"bg-zinc-950 border border-white/5 p-8 rounded-[3rem] space-y-5 shadow-2xl flex-1 flex flex-col transition-all hover:border-indigo-500/20 overflow-hidden relative",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest",children:"Synthesis Anchor"}),i&&(0,tr.jsx)("button",{onClick:()=>l(null),className:"text-[8px] font-black text-red-500 uppercase tracking-widest hover:text-red-400",children:"Clear DNA"})]}),(0,tr.jsxs)("div",{className:`flex-1 min-h-[140px] bg-black/40 border-2 border-dashed border-white/5 rounded-[2.5rem] flex flex-col items-center justify-center transition-all relative overflow-hidden group ${i?"border-indigo-500/50":""}`,children:[i?(0,tr.jsxs)(tr.Fragment,{children:[(0,tr.jsx)("img",{src:i,className:"absolute inset-0 w-full h-full object-cover opacity-60 group-hover:scale-110 transition-transform duration-700",alt:"Injected DNA"}),(0,tr.jsx)("div",{className:"absolute inset-0 bg-indigo-900/20 mix-blend-overlay"}),(0,tr.jsxs)("div",{className:"relative z-10 flex gap-2",children:[(0,tr.jsx)("div",{className:"bg-black/60 backdrop-blur-md px-4 py-2 rounded-xl border border-white/10",children:(0,tr.jsx)("span",{className:"text-[8px] font-black text-indigo-400 uppercase tracking-widest",children:"DNA_ACTIVE"})}),(0,tr.jsx)("button",{onClick:()=>r(),className:"bg-white/10 hover:bg-white/20 backdrop-blur-md px-4 py-2 rounded-xl border border-white/10 text-[8px] font-black text-white uppercase tracking-widest transition-all",children:"Swap"})]})]}):(0,tr.jsxs)("div",{className:"flex flex-col items-center gap-4 py-6",children:[(0,tr.jsxs)("div",{className:"flex gap-3",children:[(0,tr.jsxs)("button",{onClick:()=>!e&&a.current?.click(),className:"px-6 py-3 bg-zinc-900 border border-white/5 rounded-2xl text-[9px] font-black uppercase text-zinc-400 hover:text-white hover:border-indigo-500/40 transition-all flex items-center gap-2",children:[(0,tr.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12",strokeWidth:2})}),"Local"]}),(0,tr.jsxs)("button",{onClick:()=>r(),className:"px-6 py-3 bg-indigo-600/10 border border-indigo-500/20 rounded-2xl text-[9px] font-black uppercase text-indigo-400 hover:bg-indigo-600/20 transition-all flex items-center gap-2",children:[(0,tr.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4",strokeWidth:2})}),"Vault"]})]}),(0,tr.jsx)("p",{className:"text-[8px] font-black uppercase tracking-[0.2em] text-zinc-700",children:"Inject DNA Anchor"})]}),(0,tr.jsx)("input",{type:"file",ref:a,className:"hidden",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=e=>{l(e.target?.result)},e.readAsDataURL(t)}}})]}),(0,tr.jsx)("button",{onClick:t,disabled:e||!n.trim(),className:"w-full py-10 bg-indigo-600 hover:bg-indigo-500 text-white rounded-[2rem] font-black uppercase tracking-[0.8em] text-[11px] shadow-2xl active:scale-95 transition-all",children:e?"SYNAPSING...":"EXECUTE MAD SYNTH V12.5"})]})},rb=({scoutData:e})=>e&&e.candidates?(0,tr.jsxs)("div",{className:"bg-zinc-950/80 border border-white/10 rounded-[2.5rem] p-8 space-y-8 backdrop-blur-3xl animate-in fade-in zoom-in duration-700 shadow-[0_0_100px_rgba(79,70,229,0.1)]",children:[(0,tr.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-6",children:[(0,tr.jsxs)("div",{className:"space-y-2",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-2",children:[(0,tr.jsx)("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-ping"}),(0,tr.jsx)("h3",{className:"text-[10px] font-black uppercase text-indigo-400 tracking-[0.4em]",children:"LCP v2.9.5 Visual Scout Engine"})]}),(0,tr.jsx)("p",{className:"text-zinc-500 text-[11px] uppercase tracking-widest max-w-lg leading-relaxed",children:e.consensus_report})]}),(0,tr.jsxs)("div",{className:"flex gap-4",children:[(0,tr.jsxs)("div",{className:"flex flex-col items-end",children:[(0,tr.jsx)("span",{className:"text-[7px] mono text-zinc-600 font-bold uppercase tracking-widest",children:"Premium Hits"}),(0,tr.jsx)("span",{className:"text-lg font-black text-white mono",children:e.search_stats.premium_hits})]}),(0,tr.jsxs)("div",{className:"flex flex-col items-end border-l border-white/10 pl-4",children:[(0,tr.jsx)("span",{className:"text-[7px] mono text-zinc-600 font-bold uppercase tracking-widest",children:"Internal Sync"}),(0,tr.jsx)("span",{className:"text-lg font-black text-white mono",children:e.search_stats.internal_hits})]}),(0,tr.jsxs)("div",{className:"flex flex-col items-end border-l border-white/10 pl-4",children:[(0,tr.jsx)("span",{className:"text-[7px] mono text-indigo-500 font-bold uppercase tracking-widest",children:"Winner ID"}),(0,tr.jsx)("span",{className:"text-lg font-black text-indigo-400 mono",children:e.winner_id})]})]})]}),(0,tr.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.candidates.map(t=>(0,tr.jsxs)("div",{className:`p-6 rounded-[2rem] border transition-all duration-500 flex flex-col gap-5 relative overflow-hidden group ${t.id===e.winner_id?"bg-indigo-500/10 border-indigo-500/60 shadow-[0_0_40px_rgba(79,70,229,0.1)] scale-[1.02]":"bg-black/40 border-white/5 hover:border-white/10 hover:bg-zinc-900/20"}`,children:[t.id===e.winner_id&&(0,tr.jsx)("div",{className:"absolute top-0 right-0 p-3 bg-indigo-500 text-black text-[8px] font-black uppercase tracking-[0.2em] rounded-bl-2xl z-10",children:"LCP_WINNER"}),(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-start",children:[(0,tr.jsx)("span",{className:"text-[11px] font-black text-white uppercase truncate pr-4",children:t.title}),(0,tr.jsx)("span",{className:"text-[8px] px-2 py-0.5 rounded-full bg-white/5 text-zinc-400 mono font-bold uppercase",children:t.source_layer})]}),(0,tr.jsxs)("div",{className:"flex gap-2",children:[(0,tr.jsx)("div",{className:"h-0.5 flex-1 bg-white/5 rounded-full overflow-hidden",children:(0,tr.jsx)("div",{className:"h-full bg-emerald-500/60",style:{width:`${100*t.quality_metrics.technical}%`}})}),(0,tr.jsx)("div",{className:"h-0.5 flex-1 bg-white/5 rounded-full overflow-hidden",children:(0,tr.jsx)("div",{className:"h-full bg-indigo-500/60",style:{width:`${100*t.quality_metrics.aesthetic}%`}})})]})]}),(0,tr.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,tr.jsx)("p",{className:"text-[8px] font-black text-zinc-500 uppercase tracking-widest",children:"Specialist Consenus"}),(0,tr.jsxs)("span",{className:"text-[10px] mono font-bold text-indigo-400",children:[(100*t.composite_score).toFixed(1),"%"]})]}),(0,tr.jsx)("div",{className:"space-y-2.5",children:t.votes.map((e,t)=>(0,tr.jsxs)("div",{className:"flex flex-col gap-1.5 border-l-2 border-white/5 pl-3 group-hover:border-indigo-500/20 transition-colors",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-300 uppercase tracking-tighter",children:e.agent}),(0,tr.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,tr.jsx)("div",{className:"w-12 h-1 bg-white/5 rounded-full overflow-hidden",children:(0,tr.jsx)("div",{className:"h-full bg-indigo-500",style:{width:`${100*e.score}%`}})}),(0,tr.jsx)("span",{className:"text-[7px] mono text-white",children:(10*e.score).toFixed(1)})]})]}),(0,tr.jsxs)("p",{className:"text-[9px] text-zinc-500 line-clamp-2 italic leading-tight",children:['"',e.critique,'"']})]},t))})]}),(0,tr.jsxs)("div",{className:"pt-5 border-t border-white/10 grid grid-cols-4 gap-1.5 h-10 items-end",children:[(0,tr.jsx)("div",{className:"bg-pink-500/40 rounded-sm hover:bg-pink-400 transition-colors",style:{height:`${80*(t.dna_preview.z_anatomy||.5)}%`},title:"Anatomy DNA"}),(0,tr.jsx)("div",{className:"bg-indigo-500/40 rounded-sm hover:bg-indigo-400 transition-colors",style:{height:`${80*(t.dna_preview.z_structure||.5)}%`},title:"Structure DNA"}),(0,tr.jsx)("div",{className:"bg-amber-500/40 rounded-sm hover:bg-amber-400 transition-colors",style:{height:`${80*(t.dna_preview.z_lighting||.5)}%`},title:"Lighting DNA"}),(0,tr.jsx)("div",{className:"bg-emerald-500/40 rounded-sm hover:bg-emerald-400 transition-colors",style:{height:`${80*(t.dna_preview.z_texture||.5)}%`},title:"Texture DNA"})]})]},t.id))})]}):null,ry=({scoutData:e,groundingLinks:t})=>e?(0,tr.jsxs)("div",{className:"col-span-1 md:col-span-2 space-y-4",children:[(0,tr.jsx)("h3",{className:"text-[10px] font-black uppercase text-zinc-600 tracking-widest px-4",children:"Visual Scout Intelligence"}),(0,tr.jsx)(rb,{scoutData:e}),t.length>0&&(0,tr.jsxs)("div",{className:"bg-zinc-950/50 border border-white/10 p-6 rounded-[2rem] flex flex-wrap gap-4 items-center",children:[(0,tr.jsx)("span",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest",children:"Grounding Sources:"}),t.map((e,t)=>(0,tr.jsxs)("a",{href:e.uri,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 bg-white/5 border border-white/10 rounded-full text-[9px] font-bold text-indigo-400 hover:bg-white/10 transition-all flex items-center gap-2",children:[(0,tr.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14",strokeWidth:2})}),e.title]},t))]})]}):null,rv=({onResult:e,params:t,setParams:n,onReset:i,vault:l=[],settings:r})=>{let[a,s]=(0,ta.useState)(""),[o,c]=(0,ta.useState)(""),[d,u]=(0,ta.useState)(!1),[p,m]=(0,ta.useState)(!1),[h,g]=(0,ta.useState)([]),[f,x]=(0,ta.useState)([]),[b,y]=(0,ta.useState)(null),[v,_]=(0,ta.useState)([]),[N,w]=(0,ta.useState)({lighting:50,texture:50,structure:50,anatomy:50}),[E,j]=(0,ta.useState)(null),[S,I]=(0,ta.useState)(!1),[A,C]=(0,ta.useState)(1),[T,k]=(0,ta.useState)(1),[O,R]=(0,ta.useState)(.5),[P,M]=(0,ta.useState)(.5),D=async()=>{if(a.trim()&&!p){m(!0),g(e=>[...e,{type:"Meta-Prompt Translator",status:"processing",message:"Upleveling user intent to Industrial Meta-Prompt...",timestamp:Date.now(),department:"Advanced"}]);try{let e=await lw(a,r);c(e),g(e=>[...e,{type:"Meta-Prompt Translator",status:"completed",message:"Visual refinement successfully mapped to technical directives.",timestamp:Date.now(),department:"Advanced"}])}catch(e){console.error(e)}finally{m(!1)}}},U=async()=>{if(a.trim()){u(!0),y(null),x([]),g([{type:"Director",status:"processing",message:"Kernel Job Initialized. Executing MAD Consensus V12.5...",timestamp:Date.now()}]);try{let n=await lN(a,{X:50,Y:50,Z:50},l,N,r,E||void 0);if(n.imageUrl){y(n.scoutData||null),_(n.groundingLinks||[]),x(n.deliberation_flow||[]),g(n.logs),c(n.enhancedPrompt);let i={...t,z_anatomy:A,z_structure:T,z_lighting:O,z_texture:P,agent_authority:N,neural_metrics:n.params.neural_metrics};e(n.imageUrl,i,a,n.groundingLinks||[],n.grading,n.visual_anchor)}}catch(e){console.error(e),g(e=>[...e,{type:"Director",status:"error",message:"Critical Kernel Failure during synthesis.",timestamp:Date.now()}])}finally{u(!1)}}};return(0,tr.jsxs)("div",{className:"h-full flex flex-col bg-[#050505] overflow-hidden min-h-full",children:[(0,tr.jsxs)("div",{className:"flex-1 flex flex-col lg:flex-row gap-8 p-6 lg:p-12 overflow-y-auto pb-32 custom-scrollbar",children:[(0,tr.jsxs)("div",{className:"flex-1 space-y-10 max-w-5xl",children:[(0,tr.jsx)(rm,{onReset:()=>{s(""),c(""),C(1),k(1),R(.5),M(.5),w({lighting:50,texture:50,structure:50,anatomy:50}),y(null),_([]),g([]),x([]),j(null),i()}}),(0,tr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,tr.jsxs)("div",{className:"space-y-8",children:[(0,tr.jsx)(rh,{prompt:a,setPrompt:s,refinedPrompt:o,isOptimizing:p,onMagicWand:D}),(0,tr.jsx)(rg,{authority:N,onChange:(e,t)=>{w(n=>({...n,[e]:t}))}})]}),(0,tr.jsxs)("div",{className:"space-y-8 flex flex-col",children:[(0,tr.jsx)(rf,{zAnatomy:A,setZAnatomy:C,zStructure:T,setZStructure:k,zLighting:O,setZLighting:R,zTexture:P,setZTexture:M}),(0,tr.jsx)(rx,{isProcessing:d,onProcess:U,prompt:a,injectedImage:E,onImageUpload:j,onOpenVault:()=>I(!0)})]})]}),(0,tr.jsx)(ry,{scoutData:b,groundingLinks:v})]}),(0,tr.jsx)("div",{className:"w-full lg:w-[400px] flex flex-col gap-6 lg:sticky lg:top-12 h-[calc(100vh-160px)]",children:(0,tr.jsx)(lT,{logs:h,isProcessing:d,deliberation_flow:f})})]}),S&&(0,tr.jsx)(lU,{items:l,onClose:()=>I(!1),onSelect:e=>{j(e.imageUrl),I(!1)}})]})},r_=async(e,t,n)=>{let i=e.getContext("2d",{willReadFrequently:!0});if(!i)return;let l=e.width,r=e.height;i.clearRect(0,0,l,r),i.save();let a=l/2,s=r/2,o=(n.lens_center_x||0)*(.1*l),c=(n.lens_center_y||0)*(.1*r);i.translate(a+o+(n.pan_x||0)*l,s+c+(n.pan_y||0)*r),n.rotate&&i.rotate(n.rotate*Math.PI/180);let d=(n.anamorphic_squeeze||1)*(1+(n.crop_zoom||0)),u=(n.geometry_y||1)*(1+(n.crop_zoom||0));i.scale(d,u);let p=1+Math.abs(.3*(n.lens_distortion||0));i.scale(p,p);let m=n.face_warp||0;0!==m&&i.scale(1-.25*m,1),i.translate(-a,-s);let h=n.perspective_x||0,g=n.perspective_y||0;if(.001>Math.abs(h)&&.001>Math.abs(g))i.drawImage(t,0,0);else{let e=t,n=t.width,l=t.height;if(Math.abs(g)>.001){let i=document.createElement("canvas");i.width=n,i.height=l;let r=i.getContext("2d");if(r){let a=Math.min(.8,Math.abs(g));for(let e=0;e<l;e++){let i=e/l,s=n*(g>0?1-i*a:1-(1-i)*a),o=(n-s)/2;r.drawImage(t,0,e,n,1,o,e,s,1)}e=i}}if(Math.abs(h)>.001){let t=Math.min(.8,Math.abs(h));for(let r=0;r<n;r++){let a=r/n,s=l*(h>0?1-a*t:1-(1-a)*t),o=(l-s)/2;i.drawImage(e,r,0,1,l,r,o,1,s)}}else i.drawImage(e,0,0)}i.restore();let f=i.getImageData(0,0,l,r),x=f.data,b=n.sharpness>0||n.structure>0||0!==n.clarity||n.skin_smooth>0||n.denoise>0||n.chromatic_aberration>0,y=b?new Uint8ClampedArray(x):x,v=.8*(n.temperature||0),_=.8*(n.tint||0),N=n.vibrance||1,w=n.saturation||1,E=n.brightness||1,j=n.contrast||1,S=n.pivot||.5,I=Math.pow(2,n.exposure||0),A=n.dehaze||0,C=n.mix_red_red??1,T=n.mix_red_green??0,k=n.mix_red_blue??0,O=n.mix_green_red??0,R=n.mix_green_green??1,P=n.mix_green_blue??0,M=n.mix_blue_red??0,D=n.mix_blue_green??0,U=n.mix_blue_blue??1,L=n.lift||0,z=n.gamma||1,G=n.gain||1,F=n.offset||0,q=(e,t,n)=>{let i=(1-Math.abs(2*n-1))*t,l=i*(1-Math.abs(e/60%2-1)),r=n-i/2,a=0,s=0,o=0;return 0<=e&&e<60?(a=i,s=l,o=0):60<=e&&e<120?(a=l,s=i,o=0):120<=e&&e<180?(a=0,s=i,o=l):180<=e&&e<240?(a=0,s=l,o=i):240<=e&&e<300?(a=l,s=0,o=i):300<=e&&e<360&&(a=i,s=0,o=l),[(a+r)*255,(s+r)*255,(o+r)*255]},H=q(n.split_shadow_hue||210,1,.5),V=q(n.split_highlight_hue||30,1,.5),B=q(n.split_mid_hue||0,1,.5),$=60*(n.grain||0),J=3*(n.sharpness||0),W=n.clarity||0,Y=3.5*(n.chromatic_aberration||0),K=n.skin_smooth||0,X=n.eye_clarity||0,Z=n.feature_pop||0,Q=n.teeth_whitening||0;for(let e=0;e<x.length;e+=4){let t,i=y[e],o=y[e+1],c=y[e+2],d=e/4%l,u=Math.floor(e/4/l);if(b){if(Y>0){let t=(d-a)/l,n=(u-s)/r,o=Math.floor(Y*(t*t+n*n)*30);if(o>0){let t=e-4*o,n=e+4*o;t>=0&&t<y.length&&(i=y[t]),n>=0&&n<y.length&&(c=y[n+2])}}if(d>1&&d<l-2&&u>1&&u<r-2){let t=e-4*l,r=e+4*l,a=e-4,s=e+4,d=(y[t]+y[r]+y[a]+y[s]+i)*.2,u=(y[t+1]+y[r+1]+y[a+1]+y[s+1]+o)*.2,p=(y[t+2]+y[r+2]+y[a+2]+y[s+2]+c)*.2,m=i-d,h=o-u,g=c-p;if(J>0||Z>0){let e=J+2.5*Z;i+=m*e,o+=h*e,c+=g*e}if(0!==W&&(i+=m*W*.8,o+=h*W*.8,c+=g*W*.8),K>0||n.denoise>0){let e=i>o&&o>c&&i>40&&Math.abs(i-o)>5?Math.max(n.denoise,K):n.denoise;if(e>0){let t=.75*e;i=i*(1-t)+d*t,o=o*(1-t)+u*t,c=c*(1-t)+p*t}}let f=.2126*i+.7152*o+.0722*c;if(Q>0&&f>80){let e=Math.max(i,o,c);if((e-Math.min(i,o,c))/(e||1)<.5&&i>c&&o>c){let e=.8*Q,t=((i=Math.min(255,i+50*e))+(o=Math.min(255,o+50*e))+(c=Math.min(255,c+70*e)))/3;i=i*(1-.5*e)+t*e*.5,o=o*(1-.5*e)+t*e*.5,c=c*(1-.5*e)+t*e*.5}}X>0&&f>160&&f<250&&(i+=m*X*5,o+=h*X*5,c+=g*X*5)}}let p=i,m=o,h=c;i=p*C+m*T+h*k,o=p*O+m*R+h*P,c=p*M+m*D+h*U,i+=v,c-=v;let g=i/255,f=(o+=_)/255,q=c/255;if(0!==A){let e=Math.min(g,f,q),t=.3*A;g=(g-e*t)/(1-t),f=(f-e*t)/(1-t),q=(q-e*t)/(1-t)}g*=I,f*=I,q*=I,g=(g-S)*j+S+(E-1),f=(f-S)*j+S+(E-1),q=(q-S)*j+S+(E-1);let ee=(e,t,n,i,l)=>{let r=e*(1-t)+t+l;return(r*=i)>0&&(r=Math.pow(r,1/Math.max(.01,n))),r};g=ee(g,L+(n.lift_r||0),z*(n.gamma_r||1),G*(n.gain_r||1),F+(n.offset_r||0));let et=.2126*g+.7152*(f=ee(f,L+(n.lift_g||0),z*(n.gamma_g||1),G*(n.gain_g||1),F+(n.offset_g||0)))+.0722*(q=ee(q,L+(n.lift_b||0),z*(n.gamma_b||1),G*(n.gain_b||1),F+(n.offset_b||0)));if(n.split_shadow_sat>0||n.split_highlight_sat>0||n.split_mid_sat>0){let e=n.split_balance||0,t=Math.max(0,1-2*et+e),i=Math.max(0,(et-.5-e)*2),l=1-t-i;if(t>0&&n.split_shadow_sat>0){let e=t*n.split_shadow_sat*.3;g+=(H[0]/255-g)*e,f+=(H[1]/255-f)*e,q+=(H[2]/255-q)*e}if(i>0&&n.split_highlight_sat>0){let e=i*n.split_highlight_sat*.3;g+=(V[0]/255-g)*e,f+=(V[1]/255-f)*e,q+=(V[2]/255-q)*e}if(l>0&&n.split_mid_sat>0){let e=l*n.split_mid_sat*.3;g+=(B[0]/255-g)*e,f+=(B[1]/255-f)*e,q+=(B[2]/255-q)*e}}let en=Math.max(g,f,q),ei=Math.min(g,f,q),el=(en+ei)/2,er=0,ea=0;if(en!==ei){let e=en-ei;ea=el>.5?e/(2-en-ei):e/(en+ei),er=(en===g?(f-q)/e+6*(f<q):en===f?(q-g)/e+2:(g-f)/e+4)/6}if(1!==N||1!==w){let e=w+(N-1)*(1-2*ea);ea>0&&(g=el+(g-el)*e,f=el+(f-el)*e,q=el+(q-el)*e)}let es=(e,t,n)=>{if(!n)return 0;let i=Math.abs(er-e);return(i>.5&&(i=1-i),i<t)?n*(1-i/t):0};if(0!==(t=0+es(0,.08,n.sat_red||0)+es(.08,.08,n.sat_orange||0)+es(.16,.12,n.sat_yellow||0)+es(.33,.15,n.sat_green||0)+es(.5,.15,n.sat_cyan||0)+es(.66,.15,n.sat_blue||0)+es(.78,.1,n.sat_purple||0)+es(.9,.1,n.sat_magenta||0))&&ea>0&&(g=el+(g-el)*(1+t),f=el+(f-el)*(1+t),q=el+(q-el)*(1+t)),n.selective_mix>0){let e=(n.selective_hue||0)/360,t=(n.selective_threshold||20)/360,i=Math.abs(er-e);i>.5&&(i=1-i);let l=i<t?Math.pow(1-i/t,.5):0,r=1-n.selective_mix,a=r+(1-r)*l;if(g=el+(g-el)*a,f=el+(f-el)*a,q=el+(q-el)*a,l>0&&n.selective_target_sat){let e=l*n.selective_target_sat;g=el+(g-el)*(1+e),f=el+(f-el)*(1+e),q=el+(q-el)*(1+e)}}if($>0){let e=$/255*(Math.random()-.5)*(1-Math.pow(2*el-1,4));n.grain_color?(g+=e*(1+.5*Math.random()),f+=e*(1+.5*Math.random()),q+=e*(1+.5*Math.random())):(g+=e,f+=e,q+=e)}x[e]=Math.min(255,Math.max(0,255*g)),x[e+1]=Math.min(255,Math.max(0,255*f)),x[e+2]=Math.min(255,Math.max(0,255*q))}if(i.putImageData(f,0,0),n.halation&&n.halation>0&&(i.save(),i.globalCompositeOperation="lighten",i.filter=`blur(${4+(n.halation_radius||0)}px)`,i.globalAlpha=n.halation,i.drawImage(e,0,0),i.fillStyle="rgba(255, 0, 0, 0.1)",i.globalCompositeOperation="source-atop",i.fillRect(0,0,l,r),i.restore()),n.bloom&&n.bloom>0&&(i.save(),i.filter=`blur(${10+20*(n.bloom_radius||0)}px) brightness(${1+n.bloom})`,i.globalCompositeOperation="screen",i.globalAlpha=.5*n.bloom,i.drawImage(e,0,0),i.restore()),n.diffusion&&n.diffusion>0&&(i.save(),i.filter="blur(20px)",i.globalCompositeOperation="lighten",i.globalAlpha=.3*n.diffusion,i.drawImage(e,0,0),i.restore()),n.vignette&&n.vignette>0){i.save(),i.globalCompositeOperation="multiply";let e=n.vignette_feather??.5,t=n.vignette_roundness??0,o=document.createElement("canvas");o.width=l,o.height=r;let c=o.getContext("2d");if(c){c.fillStyle=`rgba(0,0,0,${n.vignette})`,c.fillRect(0,0,l,r),c.globalCompositeOperation="destination-out",c.beginPath();let e=l/2*(.8-(1-Math.abs(t))*.3),i=r/2*(.8-(1-Math.abs(t))*.3);if(t>=0)c.ellipse(a,s,e,i,0,0,2*Math.PI);else{let n=Math.min(e,i)*(1+t);c.roundRect(a-e,s-i,2*e,2*i,Math.max(0,n))}c.fill()}i.filter=`blur(${60*e}px)`,i.drawImage(o,0,0),i.restore()}},rN=({selectedNode:e,grading:t,sliderPosition:n,onSliderMove:i,containerRef:l,onUploadClick:r,onOpenVault:a})=>{let s=(0,ta.useRef)(null);return((0,ta.useEffect)(()=>{if(!e||!s.current)return;let n=s.current,i=new Image;i.crossOrigin="anonymous",i.src=e.originalImageUrl||e.imageUrl,i.onload=()=>{n.width=i.width,n.height=i.height,r_(n,i,t),n.style.filter=`
        sepia(${t.sepia||0})
        grayscale(${t.grayscale||0})
        hue-rotate(${t.hueRotate||0}deg)
        invert(${t.invert||0})
        blur(${t.blur||0}px)
      `}},[t,e]),e)?(0,tr.jsx)("div",{className:"flex-1 h-full bg-[#030303] flex flex-col items-center justify-center relative p-4 border-b border-white/5 overflow-hidden",children:(0,tr.jsx)("div",{className:"relative w-full h-full flex flex-col items-center justify-center",children:(0,tr.jsxs)("div",{ref:l,className:"relative group w-full h-full cursor-ew-resize select-none overflow-hidden rounded-[2rem] shadow-[0_0_100px_rgba(0,0,0,0.5)] border border-white/5 bg-black",onMouseMove:e=>1===e.buttons&&i(e),onTouchMove:e=>i(e),children:[(0,tr.jsx)("img",{src:e.imageUrl,className:"w-full h-full object-contain opacity-0 pointer-events-none absolute inset-0",alt:"Ref"}),(0,tr.jsx)("canvas",{ref:s,className:"absolute inset-0 w-full h-full object-contain"}),(0,tr.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",style:{clipPath:`inset(0 ${100-n}% 0 0)`},children:(0,tr.jsxs)("div",{className:"absolute inset-0 bg-[#030303]",children:[(0,tr.jsx)("img",{src:e.originalImageUrl||e.imageUrl,className:"w-full h-full object-contain opacity-100",alt:"Original"}),(0,tr.jsx)("div",{className:"absolute top-6 left-6 px-3 py-1.5 bg-black/60 rounded-lg border border-white/10 text-[9px] font-black text-white uppercase tracking-widest",children:"RAW SIGNAL"})]})}),(0,tr.jsx)("div",{className:"absolute inset-y-0 w-[1px] bg-white/50 backdrop-blur-3xl z-50 pointer-events-none shadow-[0_0_30px_rgba(255,255,255,0.8)]",style:{left:`${n}%`},children:(0,tr.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-black/90 backdrop-blur-3xl border border-white/20 rounded-full flex items-center justify-center shadow-2xl",children:(0,tr.jsxs)("div",{className:"flex gap-1",children:[(0,tr.jsx)("div",{className:"w-0.5 h-3 bg-white/20 rounded-full"}),(0,tr.jsx)("div",{className:"w-0.5 h-5 bg-white/80 rounded-full"}),(0,tr.jsx)("div",{className:"w-0.5 h-3 bg-white/20 rounded-full"})]})})})]})})}):(0,tr.jsxs)("div",{className:"flex-1 h-full bg-[#020202] flex flex-col items-center justify-center border-b border-white/5 space-y-12 p-12 relative overflow-hidden",children:[(0,tr.jsx)("div",{className:"absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-500 via-transparent to-transparent"}),(0,tr.jsxs)("div",{className:"w-40 h-40 rounded-[4rem] bg-zinc-900 flex items-center justify-center border border-white/5 shadow-[0_0_100px_rgba(0,0,0,1)] relative group overflow-hidden",children:[(0,tr.jsx)("div",{className:"absolute inset-0 bg-indigo-600/10 animate-pulse"}),(0,tr.jsx)("svg",{className:"w-16 h-16 text-zinc-700 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 2v20M2 12h20",strokeWidth:.5})})]}),(0,tr.jsxs)("div",{className:"text-center space-y-6 max-w-xl relative z-10",children:[(0,tr.jsx)("h3",{className:"text-3xl font-black uppercase tracking-[0.8em] text-white",children:"Signal Master"}),(0,tr.jsx)("p",{className:"text-[11px] text-zinc-500 uppercase font-bold leading-relaxed tracking-widest px-10",children:"Industrial Color Engineering. Inject a node from the vault or raw buffer to begin modulation."}),(0,tr.jsxs)("div",{className:"flex gap-4 justify-center pt-8",children:[(0,tr.jsx)("button",{onClick:r,className:"px-12 py-5 bg-indigo-600 text-white rounded-[2rem] text-[10px] font-black uppercase tracking-widest hover:bg-indigo-500 transition-all shadow-2xl",children:"Import RAW"}),(0,tr.jsx)("button",{onClick:a,className:"px-12 py-5 bg-white/5 border border-white/10 text-white rounded-[2rem] text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition-all",children:"Vault Archive"})]})]})]})},rw=({onCommit:e,onDownload:t,onReset:n,isSaving:i,disabled:l})=>(0,tr.jsxs)("div",{className:"flex gap-2 justify-center py-3 bg-[#0b0b0d] border-b border-white/5 z-50",children:[(0,tr.jsxs)("button",{onClick:e,disabled:l||i,className:"px-3 py-2 bg-indigo-600 text-white rounded-lg text-[8px] font-black uppercase tracking-widest shadow-xl flex items-center gap-2 active:scale-95 transition-all disabled:opacity-30",children:[(0,tr.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M5 13l4 4L19 7",strokeWidth:3})}),i?"Baking...":"Commit Master"]}),(0,tr.jsxs)("button",{onClick:t,disabled:l,className:"px-3 py-2 bg-zinc-100 text-black rounded-lg text-[8px] font-black uppercase tracking-widest shadow-xl flex items-center gap-2 active:scale-95 transition-all disabled:opacity-30",children:[(0,tr.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4",strokeWidth:2})}),"Export PNG"]}),(0,tr.jsx)("button",{onClick:n,disabled:l,className:"px-2 py-2 bg-zinc-900 border border-white/5 text-zinc-600 rounded-lg text-[8px] font-black uppercase tracking-widest hover:text-white transition-all disabled:opacity-30",children:"Reset"})]}),rE=({categories:e,activeCategory:t,setActiveCategory:n})=>(0,tr.jsx)("div",{className:"w-full bg-[#08080a] border-b border-white/5 p-4",children:(0,tr.jsx)("div",{className:"grid grid-cols-4 gap-2",children:e.map(e=>{let i=t===e.id;return(0,tr.jsxs)("button",{onClick:()=>n(e.id),className:`flex flex-col items-center justify-center gap-1 py-3 rounded-xl transition-all duration-200 group border ${i?"bg-zinc-800 border-indigo-500/50 shadow-lg":"bg-black/20 border-white/5 hover:bg-white/5 hover:border-white/10"}`,children:[(0,tr.jsx)("span",{className:`text-lg transition-transform ${i?"scale-110 text-white":"text-zinc-600 group-hover:text-zinc-400"}`,children:e.icon}),(0,tr.jsx)("span",{className:`text-[8px] font-black uppercase tracking-widest ${i?"text-indigo-400":"text-zinc-500"}`,children:e.label})]},e.id)})})}),rj=({activeCategory:e,grading:t,updateParam:n,applyPreset:i,filmStocks:l,customLuts:r,handleSaveLut:a,handleRemoveLut:s,newLutName:o,setNewLutName:c})=>{let d=({keyName:e,label:i,min:l,max:r,step:a=.001,color:s="indigo"})=>{let o=t[e]||0,[c,d]=(0,ta.useState)(o);(0,ta.useEffect)(()=>{d(o)},[o]);let u=r-l,p=Math.min(100,Math.max(0,(o-l)/u*100)),m="0%",h=`${p}%`,g=l<0&&r>0;if(g){let e=(0-l)/u*100;o>=0?(m=`${e}%`,h=`${Math.max(0,p-e)}%`):(m=`${p}%`,h=`${Math.max(0,e-p)}%`)}let f="bg-indigo-500",x="text-indigo-400",b="shadow-[0_0_8px_rgba(99,102,241,0.3)]";return"red"===s&&(f="bg-red-500",x="text-red-400",b="shadow-[0_0_8px_rgba(239,68,68,0.3)]"),"green"===s&&(f="bg-emerald-500",x="text-emerald-400",b="shadow-[0_0_8px_rgba(16,185,129,0.3)]"),"blue"===s&&(f="bg-blue-500",x="text-blue-400",b="shadow-[0_0_8px_rgba(59,130,246,0.3)]"),"amber"===s&&(f="bg-amber-500",x="text-amber-400",b="shadow-[0_0_8px_rgba(245,158,11,0.3)]"),"pink"===s&&(f="bg-pink-500",x="text-pink-400",b="shadow-[0_0_8px_rgba(236,72,153,0.3)]"),"zinc"===s&&(f="bg-zinc-400",x="text-zinc-300",b=""),(0,tr.jsxs)("div",{className:"group py-1.5 w-full",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-end mb-1 px-1",children:[(0,tr.jsx)("span",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-widest group-hover:text-zinc-300 transition-colors",children:i}),(0,tr.jsx)("input",{type:"number",step:a,value:"number"==typeof c?parseFloat(c.toFixed(3)):c,onChange:t=>{d(t.target.value);let i=parseFloat(t.target.value);isNaN(i)||n(e,i)},className:`w-16 bg-transparent text-right text-[10px] mono font-bold outline-none border-none p-0 focus:text-white transition-all ${x}`})]}),(0,tr.jsxs)("div",{className:"relative h-3 w-full flex items-center",children:[(0,tr.jsxs)("div",{className:"absolute inset-x-0 h-[2px] bg-white/10 rounded-full overflow-hidden",children:[g&&(0,tr.jsx)("div",{className:"absolute top-0 bottom-0 left-[50%] w-[1px] bg-white/30 z-0"}),(0,tr.jsx)("div",{className:`absolute top-0 bottom-0 ${f} opacity-80 group-hover:opacity-100 ${b}`,style:{left:m,width:h}})]}),(0,tr.jsx)("div",{className:`absolute w-2 h-2 bg-white rounded-full shadow-sm pointer-events-none transition-transform duration-100 z-10 opacity-0 group-hover:opacity-100 scale-0 group-hover:scale-100 ${b}`,style:{left:`calc(${p}% - 4px)`}}),(0,tr.jsx)("input",{type:"range",min:l,max:r,step:a,value:o,onChange:t=>{let i=parseFloat(t.target.value);d(i),n(e,i)},className:"absolute inset-0 w-full h-full opacity-0 cursor-ew-resize z-20"})]})]})},u=({title:e,icon:t})=>(0,tr.jsxs)("div",{className:"pt-6 pb-2 border-b border-white/5 mb-3 flex items-center gap-3",children:[t||(0,tr.jsx)("div",{className:"w-1 h-1 bg-zinc-600 rounded-full"}),(0,tr.jsx)("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-[0.3em]",children:e})]});return(0,tr.jsx)("div",{className:"h-full overflow-y-auto custom-scrollbar p-8 md:p-12 bg-[#08080a]",children:(()=>{switch(e){case"MASTER":return(0,tr.jsxs)("div",{className:"flex flex-col gap-1 pb-10",children:[(0,tr.jsx)(u,{title:"Primary Correction"}),(0,tr.jsx)(d,{keyName:"exposure",label:"Exposure",min:-3,max:3,step:.01}),(0,tr.jsx)(d,{keyName:"contrast",label:"Contrast",min:0,max:2.5,step:.01}),(0,tr.jsx)(d,{keyName:"brightness",label:"Brightness",min:0,max:2,step:.01}),(0,tr.jsx)(d,{keyName:"gamma",label:"Gamma",min:.1,max:3,step:.01}),(0,tr.jsx)(d,{keyName:"pivot",label:"Pivot",min:0,max:1,step:.01}),(0,tr.jsx)(u,{title:"Signal Balance"}),(0,tr.jsx)(d,{keyName:"offset",label:"Offset",min:-.2,max:.2,step:.001}),(0,tr.jsx)(d,{keyName:"lift",label:"Lift (Blacks)",min:-.5,max:.5,step:.001}),(0,tr.jsx)(d,{keyName:"gain",label:"Gain (Whites)",min:0,max:3,step:.01}),(0,tr.jsx)(d,{keyName:"invert",label:"Invert Signal",min:0,max:1,step:1}),(0,tr.jsx)(u,{title:"Global Color"}),(0,tr.jsx)(d,{keyName:"saturation",label:"Saturation",min:0,max:3,step:.01,color:"pink"}),(0,tr.jsx)(d,{keyName:"vibrance",label:"Vibrance",min:0,max:3,step:.01,color:"pink"}),(0,tr.jsx)(d,{keyName:"temperature",label:"Temp (K)",min:-100,max:100,step:1,color:"amber"}),(0,tr.jsx)(d,{keyName:"tint",label:"Tint",min:-100,max:100,step:1,color:"green"}),(0,tr.jsx)(d,{keyName:"hueRotate",label:"Global Hue",min:-180,max:180,step:1,color:"blue"})]});case"LGG":return(0,tr.jsxs)("div",{className:"flex flex-col gap-8 pb-12",children:[(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-3 pb-2 border-b border-white/5 mb-2",children:[(0,tr.jsx)("div",{className:"w-2 h-2 rounded-full bg-zinc-800 border border-zinc-600 shadow-[0_0_10px_black]"}),(0,tr.jsx)("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:"Lift (Shadows)"})]}),(0,tr.jsx)(d,{keyName:"lift_r",label:"Red Lift",min:-.5,max:.5,color:"red"}),(0,tr.jsx)(d,{keyName:"lift_g",label:"Green Lift",min:-.5,max:.5,color:"green"}),(0,tr.jsx)(d,{keyName:"lift_b",label:"Blue Lift",min:-.5,max:.5,color:"blue"}),(0,tr.jsx)("div",{className:"h-1"}),(0,tr.jsx)(d,{keyName:"offset",label:"Master Offset",min:-.2,max:.2,color:"zinc"})]}),(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-3 pb-2 border-b border-white/5 mb-2",children:[(0,tr.jsx)("div",{className:"w-2 h-2 rounded-full bg-zinc-600 border border-zinc-400"}),(0,tr.jsx)("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:"Gamma (Midtones)"})]}),(0,tr.jsx)(d,{keyName:"gamma_r",label:"Red Gamma",min:.1,max:3,color:"red"}),(0,tr.jsx)(d,{keyName:"gamma_g",label:"Green Gamma",min:.1,max:3,color:"green"}),(0,tr.jsx)(d,{keyName:"gamma_b",label:"Blue Gamma",min:.1,max:3,color:"blue"})]}),(0,tr.jsxs)("div",{className:"space-y-1",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-3 pb-2 border-b border-white/5 mb-2",children:[(0,tr.jsx)("div",{className:"w-2 h-2 rounded-full bg-zinc-300 border border-white shadow-[0_0_10px_white]"}),(0,tr.jsx)("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:"Gain (Highlights)"})]}),(0,tr.jsx)(d,{keyName:"gain_r",label:"Red Gain",min:0,max:3,color:"red"}),(0,tr.jsx)(d,{keyName:"gain_g",label:"Green Gain",min:0,max:3,color:"green"}),(0,tr.jsx)(d,{keyName:"gain_b",label:"Blue Gain",min:0,max:3,color:"blue"})]})]});case"MIXER":return(0,tr.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,tr.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"})," ",(0,tr.jsx)("span",{className:"text-[10px] font-black text-red-400 uppercase tracking-widest",children:"Red Output"})]}),(0,tr.jsx)(d,{keyName:"mix_red_red",label:"Red In",min:-2,max:2,color:"red"}),(0,tr.jsx)(d,{keyName:"mix_red_green",label:"Green In",min:-2,max:2,color:"green"}),(0,tr.jsx)(d,{keyName:"mix_red_blue",label:"Blue In",min:-2,max:2,color:"blue"})]}),(0,tr.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})," ",(0,tr.jsx)("span",{className:"text-[10px] font-black text-green-400 uppercase tracking-widest",children:"Green Output"})]}),(0,tr.jsx)(d,{keyName:"mix_green_red",label:"Red In",min:-2,max:2,color:"red"}),(0,tr.jsx)(d,{keyName:"mix_green_green",label:"Green In",min:-2,max:2,color:"green"}),(0,tr.jsx)(d,{keyName:"mix_green_blue",label:"Blue In",min:-2,max:2,color:"blue"})]}),(0,tr.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,tr.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"})," ",(0,tr.jsx)("span",{className:"text-[10px] font-black text-blue-400 uppercase tracking-widest",children:"Blue Output"})]}),(0,tr.jsx)(d,{keyName:"mix_blue_red",label:"Red In",min:-2,max:2,color:"red"}),(0,tr.jsx)(d,{keyName:"mix_blue_green",label:"Green In",min:-2,max:2,color:"green"}),(0,tr.jsx)(d,{keyName:"mix_blue_blue",label:"Blue In",min:-2,max:2,color:"blue"})]})]});case"HSL":return(0,tr.jsxs)("div",{className:"flex flex-col gap-1 pb-10",children:[(0,tr.jsx)(u,{title:"Vector Saturation"}),(0,tr.jsx)(d,{keyName:"sat_red",label:"Red",min:-1,max:2,color:"red"}),(0,tr.jsx)(d,{keyName:"sat_orange",label:"Orange",min:-1,max:2,color:"amber"}),(0,tr.jsx)(d,{keyName:"sat_yellow",label:"Yellow",min:-1,max:2,color:"amber"}),(0,tr.jsx)(d,{keyName:"sat_green",label:"Green",min:-1,max:2,color:"green"}),(0,tr.jsx)(d,{keyName:"sat_cyan",label:"Cyan",min:-1,max:2,color:"blue"}),(0,tr.jsx)(d,{keyName:"sat_blue",label:"Blue",min:-1,max:2,color:"blue"}),(0,tr.jsx)(d,{keyName:"sat_purple",label:"Purple",min:-1,max:2,color:"pink"}),(0,tr.jsx)(d,{keyName:"sat_magenta",label:"Magenta",min:-1,max:2,color:"pink"}),(0,tr.jsx)(u,{title:"Split Toning"}),(0,tr.jsx)("span",{className:"text-[9px] font-black text-blue-400 uppercase tracking-widest block mt-2 mb-1",children:"Shadows (Cold)"}),(0,tr.jsx)(d,{keyName:"split_shadow_hue",label:"Hue",min:0,max:360,step:1,color:"blue"}),(0,tr.jsx)(d,{keyName:"split_shadow_sat",label:"Sat",min:0,max:2,color:"blue"}),(0,tr.jsx)("span",{className:"text-[9px] font-black text-amber-400 uppercase tracking-widest block mt-4 mb-1",children:"Highlights (Warm)"}),(0,tr.jsx)(d,{keyName:"split_highlight_hue",label:"Hue",min:0,max:360,step:1,color:"amber"}),(0,tr.jsx)(d,{keyName:"split_highlight_sat",label:"Sat",min:0,max:2,color:"amber"}),(0,tr.jsx)("div",{className:"mt-4",children:(0,tr.jsx)(d,{keyName:"split_balance",label:"Split Balance",min:-1,max:1})})]});case"PHYSICS":return(0,tr.jsxs)("div",{className:"flex flex-col gap-1 pb-10",children:[(0,tr.jsx)(u,{title:"Lens Geometry"}),(0,tr.jsx)(d,{keyName:"lens_distortion",label:"Distortion",min:-1,max:1}),(0,tr.jsx)(d,{keyName:"anamorphic_squeeze",label:"Anamorphic",min:.5,max:2}),(0,tr.jsx)(d,{keyName:"geometry_y",label:"Stretch Y",min:.5,max:2}),(0,tr.jsx)(d,{keyName:"rotate",label:"Roll",min:-45,max:45,step:.1}),(0,tr.jsx)(d,{keyName:"crop_zoom",label:"Sensor Crop",min:0,max:1}),(0,tr.jsx)(d,{keyName:"perspective_x",label:"Tilt X",min:-1,max:1}),(0,tr.jsx)(d,{keyName:"perspective_y",label:"Tilt Y",min:-1,max:1}),(0,tr.jsx)(u,{title:"Optical Phenomena"}),(0,tr.jsx)(d,{keyName:"bloom",label:"Bloom",min:0,max:1,color:"amber"}),(0,tr.jsx)(d,{keyName:"bloom_radius",label:"Bloom Radius",min:0,max:2,color:"amber"}),(0,tr.jsx)(d,{keyName:"halation",label:"Halation",min:0,max:1,color:"red"}),(0,tr.jsx)(d,{keyName:"chromatic_aberration",label:"Chromatic",min:0,max:2,color:"pink"}),(0,tr.jsx)(d,{keyName:"diffusion",label:"Mist",min:0,max:1}),(0,tr.jsx)(d,{keyName:"vignette",label:"Vignette",min:0,max:1}),(0,tr.jsx)(d,{keyName:"vignette_roundness",label:"Roundness",min:-1,max:1}),(0,tr.jsx)(d,{keyName:"vignette_feather",label:"Feather",min:0,max:2})]});case"FILM":return(0,tr.jsxs)("div",{className:"flex flex-col gap-1 pb-10",children:[(0,tr.jsx)(u,{title:"Film Emulsion"}),(0,tr.jsx)(d,{keyName:"grain",label:"Grain Amount",min:0,max:1}),(0,tr.jsx)(d,{keyName:"grain_size",label:"Grain Size",min:.5,max:3}),(0,tr.jsx)(d,{keyName:"grain_roughness",label:"Roughness",min:0,max:1}),(0,tr.jsx)(d,{keyName:"grain_color",label:"Color Noise",min:0,max:1,color:"pink"}),(0,tr.jsx)(u,{title:"Spatial Detail"}),(0,tr.jsx)(d,{keyName:"sharpness",label:"Sharpness",min:0,max:2}),(0,tr.jsx)(d,{keyName:"structure",label:"Structure",min:0,max:2}),(0,tr.jsx)(d,{keyName:"clarity",label:"Clarity",min:0,max:2}),(0,tr.jsx)(d,{keyName:"dehaze",label:"Dehaze",min:-1,max:1}),(0,tr.jsx)(d,{keyName:"denoise",label:"Denoise",min:0,max:1}),(0,tr.jsx)(d,{keyName:"blur",label:"Blur",min:0,max:10,step:.1})]});case"FX":return(0,tr.jsxs)("div",{className:"flex flex-col gap-1 pb-10",children:[(0,tr.jsx)(u,{title:"Selective Color"}),(0,tr.jsx)(d,{keyName:"selective_hue",label:"Target Hue",min:0,max:360,step:1,color:"pink"}),(0,tr.jsx)(d,{keyName:"selective_threshold",label:"Range",min:0,max:100,step:1}),(0,tr.jsx)(d,{keyName:"selective_mix",label:"Desat BG",min:0,max:1}),(0,tr.jsx)(d,{keyName:"selective_target_sat",label:"Boost Target",min:0,max:1,color:"pink"}),(0,tr.jsx)(u,{title:"Portrait Engine"}),(0,tr.jsx)(d,{keyName:"skin_smooth",label:"Skin Smooth",min:0,max:1,color:"amber"}),(0,tr.jsx)(d,{keyName:"face_warp",label:"Face Slim",min:-1,max:1}),(0,tr.jsx)(d,{keyName:"eye_clarity",label:"Eye Clarity",min:0,max:1,color:"blue"}),(0,tr.jsx)(d,{keyName:"teeth_whitening",label:"Teeth White",min:0,max:1}),(0,tr.jsx)(d,{keyName:"feature_pop",label:"Feature Pop",min:0,max:1})]});case"LUT":return(0,tr.jsxs)("div",{className:"flex flex-col gap-8 pb-10",children:[(0,tr.jsxs)("div",{className:"space-y-4",children:[(0,tr.jsx)(u,{title:"Film Stocks (Emulation)"}),(0,tr.jsx)("div",{className:"grid grid-cols-2 gap-4",children:l.map(e=>(0,tr.jsxs)("button",{onClick:()=>i(e),className:`h-12 rounded-lg border transition-all flex items-center justify-between px-6 ${t.preset_name===e.name?"border-indigo-500 bg-indigo-500/20 shadow-lg":"border-white/5 bg-zinc-900/40 hover:bg-zinc-800"}`,children:[(0,tr.jsx)("span",{className:`text-[10px] font-black uppercase tracking-widest ${t.preset_name===e.name?"text-white":"text-zinc-400"}`,children:e.name.replace("_"," ")}),t.preset_name===e.name&&(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full shadow-[0_0_8px_indigo]"})]},e.name))}),(0,tr.jsxs)("div",{className:"pt-6 border-t border-white/5",children:[(0,tr.jsx)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest px-1 mb-3 block",children:"Save Current Profile"}),(0,tr.jsxs)("div",{className:"flex gap-2",children:[(0,tr.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value.toUpperCase()),placeholder:"PROFILE NAME...",className:"flex-1 bg-zinc-900/50 border border-white/10 rounded-lg px-4 py-3 text-[10px] mono text-white outline-none font-bold focus:border-indigo-500/50 transition-colors h-12"}),(0,tr.jsx)("button",{onClick:a,disabled:!o.trim(),className:"px-6 bg-indigo-600 text-white rounded-lg text-[9px] font-black uppercase tracking-widest hover:bg-indigo-500 active:scale-95 transition-all shadow-lg h-12",children:"Save"})]})]})]}),r.length>0&&(0,tr.jsxs)("div",{className:"space-y-4",children:[(0,tr.jsx)(u,{title:"User Profiles"}),(0,tr.jsx)("div",{className:"grid grid-cols-2 gap-4",children:r.map((e,n)=>(0,tr.jsxs)("div",{className:"flex gap-2 group relative",children:[(0,tr.jsxs)("button",{onClick:()=>i(e),className:`flex-1 h-12 rounded-lg border transition-all flex items-center justify-between px-4 bg-zinc-900/60 ${t.preset_name===e.name?"border-indigo-500 shadow-md":"border-white/5 hover:border-white/20"}`,children:[(0,tr.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest text-zinc-300 truncate",children:e.name}),t.preset_name===e.name&&(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full"})]}),(0,tr.jsx)("button",{onClick:()=>s(e.name),className:"w-12 h-12 bg-red-900/10 border border-red-500/10 rounded-lg flex items-center justify-center text-red-500/50 hover:text-red-500 hover:bg-red-900/20 transition-all",children:(0,tr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M6 18L18 6M6 6l12 12",strokeWidth:2.5})})})]},n))})]})]});default:return null}})()})},rS=({favoriteNodes:e,selectedNodeId:t,onSelectNode:n})=>(0,tr.jsx)("div",{className:"p-2 bg-black border-t border-white/5",children:(0,tr.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-1 custom-scrollbar scroll-smooth",children:[e.map(e=>(0,tr.jsx)("button",{onClick:()=>n(e),className:`flex-shrink-0 w-11 h-11 rounded-lg overflow-hidden border transition-all ${t===e.id?"border-indigo-500 scale-105 shadow-lg":"border-white/10 opacity-40 hover:opacity-100"}`,children:(0,tr.jsx)("img",{src:e.imageUrl,className:"w-full h-full object-cover",alt:"T"})},e.id)),0===e.length&&(0,tr.jsx)("div",{className:"w-full py-2 flex items-center justify-center opacity-10",children:(0,tr.jsx)("p",{className:"text-[7px] text-zinc-500 uppercase tracking-widest",children:"Mark favorites in Vault to inject"})})]})}),rI={preset_name:"LINEAR_RAW",css_filter_string:"none",exposure:0,contrast:1,pivot:.5,brightness:1,saturation:1,vibrance:1,temperature:0,tint:0,hueRotate:0,gamma:1,offset:0,lift:0,gain:1,invert:0,opacity:1,lift_r:0,lift_g:0,lift_b:0,gamma_r:1,gamma_g:1,gamma_b:1,gain_r:1,gain_g:1,gain_b:1,offset_r:0,offset_g:0,offset_b:0,mix_red_red:1,mix_red_green:0,mix_red_blue:0,mix_green_red:0,mix_green_green:1,mix_green_blue:0,mix_blue_red:0,mix_blue_green:0,mix_blue_blue:1,hue_red:0,sat_red:0,hue_orange:0,sat_orange:0,hue_yellow:0,sat_yellow:0,hue_green:0,sat_green:0,hue_cyan:0,sat_cyan:0,hue_blue:0,sat_blue:0,hue_magenta:0,sat_magenta:0,hue_purple:0,sat_purple:0,split_shadow_hue:240,split_shadow_sat:0,split_mid_hue:45,split_mid_sat:0,split_highlight_hue:45,split_highlight_sat:0,split_balance:0,grain:0,grain_size:1,grain_roughness:.5,grain_color:0,grain_shadows:0,grain_highlights:0,halation:0,halation_threshold:.8,halation_radius:0,film_breath:0,lens_distortion:0,chromatic_aberration:0,vignette:0,vignette_roundness:0,vignette_feather:.5,vignette_center_x:0,vignette_center_y:0,bloom:0,bloom_threshold:.8,bloom_radius:0,diffusion:0,anamorphic_squeeze:1,sharpness:0,unsharp_mask:0,structure:0,clarity:0,dehaze:0,denoise:0,denoise_chroma:0,blur:0,noise_gate:0,texture:0,skin_protect:0,skin_hue:0,skin_sat:0,skin_smooth:0,feature_pop:0,eye_clarity:0,face_warp:0,teeth_whitening:0,crop_zoom:0,pan_x:0,pan_y:0,rotate:0,perspective_x:0,perspective_y:0,tint_r:1,tint_g:1,tint_b:1,sepia:0,grayscale:0,tonal_value:1,highlight_rolloff:0,shadow_rolloff:0,whites:1,blacks:0,shadows:0,midtones:1,highlights:1,selective_hue:0,selective_threshold:40,selective_mix:0,selective_target_sat:0,hue_vs_hue_curve:0,hue_vs_sat_curve:0,sat_vs_sat_curve:0,lum_vs_sat_curve:0,lens_center_x:0,lens_center_y:0,polar_coordinates:0,lip_saturation:0,halation_hue:0,skin_smoothing:0,blemish_removal:0,skin_hue_legacy:0,skin_saturation:0,geometry_y:1},rA=[{name:"KODAK_VISION3_500T",contrast:1.1,saturation:1.2,grain:.15,halation:.2,bloom:.1,tint:-5},{name:"FUJI_ETERNA_250D",contrast:.95,saturation:.9,grain:.05,shadows:.02,midtones:1.05},{name:"CINESTILL_800T",halation:.6,bloom:.4,temperature:-20,split_shadow_hue:210,split_shadow_sat:.2},{name:"ILFORD_HP5_BW",grayscale:1,contrast:1.3,grain:.4,grain_roughness:.8},{name:"BLEACH_BYPASS",saturation:.4,contrast:1.5,structure:.5,grain:.2},{name:"TEAL_ORANGE_BLOCK",split_shadow_hue:210,split_shadow_sat:.5,split_highlight_hue:35,split_highlight_sat:.5,split_balance:-.2}],rC=({vault:e,onSave:t})=>{let[n,i]=(0,ta.useState)(null),[l,r]=(0,ta.useState)(rI),[a,s]=(0,ta.useState)([]),[o,c]=(0,ta.useState)(!1),[d,u]=(0,ta.useState)(50),[p,m]=(0,ta.useState)("MASTER"),[h,g]=(0,ta.useState)(""),[f,x]=(0,ta.useState)(!1),b=(0,ta.useRef)(null),y=(0,ta.useRef)(null),v="studio_master_luts_v15_pro";(0,ta.useEffect)(()=>{let e=localStorage.getItem(v);e&&s(JSON.parse(e))},[]),(0,ta.useEffect)(()=>{n&&r(n.grading||rI)},[n]);let _=()=>new Promise((e,t)=>{if(!n)return t();let i=new Image;i.crossOrigin="anonymous",i.src=n.originalImageUrl||n.imageUrl,i.onload=async()=>{let t=document.createElement("canvas");t.width=i.width,t.height=i.height,await r_(t,i,l);let n=t.getContext("2d");if(n&&(l.sepia||l.grayscale||l.hueRotate||l.invert||l.blur)){let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");i&&(i.drawImage(t,0,0),n.filter=`
                        sepia(${l.sepia||0})
                        grayscale(${l.grayscale||0})
                        hue-rotate(${l.hueRotate||0}deg)
                        invert(${l.invert||0})
                        blur(${l.blur||0}px)
                   `,n.clearRect(0,0,t.width,t.height),n.drawImage(e,0,0))}e(t.toDataURL("image/png",.95))},i.onerror=t}),N=[{id:"MASTER",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4",strokeWidth:2})}),label:"Master"},{id:"LGG",icon:(0,tr.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,tr.jsx)("path",{d:"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"}),(0,tr.jsx)("path",{d:"M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"})]}),label:"Wheels"},{id:"MIXER",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z",strokeWidth:2})}),label:"Mixer"},{id:"HSL",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343",strokeWidth:2})}),label:"HSL"},{id:"FX",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z",strokeWidth:2})}),label:"Skin/FX"},{id:"PHYSICS",icon:(0,tr.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,tr.jsx)("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z",strokeWidth:2}),(0,tr.jsx)("path",{d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z",strokeWidth:2})]}),label:"Lens"},{id:"FILM",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4",strokeWidth:2})}),label:"Film"},{id:"LUT",icon:(0,tr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z",strokeWidth:2})}),label:"Profile"}];return(0,tr.jsxs)("div",{className:"h-full flex flex-col bg-[#010101] overflow-hidden min-h-full",children:[(0,tr.jsxs)("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden relative",children:[(0,tr.jsx)("div",{className:"flex-1 relative flex flex-col overflow-hidden bg-black",children:(0,tr.jsx)(rN,{selectedNode:n,grading:l,sliderPosition:d,onSliderMove:e=>{if(!b.current)return;let t=b.current.getBoundingClientRect();u(Math.max(0,Math.min(100,(("touches"in e?e.touches[0].clientX:e.clientX)-t.left)/t.width*100)))},containerRef:b,onUploadClick:()=>y.current?.click(),onOpenVault:()=>x(!0)})}),(0,tr.jsxs)("div",{className:"w-full lg:w-[480px] bg-[#08080a] border-l border-white/5 flex flex-col shadow-2xl z-20 overflow-hidden relative text-zinc-100",children:[(0,tr.jsx)(rw,{onCommit:async()=>{if(n){c(!0);try{let e=await _();await t({...n,imageUrl:e,grading:l}),alert("MASTER GRADE LOCKED.")}catch(e){alert("Render Error")}finally{c(!1)}}},onDownload:async()=>{try{let e=await _(),t=document.createElement("a");t.href=e,t.download="Studio_Master_V15.png",t.click()}catch(e){alert("Download failed: No buffer")}},onReset:()=>r(rI),isSaving:o,disabled:!n}),(0,tr.jsx)(rE,{categories:N,activeCategory:p,setActiveCategory:m}),(0,tr.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6",children:(0,tr.jsx)(rj,{activeCategory:p,grading:l,updateParam:(e,t)=>{r(n=>({...n,[e]:t}))},applyPreset:e=>{r({...rI,...e,preset_name:e.name||e.preset_name})},filmStocks:rA,customLuts:a,handleSaveLut:()=>{if(!h.trim())return;let e=[...a,{...l,name:h.toUpperCase()}];s(e),localStorage.setItem(v,JSON.stringify(e)),g(""),alert("LUT PROFILE REGISTERED IN KERNEL V15.")},handleRemoveLut:e=>{let t=a.filter(t=>t.name!==e);s(t),localStorage.setItem(v,JSON.stringify(t))},newLutName:h,setNewLutName:g})}),(0,tr.jsx)(rS,{favoriteNodes:e.filter(e=>e.isFavorite),selectedNodeId:n?.id,onSelectNode:i})]})]}),f&&(0,tr.jsxs)("div",{className:"fixed inset-0 z-[1000] bg-black/98 backdrop-blur-3xl flex flex-col p-10 animate-in fade-in duration-500",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center mb-12 max-w-7xl mx-auto w-full",children:[(0,tr.jsx)("h3",{className:"text-4xl font-black text-white uppercase tracking-tighter",children:"Vault Engine"}),(0,tr.jsx)("button",{onClick:()=>x(!1),className:"px-10 py-4 bg-zinc-800 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-zinc-700",children:"Exit"})]}),(0,tr.jsx)("div",{className:"flex-1 overflow-y-auto grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-8 custom-scrollbar pb-40 max-w-7xl mx-auto w-full",children:e.map(e=>(0,tr.jsxs)("div",{onClick:()=>{i(e),x(!1)},className:"aspect-[3/4] bg-zinc-900 rounded-[2.5rem] overflow-hidden border border-white/5 hover:border-indigo-500 cursor-pointer transition-all group relative",children:[(0,tr.jsx)("img",{src:e.imageUrl,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-[3000ms]"}),(0,tr.jsx)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center",children:(0,tr.jsx)("span",{className:"text-[10px] font-black text-white uppercase tracking-widest bg-indigo-600 px-6 py-2 rounded-full",children:"Inject Signal"})})]},e.id))})]}),(0,tr.jsx)("input",{ref:y,type:"file",className:"hidden",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=e=>{let t=e.target?.result;i({id:crypto.randomUUID(),shortId:`UP-${Math.floor(1e3+9e3*Math.random())}`,name:"RAW_SIGNAL",imageUrl:t,originalImageUrl:t,prompt:"Raw imported signal",agentHistory:[],params:{z_anatomy:1,z_structure:1,z_lighting:1,z_texture:1,hz_range:"Manual",neural_metrics:{loss_mse:0,ssim_index:1,tensor_vram:0,iteration_count:0,consensus_score:1},structural_fidelity:1,scale_factor:1},rating:5,timestamp:Date.now(),usageCount:0,neuralPreferenceScore:50,isFavorite:!0,vaultDomain:"X",grading:rI}),r(rI)},e.readAsDataURL(t)}}})]})},rT=()=>(0,tr.jsx)("div",{className:"flex flex-col gap-2 border-b border-white/5 pb-8",children:(0,tr.jsxs)("div",{className:"flex items-center gap-4",children:[(0,tr.jsx)("div",{className:"w-10 h-10 bg-zinc-900 rounded-xl flex items-center justify-center border border-white/10",children:(0,tr.jsx)("svg",{className:"w-5 h-5 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z",strokeWidth:2})})}),(0,tr.jsxs)("div",{children:[(0,tr.jsx)("h2",{className:"text-4xl font-black text-white uppercase tracking-tighter",children:"Terminal Config"}),(0,tr.jsx)("p",{className:"text-[10px] mono text-zinc-500 uppercase tracking-[0.5em]",children:"LCP-v13 Dynamic API Orchestration"})]})]})}),rk=({label:e,icon:t,value:n,apiKey:i,placeholder:l,onUpdate:r,isRecentUpdate:a})=>(0,tr.jsxs)("div",{className:"bg-zinc-900/40 border border-white/5 p-6 rounded-[2rem] space-y-3 transition-all hover:border-indigo-500/20 group",children:[(0,tr.jsxs)("div",{className:"flex justify-between items-center px-1",children:[(0,tr.jsxs)("label",{className:"text-[9px] font-black text-zinc-500 uppercase tracking-widest flex items-center gap-2",children:[t,e]}),a?(0,tr.jsx)("span",{className:"text-[7px] font-black text-emerald-500 uppercase animate-pulse",children:"Live Sync Active"}):n?(0,tr.jsxs)("div",{className:"flex items-center gap-1",children:[(0,tr.jsx)("span",{className:"text-[7px] font-bold text-zinc-700 uppercase",children:"Vault Secured"}),(0,tr.jsx)("svg",{className:"w-3 h-3 text-emerald-500/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M5 13l4 4L19 7",strokeWidth:3})})]}):null]}),(0,tr.jsxs)("div",{className:"relative",children:[(0,tr.jsx)("input",{type:"password",value:n,onChange:e=>r(i,e.target.value),placeholder:l,className:"w-full bg-black/40 border border-white/5 rounded-2xl px-6 py-4 text-xs text-indigo-400 focus:outline-none focus:border-indigo-500/30 transition-all font-mono placeholder:text-zinc-800"}),(0,tr.jsx)("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,tr.jsx)("svg",{className:"w-4 h-4 text-zinc-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z",strokeWidth:2})})})]})]}),rO=({settings:e,onUpdate:t,saveIndicator:n})=>(0,tr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,tr.jsx)(rk,{label:"Google / Gemini API",apiKey:"googleApiKey",value:e.googleApiKey,placeholder:"AI Studio API Key...",onUpdate:t,isRecentUpdate:"googleApiKey"===n,icon:(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full"})}),(0,tr.jsx)(rk,{label:"Pexels API",apiKey:"pexelsApiKey",value:e.pexelsApiKey,placeholder:"Pexels Key for Scout...",onUpdate:t,isRecentUpdate:"pexelsApiKey"===n,icon:(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full"})}),(0,tr.jsx)(rk,{label:"Unsplash Access Key",apiKey:"unsplashAccessKey",value:e.unsplashAccessKey,placeholder:"Unsplash Source...",onUpdate:t,isRecentUpdate:"unsplashAccessKey"===n,icon:(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-pink-500 rounded-full"})}),(0,tr.jsx)(rk,{label:"Pixabay API",apiKey:"pixabayApiKey",value:e.pixabayApiKey,placeholder:"Pixabay Logic...",onUpdate:t,isRecentUpdate:"pixabayApiKey"===n,icon:(0,tr.jsx)("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"})})]}),rR=()=>(0,tr.jsxs)("div",{className:"bg-indigo-600/5 border border-indigo-500/10 p-8 rounded-[3rem] space-y-4 relative overflow-hidden group",children:[(0,tr.jsx)("div",{className:"absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity",children:(0,tr.jsx)("svg",{className:"w-32 h-32",fill:"currentColor",viewBox:"0 0 24 24",children:(0,tr.jsx)("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})})}),(0,tr.jsxs)("h3",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-widest flex items-center gap-2",children:[(0,tr.jsx)("span",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-pulse"}),"Protocolo de PersistÃªncia Local"]}),(0,tr.jsx)("p",{className:"text-xs text-zinc-500 leading-relaxed uppercase max-w-2xl",children:"As chaves inseridas acima sÃ£o persistidas exclusivamente no **IndexedDB** do seu navegador. O sistema prioriza estas chaves para todas as operaÃ§Ãµes do Nexus Creation Hub e do Visual Scout. Se um campo estiver vazio, o Kernel utilizarÃ¡ as chaves padrÃ£o injetadas via environment variables."}),(0,tr.jsxs)("div",{className:"pt-4 flex gap-6",children:[(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-700 uppercase",children:"Encryption"}),(0,tr.jsx)("span",{className:"text-[9px] font-bold text-zinc-500 uppercase",children:"AES-256 Buffer"})]}),(0,tr.jsxs)("div",{className:"flex flex-col",children:[(0,tr.jsx)("span",{className:"text-[7px] font-black text-zinc-700 uppercase",children:"Storage Mode"}),(0,tr.jsx)("span",{className:"text-[9px] font-bold text-zinc-500 uppercase",children:"Browser Native"})]})]})]}),rP=({settings:e,setSettings:t})=>{let[n,i]=(0,ta.useState)(e),[l,r]=(0,ta.useState)(null);return(0,tr.jsx)("div",{className:"h-full flex flex-col bg-[#050505] overflow-y-auto custom-scrollbar p-6 lg:p-12 pb-32",children:(0,tr.jsxs)("div",{className:"max-w-4xl mx-auto w-full space-y-12",children:[(0,tr.jsx)(rT,{}),(0,tr.jsx)(rO,{settings:n,onUpdate:(e,l)=>{let a={...n,[e]:l};i(a),t(a),r(e),setTimeout(()=>r(null),2e3)},saveIndicator:l}),(0,tr.jsx)(rR,{}),(0,tr.jsxs)("div",{className:"pt-8 text-center border-t border-white/5",children:[(0,tr.jsx)("p",{className:"text-[8px] mono text-zinc-700 uppercase tracking-widest font-black",children:"Kernel Status: V13 Industrial - No Restart Required"}),(0,tr.jsx)("div",{className:"flex justify-center gap-4 mt-4",children:(0,tr.jsx)("div",{className:"h-1 w-12 bg-indigo-500/20 rounded-full overflow-hidden",children:(0,tr.jsx)("div",{className:"h-full bg-indigo-500 animate-pulse",style:{width:"100%"}})})})]})]})})},rM=()=>(0,tr.jsx)("div",{className:"min-h-full bg-[#050505] p-6 md:p-16 overflow-y-auto flex flex-col items-center",children:(0,tr.jsxs)("div",{className:"max-w-4xl w-full space-y-16",children:[(0,tr.jsxs)("header",{className:"space-y-4 border-b border-white/5 pb-12",children:[(0,tr.jsx)("h2",{className:"text-5xl font-black text-white uppercase tracking-tighter",children:"Venus Protocol"}),(0,tr.jsx)("p",{className:"text-indigo-400 font-black uppercase tracking-[0.4em] text-xs",children:"V2.0 Industrial Documentation"})]}),(0,tr.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[{title:"1. The Venus Pipeline",content:"Venus is a multi-agent latent space orchestrator using Gemini 3 intelligence."},{title:"2. DNA Components",content:"PEP (Identity), POP (Pose), POV (Lens), AMB (Ambient)."},{title:"3. Fusion Reactor",content:"Advanced identity migration system for consistency."}].map((e,t)=>(0,tr.jsxs)("div",{className:"space-y-4 p-8 bg-zinc-900/20 border border-white/5 rounded-[2.5rem]",children:[(0,tr.jsx)("h3",{className:"text-lg font-black text-white uppercase tracking-tight",children:e.title}),(0,tr.jsx)("p",{className:"text-zinc-500 text-xs mono",children:e.content})]},t))})]})});a=["gl_context_webgl.cc","gl_context.cc","Successfully created a WebGL context","OpenGL error checking is disabled","GL version","NGL_LOG"],s=e=>function(...t){let n=t.join(" ");a.some(e=>n.includes(e))||e.apply(console,t)},console.log=s(console.log),console.warn=s(console.warn),console.info=s(console.info);let rD={z_anatomy:1,z_structure:1,z_lighting:.5,z_texture:.5,hz_range:"Standard",structural_fidelity:1,scale_factor:1,auto_tune_active:!0,neural_metrics:{loss_mse:0,ssim_index:1,tensor_vram:6.2,iteration_count:0,consensus_score:1}},rU={fontSize:16,fontColor:"#ffffff",backgroundColor:"#000000",fontFamily:"Inter",bgOpacity:.7,textAlign:"center",paddingHMult:1.2,paddingVMult:1.2,radiusMult:.8,marginMult:2.5},rL={googleApiKey:"",pexelsApiKey:"",unsplashAccessKey:"",pixabayApiKey:""};e.s(["default",0,()=>{let[e,t]=(0,ta.useState)("creation"),[n,i]=(0,ta.useState)([]),[l,r]=(0,ta.useState)(()=>{let e=localStorage.getItem("venus_app_settings");return e?JSON.parse(e):rL}),[a,s]=(0,ta.useState)(""),[o,c]=(0,ta.useState)(null),[d,u]=(0,ta.useState)(null),[p,m]=(0,ta.useState)([]),[h,g]=(0,ta.useState)({...rD}),[f,x]=(0,ta.useState)([]),[b,y]=(0,ta.useState)(void 0),[v,_]=(0,ta.useState)(void 0),[N,w]=(0,ta.useState)(!1),[E,j]=(0,ta.useState)(!1),[S,I]=(0,ta.useState)({id:crypto.randomUUID(),title:"Venus Documentary",beats:[],audioUrl:null,fps:30,aspectRatio:"16:9",subtitleSettings:rU}),[A,C]=(0,ta.useState)(""),[T,k]=(0,ta.useState)(""),[O,R]=(0,ta.useState)(""),[P,M]=(0,ta.useState)([]),[D,U]=(0,ta.useState)(0);(0,ta.useEffect)(()=>{localStorage.setItem("venus_app_settings",JSON.stringify(l))},[l]);let L=(0,ta.useCallback)(async()=>{try{let e=await lY();i(Array.isArray(e)?e.sort((e,t)=>t.timestamp-e.timestamp):[])}catch(e){console.error("Critical Database Error:",e),i([])}finally{w(!0)}},[]);(0,ta.useEffect)(()=>{L().catch(e=>{console.error("Init Error",e),j(!0)})},[L]);let z=(0,ta.useCallback)(async e=>{try{await lJ(e),i(t=>{let n=t.findIndex(t=>t.id===e.id);if(-1!==n){let i=[...t];return i[n]=e,i}return[e,...t]})}catch(e){console.error("Failed to index node:",e)}},[]),G=(0,ta.useCallback)(async e=>{try{await lK(e),i(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Delete failed:",e)}},[]),F=(0,ta.useCallback)(()=>{s(""),c(null),u(null),m([]),g({...rD}),x([]),y(void 0),_(void 0)},[]);return E?(0,tr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center p-8 text-center",children:(0,tr.jsxs)("div",{className:"space-y-4",children:[(0,tr.jsx)("h1",{className:"text-2xl font-black text-white uppercase",children:"Venus AI Kernel Failure"}),(0,tr.jsx)("p",{className:"text-zinc-500 text-sm mono",children:"Check API configuration environment."}),(0,tr.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-indigo-600 text-white rounded-full font-bold text-xs",children:"Reload Venus"})]})}):(0,tr.jsxs)("div",{className:"min-h-screen w-full flex flex-col bg-[#050505] text-zinc-100 overflow-hidden relative selection:bg-indigo-500 selection:text-white",children:[(0,tr.jsx)(ts,{activeTab:e,setActiveTab:t}),(0,tr.jsx)(tc,{activeTab:e,setActiveTab:t,vaultCount:n.length}),(0,tr.jsx)("main",{className:"flex-1 overflow-auto bg-[#020202] relative custom-scrollbar",children:N?(0,tr.jsx)(ta.Suspense,{fallback:(0,tr.jsx)("div",{className:"p-8 text-center text-zinc-500 text-[10px] mono animate-pulse",children:"LATENT_BUFFER_LOADING..."}),children:(0,tr.jsxs)("div",{className:"pb-28 lg:pb-0 h-full",children:["creation"===e&&(0,tr.jsx)(rv,{onResult:(e,n,i,l,r,a)=>{c(e),g(n),s(i),x(l),y(r),_(a),u(null),t("workspace")},params:h,setParams:g,onReset:F,vault:n,settings:l}),"workspace"===e&&(0,tr.jsx)(lH,{onSave:z,vault:n,prompt:a,setPrompt:s,currentImage:o,setCurrentImage:c,originalSource:d,setOriginalSource:u,logs:p,setLogs:m,params:h,setParams:g,onReloadApp:F,grading:b,visualAnchor:v,settings:l}),"grading"===e&&(0,tr.jsx)(rC,{vault:n,onSave:z}),"cinema"===e&&(0,tr.jsx)(rp,{vault:n,onSave:z,currentSourceImage:o,project:S,setProject:I,script:A,setScript:C,title:T,setTitle:k,credits:O,setCredits:R,logs:P,setLogs:M,activeBeatIndex:D,setActiveBeatIndex:U,onReset:()=>{},settings:l}),"fusion"===e&&(0,tr.jsx)(rl,{vault:n,onResult:(e,n,i)=>{c(e),g(n),m(i),y(void 0),_(void 0),t("workspace")},settings:l}),"manual"===e&&(0,tr.jsx)(l7,{onSave:z,settings:l}),"vault"===e&&(0,tr.jsx)(l2,{items:n,onDelete:G,onClearAll:()=>{},onRefresh:L,onReload:e=>{c(e.imageUrl),u(e.originalImageUrl),g(e.params),s(e.prompt),m(e.agentHistory||[]),y(e.grading),_(void 0),t("workspace")}}),"docs"===e&&(0,tr.jsx)(rM,{}),"settings"===e&&(0,tr.jsx)(rP,{settings:l,setSettings:r})]})}):(0,tr.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,tr.jsxs)("div",{className:"relative",children:[(0,tr.jsx)("div",{className:"w-16 h-16 border-4 border-indigo-600/20 rounded-full"}),(0,tr.jsx)("div",{className:"absolute inset-0 w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"})]})})})]})}],31713)}]);