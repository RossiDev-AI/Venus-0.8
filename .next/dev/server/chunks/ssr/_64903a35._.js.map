{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/user/Venus-0.8/geminiService.ts"],"sourcesContent":["\nimport { GoogleGenAI, Type, GenerateContentResponse } from \"@google/genai\";\nimport { TimelineBeat, VaultItem, CategorizedDNA, FusionManifest, LatentParams, AgentStatus, AgentType, AgentAuthority, ScoutData, AppSettings } from \"./types\";\n\nconst getAI = (settings?: AppSettings) => {\n  const key = settings?.googleApiKey || process.env.API_KEY as string;\n  if (!key) console.warn(\"CRITICAL: API Key missing in GeminiService\");\n  return new GoogleGenAI({ apiKey: key });\n};\n\n// MAX PERMISSIVE SAFETY SETTINGS\nconst SAFETY_SETTINGS = [\n  { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_ONLY_HIGH' },\n  { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_ONLY_HIGH' },\n  { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_ONLY_HIGH' },\n  { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_ONLY_HIGH' },\n  { category: 'HARM_CATEGORY_CIVIC_INTEGRITY', threshold: 'BLOCK_ONLY_HIGH' }\n] as any;\n\nasync function executeWithRetry<T>(fn: () => Promise<T>, retries = 2, delay = 2000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error: any) {\n    const errString = JSON.stringify(error, null, 2);\n    console.warn(`[Gemini Retry Log] Attempt failed. Retries left: ${retries}. Error:`, errString.substring(0, 300));\n\n    if (errString.includes(\"SAFETY\") || errString.includes(\"BLOCKED\")) {\n       console.error(\" [CRITICAL] SAFETY BLOCK DETECTED. Retries may be futile but proceeding if quota allows.\");\n    }\n\n    if (retries > 0) {\n      await new Promise(resolve => setTimeout(resolve, delay));\n      return executeWithRetry(fn, retries - 1, delay * 2);\n    }\n    throw error;\n  }\n}\n\n// --- UTILITY: Match Dimensions (Center Crop) ---\nasync function matchImageDimensions(sourceUrl: string, targetWidth: number, targetHeight: number): Promise<string> {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = \"anonymous\";\n        img.src = sourceUrl;\n        img.onload = () => {\n            const canvas = document.createElement('canvas');\n            canvas.width = targetWidth;\n            canvas.height = targetHeight;\n            const ctx = canvas.getContext('2d');\n            if (!ctx) return resolve(sourceUrl);\n\n            // Draw background black to avoid alpha issues\n            ctx.fillStyle = \"black\";\n            ctx.fillRect(0,0, targetWidth, targetHeight);\n\n            const scale = Math.max(targetWidth / img.width, targetHeight / img.height);\n            const x = (targetWidth / 2) - (img.width / 2) * scale;\n            const y = (targetHeight / 2) - (img.height / 2) * scale;\n            \n            ctx.drawImage(img, x, y, img.width * scale, img.height * scale);\n            resolve(canvas.toDataURL('image/png'));\n        };\n        img.onerror = () => {\n            console.warn(\"Image load failed for dimension matching, using original.\");\n            resolve(sourceUrl);\n        }\n    });\n}\n\nfunction getNearestAspectRatio(width: number, height: number): string {\n  const ratio = width / height;\n  const ratios: Record<string, number> = {\n    \"1:1\": 1,\n    \"3:4\": 3/4,\n    \"4:3\": 4/3,\n    \"9:16\": 9/16,\n    \"16:9\": 16/9\n  };\n  \n  return Object.keys(ratios).reduce((a, b) => \n    Math.abs(ratios[a] - ratio) < Math.abs(ratios[b] - ratio) ? a : b\n  );\n}\n\n// ... (Existing Scout/Script/DNA functions remain unchanged) ...\nexport async function scoutMediaForBeat(query: string, fullCaption: string, settings?: AppSettings, targetProvider?: 'PEXELS' | 'UNSPLASH' | 'PIXABAY' | 'GEMINI') {\n  const ai = getAI(settings);\n  const intentResponse: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({\n    model: \"gemini-3-flash-preview\",\n    contents: `TEXT: \"${fullCaption}\". TASK: Literal search string for visuals (English, 3-5 words).`,\n  }));\n  const literalQuery = intentResponse.text?.trim() || query;\n  return { assetUrl: null, source: \"Web Search\", title: literalQuery };\n}\n\nexport async function scriptToTimeline(text: string, wordCount: number, fidelityMode: boolean = false, settings?: AppSettings): Promise<TimelineBeat[]> {\n  const ai = getAI(settings);\n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({\n    model: \"gemini-3-flash-preview\",\n    contents: `Transform into cinematic beats: \"${text}\"`,\n    config: {\n      systemInstruction: `Professional Director: Output JSON array. Fields: caption, scoutQuery, duration.`,\n      responseMimeType: \"application/json\",\n      responseSchema: {\n        type: Type.ARRAY,\n        items: {\n          type: Type.OBJECT,\n          properties: { caption: { type: Type.STRING }, scoutQuery: { type: Type.STRING }, duration: { type: Type.NUMBER } },\n          required: [\"caption\", \"scoutQuery\", \"duration\"]\n        }\n      }\n    }\n  }));\n  const raw = JSON.parse(response.text || \"[]\");\n  return raw.map((b: any) => ({ id: crypto.randomUUID(), timestamp: Date.now(), duration: b.duration || 6, assetUrl: null, caption: b.caption, assetType: 'IMAGE', scoutQuery: b.scoutQuery }));\n}\n\nexport async function generateImageForBeat(caption: string, scoutQuery: string, settings?: AppSettings, baseImage?: string): Promise<string> {\n  const ai = getAI(settings);\n  const contents: any[] = [];\n  if (baseImage) {\n    contents.push({ inlineData: { mimeType: \"image/png\", data: baseImage.split(',')[1] } });\n  }\n  contents.push({ text: `Cinematic frame: ${scoutQuery}. ${caption}. Photorealistic, 8k. ${baseImage ? 'Maintain style/identity of ref.' : ''}` });\n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({\n    model: 'gemini-2.5-flash-image',\n    contents: { parts: contents },\n    config: { \n      imageConfig: { aspectRatio: \"16:9\" },\n      safetySettings: SAFETY_SETTINGS\n    }\n  }));\n  let imageUrl = \"\";\n  if (response.candidates?.[0]?.content?.parts) {\n    for (const part of response.candidates[0].content.parts) { if (part.inlineData) imageUrl = `data:image/png;base64,${part.inlineData.data}`; }\n  }\n  return imageUrl;\n}\n\nexport async function extractDeepDNA(imageUrl: string, settings?: AppSettings): Promise<CategorizedDNA> {\n  const ai = getAI(settings);\n  const base64 = imageUrl.includes(',') ? imageUrl.split(',')[1] : imageUrl;\n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({\n    model: \"gemini-3-flash-preview\",\n    contents: {\n      parts: [\n        { inlineData: { mimeType: \"image/png\", data: base64 } },\n        { text: `JSON forensic DNA biopsy in English: human_description, character_details, environment_context, pose_attribute, camera_specs, lighting_setup, technical_tags.` }\n      ]\n    },\n    config: { responseMimeType: \"application/json\" }\n  }));\n  const parsed = JSON.parse(response.text || \"{}\");\n\n  const flatten = (val: any): string => {\n    if (!val) return '';\n    if (typeof val === 'string') return val;\n    if (typeof val === 'object') {\n      return Object.values(val).join(', ');\n    }\n    return String(val);\n  };\n\n  const sanitized = {\n    ...parsed,\n    character_details: flatten(parsed.character_details),\n    environment_context: flatten(parsed.environment_context),\n    pose_attribute: flatten(parsed.pose_attribute),\n    camera_specs: flatten(parsed.camera_specs),\n    lighting_setup: flatten(parsed.lighting_setup),\n    human_description: flatten(parsed.human_description),\n    technical_tags: Array.isArray(parsed.technical_tags) ? parsed.technical_tags.map((t: any) => flatten(t)) : []\n  };\n\n  return { ...sanitized, character: sanitized.character_details, environment: sanitized.environment_context, pose: sanitized.pose_attribute };\n}\n\n// === MAIN SYNTHESIS FUNCTION (ROBUST 2-PASS REFINEMENT) ===\nexport async function executeGroundedSynth(\n  prompt: string, \n  weights: any, \n  vault: VaultItem[], \n  authority: AgentAuthority, \n  settings?: AppSettings, \n  baseImage?: string, \n  poseImage?: string, \n  poseLandmarks?: any[],\n  poseMaskImage?: string, // The Hyper-Rig (Skeleton)\n  poseText?: string,\n  targetRatio?: string\n): Promise<any> {\n  const ai = getAI(settings);\n  \n  // --- PIPELINE WITH POSE RIG ---\n  if (baseImage && poseMaskImage) {\n      console.log(\"[Gemini Service] Initializing Iterative Refinement Pipeline (V13.0 - NO CACHE)...\");\n      \n      const activePrompt = prompt.trim() ? prompt : \"Cinematic scene.\";\n      const logs: AgentStatus[] = [];\n\n      // 1. DYNAMIC ASPECT RATIO DETECTION\n      let dynamicAspectRatio = \"16:9\";\n      if (targetRatio) {\n          dynamicAspectRatio = targetRatio;\n      } else {\n          const targetDim = await new Promise<{w: number, h: number}>(resolve => {\n              const img = new Image(); \n              img.onload = () => resolve({w: img.width, h: img.height}); \n              img.onerror = () => resolve({w: 1024, h: 1024});\n              img.src = poseMaskImage;\n          });\n          dynamicAspectRatio = getNearestAspectRatio(targetDim.w, targetDim.h);\n      }\n      \n      // Prep Base64s\n      let matchW = 1024, matchH = 576; // Default 16:9\n      if (dynamicAspectRatio === '9:16') { matchW = 576; matchH = 1024; }\n      else if (dynamicAspectRatio === '1:1') { matchW = 1024; matchH = 1024; }\n      else if (dynamicAspectRatio === '4:3') { matchW = 1024; matchH = 768; }\n      \n      const poseBase64 = poseMaskImage.split(',')[1];\n      let matchedBaseImage = await matchImageDimensions(baseImage, matchW, matchH);\n      let identityBase64 = matchedBaseImage.split(',')[1];\n\n      // Generate Unique Entropy for Cache Busting\n      const sessionEntropy = Date.now().toString(36) + Math.random().toString(36).substring(2);\n\n      // --- STAGE 1: DNA ANALYSIS (Internal) ---\n      logs.push({ type: 'Identity Guard', status: 'processing', message: 'Stage 1/4: Analyzing Biological & Structural Matrix...', timestamp: Date.now(), department: 'Casting' });\n      \n      // We assume identity extraction is handled by the model context in the next step to save latency,\n      // or we could do a quick text extraction if needed. For speed/consistency, we embed strict instructions.\n      \n      logs.push({ type: 'Rigging Supervisor', status: 'completed', message: 'Vectors Locked. Initiating Structural Draft.', timestamp: Date.now(), department: 'Structure' });\n\n      // --- STAGE 2: DRAFT ANCHOR (Identity + Skeleton -> Draft Image) ---\n      // Goal: Get the pose right. If texture is bad (mannequin), we fix in stage 3.\n      logs.push({ type: 'Puppeteer Agent', status: 'processing', message: `Stage 2/4: Generating Structural Draft (Session ${sessionEntropy})...`, timestamp: Date.now(), department: 'Structure' });\n\n      const draftPrompt = `\n      [SYSTEM: FRESH RENDER SESSION ${sessionEntropy}_DRAFT]\n      TASK: Generate an image based on the SKELETON POSE and CHARACTER IDENTITY.\n      \n      INPUTS:\n      1. IMAGE 1 (SKELETON): Strict pose guide. IGNORE the black background and colored lines visual style.\n      2. IMAGE 2 (CHARACTER): The person to render.\n      \n      INSTRUCTION:\n      - Render the character from Image 2 in the exact pose of Image 1.\n      - SCENE: ${activePrompt}\n      - IMPORTANT: Do not make it look like a 3D render. Attempt photorealism.\n      - FORCE: Do not use cached latent patterns. Calculate geometry from scratch.\n      `;\n\n      const draftResponse: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({\n        model: 'gemini-2.5-flash-image',\n        contents: { parts: [\n            { inlineData: { mimeType: \"image/png\", data: poseBase64 } },\n            { inlineData: { mimeType: \"image/png\", data: identityBase64 } },\n            { text: draftPrompt }\n        ] },\n        config: { \n            imageConfig: { aspectRatio: dynamicAspectRatio }, \n            safetySettings: SAFETY_SETTINGS,\n            temperature: 0.45 // Slightly increased to ensure fresh noise\n        }\n      }));\n\n      let draftBase64 = \"\";\n      if (draftResponse.candidates?.[0]?.content?.parts) {\n          for (const part of draftResponse.candidates[0].content.parts) { \n              if (part.inlineData && part.inlineData.data) { draftBase64 = part.inlineData.data; }\n          }\n      }\n\n      if (!draftBase64) throw new Error(\"Stage 2 Failed: Draft Generation Error.\");\n      logs.push({ type: 'Puppeteer Agent', status: 'completed', message: 'Draft Anchor Created.', timestamp: Date.now(), department: 'Structure' });\n\n      // --- STAGE 3: RECURSIVE REFINEMENT (Draft + Identity -> Final Polish) ---\n      // Goal: Fix the \"Mannequin/Clay\" look. \n      // Input 1: The Draft (Perfect Pose, maybe bad texture)\n      // Input 2: The Identity (Perfect Texture)\n      logs.push({ type: 'Neural Alchemist', status: 'processing', message: 'Stage 3/4: Recursive Refinement (Memory Flush & Polish)...', timestamp: Date.now(), department: 'Advanced' });\n\n      const refinePrompt = `\n      [SYSTEM: MEMORY FLUSH REQUIRED - ID ${sessionEntropy}_POLISH]\n      TASK: RE-TEXTURE and FIX ANATOMY.\n      \n      INPUTS:\n      1. IMAGE 1 (DRAFT): Composition is correct, but texture might be plastic/fake/clay.\n      2. IMAGE 2 (REFERENCE): Contains the REAL skin texture, lighting, and fabric details.\n\n      MANDATORY PROTOCOLS:\n      - **FLUSH CACHE**: Do not use internal memory from previous runs.\n      - **ANTI-ALIASING**: Remove \"plastic\" or \"3D render\" look.\n      - Transfer HYPER-REALISTIC SKIN TEXTURE from Image 2 to Image 1.\n      - If limbs in Image 1 look awkward (bad anatomy), FIX THEM to look natural.\n      - SCENE: ${activePrompt}\n      `;\n\n      const finalResponse: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({\n        model: 'gemini-2.5-flash-image',\n        contents: { parts: [\n            { inlineData: { mimeType: \"image/png\", data: draftBase64 } }, // The Draft Anchor\n            { inlineData: { mimeType: \"image/png\", data: identityBase64 } }, // The Texture Source\n            { text: refinePrompt }\n        ] },\n        config: { \n            imageConfig: { aspectRatio: dynamicAspectRatio }, \n            safetySettings: SAFETY_SETTINGS,\n            temperature: 0.6 // Higher temperature to force model to \"dream\" new texture details vs using cache\n        }\n      }));\n\n      let finalUrl = \"\";\n      if (finalResponse.candidates?.[0]?.content?.parts) {\n          for (const part of finalResponse.candidates[0].content.parts) { \n              if (part.inlineData) { finalUrl = `data:image/png;base64,${part.inlineData.data}`; }\n          }\n      }\n\n      if (!finalUrl) throw new Error(\"Stage 3 Failed: Refinement Error.\");\n\n      // --- STAGE 4: MEMORY CLEANUP & FINALIZATION ---\n      // Explicitly clear huge base64 strings to help Garbage Collector and visually confirm \"Cache Purged\"\n      draftBase64 = \"\";\n      identityBase64 = \"\";\n      matchedBaseImage = \"\";\n\n      logs.push({ type: 'Director', status: 'completed', message: 'Pipeline Complete. VRAM Cache Purged.', timestamp: Date.now(), department: 'Direction' });\n\n      return {\n        imageUrl: finalUrl,\n        logs: logs,\n        enhancedPrompt: \"RECURSIVE_POLISH_V13: \" + activePrompt,\n        params: { neural_metrics: { consensus_score: 1.0, iteration_count: 2, tensor_vram: 0, projection_coherence: 1.0, loss_mse: 0, ssim_index: 1 } }\n      };\n  }\n\n  // --- STANDARD GENERATION (No Pose) ---\n  const deliberationContents: any[] = [];\n  if (baseImage) deliberationContents.push({ inlineData: { mimeType: \"image/png\", data: baseImage.split(',')[1] } });\n  \n  const planning: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({\n    model: \"gemini-3-flash-preview\",\n    contents: deliberationContents.length > 0 \n      ? { parts: deliberationContents.concat([{ text: `Task: Character Re-Targeting Optimization. User intent: ${prompt}.` }]) }\n      : { text: `Task: Optimize intent for image synth. Prompt: ${prompt}` },\n    config: {\n      thinkingConfig: { thinkingBudget: 1024 }, \n      responseMimeType: \"application/json\",\n      responseSchema: { \n        type: Type.OBJECT, \n        properties: { \n          enhancedPrompt: { type: Type.STRING }, \n          logs: { \n            type: Type.ARRAY, \n            items: { \n              type: Type.OBJECT, \n              properties: { \n                type: { type: Type.STRING }, \n                status: { type: Type.STRING }, \n                message: { type: Type.STRING } \n              } \n            } \n          } \n        } \n      }\n    }\n  }));\n  const plan = JSON.parse(planning.text || \"{}\");\n\n  const imageUrl = await generateImageForBeat(plan.enhancedPrompt || prompt, prompt, settings, baseImage);\n\n  if (!imageUrl) { throw new Error(\"Standard Synthesis produced no visual output.\"); }\n\n  return {\n    imageUrl,\n    logs: (plan.logs || []).map((l: any) => ({ type: l.type as AgentType, status: l.status as any, message: l.message, timestamp: Date.now() })),\n    enhancedPrompt: plan.enhancedPrompt || prompt,\n    params: { neural_metrics: { consensus_score: 0.98, iteration_count: 64, tensor_vram: 7.8, projection_coherence: 0.96, loss_mse: 0, ssim_index: 1 } }\n  };\n}\n\n// ... (Rest of exports unchanged) ...\nexport async function optimizeVisualPrompt(prompt: string, settings?: AppSettings, currentImage?: string): Promise<string> {\n  const ai = getAI(settings);\n  const parts: any[] = [];\n  if (currentImage) parts.push({ inlineData: { mimeType: \"image/png\", data: currentImage.split(',')[1] } });\n  \n  // FIX: LOBOTOMY PROTOCOL for the Prompt Agent. \n  // Forces it to act as a dumb backend service, returning ONLY the final string.\n  parts.push({ text: `\n    ACT AS A BACKEND API. \n    TASK: Rewrite the following user request into ONE SINGLE, highly detailed, technical image generation prompt (English).\n    INPUT: \"${prompt}\"\n    RULES:\n    1. Output ONLY the raw prompt string. \n    2. NO \"Option 1\", NO \"Here is the prompt\", NO conversational text.\n    3. NO Markdown, NO bolding, NO bullets.\n    4. Combine scene, lighting, style, and camera details into one dense paragraph.\n  ` });\n  \n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({ model: \"gemini-3-flash-preview\", contents: { parts } }));\n  \n  // Extra sanitization just in case\n  let cleanText = response.text?.trim() || prompt;\n  cleanText = cleanText.replace(/^Here is.*?:\\s*/i, '').replace(/^Option 1:?/i, '').replace(/\\*\\*/g, '');\n  \n  return cleanText;\n}\n\nexport async function matchVaultForBeat(caption: string, vault: VaultItem[], settings?: AppSettings) {\n  if (vault.length === 0) return null;\n  const ai = getAI(settings);\n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({\n    model: \"gemini-3-flash-preview\",\n    contents: `Identify best Node ID from vault for: \"${caption}\". VAULT: ${JSON.stringify(vault.map(v=>({id:v.shortId, p:v.prompt})))}`,\n    config: { responseMimeType: \"application/json\" }\n  }));\n  const winnerId = JSON.parse(response.text || \"{}\").winner_id;\n  return vault.find(v => v.shortId === winnerId) || null;\n}\n\nexport async function getGlobalVisualPrompt(text: string, settings?: AppSettings) {\n  const ai = getAI(settings);\n  const resp: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({ model: \"gemini-3-flash-preview\", contents: `Atmosphere description for cover (8 words): \"${text}\"` }));\n  return resp.text?.trim() || \"Cinematic atmosphere\";\n}\n\nexport async function executeFusion(manifest: FusionManifest, vault: VaultItem[], settings?: AppSettings) {\n  const ai = getAI(settings);\n  const pep = vault.find(v => v.shortId === manifest.pep_id);\n  const pop = vault.find(v => v.shortId === manifest.pop_id);\n  const parts: any[] = [];\n  if (pep) parts.push({ inlineData: { mimeType: \"image/png\", data: pep.imageUrl.split(',')[1] } });\n  if (pop) parts.push({ inlineData: { mimeType: \"image/png\", data: pop.imageUrl.split(',')[1] } });\n  parts.push({ text: `Fuse PEP identity with POP pose. Intent: ${manifest.fusionIntent}` });\n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({ \n      model: 'gemini-2.5-flash-image', \n      contents: { parts }, \n      config: { \n          imageConfig: { aspectRatio: \"16:9\" },\n          safetySettings: SAFETY_SETTINGS\n      } \n  }));\n  let imageUrl = \"\";\n  if (response.candidates?.[0]?.content?.parts) {\n    for (const part of response.candidates[0].content.parts) { if (part.inlineData) imageUrl = `data:image/png;base64,${part.inlineData.data}`; }\n  }\n  return { imageUrl, logs: [{ type: 'Neural Alchemist' as AgentType, status: 'completed' as const, message: 'Identity Migration stabilized.', timestamp: Date.now() }], params: { neural_metrics: { consensus_score: 0.95, iteration_count: 50, tensor_vram: 8.2, loss_mse: 0.02, ssim_index: 0.98 } } };\n}\n\nexport async function autoOptimizeFusion(intent: string, manifest: FusionManifest, vault: VaultItem[], settings?: AppSettings) {\n  const ai = getAI(settings);\n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({ model: \"gemini-3-flash-preview\", contents: `Select best Node IDs for: \"${intent}\". VAULT: ${JSON.stringify(vault.map(v=>({id:v.shortId, dna:v.dna})))}`, config: { responseMimeType: \"application/json\" } }));\n  return { manifest: { ...manifest, ...JSON.parse(response.text || \"{}\") } };\n}\n\nexport async function visualAnalysisJudge(imageUrl: string, intent: string, refImageUrl?: string, settings?: AppSettings) {\n  const ai = getAI(settings);\n  const parts: any[] = [{ inlineData: { mimeType: \"image/png\", data: imageUrl.split(',')[1] } }];\n  if (refImageUrl) parts.push({ inlineData: { mimeType: \"image/png\", data: refImageUrl.split(',')[1] } });\n  parts.push({ text: `Audit visual quality. Intent: ${intent}` });\n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({ model: \"gemini-3-flash-preview\", contents: { parts }, config: { responseMimeType: \"application/json\" } }));\n  return JSON.parse(response.text || '{\"score\": 0.8}');\n}\n\nexport async function refinePromptDNA(intent: string, settings?: AppSettings) {\n  const ai = getAI(settings);\n  const response: GenerateContentResponse = await executeWithRetry(() => ai.models.generateContent({ model: \"gemini-3-flash-preview\", contents: `Refine intent: \"${intent}\"` }));\n  return { refined: response.text?.trim() || intent, logs: [] };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 732, "column": 0}, "map": {"version":3,"sources":["file:///home/user/Venus-0.8/dbService.ts"],"sourcesContent":["\nimport { VaultItem, DNAToken, VaultDomain } from './types';\n\nconst DB_NAME = 'LatentCinemaDB';\nconst STORE_NAME = 'vault_nodes';\nconst TOKEN_STORE_NAME = 'dna_tokens';\nconst DB_VERSION = 2; // Incrementado para suportar o novo store\n\nexport const initDB = (): Promise<IDBDatabase> => {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n    request.onupgradeneeded = (event: any) => {\n      const db = request.result;\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\n        db.createObjectStore(STORE_NAME, { keyPath: 'id' });\n      }\n      if (!db.objectStoreNames.contains(TOKEN_STORE_NAME)) {\n        db.createObjectStore(TOKEN_STORE_NAME, { keyPath: 'id' });\n      }\n    };\n    request.onsuccess = () => resolve(request.result);\n    request.onerror = () => reject(request.error);\n  });\n};\n\nexport const saveNode = async (item: VaultItem): Promise<void> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const nodeToSave = {\n      ...item,\n      usageCount: item.usageCount ?? 0,\n      neuralPreferenceScore: item.neuralPreferenceScore ?? 50,\n      isFavorite: item.isFavorite ?? false,\n      vaultDomain: item.vaultDomain ?? 'X'\n    };\n    tx.objectStore(STORE_NAME).put(nodeToSave);\n    tx.oncomplete = () => resolve();\n    tx.onerror = () => reject(tx.error);\n  });\n};\n\n// --- NOVAS FUNÇÕES PARA NEURAL DNA TOKENS ---\n\nexport const saveDNAToken = async (token: DNAToken): Promise<void> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(TOKEN_STORE_NAME, 'readwrite');\n    tx.objectStore(TOKEN_STORE_NAME).put(token);\n    tx.oncomplete = () => resolve();\n    tx.onerror = () => reject(tx.error);\n  });\n};\n\nexport const getAllDNATokens = async (): Promise<DNAToken[]> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(TOKEN_STORE_NAME, 'readonly');\n    const request = tx.objectStore(TOKEN_STORE_NAME).getAll();\n    request.onsuccess = () => resolve(request.result || []);\n    request.onerror = () => reject(request.error);\n  });\n};\n\nexport const getDNATokensByDomain = async (domain: VaultDomain): Promise<DNAToken[]> => {\n  const tokens = await getAllDNATokens();\n  return tokens.filter(t => t.domain === domain);\n};\n\nexport const deleteDNAToken = async (id: string): Promise<void> => {\n  const db = await initDB();\n  const tx = db.transaction(TOKEN_STORE_NAME, 'readwrite');\n  tx.objectStore(TOKEN_STORE_NAME).delete(id);\n};\n\n// --- FIM DAS NOVAS FUNÇÕES ---\n\nexport const toggleFavoriteNode = async (id: string): Promise<boolean> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.get(id);\n    request.onsuccess = () => {\n      const item = request.result as VaultItem;\n      if (item) {\n        item.isFavorite = !item.isFavorite;\n        // Favoritos ganham boost no score\n        item.neuralPreferenceScore = item.isFavorite ? Math.min(100, item.neuralPreferenceScore + 20) : item.neuralPreferenceScore;\n        store.put(item);\n        resolve(item.isFavorite);\n      } else {\n        reject(\"Node not found\");\n      }\n    };\n  });\n};\n\nexport const incrementNodeUsage = async (shortId: string): Promise<void> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.getAll();\n    request.onsuccess = () => {\n      const items = request.result as VaultItem[];\n      const item = items.find(i => i.shortId === shortId);\n      if (item) {\n        item.usageCount = (item.usageCount ?? 0) + 1;\n        item.neuralPreferenceScore = Math.min(100, (item.usageCount * 5) + (item.rating * 10) + (item.isFavorite ? 20 : 0));\n        store.put(item);\n      }\n      resolve();\n    };\n  });\n};\n\nexport const getAllNodes = async (): Promise<VaultItem[]> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const request = tx.objectStore(STORE_NAME).getAll();\n    request.onsuccess = () => resolve(request.result || []);\n    request.onerror = () => reject(request.error);\n  });\n};\n\nexport const deleteNode = async (id: string): Promise<void> => {\n  const db = await initDB();\n  const tx = db.transaction(STORE_NAME, 'readwrite');\n  tx.objectStore(STORE_NAME).delete(id);\n};\n\nexport const bulkSaveNodes = async (items: VaultItem[]): Promise<void> => {\n  const db = await initDB();\n  const tx = db.transaction(STORE_NAME, 'readwrite');\n  const store = tx.objectStore(STORE_NAME);\n  items.forEach(item => store.put(item));\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 885, "column": 0}, "map": {"version":3,"sources":["file:///home/user/Venus-0.8/gradingProcessor.ts"],"sourcesContent":["\nimport { LatentGrading } from './types';\n\nexport const applyGrading = async (\n  canvas: HTMLCanvasElement, \n  image: HTMLImageElement, \n  grading: LatentGrading\n): Promise<void> => {\n  const ctx = canvas.getContext('2d', { willReadFrequently: true });\n  if (!ctx) return;\n\n  const w = canvas.width;\n  const h = canvas.height;\n  \n  ctx.clearRect(0, 0, w, h);\n  ctx.save();\n\n  const cx = w / 2;\n  const cy = h / 2;\n  \n  const lensCenterX = (grading.lens_center_x || 0) * (w * 0.1);\n  const lensCenterY = (grading.lens_center_y || 0) * (h * 0.1);\n  \n  ctx.translate(cx + lensCenterX + (grading.pan_x || 0) * w, cy + lensCenterY + (grading.pan_y || 0) * h);\n  \n  if (grading.rotate) ctx.rotate(grading.rotate * Math.PI / 180);\n  \n  const scaleX = (grading.anamorphic_squeeze || 1) * (1 + (grading.crop_zoom || 0));\n  const stretchY = (grading as any).geometry_y || 1; \n  const scaleY = stretchY * (1 + (grading.crop_zoom || 0));\n  \n  ctx.scale(scaleX, scaleY);\n  \n  const dist = grading.lens_distortion || 0;\n  const zoom = 1 + Math.abs(dist * 0.3); \n  ctx.scale(zoom, zoom);\n  \n  const faceWarp = grading.face_warp || 0; \n  if (faceWarp !== 0) {\n      ctx.scale(1 - (faceWarp * 0.25), 1); \n  }\n\n  ctx.translate(-cx, -cy);\n\n  // --- PERSPECTIVE TILT ENGINE (Fake 3D Slicing) ---\n  const px = grading.perspective_x || 0;\n  const py = grading.perspective_y || 0;\n\n  if (Math.abs(px) < 0.001 && Math.abs(py) < 0.001) {\n      ctx.drawImage(image, 0, 0);\n  } else {\n      let source: CanvasImageSource = image;\n      let sourceW = image.width;\n      let sourceH = image.height;\n\n      // Apply TILT Y (Vertical Perspective) - Affects Width per Row\n      if (Math.abs(py) > 0.001) {\n          const tempCanvas = document.createElement('canvas');\n          tempCanvas.width = sourceW;\n          tempCanvas.height = sourceH;\n          const tCtx = tempCanvas.getContext('2d');\n          if (tCtx) {\n              // Cap deformation at 0.8 (80%) to prevent full collapse/inversion\n              const strength = Math.min(0.8, Math.abs(py)); \n              \n              for (let y = 0; y < sourceH; y++) {\n                  const progress = y / sourceH;\n                  let scale = 1;\n                  \n                  // py > 0: Top Wide, Bottom Narrow. py < 0: Top Narrow, Bottom Wide.\n                  if (py > 0) scale = 1 - (progress * strength);\n                  else scale = 1 - ((1 - progress) * strength);\n                  \n                  const rowW = sourceW * scale;\n                  const xOff = (sourceW - rowW) / 2;\n                  \n                  // Draw 1px high slice\n                  tCtx.drawImage(image, 0, y, sourceW, 1, xOff, y, rowW, 1);\n              }\n              source = tempCanvas;\n          }\n      }\n\n      // Apply TILT X (Horizontal Perspective) - Affects Height per Column\n      if (Math.abs(px) > 0.001) {\n           const strength = Math.min(0.8, Math.abs(px));\n           \n           for (let x = 0; x < sourceW; x++) {\n               const progress = x / sourceW;\n               let scale = 1;\n               \n               // px > 0: Left Wide, Right Narrow. px < 0: Left Narrow, Right Wide.\n               if (px > 0) scale = 1 - (progress * strength);\n               else scale = 1 - ((1 - progress) * strength);\n               \n               const colH = sourceH * scale;\n               const yOff = (sourceH - colH) / 2;\n               \n               // Draw 1px wide slice from source (which might be Y-tilted already)\n               ctx.drawImage(source, x, 0, 1, sourceH, x, yOff, 1, colH);\n           }\n      } else {\n          // If only Y was applied, draw the result of Y\n          ctx.drawImage(source, 0, 0);\n      }\n  }\n\n  ctx.restore();\n\n  const imageData = ctx.getImageData(0, 0, w, h);\n  const data = imageData.data;\n  \n  const needsSpatial = grading.sharpness > 0 || grading.structure > 0 || \n                       grading.clarity !== 0 || grading.skin_smooth > 0 || grading.denoise > 0 ||\n                       grading.chromatic_aberration > 0;\n                       \n  const sourceData = needsSpatial ? new Uint8ClampedArray(data) : data;\n\n  // Global adjustments params\n  const tempK = (grading.temperature || 0) * 0.8;\n  const tintM = (grading.tint || 0) * 0.8;\n  const vibrance = grading.vibrance || 1;\n  const saturation = grading.saturation || 1;\n  const brightness = grading.brightness || 1;\n  const contrast = grading.contrast || 1;\n  const pivot = grading.pivot || 0.5;\n  const exposure = Math.pow(2, grading.exposure || 0);\n  const dehazeVal = grading.dehaze || 0;\n  \n  // Mixer Matrix\n  const mRR = grading.mix_red_red ?? 1, mRG = grading.mix_red_green ?? 0, mRB = grading.mix_red_blue ?? 0;\n  const mGR = grading.mix_green_red ?? 0, mGG = grading.mix_green_green ?? 1, mGB = grading.mix_green_blue ?? 0;\n  const mBR = grading.mix_blue_red ?? 0, mBG = grading.mix_blue_green ?? 0, mBB = grading.mix_blue_blue ?? 1;\n\n  // LGG Globals\n  const globalLift = grading.lift || 0;\n  const globalGamma = grading.gamma || 1;\n  const globalGain = grading.gain || 1;\n  const globalOffset = grading.offset || 0;\n\n  const hslToRgb = (h: number, s: number, l: number) => {\n     const c = (1 - Math.abs(2 * l - 1)) * s;\n     const x = c * (1 - Math.abs((h / 60) % 2 - 1));\n     const m = l - c / 2;\n     let r=0,g=0,b=0;\n     if(0<=h&&h<60){r=c;g=x;b=0}else if(60<=h&&h<120){r=x;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x}\n     else if(180<=h&&h<240){r=0;g=x;b=c}else if(240<=h&&h<300){r=x;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x}\n     return [(r+m)*255, (g+m)*255, (b+m)*255];\n  };\n  const shadowRGB = hslToRgb(grading.split_shadow_hue || 210, 1, 0.5);\n  const highlightRGB = hslToRgb(grading.split_highlight_hue || 30, 1, 0.5);\n  const midRGB = hslToRgb(grading.split_mid_hue || 0, 1, 0.5);\n\n  const grainAmt = (grading.grain || 0) * 60; \n  const sharpenAmt = (grading.sharpness || 0) * 3;\n  const clarityAmt = (grading.clarity || 0);\n  const chromaAmt = (grading.chromatic_aberration || 0) * 3.5;\n\n  const skinSmooth = grading.skin_smooth || 0;\n  const eyeClarity = grading.eye_clarity || 0;\n  const featurePop = grading.feature_pop || 0;\n  const teethWhitening = grading.teeth_whitening || 0;\n\n  for (let i = 0; i < data.length; i += 4) {\n     let r = sourceData[i];\n     let g = sourceData[i+1];\n     let b = sourceData[i+2];\n     \n     const x = (i / 4) % w;\n     const y = Math.floor((i / 4) / w);\n\n     if (needsSpatial) {\n         if (chromaAmt > 0) {\n             const distX = (x - cx) / w;\n             const distY = (y - cy) / h;\n             const distSq = distX*distX + distY*distY;\n             const offset = Math.floor(chromaAmt * distSq * 30); \n             \n             if (offset > 0) {\n                 const rIdx = i - offset * 4;\n                 const bIdx = i + offset * 4;\n                 if (rIdx >= 0 && rIdx < sourceData.length) r = sourceData[rIdx];\n                 if (bIdx >= 0 && bIdx < sourceData.length) b = sourceData[bIdx + 2];\n             }\n         }\n\n         if (x > 1 && x < w - 2 && y > 1 && y < h - 2) {\n             const up = i - w * 4, down = i + w * 4, left = i - 4, right = i + 4;\n             const avgR = (sourceData[up] + sourceData[down] + sourceData[left] + sourceData[right] + r) * 0.2;\n             const avgG = (sourceData[up+1] + sourceData[down+1] + sourceData[left+1] + sourceData[right+1] + g) * 0.2;\n             const avgB = (sourceData[up+2] + sourceData[down+2] + sourceData[left+2] + sourceData[right+2] + b) * 0.2;\n             const hpR = r - avgR; const hpG = g - avgG; const hpB = b - avgB;\n             \n             if (sharpenAmt > 0 || featurePop > 0) {\n                 const boost = sharpenAmt + (featurePop * 2.5);\n                 r += hpR * boost; g += hpG * boost; b += hpB * boost;\n             }\n             if (clarityAmt !== 0) {\n                 r += hpR * clarityAmt * 0.8;\n                 g += hpG * clarityAmt * 0.8;\n                 b += hpB * clarityAmt * 0.8;\n             }\n             if (skinSmooth > 0 || grading.denoise > 0) {\n                 const isSkin = (r > g && g > b && r > 40 && Math.abs(r-g) > 5);\n                 const blurStrength = isSkin ? Math.max(grading.denoise, skinSmooth) : grading.denoise;\n                 if (blurStrength > 0) {\n                    const mix = blurStrength * 0.75; \n                    r = r * (1 - mix) + avgR * mix;\n                    g = g * (1 - mix) + avgG * mix;\n                    b = b * (1 - mix) + avgB * mix;\n                 }\n             }\n             \n             const lumaPixel = 0.2126*r + 0.7152*g + 0.0722*b;\n             if (teethWhitening > 0 && lumaPixel > 80) { \n                 const max = Math.max(r,g,b);\n                 const min = Math.min(r,g,b);\n                 const sat = (max - min) / (max || 1);\n                 if (sat < 0.5 && r > b && g > b) {\n                     const wStr = teethWhitening * 0.8;\n                     r = Math.min(255, r + 50 * wStr);\n                     g = Math.min(255, g + 50 * wStr);\n                     b = Math.min(255, b + 70 * wStr); \n                     const gray = (r+g+b)/3;\n                     r = r * (1 - wStr*0.5) + gray * wStr*0.5;\n                     g = g * (1 - wStr*0.5) + gray * wStr*0.5;\n                     b = b * (1 - wStr*0.5) + gray * wStr*0.5;\n                 }\n             }\n\n             if (eyeClarity > 0 && lumaPixel > 160 && lumaPixel < 250) {\n                r += hpR * eyeClarity * 5;\n                g += hpG * eyeClarity * 5;\n                b += hpB * eyeClarity * 5;\n             }\n         }\n     }\n\n     const ir = r, ig = g, ib = b;\n     r = ir * mRR + ig * mRG + ib * mRB;\n     g = ir * mGR + ig * mGG + ib * mGB;\n     b = ir * mBR + ig * mBG + ib * mBB;\n     r += tempK; b -= tempK; g += tintM;\n\n     let nr = r / 255; let ng = g / 255; let nb = b / 255;\n     \n     // Dehaze\n     if (dehazeVal !== 0) {\n         const minC = Math.min(nr, ng, nb);\n         const dehazeFactor = dehazeVal * 0.3;\n         nr = (nr - minC * dehazeFactor) / (1 - dehazeFactor);\n         ng = (ng - minC * dehazeFactor) / (1 - dehazeFactor);\n         nb = (nb - minC * dehazeFactor) / (1 - dehazeFactor);\n     }\n\n     // Exposure / Brightness / Contrast\n     nr *= exposure; ng *= exposure; nb *= exposure;\n     nr = (nr - pivot) * contrast + pivot + (brightness - 1);\n     ng = (ng - pivot) * contrast + pivot + (brightness - 1);\n     nb = (nb - pivot) * contrast + pivot + (brightness - 1);\n\n     // LGG Application with GLOBAL + PER-CHANNEL Logic\n     const applyLGG = (c: number, lift: number, gam: number, gain: number, off: number) => {\n         // Lift: (Color * (1-Lift) + Lift)\n         let val = c * (1 - lift) + lift + off; \n         // Gain: Scale\n         val *= gain;\n         // Gamma: Power\n         if (val > 0) val = Math.pow(val, 1 / Math.max(0.01, gam));\n         return val;\n     };\n\n     // Combine Global values with Channel values\n     // Note: Lift is additive/interpolation, Gain is multiplicative, Gamma is multiplicative\n     nr = applyLGG(nr, \n        globalLift + (grading.lift_r || 0), \n        globalGamma * (grading.gamma_r || 1), \n        globalGain * (grading.gain_r || 1), \n        globalOffset + (grading.offset_r || 0)\n     );\n     ng = applyLGG(ng, \n        globalLift + (grading.lift_g || 0), \n        globalGamma * (grading.gamma_g || 1), \n        globalGain * (grading.gain_g || 1), \n        globalOffset + (grading.offset_g || 0)\n     );\n     nb = applyLGG(nb, \n        globalLift + (grading.lift_b || 0), \n        globalGamma * (grading.gamma_b || 1), \n        globalGain * (grading.gain_b || 1), \n        globalOffset + (grading.offset_b || 0)\n     );\n\n     const luma = 0.2126*nr + 0.7152*ng + 0.0722*nb;\n     \n     // Split Toning\n     if (grading.split_shadow_sat > 0 || grading.split_highlight_sat > 0 || grading.split_mid_sat > 0) {\n         const bal = grading.split_balance || 0;\n         const sMask = Math.max(0, 1 - (luma * 2) + bal);\n         const hMask = Math.max(0, (luma - 0.5 - bal) * 2);\n         const mMask = 1 - sMask - hMask;\n\n         if (sMask > 0 && grading.split_shadow_sat > 0) {\n             const str = sMask * grading.split_shadow_sat * 0.3;\n             nr += (shadowRGB[0]/255 - nr) * str;\n             ng += (shadowRGB[1]/255 - ng) * str;\n             nb += (shadowRGB[2]/255 - nb) * str;\n         }\n         if (hMask > 0 && grading.split_highlight_sat > 0) {\n             const str = hMask * grading.split_highlight_sat * 0.3;\n             nr += (highlightRGB[0]/255 - nr) * str;\n             ng += (highlightRGB[1]/255 - ng) * str;\n             nb += (highlightRGB[2]/255 - nb) * str;\n         }\n         if (mMask > 0 && grading.split_mid_sat > 0) {\n             const str = mMask * grading.split_mid_sat * 0.3;\n             nr += (midRGB[0]/255 - nr) * str;\n             ng += (midRGB[1]/255 - ng) * str;\n             nb += (midRGB[2]/255 - nb) * str;\n         }\n     }\n\n     // HSL Adjustments\n     const max = Math.max(nr, ng, nb);\n     const min = Math.min(nr, ng, nb);\n     const lumHsl = (max + min) / 2;\n     let hue = 0;\n     let s = 0;\n     if (max !== min) {\n         const d = max - min;\n         s = lumHsl > 0.5 ? d / (2 - max - min) : d / (max + min);\n         if (max === nr) hue = (ng - nb) / d + (ng < nb ? 6 : 0);\n         else if (max === ng) hue = (nb - nr) / d + 2;\n         else hue = (nr - ng) / d + 4;\n         hue /= 6;\n     }\n\n     if (vibrance !== 1 || saturation !== 1) {\n         const vibFactor = (vibrance - 1) * (1 - s * 2); \n         const totalSat = saturation + vibFactor;\n         if (s > 0) {\n             nr = lumHsl + (nr - lumHsl) * totalSat;\n             ng = lumHsl + (ng - lumHsl) * totalSat;\n             nb = lumHsl + (nb - lumHsl) * totalSat;\n         }\n     }\n\n     const getSatBoost = (targetH: number, width: number, boost: number) => {\n         if (!boost) return 0;\n         let diff = Math.abs(hue - targetH);\n         if (diff > 0.5) diff = 1 - diff;\n         if (diff < width) return boost * (1 - diff/width);\n         return 0;\n     };\n\n     let boost = 0;\n     boost += getSatBoost(0, 0.08, grading.sat_red || 0);\n     boost += getSatBoost(0.08, 0.08, grading.sat_orange || 0);\n     boost += getSatBoost(0.16, 0.12, grading.sat_yellow || 0);\n     boost += getSatBoost(0.33, 0.15, grading.sat_green || 0);\n     boost += getSatBoost(0.5, 0.15, grading.sat_cyan || 0);\n     boost += getSatBoost(0.66, 0.15, grading.sat_blue || 0);\n     boost += getSatBoost(0.78, 0.1, grading.sat_purple || 0);\n     boost += getSatBoost(0.9, 0.1, grading.sat_magenta || 0);\n\n     if (boost !== 0 && s > 0) {\n         nr = lumHsl + (nr - lumHsl) * (1 + boost);\n         ng = lumHsl + (ng - lumHsl) * (1 + boost);\n         nb = lumHsl + (nb - lumHsl) * (1 + boost);\n     }\n\n     // Selective Color (Sin City)\n     if (grading.selective_mix > 0) {\n         const targetH = (grading.selective_hue || 0) / 360;\n         const thresh = (grading.selective_threshold || 20) / 360;\n         let diff = Math.abs(hue - targetH);\n         if (diff > 0.5) diff = 1 - diff;\n         let mask = diff < thresh ? Math.pow(1 - (diff / thresh), 0.5) : 0;\n         const bgSatMult = 1 - grading.selective_mix; \n         const finalMult = bgSatMult + (1 - bgSatMult) * mask;\n         nr = lumHsl + (nr - lumHsl) * finalMult;\n         ng = lumHsl + (ng - lumHsl) * finalMult;\n         nb = lumHsl + (nb - lumHsl) * finalMult;\n         if (mask > 0 && grading.selective_target_sat) {\n             const bst = mask * grading.selective_target_sat;\n             nr = lumHsl + (nr - lumHsl) * (1 + bst);\n             ng = lumHsl + (ng - lumHsl) * (1 + bst);\n             nb = lumHsl + (nb - lumHsl) * (1 + bst);\n         }\n     }\n\n     // Film Grain\n     if (grainAmt > 0) {\n         const noise = (Math.random() - 0.5) * (grainAmt / 255);\n         const grainMask = 1 - Math.pow(2 * lumHsl - 1, 4); \n         const finalNoise = noise * grainMask;\n         if (grading.grain_color) {\n             nr += finalNoise * (1 + Math.random()*0.5);\n             ng += finalNoise * (1 + Math.random()*0.5);\n             nb += finalNoise * (1 + Math.random()*0.5);\n         } else {\n             nr += finalNoise; ng += finalNoise; nb += finalNoise;\n         }\n     }\n\n     data[i] = Math.min(255, Math.max(0, nr * 255));\n     data[i+1] = Math.min(255, Math.max(0, ng * 255));\n     data[i+2] = Math.min(255, Math.max(0, nb * 255));\n  }\n  \n  ctx.putImageData(imageData, 0, 0);\n\n  // Post-Process Effects (Halation, Bloom, etc)\n  if (grading.halation && grading.halation > 0) {\n      ctx.save();\n      ctx.globalCompositeOperation = 'lighten';\n      ctx.filter = `blur(${4 + (grading.halation_radius||0)}px)`;\n      ctx.globalAlpha = grading.halation;\n      ctx.drawImage(canvas, 0, 0);\n      ctx.fillStyle = 'rgba(255, 0, 0, 0.1)'; \n      ctx.globalCompositeOperation = 'source-atop';\n      ctx.fillRect(0, 0, w, h);\n      ctx.restore();\n  }\n\n  if (grading.bloom && grading.bloom > 0) {\n      ctx.save();\n      ctx.filter = `blur(${10 + (grading.bloom_radius||0)*20}px) brightness(${1 + grading.bloom})`;\n      ctx.globalCompositeOperation = 'screen';\n      ctx.globalAlpha = grading.bloom * 0.5;\n      ctx.drawImage(canvas, 0, 0);\n      ctx.restore();\n  }\n\n  if (grading.diffusion && grading.diffusion > 0) {\n      ctx.save();\n      ctx.filter = `blur(${20}px)`; \n      ctx.globalCompositeOperation = 'lighten';\n      ctx.globalAlpha = grading.diffusion * 0.3;\n      ctx.drawImage(canvas, 0, 0);\n      ctx.restore();\n  }\n\n  if (grading.vignette && grading.vignette > 0) {\n      ctx.save();\n      ctx.globalCompositeOperation = 'multiply';\n      const feather = grading.vignette_feather ?? 0.5;\n      const roundness = grading.vignette_roundness ?? 0;\n      const vCanvas = document.createElement('canvas');\n      vCanvas.width = w; vCanvas.height = h;\n      const vCtx = vCanvas.getContext('2d');\n      if (vCtx) {\n          vCtx.fillStyle = `rgba(0,0,0,${grading.vignette})`;\n          vCtx.fillRect(0, 0, w, h);\n          vCtx.globalCompositeOperation = 'destination-out';\n          vCtx.beginPath();\n          const rx = w/2 * (0.8 - (1-Math.abs(roundness))*0.3); \n          const ry = h/2 * (0.8 - (1-Math.abs(roundness))*0.3); \n          if (roundness >= 0) {\n             vCtx.ellipse(cx, cy, rx, ry, 0, 0, 2 * Math.PI);\n          } else {\n             const rr = Math.min(rx, ry) * (1 + roundness); \n             vCtx.roundRect(cx - rx, cy - ry, rx*2, ry*2, Math.max(0, rr));\n          }\n          vCtx.fill();\n      }\n      ctx.filter = `blur(${feather * 60}px)`;\n      ctx.drawImage(vCanvas, 0, 0);\n      ctx.restore();\n  }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1319, "column": 0}, "map": {"version":3,"sources":["file:///home/user/Venus-0.8/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useCallback, Suspense } from 'react';\nimport Header from '../components/layout/Header';\nimport Navigation from '../components/layout/Navigation';\nimport Workspace from '../components/workspace/Workspace';\nimport Vault from '../components/vault/Vault';\nimport ManualNode from '../components/manual/ManualNode';\nimport FusionLab from '../components/fusion/FusionLab';\nimport CinemaLab from '../components/cinema/CinemaLab';\nimport CreationLab from '../components/creation/CreationLab';\nimport GradingLab from '../components/grading/GradingLab';\nimport SettingsLab from '../components/settings/SettingsLab';\nimport DocsLab from '../components/docs/DocsLab';\nimport { VaultItem, AgentStatus, LatentParams, LatentGrading, VisualAnchor, CinemaProject, SubtitleSettings, AppSettings } from '../types';\nimport { getAllNodes, saveNode, deleteNode } from '../dbService';\n\n// --- KERNEL LOG SUPPRESSION PROTOCOL ---\n(function() {\n    const suppressedKeywords = [\n        'gl_context_webgl.cc',\n        'gl_context.cc',\n        'Successfully created a WebGL context',\n        'OpenGL error checking is disabled',\n        'GL version',\n        'NGL_LOG'\n    ];\n\n    const filterConsole = (originalFn: any) => {\n        return function(...args: any[]) {\n            const message = args.join(' ');\n            const shouldSuppress = suppressedKeywords.some(keyword => message.includes(keyword));\n            if (!shouldSuppress) {\n                originalFn.apply(console, args);\n            }\n        };\n    };\n\n    console.log = filterConsole(console.log);\n    console.warn = filterConsole(console.warn);\n    console.info = filterConsole(console.info);\n})();\n\nconst DEFAULT_PARAMS: LatentParams = {\n  z_anatomy: 1.0,\n  z_structure: 1.0, \n  z_lighting: 0.5, \n  z_texture: 0.5,\n  hz_range: 'Standard', \n  structural_fidelity: 1.0, \n  scale_factor: 1.0,\n  auto_tune_active: true,\n  neural_metrics: { \n    loss_mse: 0, \n    ssim_index: 1, \n    tensor_vram: 6.2, \n    iteration_count: 0, \n    consensus_score: 1 \n  }\n};\n\nconst DEFAULT_SUBTITLES: SubtitleSettings = {\n  fontSize: 16,\n  fontColor: '#ffffff',\n  backgroundColor: '#000000',\n  fontFamily: 'Inter',\n  bgOpacity: 0.7,\n  textAlign: 'center',\n  paddingHMult: 1.2,\n  paddingVMult: 1.2,\n  radiusMult: 0.8,\n  marginMult: 2.5\n};\n\nconst DEFAULT_SETTINGS: AppSettings = {\n  googleApiKey: '',\n  pexelsApiKey: '',\n  unsplashAccessKey: '',\n  pixabayApiKey: ''\n};\n\nconst Page: React.FC = () => {\n  const [activeTab, setActiveTab] = useState<'creation' | 'workspace' | 'vault' | 'manual' | 'fusion' | 'cinema' | 'grading' | 'settings' | 'docs'>('creation');\n  const [vaultItems, setVaultItems] = useState<VaultItem[]>([]);\n  const [appSettings, setAppSettings] = useState<AppSettings>(() => {\n    const saved = typeof window !== \"undefined\" ? localStorage.getItem('venus_app_settings') : null;\n    return saved ? JSON.parse(saved) : DEFAULT_SETTINGS;\n  });\n  \n  const [studioPrompt, setStudioPrompt] = useState('');\n  const [studioCurrentImage, setStudioCurrentImage] = useState<string | null>(null);\n  const [studioOriginalSource, setStudioOriginalSource] = useState<string | null>(null);\n  const [studioLogs, setStudioLogs] = useState<AgentStatus[]>([]);\n  const [studioParams, setStudioParams] = useState<LatentParams>({ ...DEFAULT_PARAMS });\n  const [studioGroundingLinks, setStudioGroundingLinks] = useState<{title: string, uri: string}[]>([]);\n  const [studioGrading, setStudioGrading] = useState<LatentGrading | undefined>(undefined);\n  const [studioVisualAnchor, setStudioVisualAnchor] = useState<VisualAnchor | undefined>(undefined);\n  const [isDbLoaded, setIsDbLoaded] = useState(false);\n  const [hasInitError, setHasInitError] = useState(false);\n\n  const [cinemaProject, setCinemaProject] = useState<CinemaProject>({\n    id: typeof window !== \"undefined\" ? crypto.randomUUID() : '',\n    title: 'Venus Documentary',\n    beats: [],\n    audioUrl: null,\n    fps: 30,\n    aspectRatio: '16:9',\n    subtitleSettings: DEFAULT_SUBTITLES\n  });\n  const [cinemaScript, setCinemaScript] = useState('');\n  const [cinemaTitle, setCinemaTitle] = useState('');\n  const [cinemaCredits, setCinemaCredits] = useState('');\n  const [cinemaLogs, setCinemaLogs] = useState<AgentStatus[]>([]);\n  const [cinemaActiveBeatIndex, setCinemaActiveBeatIndex] = useState(0);\n\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem('venus_app_settings', JSON.stringify(appSettings));\n    }\n  }, [appSettings]);\n\n  const fetchVault = useCallback(async () => {\n    try {\n      const items = await getAllNodes();\n      setVaultItems(Array.isArray(items) ? items.sort((a, b) => b.timestamp - a.timestamp) : []);\n    } catch (err) {\n      console.error(\"Critical Database Error:\", err);\n      setVaultItems([]);\n    } finally {\n      setIsDbLoaded(true);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchVault().catch(e => {\n      console.error(\"Init Error\", e);\n      setHasInitError(true);\n    });\n  }, [fetchVault]);\n\n  const handleCreationResult = (imageUrl: string, params: LatentParams, prompt: string, links: any[], grading?: LatentGrading, visualAnchor?: VisualAnchor) => {\n    setStudioCurrentImage(imageUrl);\n    setStudioParams(params);\n    setStudioPrompt(prompt);\n    setStudioGroundingLinks(links);\n    setStudioGrading(grading);\n    setStudioVisualAnchor(visualAnchor);\n    setStudioOriginalSource(null);\n    setActiveTab('workspace');\n  };\n\n  const handleFusionResult = (imageUrl: string, params: LatentParams, logs: any[]) => {\n    setStudioCurrentImage(imageUrl);\n    setStudioParams(params);\n    setStudioLogs(logs);\n    setStudioGrading(undefined);\n    setStudioVisualAnchor(undefined);\n    setActiveTab('workspace');\n  };\n\n  const handleSaveToVault = useCallback(async (item: VaultItem) => {\n    try {\n      await saveNode(item);\n      setVaultItems(prev => {\n        const index = prev.findIndex(i => i.id === item.id);\n        if (index !== -1) {\n          const updated = [...prev];\n          updated[index] = item;\n          return updated;\n        }\n        return [item, ...prev];\n      });\n    } catch (e) {\n      console.error(\"Failed to index node:\", e);\n    }\n  }, []);\n\n  const handleDeleteFromVault = useCallback(async (id: string) => {\n    try {\n      await deleteNode(id);\n      setVaultItems(prev => prev.filter(item => item.id !== id));\n    } catch (e) {\n      console.error(\"Delete failed:\", e);\n    }\n  }, []);\n\n  const handleReloadFromVault = (item: VaultItem) => {\n    setStudioCurrentImage(item.imageUrl);\n    setStudioOriginalSource(item.originalImageUrl);\n    setStudioParams(item.params);\n    setStudioPrompt(item.prompt);\n    setStudioLogs(item.agentHistory || []);\n    setStudioGrading(item.grading);\n    setStudioVisualAnchor(undefined);\n    setActiveTab('workspace');\n  };\n\n  const executeHardReset = useCallback(() => {\n    setStudioPrompt('');\n    setStudioCurrentImage(null);\n    setStudioOriginalSource(null);\n    setStudioLogs([]);\n    setStudioParams({ ...DEFAULT_PARAMS });\n    setStudioGroundingLinks([]);\n    setStudioGrading(undefined);\n    setStudioVisualAnchor(undefined);\n  }, []);\n\n  if (hasInitError) {\n    return (\n      <div className=\"min-h-screen bg-black flex items-center justify-center p-8 text-center\">\n        <div className=\"space-y-4\">\n          <h1 className=\"text-2xl font-black text-white uppercase\">Venus AI Kernel Failure</h1>\n          <p className=\"text-zinc-500 text-sm mono\">Check API configuration environment.</p>\n          <button onClick={() => window.location.reload()} className=\"px-6 py-2 bg-indigo-600 text-white rounded-full font-bold text-xs\">Reload Venus</button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen w-full flex flex-col bg-[#050505] text-zinc-100 overflow-hidden relative selection:bg-indigo-500 selection:text-white\">\n      <Header activeTab={activeTab} setActiveTab={setActiveTab} />\n      <Navigation activeTab={activeTab} setActiveTab={setActiveTab} vaultCount={vaultItems.length} />\n\n      <main className=\"flex-1 overflow-auto bg-[#020202] relative custom-scrollbar\">\n        {!isDbLoaded ? (\n          <div className=\"flex h-full items-center justify-center\">\n             <div className=\"relative\">\n                <div className=\"w-16 h-16 border-4 border-indigo-600/20 rounded-full\" />\n                <div className=\"absolute inset-0 w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin\" />\n             </div>\n          </div>\n        ) : (\n          <Suspense fallback={<div className=\"p-8 text-center text-zinc-500 text-[10px] mono animate-pulse\">LATENT_BUFFER_LOADING...</div>}>\n            <div className=\"pb-28 lg:pb-0 h-full\">\n              {activeTab === 'creation' && (\n                <CreationLab \n                  onResult={handleCreationResult}\n                  params={studioParams}\n                  setParams={setStudioParams}\n                  onReset={executeHardReset}\n                  vault={vaultItems}\n                  settings={appSettings}\n                />\n              )}\n              {activeTab === 'workspace' && (\n                <Workspace \n                  onSave={handleSaveToVault} vault={vaultItems} prompt={studioPrompt} setPrompt={setStudioPrompt}\n                  currentImage={studioCurrentImage} setCurrentImage={setStudioCurrentImage} \n                  originalSource={studioOriginalSource} setOriginalSource={setStudioOriginalSource}\n                  logs={studioLogs} setLogs={setStudioLogs} params={studioParams} setParams={setStudioParams}\n                  onReloadApp={executeHardReset} grading={studioGrading} visualAnchor={studioVisualAnchor}\n                  settings={appSettings}\n                />\n              )}\n              {activeTab === 'grading' && <GradingLab vault={vaultItems} onSave={handleSaveToVault} />}\n              {activeTab === 'cinema' && (\n                <CinemaLab \n                  vault={vaultItems} \n                  onSave={handleSaveToVault} \n                  currentSourceImage={studioCurrentImage}\n                  project={cinemaProject}\n                  setProject={setCinemaProject}\n                  script={cinemaScript}\n                  setScript={setCinemaScript}\n                  title={cinemaTitle}\n                  setTitle={setCinemaTitle}\n                  credits={cinemaCredits}\n                  setCredits={setCinemaCredits}\n                  logs={cinemaLogs}\n                  setLogs={setCinemaLogs}\n                  activeBeatIndex={cinemaActiveBeatIndex}\n                  setActiveBeatIndex={setCinemaActiveBeatIndex}\n                  onReset={() => {}}\n                  settings={appSettings}\n                />\n              )}\n              {activeTab === 'fusion' && <FusionLab vault={vaultItems} onResult={handleFusionResult} settings={appSettings} />}\n              {activeTab === 'manual' && <ManualNode onSave={handleSaveToVault} settings={appSettings} />}\n              {activeTab === 'vault' && <Vault items={vaultItems} onDelete={handleDeleteFromVault} onClearAll={() => {}} onRefresh={fetchVault} onReload={handleReloadFromVault} />}\n              {activeTab === 'docs' && <DocsLab />}\n              {activeTab === 'settings' && <SettingsLab settings={appSettings} setSettings={setAppSettings} />}\n            </div>\n          </Suspense>\n        )}\n      </main>\n    </div>\n  );\n};\n\nexport default Page;"],"names":[],"mappings":"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"}}]
}